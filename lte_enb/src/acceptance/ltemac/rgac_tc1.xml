#/************************************************************************
#     Name:     LTE-MAC Test Cases
#  
#     Type:     XML Script
#  
#     Desc:     XML source for LTE MAC Test Case
#     
#     File:     rgac_tc16.xml 
#  
#     Sid:      
#  
#     Prg:      ns
#**********************************************************************/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=16:sm:rgac_tc16.xml

#
#
#       Test:    1.1
#
#       Desc:   "To test the successful C-RNTI based contention resolution" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.1" altid="3.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of C-RNTI based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Ue sends a C-RNTI control element in Msg3 and gets an uplink grant
through random access"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>
      # rg005.201 Removing debug prints
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.crg.cfgcfm/>
        <tapa.rgr.cfgCfm instId="5"/>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      <tapa.expset>
         <tapa.rgr.uestaind />
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      # and Data reception request for the UL grant sent for contention
      # resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Expect data reception request for Msg3 Re-Tx (ueId=1).
      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for UL data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For UL data 
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # At start of this step, we are at (1,9)
      # Send 3 TTIs to check if the are no pending msgs at MAC 
      # At 4th TTI, there will be a data reception request pending for the 
      # reported short BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.2
#
#       Desc:   "To test multiple simultaneous random access procedures"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.2" altid="3.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of multiple simultaneous random access procedures
         for multiple rapIds"
      </tapa.desc>

      <tapa.longdesc>
         "4 RAPIDs in one random access request indication shall be handled"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>
      # Cell Configuration
      <tapa.rg.cellInit size="2" numSubbands="24" ulTotalBw="60"/>
      # Ue Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Configure a DTCH for the UE
      <tapa.send >
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a DTCH for the UE
      <tapa.send >
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send >
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send 1 tti for applying configuration
      <tapa.send >
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send RaReqInd for one rapId 
      <tapa.send lc="TRUE">
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="4" rapIds="18:56:35:43"
               timingAdvs="2:3:4:5" tpcs="1:2:3:4" cqiPres="TRUE:TRUE:TRUE:TRUE"
               cqis="2:3:4:1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      # Expect confirm for logical channel
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" expectAll="TRUE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="4">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="2"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="3"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="4"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="4" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="4" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # Send CCCH SDU
      # Send CRNTI MAC CE with valid CRNTI
      # Send CRNTI MAC CE with invalid CRNTI
      # Send CCCH SDU
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="4">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="1"/>
          <tapa.tfu.dat crnti="0" ueId="2" addCrnti="TRUE" />
          <tapa.tfu.dat invldCrnti="TRUE" ueId="3" addCrnti="TRUE"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="4" lcId="4"/>
      </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send 1 TTI to process Msg3 data indication
      # And for scheduling of grant for the CRNTI based contention resolution.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0 for ueId=3.
      <tapa.expset>
         <tapa.rgr.uestaind />
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="4"/>
      </tapa.send>


      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4" ueId="1"/>
         <tapa.rgu.cstaind lcId="4" ueId="4"/>
      </tapa.expset>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="4" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # chk ueId Expect Msg4 from MAC to PHY
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="3" validate="TRUE" chkCcchSh="TRUE" ueId="1"/>
           <tapa.tfu.pdsch.dat.req use="4" validate="TRUE" chkCcchSh="TRUE" ueId="4"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5).
      # Expect data reception request for MSG3 re-transmission.
      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="5">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2">
           <tapa.tfu.hq.recp.req ueId="1"/>
           <tapa.tfu.hq.recp.req ueId="4"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,8)
      # Send 1 TTIs = (TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
     <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtGrant="TRUE"
            vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4 for ueId=1 
      # Send NACK as feedback for Msg4 for ueId=4 
      <tapa.send lc="TRUE">
        <tapa.tfu.hq.ind hqInds="2">
           <tapa.tfu.hq ueId="1"/>
           <tapa.tfu.hq ueId="4" isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (2,1)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send lc="TRUE">
         <tapa.crg.cfgreq.cfg.ue ueId="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.crg.cfgreq.cfg.ue ueId="2"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.crg.cfgreq.cfg.ue ueId="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.crg.cfgreq.cfg.ue ueId="4"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgr.cfgreq.cfg.ue ueId="4" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send TTI to apply the config
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

# At start of this step, we are at (2,2)
      # Expecting a pdcch request and data request for MSG4 re-transmission for
      # ueID=4.
      # Expect success in cfg cfm for ueId=1 and ueId=4(CCCH SDU based)
      # Expect failure in cfg cfm for ueId=2 and ueId=3
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE" ueId="4"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="4"/>
        </tapa.tfu.cntrl.req>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.3
#
#       Desc:    To test PDCCH Order generation for an Idle Ue. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.3" altid="3.17">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test PDCCH Order generation for an Idle Ue." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for an Idle Ue.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

      # UE configuration
      <tapa.rg.UeInit taTmrPres="TRUE" taTmr="40" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      # Send BO for the created logical channel on RGU to trigger a PO. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="10"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Apply GAP number of TTI before indicating a RaReq
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #  send an authorized raReq. Processing this, MAC shall
      # free the rapId to UE association and further raReq with
      # this rapId without a PDCCH Order shall be discarded by MAC.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="11"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #  send an UNauthorized raReq.
      # verify this is discarded, as no rarsp is generated.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # expect a recp req for this UE.
    <tapa.expect>
       <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.msg3.recp.req/>
       </tapa.tfu.recp.req>
    </tapa.expect>
   <!--
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req ueId="0" vldtDatRecp="TRUE"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
   -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown> 

</tapa.testcase>


#
#
#       Test:    1.4
#
#       Desc:    To test successful handover scenario. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.4" altid="3.20">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful handover scenario." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for an Idle Ue.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49.
         Configure a HO Ue with dedPreamble Id as 50"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue cellId="3"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request with rnti not belonging to the configured rnti pool of SCH 
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
      </tapa.send>


      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # send raReq with the alloted rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="50"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      # send raReq with the alloted rapId again
      # The retransmission of RAP ID is possible if RAR detection is not sucessful.
      # Hence The RAP ID is honoured.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="50"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.5
#
#       Desc:    To test unauthorized use of dedicated preambles, with in a Basic HO case. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.5" altid="3.22">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test unauthorized use of dedicated preambles, with in a Basic HO case." 
      </tapa.desc>

      <tapa.longdesc>
         "To test unauthorized use of dedicated preambles.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49.
         Configure a HO Ue with dedPreamble Id as 50"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue cellId="3"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request with rnti belonging to the configured rnti pool of SCH 
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
      </tapa.send>


      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #verify unauthorized use of RapId would result in MAC discarding the raReq
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="63"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      #verify no ra Rsp is generated for rapId=63 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #verify unauthorized use of RapId would result in MAC discarding the raReq
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      #verify no ra Rsp is generated for rapId=30 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # send raReq with the alloted rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="50"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      # send raReq with the alloted rapId again
      # verify that rapId-ue association is cleared in the 
      # previous raReqInd processing and that this is not honoured.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="50"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.6
#
#       Desc:    To test SC1 DL Scheduler for AMBR and GBR SVCs
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.6"  altid="7.10">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SC1 DL Scheduler for AMBR and GBR SVCs "
      </tapa.desc>

      <tapa.longdesc>
         "Configure 8 Ues, first four with 1 GBR svc each and the next four with 1 AMBR svc each. GBR is sufficient and same (say 200). So is AMBR. Report BO for GBR SVCs are 50, 40,30,20 and follow the same for each AMBR svc. Verify the order of scheduling to be UE1,2,3,4,5,6,7,8. Now again send the staRsps, now reversing the BO. (i.e now UE1-svc shud be updated with 20). Verify the scheduling order this time to be UE4,3,2,1,8,7,6,5."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched2 ulSchdType="0"  dlSchdType="0"/>

      #Do RACH and UE Config
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>
      <tapa.rg.UeInit.grp16 ueId="2"/>
      <tapa.rg.UeInit.grp16 ueId="3"/>
      <tapa.rg.UeInit.grp16 ueId="4"/>
      <tapa.rg.UeInit.grp16 ueId="5"/>
      <tapa.rg.UeInit.grp16 ueId="6"/>
      <tapa.rg.UeInit.grp16 ueId="7"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
  <tapa.send>
     <tapa.tfu.dlcqi.ind>
         <tapa.tfu.dlcqi  ueId="0" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="1" wbCqi="15" isPucchInfo="FALSE" cqiMode="1"/>
         <tapa.tfu.dlcqi  ueId="2" isPucchInfo="FALSE" cqiMode="3" wbCqi="15"
            numOfSubbands="0"/>
         <tapa.tfu.dlcqi  ueId="3" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="4" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="5" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="6" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="7" cqiIdx="15"/>
     </tapa.tfu.dlcqi.ind>
  </tapa.send>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="4" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="5" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="6" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="7" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>



      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="300"  dlMbr="2000"
         instId="5"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300" instId="5"  dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="2" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="3" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="4" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="5" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="6" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="7" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="20"/>
      </tapa.send>
      

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
      
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="1" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="2" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="3" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="4" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="5" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="6" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="7" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      ##########################################################     
      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="50"/>
      </tapa.send>
      

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

     ######################################################################
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0"/>
         <tapa.tfu.hq  ueId="1"/>
         <tapa.tfu.hq  ueId="2"/>
         <tapa.tfu.hq  ueId="3"/>
         <tapa.tfu.hq  ueId="4"/>
         <tapa.tfu.hq  ueId="5"/>
         <tapa.tfu.hq  ueId="6"/>
         <tapa.tfu.hq  ueId="7"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

    
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.7
#
#       Desc:    To verify that UEs with non-lcg0 bs are satisfied in the descending order of 
#                their effbs values, where effBs=MIN(ueBr, nonLcg0Bs). ueBr values are configured 
#                such that nonLcg0Bs value provided are much greater than corresponding ueBr values.
#                In this case the UEs selection for scheduling shall be solely on the basis of ueBr.
#
#       Notes:   None
#              
#       Module:  SC1 scheduler
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.7" altid="7.25">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To verify that UEs with non-lcg0 bs are satisfied in the descending order of 
          their effbs values, where effBs=MIN(ueBr, nonLcg0Bs). ueBr values are configured 
          such that nonLcg0Bs value provided are much greater than corresponding ueBr values.
          In this case the UEs selection for scheduling shall be solely on the basis of ueBr."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="1000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="2000"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueBr="3000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="42"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="41"/>
           <tapa.tfu.dat ueId="2" use="6" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="40"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
     # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # verify grnt is recieved for UEs in descending order of ueBr amount
      # with BW constraint restricdting grnt allocation to only 2 UEs
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.8
#
#       Desc:    To verify that UEs with lcg0Bs are given higher priority by scheduler
#                compared to UEs with nonLcg0Bs. Provide more optimal conditions for UE with
#                nonlcg0Bs than the lcg0bs Ue. Verify that irrespective of any QOS or BSR value,
#                lcg0Bs Ue is scheduled first by the scheduler.
#
#       Notes:   None
#              
#       Module:  SC1 scheduler
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.8" altid="7.26">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To verify that UEs with lcg0Bs are given higher priority by scheduler
          compared to UEs with nonLcg0Bs. Provide more optimal conditions for UE with
          nonlcg0Bs than the lcg0bs Ue. Verify that irrespective of any QOS or BSR value,
          lcg0Bs Ue is scheduled first by the scheduler."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="6000" ueCatEnum="4"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="1000" ueCatEnum="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #Indicate higher BSR to UE0.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="42"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="0" bsr="41"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # verify grnt is recieved only for lcg0Bs Ue i.e UE1
      # with BW constraint restricdting grnt allocation to only 1 UE
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.9
#
#       Desc:    Harq retransmissions when no feedback comes from PHY
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.9" altid="6.3">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of HARQ ACK" 
      </tapa.desc>

      <tapa.longdesc>
         "Testing that MAC downlink HARQ handles absence of explit HARQ
         acknowledgement from PHY, and stops retransmissions when max number
         of downlink harq tx is exhausted."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE configuration
      <tapa.rg.UeInit.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2" TTI="100"/>
      </tapa.send> 

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="FALSEE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send a tti (to get a Harq failure indication)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.10
#
#       Desc:    To test that a UE has 8 harq processes in DL
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.10" altId="6.5">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test that a UE has 8 harq processes in DL"
      </tapa.desc>

      <tapa.longdesc>
         "Send data to schedule all the 8 harq processes and still send new data,
          without sending any feedback and check for retransmission 
          as there is no harq process left for new transmission"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE configuration
      <tapa.rg.UeInit.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>
     
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>
     
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for first harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="1"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU for second harq
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for second harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
         # Expect PDU from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req lcId="9" use="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU for third harq
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for third harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="3"/>
         # Expect PDU from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req lcId="9" use="2" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU for fourth harq
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for fourth harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="4"/>
         # Expect PDU from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req lcId="9" use="3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req  saveTo="3" chkTransId="3"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU for fifth harq
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for fifth harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="5"/>
         # Expect PDU from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req chkSdu="TRUE" lcId="9" use="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req chkTransId="4" saveTo="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU for sixth harq
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for sixth harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="6"/>
         # Expect PDU from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req chkSdu="TRUE" lcId="9" use="5"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req chkTransId="5" saveTo="5"/>
        </tapa.tfu.cntrl.req>
         # HARQ-ACK for the first data sent out is expected here
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU for seventh harq
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for seventh harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="7"/>
         # Expect PDU from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req chkSdu="TRUE" lcId="9" use="6"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req chkTransId="6" saveTo="6"/>
        </tapa.tfu.cntrl.req>
         # HARQ-ACK for the first data sent out is expected here
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU for eighth harq
         # process. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Step 34
         # Expect staInd from MAC to RLC for eighth harq process 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="8"/>
         # Expect PDU from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req chkSdu="TRUE" lcId="9" use="7"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req chkTransId="7" saveTo="7"/>
        </tapa.tfu.cntrl.req>
         # HARQ-ACK for the first data sent out is expected here
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Step 37
         # Expect PDU from and harqRecpReq MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req chkSdu="TRUE" lcId="9" use="8"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req chkTransId="8" saveTo="8"/>
        </tapa.tfu.cntrl.req>
         # HARQ-ACK for the first data sent out is expected here
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU
         # without sending any feedback (while all harq processes
         # are busy)
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to schedule. Note that no StaInd is expected,
         # indicating that no fresh allocation occurs.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a Tti to retransmit the data.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # First Harq process needs to be picked up for retransmission
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req chkSdu="TRUE" lcId="9" use="9"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" use="1" vldtRetx="TRUE" vldtHqId="TRUE"/>
        </tapa.tfu.cntrl.req>
         # HARQ-ACK for the first data sent out is expected here
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.11
#
#       Desc:    To validate if 8 uplink HARQ processes are supported at MAC
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.11" altid="5.2">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate if 8 uplink HARQ processes are supported at MAC"
      </tapa.desc>

      <tapa.longdesc>
         "Send BSR that spans 8 TTIs and check that retransmission happens as no
data is sent"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 maxUlHqTx="4" ueBr="4000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="55"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

       # Send first TTI to schedule the BSR sent
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect HARQ ACK in PHICH
      </tapa.expset>
      
      # Send second TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
    
      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # DatInd that should go in this TTI is not sent

      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="6" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
         # expecting adaptive retx grant
      #  <tapa.tfu.cntrl.req numCntrlReq="1">
      #     <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtRetx="TRUE" saveTo="9" vldtGrant="TRUE"/>
      #  </tapa.tfu.cntrl.req>
      # rg006.201: ccpu00111742: Sending NACK in PHICH for failed UL TX 
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send tenth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="7" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
         # expecting adaptive retx grant
      #  <tapa.tfu.cntrl.req numCntrlReq="1">
      #     <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtRetx="TRUE" saveTo="9" vldtGrant="TRUE"/>
      #  </tapa.tfu.cntrl.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.12
#
#       Desc:    To validate re-transmissions for single UE till maximum number
#                of transmissions are reached
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.12" altid="5.4">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate re-transmissions for single UE till maximum number
          of transmissions are reached"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE with maximum HARQ transmissions = 4
      <tapa.rg.UeInit.grp16 maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req vldtGrant="TRUE" isUlGrant="TRUE" vldtTx="TRUE"  saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect first data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" vldtRv="0" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit  + TFU_UL_DELTA(=1)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # do not send CRC after 3 ttis

      # Send a TTI to expect HarqAckReq (4 (for fdbk to go from PHY) - TFU_DELTA
      # (=2) - 1 (elapsed as TFU_UL_DELTA)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" TTI="600"/>
      </tapa.send>

     # Expect data reception request
      <tapa.expset>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expset>

     
<!--
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
-->

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" TTI="200"/>
      </tapa.send>
   



      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>




      </tapa.expect>

      # Do not expect fifth data reception req as maxHqTx configured=4
      # Send an additional TTI to ensure that datRecpReq has not come
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    1.13
#
#       Desc:    To test UE reset at both CRG and RGR Interface with Data Path
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="1.13" altId="2.37">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test UE reset at CRG/RGR interface with Data Path
      </tapa.desc>

      <tapa.longdesc>
         "Create a CELL at CRG and RGR Interface and then create UE at CRG and
         RGR interface and start Downlink Data Path and then Send UE Reset 
         Request(RRC Re-establishment) at CRG/RGR interfaces after Status Indication from MAC"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueCatEnum="1" ulAmbr="1024"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="1024"/>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>
      
      # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
     
      # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="FALSE" />
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Added this since CRG UE Reset is dummy which is not clearing UE's HARQ 
      #Proc after reset
      <tapa.expect>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId='0' validate="TRUE" />
        </tapa.tfu.dat.req>
      </tapa.expect>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send re-configuration disabling SPS in downlink
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0" 
           oldcrnti="11" newUeId="1" newcrnti="12"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="100"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId='1' validate="TRUE" chkCcchSh="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId='1'/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req ueId='1'/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
          <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp ueId="1" lcId="1" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="1" />
      </tapa.expect>
      
      <tapa.send lc="TRUE">
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="1" lcType="5"/>
      </tapa.send>
 
      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  ueId="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Request to ShutDown LTEMAC
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    1.14
#
#       Desc:    To test UE reset at both CRG and RGR Interface with Data Path
#
#       Notes:   None
#              
#       Module:  Configuration/Reset 
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.14" altId="2.38">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To test UE reset at CRG/RGR interface with Data Path
      </tapa.desc>

      <tapa.longdesc>
         "Create a CELL at CRG and RGR Interface and then create UE at CRG and
         RGR interface and start Uplink Data Path and then Send UE Reset 
         Request at CRG/RGR interfaces after Status Indication from MAC"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      # Send UE Reset request for the default Ue at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With default Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
     
      # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="FALSE" />
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

     # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
     # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

     # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send re-configuration disabling SPS in downlink
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0"
           oldcrnti="11" newUeId="1" newcrnti="12"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      # Send UE ReConfiguration for the same UE created above for change in RNTI
       <tapa.send>
            <tapa.crg.cfgreq.recfg.ue cellId="3" oldUeId="0" newUeId="1"
              UeReCfgType="64"/>
       </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
       <tapa.expect>
            <tapa.crg.cfgcfm/>
       </tapa.expect>
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="100"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId='1' validate="TRUE" chkCcchSh="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId='1'/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req ueId='1'/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
          <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send a TTI to schedule SR, As UE is reset above we should not get pdcch
      # request after this TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Yes we didn't get pdcch request so Send SR Indication for default UE
      # again for normal UL call flow
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
     
     # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # In normal call flow we send 4 TTI's to get pusch recp req at TFU, But now
      # send 3 TTI's and then send UE Reset for default UE at RGR and CRG.
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # Send UE Reset request for the default Ue at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="1" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With default Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="1" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>

      # Now send one more TTI now we shouldn't get pusch recp req at TFU as we
      # reset UE above 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # send extra TTIs to verify nothing scheduled/signalled here after 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    1.15
#
#       Desc:    To test Validation of CRG CELL Configuration parameters
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="1.15" altId="2.10">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Validation of CRG CELL Configuration parameters"
      </tapa.desc>

      <tapa.longdesc>
         "This will send CRG/RGR CELL configuration to validate the different
         parameteres of CELL configuration"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration for Validation dlTotalBw and ulTotalBw
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell  cellId="3"  dlTotalBw="0" ulTotalBw="0"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      
      #Send CRG Cell Configuration for Validation dlTotalBw and ulTotalBw
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell  cellId="3"  dlTotalBw="6" ulTotalBw="0"/>
      </tapa.send>
      #Expect Negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      #Send CRG Cell Configuration for Validation dlTotalBw and ulTotalBw
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell  cellId="3"  dlTotalBw="6" ulTotalBw="111"/>
      </tapa.send>
      #Expect Negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      RGR Cell Validation Starts from here 
      #Send RGR Cell configuration for invalid maxDlHqTx
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" maxDlHqTx="0" maxMsg4HqTx="0"/>
      </tapa.send>
      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UnBind Request to SCH SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq elmntType="STGEN" action="ASHUTDOWN"/>
      </tapa.send>
      
      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.ubndreq spId="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm/>
      </tapa.expect>

      #Send Control Request to LTEMAC for ShutDown 
      <tapa.send>
         <tapa.lrg.cntrlreq action="ASHUTDOWN" elmntType="STGEN" />
      </tapa.send>

      # Expect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    1.16
#
#       Desc:    To test Validation of CRG UE Configuration parameters
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="1.16" altId="2.11">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Validation of CRG UE Configuration parameters"
      </tapa.desc>

      <tapa.longdesc>
         " Finish Cell Initialization and RACH and send UE config request to
         test validation for each parameter seperately"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>

      #Initialize
      <tapa.rg.cellInit/>

      #Finish RACH 
      <tapa.rg.rach.grp16/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      # Send UE config request with inavlid Cell Id
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue cellId="4"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
        <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      
      # Send UE config request with inavlid max Uplink Harq Tx
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue maxUlHqTx="0"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
        <tapa.crg.cfgcfm status="15"/>
     </tapa.expect>

     # Send UE config request with inavlid Cell Id at RGR
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="4"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send UE config request with inavlid rnti at RGR
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="5"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send UE config request with inavlid ackNackRepFactor at RGR
      <tapa.send>
       /*rg003.301[ccpu00121749] -ADD-Validating ACK/NACK is Enabled */ 
        <tapa.rgr.cfgreq.cfg.ue instId="5" isMesGapEnabled="FALSE" ueId="0" isAckNackEnabled="TRUE" ackNackRepFactor="RGAC_ACKNACK_REPFACT_N2_ERR"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send UE config request with inavlid gapOffst at RGR
      <tapa.send>
      /*rg003.301[ccpu00121749] -ADD-Validating ACK/NACK is Enabled */ 
        <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="40"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request with inavlid gapOffst at RGR
      <tapa.send>
      /*rg003.301[ccpu00121749] -ADD-Validating ACK/NACK is Enabled */ 
        <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"  isMesGapEnabled="TRUE" gapPrd="80" gapOffst="80"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request with inavlid max Uplink Harq Tx at RGR
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" maxUlHqTx="0"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>
     
     # Send UE config request with inavlid puschtpcRnti at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" puschTpcRntiPres="TRUE" puschtpcRnti="19"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>
           
      # Send UE config request with inavlid puschtpcRnti at RGR 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" pucchTpcRntiPres="TRUE" pucchtpcRnti="19"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request with inavlid transmission mode at RGR 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" txModeEnum ="RGAC_RGR_UE_TM_ERR"/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Request to ShutDown LTEMAC
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.17
#
#       Desc:   "To test the successful creation of MAC PDU with subheaders,
#                padding subheaders, control elements, SDUs and padding
#
#       Notes:   None
#              
#       Module:  "MUX Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.17" altid="4.1">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful multiplexing of MAC PDU" 
      </tapa.desc>

      <tapa.longdesc>
         "Testing that the MAC PDU contains subheaders for SDU, CE and padding
         along with the CE, SDU and padding bytes"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit.grp16 taTmrPres="TRUE" taTmr="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8"  instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

       <tapa.send>
          <tapa.tfu.timingadv.ind>
             <tapa.tfu.timingadv ueId="0" timingAdv="5"  />
          </tapa.tfu.timingadv.ind>
       </tapa.send>

      <tapa.send lc="TRUE">
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="3" lcType="4" bo="54"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="3" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3" lcType="4"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSdu="TRUE" lcId="3" chkTA="TRUE"
               taVal="5"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.18
#
#       Desc:    To validate Padding headers are correctly decoded and also
#       short and long sub headers are decoded propoerly.
#               
#              
#
#       Notes:   None
#              
#       Module: 
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.18" altid="4.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DEMUX"/>

      <tapa.desc>
         To validate Padding headers are correctly decoded and also
         short and long sub headers are decoded propoerly."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
   
      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="50"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueBr="4000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8"/>
      </tapa.send>

      # Configure uplink DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="2" lcType="4" ulQci="8"/>
      </tapa.send>

      # Configure uplink DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="2" lcType="4" ulQci="8"/>
      </tapa.send>

      # Configure uplink DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="2" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcType="4" instId="5"/>
      </tapa.send>

      # Configure all LCGs for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication for config application
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
       <tapa.send lc="TRUE">
          <tapa.tfu.sr.ind>
             <tapa.tfu.sr/>
          </tapa.tfu.sr.ind>
       </tapa.send>

      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3" addLongBsr="TRUE" bsr0="55"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1"/>
      </tapa.expect>

       # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
       # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 TTIs (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      # But because of long bsr, we will get pdcchReqs every TTI till the
      # bsr is satisfied
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        # Expect data reception request
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      # Because of earlier pdcch Reqs, datRecpReqs would have come in these 3
      # TTIs. And pdcchReqs would have come for the remaining BSR.
      # So expect them as well giving individual TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        # Expect data reception request
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI ="100"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        # Expect data reception request
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        # Expect data reception request
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="900"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        # Expect data reception request
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send data indication using TB size recieved in the grant
    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat lcIds="3:4" use="3" sduSzs="1024:200"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

      <tapa.expect>
         # Expect datInd to go to RLC
         <tapa.rgu.ddatind numLch="2" lchTb1Data="3,1:4,1"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.19
#
#       Desc:   "To test successful DL path for SC1 scheduler with 8 UEs and DLFS
#       shall satisfy the requested allocation in the respective best available
#       sub-bands for the UE. The UEs to be scheduled shall be mix of
#       transmitting and re-transmitting Ues.
#       Notes:   None
#              
#       Module:  "DLFS Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.19" altid="12.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test successful DL path for SC1 scheduler with 8 UEs and DLFS
         shall satisfy the requested allocation in the respective best available
         sub-bands for the UE. The UEs to be scheduled shall be mix of
         transmitting and re-transmitting Ues.
      </tapa.desc>

      <tapa.longdesc>
         To test successful DL path for SC1 scheduler with 8 UEs and DLFS
         shall satisfy the requested allocation in the respective best available
         sub-bands for the UE. The UEs to be scheduled shall be mix of
         transmitting and re-transmitting Ues.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="60"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="1" aprdModeEnumPres="TRUE"
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30"/>
      
      <tapa.rg.UeInit.grp16 ueId="3" ueCatEnum="1" cqiPmiCfgIdx="1" k="1" 
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
      
      <tapa.rg.UeInit.grp16 ueId="4" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="5" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="6" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
      
      <tapa.rg.UeInit.grp16 ueId="7" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="4" lcId="5" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="5" lcId="6" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="6" lcId="7" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="7" lcId="8" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="4" lcId="5" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="5" lcId="6" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="6" lcId="7" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="7" lcId="8" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Current SFN = 18 sf = 3

      # Send CQI indication for aperiodic mode 2-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" cqiMode="1" wbCqi="8" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst =
            "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI indication for aperiodic mode 3-0 for UE3
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="2" isPucchInfo="FALSE" cqiMode="3" wbCqi="7"
            numOfSubbands = "9" rbStartLst="0:6:12:18:24:30:36:42:48" numRbLst =
            "6:6:6:6:6:6:6:6:2" cqiIdxLst="7:14:13:8:3:5:9:12:11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 2-0 for UE5
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="4" isPucchInfo="FALSE" cqiMode="1" wbCqi="9" cqiIdx="11"
            numOfSubbands = "5" rbStartLst = "0:9:15:45:48" numRbLst =
            "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 3-0 for UE6
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="5" isPucchInfo="FALSE" cqiMode="3" wbCqi="6"
            numOfSubbands = "9" rbStartLst="0:6:12:18:24:30:36:42:48" numRbLst =
            "6:6:6:6:6:6:6:6:2" cqiIdxLst="12:11:7:10:8:9:15:4:4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 2-0 for UE7
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="6" isPucchInfo="FALSE" cqiMode="1" wbCqi="8"
              cqiIdx="8"
            numOfSubbands = "5" rbStartLst = "0:9:15:45:48" numRbLst =
            "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 3-0 for UE8
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="7" isPucchInfo="FALSE" cqiMode="3" wbCqi="6"
            numOfSubbands = "9" rbStartLst="0:6:12:18:24:30:36:42:48" numRbLst =
            "6:6:6:6:6:6:6:6:2" cqiIdxLst="7:14:13:8:3:5:9:12:4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      #Send sub-band CQI for periodic mode 2-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="1" isPucchInfo="TRUE" cqiMode="2" isWideband="FALSE"
              sbCqi="5" label="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      #Send wide-band CQI for periodic mode 1-0 for UE4 
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="3" isPucchInfo="TRUE" cqiMode="0" cqiIdx="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.delay delay="5"/>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="80"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="40"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="3" bo="100"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="4" bo="79"/>
      </tapa.send>

      #Send BO for UE5
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="4" lcId="5" bo="160"/>
      </tapa.send>

      #Send BO for UE6
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="5" lcId="6" bo="140"/>
      </tapa.send>
      
      #Send BO for UE7
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="6" lcId="7" bo="100"/>
      </tapa.send>
      
      #Send BO for UE8
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="7" lcId="8" bo="54"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         # The priority of the UEs as selected by DLFS is same as this
         <tapa.rgu.dstaind ueId="7" numLchTb1="1" lchTb1Data="8" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="3" />
         <tapa.rgu.dstaind ueId="5" numLchTb1="1" lchTb1Data="6" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="2" />
         <tapa.rgu.dstaind ueId="4" numLchTb1="1" lchTb1Data="5" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="6" numLchTb1="1" lchTb1Data="7" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="4" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="2,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE3
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="3,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE4
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="4,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE5
         <tapa.rgu.ddatreq ueId="4" numLchTb1="1" lchTb1Data="5,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE6
         <tapa.rgu.ddatreq ueId="5" numLchTb1="1" lchTb1Data="6,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE7
         <tapa.rgu.ddatreq ueId="6" numLchTb1="1" lchTb1Data="7,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE8
         <tapa.rgu.ddatreq ueId="7" numLchTb1="1" lchTb1Data="8,0,1"/>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4"/>
        <tapa.tfu.pdcch.cntrl.req ueId="4" saveTo="5"/>
        <tapa.tfu.pdcch.cntrl.req ueId="5" saveTo="6"/>
        <tapa.tfu.pdcch.cntrl.req ueId="6" saveTo="7"/>
        <tapa.tfu.pdcch.cntrl.req ueId="7" saveTo="8"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:2:4:7:9"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"
              vldtSbAlloc="TRUE"
              allocSbIds="0:1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16"/>
        <tapa.tfu.pdsch.dat.req ueId="2" use="3" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="2:3:4:5:14:15:16:6:7"/>
        <tapa.tfu.pdsch.dat.req ueId="3" use="4" validate="TRUE"
              vldtSbAlloc="TRUE"
              allocSbIds="0:1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16"/>
        <tapa.tfu.pdsch.dat.req ueId="4" use="5" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:3:5:15:16"/>
        <tapa.tfu.pdsch.dat.req ueId="5" use="6" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:1:2:3:12:13"/>
        <tapa.tfu.pdsch.dat.req ueId="6" use="7" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:3:5:15:16"/>
        <tapa.tfu.pdsch.dat.req ueId="7" saveTo="1" use="8" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="2:3:4:5:14:15"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send lc="TRUE">
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req numRntis="8" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
        <tapa.tfu.hq.recp.req ueId="3"/>
        <tapa.tfu.hq.recp.req ueId="4"/>
        <tapa.tfu.hq.recp.req ueId="5"/>
        <tapa.tfu.hq.recp.req ueId="6"/>
        <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.delay delay="5"/>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="2"/>
        <tapa.tfu.hq ueId="3"/>
        <tapa.tfu.hq ueId="4"/>
        <tapa.tfu.hq ueId="5"/>
        <tapa.tfu.hq ueId="6"/>
        <tapa.tfu.hq ueId="7" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   #Send BO for UE4
     <tapa.send lc="TRUE">
        # Send BO for the created logical channel on RGU. 
        <tapa.rgu.dstarsp ueId="3" lcId="4" bo="89"/>
     </tapa.send>
     
   <tapa.delay delay="5"/>
     #Send wide-band CQI for periodic mode 1-0 for UE4 with CQI less than
     threshold CQI
      <tapa.send lc="TRUE">
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="3" isPucchInfo="TRUE" cqiMode="0" cqiIdx="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.delay delay="5"/>

   <tapa.send>
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send> 

   <tapa.expect>
      <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="4" />
   </tapa.expect>

   <tapa.delay delay="5"/>

   <tapa.send>
      # Send DDatReq for UE4
      <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="4,0,1"/>
   </tapa.send>

   <tapa.send lc="TRUE">
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send> 

   <tapa.expset>
      # Expect PDU from MAC to PHY. 
     <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req  ueId="7" validate = "TRUE" saveTo="2" 
           use="8" vldtRetx="TRUE"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="3"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req validate="TRUE" ueId="7"
           use="2" retxUse="1" chkSdu="FALSE"
           lcId="8" isRetx="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="3" use="3" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
      # Send a 4 TTIs to expect harqReception request 
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="3"/>
        <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="3"/>
        <tapa.tfu.hq ueId="7"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg002.301 ccpu00109543 MOD
#
#       Test:    1.20
#
#       Desc:   "To verify if throughput is raised due to frequency selective RB
#       alloction for SC1 scheduler with 8 UEs in a frequency selective cell.
#       DLFS shall satisfy the requested allocation in the respective best 
#       available sub-bands for the UE. The UEs to be scheduled shall be mix of
#       transmitting and re-transmitting Ues.
#       Notes:   None
#              
#       Module:  "DLFS Module"
#
#       File:    rgac_tc12.xml
#
#
<tapa.testcase id="1.20" altid="12.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify if throughput is raised due to frequency selective RB
         alloction for SC1 scheduler with 8 UEs in a frequency selective cell.
         DLFS shall satisfy the requested allocation in the respective best 
         available sub-bands for the UE. The UEs to be scheduled shall be mix of
         transmitting and re-transmitting Ues.
      </tapa.desc>

      <tapa.longdesc>
         To verify if throughput is raised due to frequency selective RB
         alloction for SC1 scheduler with 8 UEs in a frequency selective cell.
         DLFS shall satisfy the requested allocation in the respective best 
         available sub-bands for the UE. The UEs to be scheduled shall be mix of
         transmitting and re-transmitting Ues.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="100"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="1" aprdModeEnumPres="TRUE"
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30"/>
      
      <tapa.rg.UeInit.grp16 ueId="3" ueCatEnum="1" cqiPmiCfgIdx="1" k="1" 
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
      
      <tapa.rg.UeInit.grp16 ueId="4" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="5" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20"/>
      
      <tapa.rg.UeInit.grp16 ueId="6" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
      
      <tapa.rg.UeInit.grp16 ueId="7" ueCatEnum="1" cqiPmiCfgIdx="1" k="1"
         aprdModeEnumPres = "TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="4" lcId="5" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="5" lcId="6" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="6" lcId="7" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="7" lcId="8" lcgId="1" dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="4" lcId="5" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="5" lcId="6" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="6" lcId="7" dir="1" lcType="4" instId="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="7" lcId="8" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Current SFN = 18 sf = 3

      # Send CQI indication for aperiodic mode 2-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" cqiMode="1" wbCqi="8" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst =
            "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI indication for aperiodic mode 3-0 for UE3
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="2" isPucchInfo="FALSE" cqiMode="3" wbCqi="7"
            numOfSubbands = "9" rbStartLst="0:6:12:18:24:30:36:42:48" numRbLst =
            "6:6:6:6:6:6:6:6:2" cqiIdxLst="7:14:13:8:3:5:9:12:11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 2-0 for UE5
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="4" isPucchInfo="FALSE" cqiMode="1" wbCqi="9" cqiIdx="11"
            numOfSubbands = "5" rbStartLst = "0:9:15:45:48" numRbLst =
            "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 3-0 for UE6
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="5" isPucchInfo="FALSE" cqiMode="3" wbCqi="6"
            numOfSubbands = "9" rbStartLst="0:6:12:18:24:30:36:42:48" numRbLst =
            "6:6:6:6:6:6:6:6:2" cqiIdxLst="12:11:7:10:8:9:15:4:4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 2-0 for UE7
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="6" isPucchInfo="FALSE" cqiMode="1" wbCqi="8"
              cqiIdx="8"
            numOfSubbands = "5" rbStartLst = "0:9:15:45:48" numRbLst =
            "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for aperiodic mode 3-0 for UE8
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="7" isPucchInfo="FALSE" cqiMode="3" wbCqi="6"
            numOfSubbands = "9" rbStartLst="0:6:12:18:24:30:36:42:48" numRbLst =
            "6:6:6:6:6:6:6:6:2" cqiIdxLst="7:14:13:8:3:5:9:12:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      #Send sub-band CQI for periodic mode 2-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="1" isPucchInfo="TRUE" cqiMode="2" isWideband="FALSE"
              sbCqi="5" label="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      #Send wide-band CQI for periodic mode 1-0 for UE4 
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="3" isPucchInfo="TRUE" cqiMode="0" cqiIdx="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="50"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="3" bo="120"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="4" bo="69"/>
      </tapa.send>

      #Send BO for UE5
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="4" lcId="5" bo="160"/>
      </tapa.send>

      #Send BO for UE6
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="5" lcId="6" bo="400"/>
      </tapa.send>
      
      #Send BO for UE7
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="6" lcId="7" bo="200"/>
      </tapa.send>
      
      #Send BO for UE8
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="7" lcId="8" bo="200"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="7" numLchTb1="1" lchTb1Data="8" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="3" />
         <tapa.rgu.dstaind ueId="5" numLchTb1="1" lchTb1Data="6" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="2" />
         <tapa.rgu.dstaind ueId="4" numLchTb1="1" lchTb1Data="5" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="6" numLchTb1="1" lchTb1Data="7" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="4" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="2,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE3
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="3,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE4
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="4,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE5
         <tapa.rgu.ddatreq ueId="4" numLchTb1="1" lchTb1Data="5,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE6
         <tapa.rgu.ddatreq ueId="5" numLchTb1="1" lchTb1Data="6,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE7
         <tapa.rgu.ddatreq ueId="6" numLchTb1="1" lchTb1Data="7,0,1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE8
         <tapa.rgu.ddatreq ueId="7" numLchTb1="1" lchTb1Data="8,0,1"/>
      </tapa.send>
      
      <tapa.send lc="TRUE"> 
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="7" saveTo="8"/>
        <tapa.tfu.pdcch.cntrl.req ueId="5" saveTo="6"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
        <tapa.tfu.pdcch.cntrl.req ueId="4" saveTo="5"/>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="6" saveTo="7"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"
              vldtSbAlloc="TRUE"
              allocSbIds="2:2:2:3:4:5:6:7:8:10:12:13:14:15:16:15:24"/>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:1:3:5:6"/>
        <tapa.tfu.pdsch.dat.req ueId="2" use="3" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:1:3:4:6:7:9:10:12"/>
        <tapa.tfu.pdsch.dat.req ueId="3" use="4" validate="TRUE"
              vldtSbAlloc="TRUE"
              allocSbIds="0:1:2:3:4:5:6:7:8:9:10:11:12:13:14:15:16"/>
        <tapa.tfu.pdsch.dat.req ueId="4" use="5" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:2:3:11:12"/>
        <tapa.tfu.pdsch.dat.req ueId="5" use="6" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:1:3:4:6:7:9:10:12"/>
        <tapa.tfu.pdsch.dat.req ueId="6" use="7" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:2:3:11:12"/>
        <tapa.tfu.pdsch.dat.req ueId="7" saveTo="1" use="8" validate="TRUE"
              vldtSbAlloc="TRUE" allocSbIds="0:1:2:4:6:6:8:8:12"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send lc="TRUE">
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req numRntis="8" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
        <tapa.tfu.hq.recp.req ueId="3"/>
        <tapa.tfu.hq.recp.req ueId="4"/>
        <tapa.tfu.hq.recp.req ueId="5"/>
        <tapa.tfu.hq.recp.req ueId="6"/>
        <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   # Ending TC here: further processing not needed
   
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.21
#
#       Desc:   "To verify that UE with best CQI gets priority over other UEs
#       in 3 UE scenario"
#
#       Notes:   None
#              
#       Module:  "MAX C/I Module"
#
#       File:    rgac_tc13.xml
#
#
<tapa.testcase id="1.21" altid="13.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify UE with best CQI gets priority over others in a 3 UE
         scenario.
      </tapa.desc>

      <tapa.longdesc>
         To verify UE with best CQI gets priority over others in a 3 UE
         scenario.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="50" dlSchdType="3" maxDlBwPerUe="20"/>

      # UE Creation with periodic mode 1-0
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" 
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE3
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         #ccpu00120621:qci is now from 1 to 9 instead of 0-8. Adding 1
         #to dlQci
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="2" instId="5" />
      </tapa.send>
      
      # Configure a Non-GBR dedicated logical channel (DTCH) for the 
      # created UE with QCI = 0 for UE2
      <tapa.send>
         #ccpu00120621:qci is now from 1 to 9 instead of 0-8. Adding 1
         #to dlQci
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE3
         #ccpu00120621:qci is now from 1 to 9 instead of 0-8. Adding 1
         #to dlQci
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="5" dir="1" lcType="4"
            dlQci="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send CQI indication for periodic mode 1-0 for UE1 = 8
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" cqiMode="0" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for periodic mode 1-0 for UE2 =14
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="TRUE" cqiMode="0" cqiIdx="15"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI indication for periodic mode 1-0 for UE3 = 10
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="2" isPucchInfo="TRUE" cqiMode="0" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="400"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="4" bo="800"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE3. 
         <tapa.rgu.dstarsp ueId="2" lcId="5" lcType="4" bo="300"/>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for UE2 and UE3 
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="5" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE3
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="5,0,1"/>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3" />
     <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="2" use="2" validate="TRUE"/>
     </tapa.tfu.dat.req>
     # Now UE1 will also get scheduled
   </tapa.expset>

   # Ending TC here: further processing not needed
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.22
#
#       Desc:   "Verify that for Ues with same CQI, scheduling would be in a round robin manner.
#
#       Notes:   None
#              
#       Module:  "MAX C/I Module"
#
#       File:    rgac_tc13.xml
#
#
<tapa.testcase id="1.22" altid="13.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        Verify that for UEs with same CQI, scheduling is done in round robin
        manner.
      </tapa.desc>

      <tapa.longdesc>
        Verify that for UEs with same CQI, scheduling is done in round robin
        manner.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="25" dlSchdType="3" maxDlBwPerUe="25"/>

      # UE Creation with periodic mode 1-0
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" 
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a GBR DTCH for the UE1 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR DTCH for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Configure a GBR DTCH with QCI = 3 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>
      
      # Configure a GBR DTCH for UE2 with QCI=2 on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="5"
           dlQci="2" instId="5" />
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to apply the configuration
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send CQI indication for periodic mode 1-0 for UE1 with cqi = 8
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" cqiMode="0" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send CQI indication for periodic mode 1-0 for UE2 with cqi = 8
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="TRUE" cqiMode="0" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="1400"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="5" bo="1400"/>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for DTCH of UE1
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      <tapa.send>
         # Send data for UE1
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="3,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
     </tapa.tfu.dat.req>
     # Now UE2 will also get scheduled
     <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4"/>
   </tapa.expset>

   <tapa.delay delay="5"/>
    <tapa.send>
       # Send data for UE2
       <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4,0,1"/>
    </tapa.send>

  <tapa.send lc="TRUE">
     # Send DL_DELTA Ttis to get the MAC PDU at PHY.
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
     </tapa.tfu.dat.req>
     # Now UE1 will also get scheduled
     <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3"/>
   </tapa.expset>

   <tapa.delay delay="5"/>
    <tapa.send>
       # Send data for UE1
       <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="3,0,1"/>
    </tapa.send>
    
  <tapa.send lc="TRUE">
     # Send DL_DELTA Ttis to get the MAC PDU at PHY.
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
     </tapa.tfu.dat.req>
     # Now UE2 will get scheduled again
     <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4"/>
   </tapa.expset>
   <tapa.delay delay="5"/>
   
    <tapa.send>
       # Send data for UE2
       <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4,0,1"/>
    </tapa.send>

  <tapa.send lc="TRUE">
     # Send DL_DELTA Ttis to get the MAC PDU at PHY.
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

   <tapa.expset>
     # Now UE1 will get scheduled again
     <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3"/>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   # Ending TC here: further processing not needed
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    1.23
#
#       Desc:    To validate that for Uplink scheduling MAX CI chooses a UEs with
#       different wideband CQI such that the UE with the best CQI gets
#       allocations ahead of other UEs. (LONG BSR)
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc13.xml
#
#
###############################################################################
<tapa.testcase id="1.23" altid="13.25">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate that for Uplink scheduling MAX CI chooses a UEs with
         different wideband CQI such that the UE with the best CQI gets
         allocations ahead of other UEs."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="3"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="15000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="15000"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="15000"/>
      <tapa.rg.UeInit.grp16 ueId="3" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="15000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" 
            lcgId="1" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="3" 
            lcgId="1" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Indicate the same CQI for both
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12" /> 
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" /> 
            <tapa.tfu.ulcqi ueId="2" isWideBand="TRUE" wideCqi="5" /> 
            <tapa.tfu.ulcqi ueId="3" isWideBand="TRUE" wideCqi="8" /> 
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" ueId="0" addLongBsr="TRUE" bsr0="0" bsr1="50" 
             bsr2="0" bsr3="0"/>
          <tapa.tfu.dat use="6" ueId="1" addLongBsr="TRUE" bsr0="0" bsr1="50" 
             bsr2="0" bsr3="0"/>
          <tapa.tfu.dat use="7" ueId="2" addLongBsr="TRUE" bsr0="0" bsr1="50" 
             bsr2="0" bsr3="0"/>
          <tapa.tfu.dat use="8" ueId="3" addLongBsr="TRUE" bsr0="0" bsr1="50" 
             bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

     # Send a TTI to schedule BSR
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect DCI format 0 and do basic validations of the grant
     <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    13.26
#
#       Desc:    To validate that for Uplink scheduling MAX CI Changes the
#       priority of UEs as soon as the UL CQI indication is received.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc13.xml
#
#
###############################################################################
<tapa.testcase id="1.24" altid="13.26">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate that for Uplink scheduling MAX CI Changes the
         priority of UEs as soon as the UL CQI indication is received."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20" ulSchdType="3"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="2000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="2000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="6" /> 
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="8" /> 
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" ueId="0" addTruncBsr="TRUE" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="4" ueId="1" addTruncBsr="TRUE" lcgId="1" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="9" /> 
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" /> 
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
 
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.10
#
#       Desc:   "Verify that remaining rate is considered
#                for GBR channels"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="1.25" altid="14.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that remaining rate is cnosidered for
          GBR channels."
      </tapa.desc>

      <tapa.longdesc>
         "Configure two GBR services of equal priority (for different UEs) -
         LC 3 and LC 4. Update non-zero BO for LC 3. Once complete allocation
         has bee made for this (make sure configured GBR is larger than
         allocation), update BO for both LC 3 and LC 4 in the same subframe,
         LC 3's BO being larger.
         Verify that LC 4 is completely satisfied first."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="25" maxDlBwPerUe="25" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 ueId="0" />
      <tapa.rg.UeInit.grp16 ueId="1" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 2 (QCI 3/4) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="4"
            dlGbr="500" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 3 (QCI 5/6) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="5"
            dlGbr="500" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send some BO to satisfy the higher priority LC,
      # So that its remaining rate goes down.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="400"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="3"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="14"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

   <tapa.delay delay="5"/>
      # Send data corresponding to staInds.
      # Also, now send more BO updates, so that the lower
      # priority LC also has some BO.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="200"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="5000"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel, and also for the higher priority
         # one. However, the lower priority is expected to have
         # been completely scheduled for here.
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

   <tapa.delay delay="5"/>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the original
         # higher priority channel, thus indicating that during the
         # last scheduling time, it had given preference to the
         # lower priority channel due to higher remaining fraction.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.17
#
#       Desc:   "Verify that for the case of two UEs with
#                DTCHs of comparable properties, the DTCH for
#                higher CQI UE starts getting satisfied first.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="1.26" altid="14.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that for the case of two UEs with
          DTCHs of comparable properties, the DTCH for
          higher CQI UE starts getting satisfied first."
      </tapa.desc>

      <tapa.longdesc>
         "For the two GBR DTCHs of two UEs, configure them such that LC of UE
         1 is of priority slightly higher (priority value one lower) than LC
         of UE 2. Other properties shall remain same.
         Assign CQI = 7 for UE 1 and CQI = 14 for UE 2. Assign large BOs to
         both channels.
         Verify that LC of UE 2 is allocated first (despite it having a lower
         service priority)."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="25" maxDlBwPerUe="25" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 ueId="0" />
      <tapa.rg.UeInit.grp16 ueId="1" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            lcType="4" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="2"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Just let some TTIs pass by
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="800"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="800"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="15"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC. Second UE (with higher CQI) shall
      # be satisfied first, and then the other one (though
      # this is not known (checked for) here yet.
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

   <tapa.delay delay="5"/>
      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # The second UE with lower CQI was not completely satisfied
         # initially, which means that the remainder of it would
         # have been scheduled now.
         # Also not the absence of UE 2 being scheduled, indicating
         # that it indeed must have been totally satisfied the
         # first time around.
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      # Send data corresponding to staInd - not doing this,
      # ending TC here.
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg003.301 ccpu00119087 MOD
#rg002.301 ccpu00109543 MOD
#
#       Test:    14.22
#
#       Desc:   "Verify that HARQ proc with GBR DTCH receives higher
#                priority than proc carrying AMBR DTCH.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="1.27" altid="14.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with priority 0 DTCH receives higher
          priority than proc carrying GBR DTCH."
      </tapa.desc>

      <tapa.longdesc>
         "Ensure that proc 1 (of UE 1) carries AMBR DTCH and proc 2 (of UE 2)
         carries GBR DTCH in same subframe. Update CQI for each so that now
         both procs together canonot be retransmitted in the same subframe.
         Generate a NACK for each. In the next downlink subframe, data for
         proc 2 should appear. Data for proc 1 should appear in a subsequent
         downlink subframe."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>
   
   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" maxDlRetxBw="25"
         dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a GBR DTCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         # Configure an AMBR DTCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure GBR DTCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="1" instId="5"/>
      </tapa.send>

      # Configure AMBR DTCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="7" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>


      # Send BOs. Note that BOs should be sent such
      # that they are completely satisfied without
      # leaving a lot of buffer in the bandwidth.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="700"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="700"/>
      </tapa.send>

      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for both DCCH and DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="9"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="200"/>
     </tapa.send>
      
      #since cqi is changed in between the tx and retx,allocation will 
      #not be successful.we will try to do allocation for RG_SCH_MAX_RETX_ALLOC_FAIL
      #times and then release the hq proc.
      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtRetx="TRUE"
               use="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      # A TTI for rescheduling the other left out proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="100"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      # Ending TC here, what needed to be verified is achieved.
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg003.301 MOD
#
#
#       Test:    1.28
#
#       Desc:    "Verify that CQI is considered to determine UE
#                 priority while scheduling"
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="1.28" altid="14.28">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that CQI is considered to determine UE
           priority while scheduling"
      </tapa.desc>

      <tapa.longdesc>
         "Set up two similar UEs, UE 1 having CQI = 10 and UE 2 having CQI = 7.
         Both UE are configured with same LC and LCG(default bearer).
         Using TP factor = 10 and Fairness Factor = 0, Both UE should be
         scheduled and UE with higher CQI should be present in upper data queue
         and so it should be scheduled first.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulSchdType="1" maxUlUeNewTxPerTti="2"
      ulThroughputFactor="10" ulFairnessFactor="0"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="100000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="100000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 3 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="3" lcId="3"
            lcType="4" dir="3"/>
      </tapa.send>

      # Configure LCG 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5"/>
      </tapa.send>

      # Configure LCG 3 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="3" bsr="60" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="3" bsr="60" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.delay delay="5"/>

      <tapa.send lc="TRUE">
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="7"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="10"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      <tapa.delay delay="5"/>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
      </tapa.expset>

      <tapa.delay delay="5"/>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE" rbStart="2" numRb="30"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE" rbStart="32" numRb="60"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.29
#
#       Desc:    "Verify that bitrate of UE is considered to
#                 determine UE priority while scheduling"
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="1.29" altid="14.29">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that bitrate of UE is considered to
          determine UE priority while scheduling"
      </tapa.desc>

      <tapa.longdesc>
         "Set up two similar UEs, UE 1 having CQI = 10 and UE 2 having CQI = 9.
         Report BSR for LCG 1 for UE 1, and satisfy it. (This would cause
         remaining bitrate of UE 1 to reduce.)
         Report BSR for LCG 1 for both UE 1 and UE 2, such that both UEs
         together cannot be completely satisfied in the same subframe. Ensure
         that priorities are configured such the resulting bitrate difference
         more than compensates for difference in CQI priorities.
         Verify that UE 2 is satisifed first completely before UE 1 (despite
         UE 2 having lower CQI)."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="75"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="75"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="3" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Report good CQI for the UE to get the job of pumping
      # out data quickly
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="10"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      # Report high BSR, satisfying which would cause UE's
      # remaining BR to perceivably diminish.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" ueId="0" addShortBsr="TRUE"
               lcgId="3" bsr="23" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expect>
   
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" ueId="0" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expect>


      # Send a bunch of TTIs so that no outstanding allocations
      # count when SR is received by MAC.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="700"/>
      </tapa.send>

      # Now start the complete cycle of allocations for both UEs,
      # intending to verify that UE 2 now gets higher preference
      # due to earlier allocation to UE 1.

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="800"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Report large BOs, lest a small BO shadows the effect of UE
      # bit rate in remaining bit rate calculation, and so that
      # only one UE being allocation in a subframe is visible.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="3" bsr="62" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="3" bsr="62" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="10"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="9"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="500"/>
      </tapa.send>

      # Now grant is expected only for second UE.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

<!--

      # Remaining allocations for second UE made here.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    10.18
#
#       Desc:    "Verify PUSCH group power control with non-group power
#                 control"
#
#       Notes:   None
#              
#       Module:  "Power"
#
#       File:    rgac_tc10.xml
#
#
<tapa.testcase id="1.30" altid="10.18">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUSCH group power control with non-group power control"
      </tapa.desc>

      <tapa.longdesc>
         "Verify PUSCH group power control with non-group power control"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
         pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
         puschFmt3StartRnti="300" puschFmt3RntiSize="4"
         puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 isAccumulated="TRUE" trgCqi="12"
         ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="6"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

   <tapa.delay delay="5"/>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 (only - no format 3)
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"
              vldtTpc="TRUE" tpcCmd="3"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Now group power control kicks in
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2:0:1:3:4:10"
               tpcCmds="3:1:1:1:1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="100"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2" tpcCmds="3"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2" tpcCmds="3"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    10.21
#
#       Desc:    "Verify PUCCH group power control"
#
#       Notes:   None
#              
#       Module:  "Power"
#
#       File:    rgac_tc10.xml
#
#
<tapa.testcase id="1.31" altid="10.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUCCH group power control"
      </tapa.desc>

      <tapa.longdesc>
         "Verify PUCCH group power control"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
         pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
         puschFmt3StartRnti="300" puschFmt3RntiSize="4"
         puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 ueId="0" isAccumulated="TRUE" trgCqi="14"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="202" uePucchPwrIdx="0"
         puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="0"/>
      <tapa.rg.UeInit.grp16 ueId="1" isAccumulated="TRUE" trgCqi="5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="202" uePucchPwrIdx="2"
         puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="2"/>


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #CfgdpucchDeltaPwr = -127 + pucchDeltaPwr
      <tapa.send>
         <tapa.tfu.pucchdelta.ind>
            <tapa.tfu.pucchdelta ueId="0" pucchDeltaPwr="134"/>
            <tapa.tfu.pucchdelta ueId="1" pucchDeltaPwr="125"/>
         </tapa.tfu.pucchdelta.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 3A
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2" tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
<!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.3
#
#       Desc:    Verify that during Measurement GAP a UE is not scheduled for
#       uplink transmission.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="1.32" altid="9.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that during Measurement Gap a UE is not scheduled for uplink
         transmission.
      </tapa.desc>

      <tapa.longdesc>
         "Verify that during measurement Gap a UE is not scheduled for uplink
         transmission."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication such that measurement Gap starts after 'X' subframes
      # X = UL_DELTA + RG_UL_SCHED_DELTA + 4  = 1 + 2 + 4 = 7.
   <tapa.send>
      <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="7"/>
   </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Should not recieve any UL Allocations
      <tapa.timeout/>
      
     # Send a TTI 10 TTIs such that we reach 2 subframes before the end of Measurement Gap
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.delay delay="5"/>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

   </tapa.test>

   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.8
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. And in
#       the case where Feedback isnt received at action is taken on the final
#       feedback in the case of a NACK retransmission is scheduled.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="1.33" altid="9.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs (assume NACK in case
       of tie)."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit.grp16 isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

   <tapa.delay delay="5"/>
      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="1" saveTo="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate="TRUE" use="1" saveTo="3"
               vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate="TRUE" use="3" isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.19
#
#       Desc:    Verify that if ACK/NACK and measurement gap coincide then the
#       UE is activated only after it is active as per ACK/NACK and measurement
#       gap.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="1.34" altid="9.19">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that if ACK/NACK and measurement gap coincide then the
         UE is activated only after it is active as per ACK/NACK and measurement
         gap."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that if ACK/NACK and measurement gap coincide then the
         UE is activated only after it is active as per ACK/NACK and measurement
         gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit.grp16 isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4" isMesGapEnabled="TRUE" 
         gapPrd="40" gapOffst="35"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send TTI indication so that we reach the start of measGap 
      # We should be far enough to do a downlink transmission 8 + 3
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="12"/>
      </tapa.send>

   <tapa.delay delay="5"/>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

   <tapa.delay delay="5"/>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Do not expect a format 0 to go out for UL
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Ideally we would get a grant over here but due to meas Gap we shouldn't
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send >
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   <tapa.delay delay="5"/>

      # Send a 6 - TFU_DELTA TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send >
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Uplink grant - we would be out of measGap after TFU_DELTA
      # subframes
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    15.3
#
#       Desc:    Verify that UEs are scheduled in the reported BO order 
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="1.35" altid="15.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that UEs are scheduled in the reported BO order" 
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expset>

   <tapa.delay delay="1"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    15.9
#
#       Desc:    Verify that in a multiple UE Scenario, the UEs shall be
#       scheduled in RR fashion based on Short BSR 
#
#       Notes:   None
#              
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="1.36" altid="15.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that in a multiple UE Scenario, the UEs shall be 
            scheduled in RR fashion based on Short BSR"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>
      #Initialize UE
      <tapa.rg.2UeRrInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      #UE1 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="4" addShortBsr="TRUE" bsr="9" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="400"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="1" use="8" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    1.37
#
#       Desc:    TDD Configuration 2 data transfer for a UE in multiplexing mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.37" altid="11.1">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 data transfer for a UE in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure at UE. Then UE sends data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" spclSfCfgIdx="5"
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.
      <tapa.send >
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send >
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>
   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.38
#
#       Desc:    TDD Configuration 2 Data Transfer for 2 UEs in multiplexing mode
#
#       Notes:   None
#
#       Module:  None
#
#       File:    rgac_tc16.xml
<tapa.testcase id="1.38" altid="11.2">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Data Transfer for 2 UEs in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs. It then sends DL data."
      </tapa.longdesc>
         
   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="5"
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     # old tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     # old tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         # old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         # old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="1"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                 ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Expect data indication for 1st UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Data Indication at RLC for 2nd UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expset>


#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 2nd UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>


   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>


   # Send data with size equal to the allocated size for DAT1 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TPT1"/>
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="1" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
    # Send BO for the created logical channel for DAT2 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT2 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="1"/>
    </tapa.send>

   <tapa.send>
      #old tapa.tfu.tti.ind numTti="2" />
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT2 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT2 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>

      #old tapa.tfu.tti.ind numTti="1" />
      <tapa.tfu.tti.ind numTti="1" TTI="TPT2"/>
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="1" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT3 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT3 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   <tapa.expset>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
   </tapa.expset>
 
   # Send data with size equal to the allocated size for DAT3 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT3 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT3 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="1" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT4 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT4 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT4 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>
   # Expect PDSCH and PDCCH for the dat req for DAT4 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   #send HARQ Recption Request for DAT 1,2 for 1st and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>

   </tapa.expect>

   # Send data with size equal to the allocated size for DAT4 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT4 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TPT3" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT4 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 3,4 for 1st UE and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   # Removing some steps as already more data sent and recieved in DL/UL
   # Because the testcase is large enough
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.39
#
#       Desc:    TDD Configuration 0 Data Transfer for 2 UEs in multiplexing mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.39" altid="11.7">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 0 Data Transfer for 2 UEs in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 0, the procedure initiates RACH followed
          by RB setup procedure for 2 UEs with data transfer."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" spclSfCfgIdx="5"
         raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0" />
           <tapa.tfu.sr ueId="1" />
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req  saveTo="3" ueId="0" use="0"/>
        <tapa.tfu.pusch.recp.req  saveTo="4" ueId="1" use="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.40
#
#       Desc:    TDD Configuration 5 data tranfer for 2 UEs in bundling mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.40" altid="11.13">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 5 data tranfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 5, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs with data transfer."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="5" spclSfCfgIdx="5"
         raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:1" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" ueId="0"/>
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" ueId="1"/>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="9"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" 
            isAckLst="TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" 
            isAckLst="TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5" ueId="0"/>
      <tapa.rgr.cfgCfm instId="5" ueId="1"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                     vldtGrant="TRUE" vldtTx="TRUE" ueId="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                     vldtGrant="TRUE" vldtTx="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0"  saveTo="3" ueId="0"/>
        <tapa.tfu.pusch.recp.req use="0"  saveTo="4" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    1.41
#
#       Desc:    TDD Configuration 4 data transfer for 2 UEs with multiplexing mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.41" altid="11.14">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 4 data transfer for 2 UEs with multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 4, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="4" spclSfCfgIdx="5" 
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                  ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                  ueId="1"   vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0"  saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.42
#
#       Desc:    TDD Configuration 3 data transfer for 2 UEs in multiplexing mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.42" altid="11.15">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 3 data transfer for 2 UEs in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 3, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="3" spclSfCfgIdx="5" 
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:1" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="5"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  ueId="0"/>
        <tapa.tfu.pdsch.dat.req  ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                     ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                     ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0" saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.43
#
#       Desc:    TDD Configuration 1 data transfer for 2 UEs in multiplexing mode.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.43" altid="11.16">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 data transfer for 2 UEs in multiplexing mode."
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" spclSfCfgIdx="5" 
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:3" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>
   <tapa.delay delay="1"/>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                        ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" saveTo="3" ueId="0"/>
        <tapa.tfu.pusch.recp.req use="0" saveTo="4" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    1.44
#
#       Desc:    TDD Configuration 6 data transfer for 2 UEs in bundling mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.44" altid="11.17">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 6 data transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 6, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="6" spclSfCfgIdx="5"
         raWinSize="5"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

         # Send it in the 0th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="5" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                           ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                           ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0" saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

 # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                           ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE"
                           ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>
</tapa.testcase>
</tapa.testcase>
#
#
#       Test:    1.45
#
#       Desc:    TDD Configuration 4 data transfer for 2 UEs with bundling mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.45" altid="11.18">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 4 data transfer for 2 UEs with bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 4, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="4" spclSfCfgIdx="5" 
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                  ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                  ueId="1"   vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0"  saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.46
#
#       Desc:    TDD Configuration 3 data transfer for 2 UEs in bundling mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.46" altid="11.19">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 3 data transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 3, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="3" spclSfCfgIdx="5" 
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:1" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="5"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  ueId="0"/>
        <tapa.tfu.pdsch.dat.req  ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                     ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                     ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0" saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.47
#
#       Desc:    TDD Configuration 1 data transfer for 2 UEs in bundling mode.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.47" altid="11.20">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 data transfer for 2 UEs in bundling mode."
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" spclSfCfgIdx="5" 
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:3" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                        ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" saveTo="3" ueId="0"/>
        <tapa.tfu.pusch.recp.req use="0" saveTo="4" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>
</tapa.testcase>

#
#
#       Test:    1.48
#
#       Desc:    TDD Configuration 6 data transfer for 2 UEs in multiplexing mode.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.48" altid="11.21">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 6 data transfer for 2 UEs in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 6, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="6" spclSfCfgIdx="5"
         raWinSize="5"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

         # Send it in the 0th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="5" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                           ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                           ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0" saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

 # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                           ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE"
                           ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>


      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.49
#
#       Desc:    TDD Configuration 2 Retransmission scenario in multiplexing mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="1.49" altid="11.3">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Retransmission scenario in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>
 # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="5"
         maxDlRetxBw="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Downlink data now 
       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
	
   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2
    <tapa.send>
       #old tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="3" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   <tapa.send>
      #old tapa.tfu.tti.ind numTti="1" />
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
   
    <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>

  # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
    
	<tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
  
   # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
	
	<tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

  <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
  #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

    <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
  # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
  
 <tapa.send>
   # old tapa.tfu.tti.ind numTti="3" />
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>





#
#
#       Test:    1.50
#
#       Desc:    TDD Configuration 2 Retransmission scenario in bundling mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="1.50" altid="11.4">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Retransmission scenario in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>


 # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="5"
         maxDlRetxBw="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Downlink data now 
       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
        <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

        <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
  #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
 <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect Retransmission for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
# Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

<tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #send HARQ Recption Request for DAT 2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   <tapa.send>

      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

# Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.51
#
#       Desc:    TDD Configuration 2 Data Transfer for 2 UEs in bundling mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="1.51" altid="11.5">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Data Transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
            
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="5"
         />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.52
#
#       Desc:    TDD Configuration 2 Data Transfer for 2 UEs in bundling mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="1.52" altid="11.6">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Data Transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs. It then sends DL data."
      </tapa.longdesc>
         
   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="5"
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" 
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #Expect data indication for 1st UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Expect Data Indication at RLC for 2nd UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expset>
#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 2nd UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>


   # Send data with size equal to the allocated size for DAT1 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1" spId="0">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="1"/>
    </tapa.send>
    
    <tapa.send>
      <tapa.tfu.tti.ind numTti="3" TTI="TEST0" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT2 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   
   # Send data with size equal to the allocated size for DAT2 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>
<!--
   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
  -->
    <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st and 2nd  UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT3 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT3 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT3 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT3 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   # Send data with size equal to the allocated size for DAT3 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT3 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT4 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT4 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT4 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   #send HARQ Recption Request for DAT 1,2 for 1st and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   # Send data with size equal to the allocated size for DAT4 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT4 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT4 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 3,4 for 1st UE and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 3,4 for 1st UE and 2nd UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

      <tapa.send>
        # old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
    # Send a TTI to schedule SR 
      <tapa.send>
         #<tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

    # Send SR Indication for 1st UE and 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
    # Send a TTI to schedule SR 
      <tapa.send>
        # old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Expect DCI format 0 for 1st UE and 2nd UE
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for 1st UE and 2nd UE
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
        <tapa.tfu.pusch.recp.req  ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5" TTI="TEST1"/>
      </tapa.send>

   #Send CRC for Msg for 1st UE and 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Send BSR for 1st UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   # Send BSR for 2nd UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="1"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
# Expect PHICH for 1st UE and 2nd UE
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
#Below commented part is not working and it
 needs to be tested after merging of servanan TDD fixes
<!--
 <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtGrant="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="2" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
         <tapa.tfu.pusch.recp.req ueId="1"/>
      </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" TTI="TEST" />
   </tapa.send>

   # Expect PHICH for 1st UE and 2nd UE
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.53
#
#       Desc:    To test SI
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="1.53" altid="15.14">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         # rg004.201-ADD-Added for SI Enhancement*/
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send lc="TRUE">
         # Send BO for BCCH-DLSCH logical channel on RGU.
         <tapa.rgu.cstarsp lcId="5" lcType="1" bo="32" 
            frameNum="0" subFrameNum="0"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.cstaind lcId="5" boSatisfied="TRUE" maxRb="3" saveTo="1"/>
      </tapa.expect>

      <tapa.delay delay="1"/>

      <tapa.send>
         # Send BCCH-DLSCH data to MAC on RGU. 
         <tapa.rgu.cdatreq bcchIdx="1" lcId="5" lcType="1" use="1"/>
         #<tapa.rgu.cdatreq lcId="5" lcType="1" use="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req />
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req />
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.54
#
#       Desc:    To test SI
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="1.54" altid="15.16">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         # rg004.201-ADD-Added for SI Enhancement*/
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send lc="TRUE">
         # Send BO for BCCH-DLSCH logical channel on RGU.
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="32" 
            frameNum="0" subFrameNum="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for BCCH-DLSCH logical channel on RGU.
         <tapa.rgu.cstarsp lcId="5" lcType="1" bo="32" 
            frameNum="0" subFrameNum="0"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.cstaind lcId="5" boSatisfied="TRUE" maxRb="3" saveTo="1"/>
      </tapa.expect>

      <tapa.delay delay="1"/>
      <tapa.send>
         # Send BCCH-DLSCH data to MAC on RGU. 
         <tapa.rgu.cdatreq bcchIdx="1" lcId="5" lcType="1" use="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       <tapa.expset>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.cstaind lcId="2" boSatisfied="TRUE" maxRb="3" saveTo="2"/>
         <tapa.tfu.cntrl.req>
            <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req>
            <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>
      <tapa.send>
         # Send BCCH-DLSCH data to MAC on RGU. 
         <tapa.rgu.cdatreq bcchIdx="2" lcId="2" lcType="1" use="2"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req>
            <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req>
            <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req>
            <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req>
            <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#       rg004.201
#
#       Test:    1.55
#
#       Desc:   "To test the successful PHR handling for PHR recieved with MSG3
#                for CCCH SDU based contention resolution where UeCfg from RRC 
#                is received after Msg4 is transmitted" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.55">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of PHR handling for CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, Msg4 and then UeCfg"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="0"
           addPhr="TRUE" phr="10"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
   </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" isAccumulated="TRUE"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # At start of this step, we are at (2,1)
      # Send CDatReq on CCCH for the same rnti.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3"
                            sendNoMatter="TRUE"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send stats req to know the failure
      <tapa.send>
         <tapa.lrg.stsreq elmntType="STRGUSAP"/>
      </tapa.send>
      
      # Expect stats to indicate a pdu drop
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STRGUSAP" numPduDrop="1"/>
      </tapa.expect>

      # At start of this step, we are at (2,1)
      # Send TTI to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #rg001.301-ADD-[ccpu00118788] We now give minimum RBs to make sure
      #                 UE can report changed power situation
      # Therefore,Expect DCI format 0 due to PHR constraints
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtTpc="TRUE" tpcPositive="FALSE" isAccumulated="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.56
#
#       Desc:    Verify successful PHR handling for non-adaptive msg3
#       re-transmission
#
#       Notes:   None
#              
#       Module:  scheduler
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.56">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         Verify successful PHR handling when recieved with non-adaptive MSG3
         re-transmission.
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL. Set ccchCqi and msgSizeGrpA such that 2 Subbands 
      #are taken for msg3 alloc.
      <tapa.rg.cellInit ulTotalBw="100" maxUlUeNewTxPerTti="10"
         dlSchdType="0" ulSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit ueId="0" ueBr="3000" maxUlHqTx="4" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="15"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="0" bsr="20"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req  expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="5" numRapId="2" rapIds="1:2"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5" rapIds="1:2" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" vldtGrant="TRUE" vldtRetx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="1" use="4" validate="TRUE" saveTo="5"/>
           <tapa.tfu.msg3.recp.req ueId="2" use="4" validate="TRUE" saveTo="6"/>
           <tapa.tfu.pusch.recp.req ueId="0" use="3" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat ueId="0" use="4" lcId="3"/>
          <tapa.tfu.dat ueId="1" use="5" isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>
    </tapa.send>

      <tapa.expset>
         # Expect datInd to go to RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

       # Send BO for Msg4 on RGU. 
       <tapa.send>
          <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      #msg3 was scheduled for RETX Here

      # verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="1" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
  
      # Validate msg3 Recp for RETX
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="2" use="4" validate="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

    #Send CRC for Msg
    <tapa.send>
       <tapa.tfu.crc.ind>
          <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
       </tapa.tfu.crc.ind>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" use="6" isCcchSdu="TRUE" sduSize="6"
                        addPhr="TRUE" phr="30"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

    <tapa.expset>
         # Expect datInd to go to RLC
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
      </tapa.expset>

       # Send BO for Msg4 on RGU. 
       <tapa.send>
          <tapa.rgu.cstarsp ueId="2" lcId="4" lcType="3" bo="10"/>
       </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="2" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq  ueId="1"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="2" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="1"/>
     </tapa.tfu.cntrl.req>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="2"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq  ueId="2"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

     # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Send 2 TTIs to check no further indications from MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtTpc="TRUE" tpcPositive="TRUE" isAccumulated="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="2" use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" use="2" lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#ccpu00115364 changed test case considering changed modPrd value
#
#       Test:    1.57
#
#       Desc:    To test SI Scheduling using SI Enhancement
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.57" altid="15.19">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="620"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" siWinSize="4"
          siRetxCnt="2" recfgType="2048" modPrd="64"/>
      </tapa.send>

       #SFN,SF is (62,0),giving TTI upto (62,3)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.rgr.cfgCfm instId="5" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      #Modify the SI information
      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" buffSz="37"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (62,4), giving TTI upto (63,8)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.bch.dat.req />
          <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
   
      #SFN,SF is (63,9), giving TTI upto (64,0)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


       #SFN,SF is (64,0), giving TTI upto (64,2)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,3), giving TTI upto (64,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,4), giving TTI upto (64,4)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,5) giving TTU upto (64,6)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
         <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="10" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,7) giving TTI upto (64,7)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="10" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,8) giving TTI upto (65,0)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="11" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,1) giving TTI upto (65,1)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="11" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,2) giving TTI upto (66,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

# rg004.201-ADD-Added for SI Enhancement*/
#
#
#       Test:    1.58
#
#       Desc:    To test SI Parameters Configuration
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.58" altid="15.20">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Parameters Configuration in SI Cfg Req and Cell Cfg Req. Negative Scenearios test case."
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Verify SI Configuration request for invalid CFG Type 
      <tapa.send>
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_INV" />
      </tapa.send>

      # Expect SI Cfg Cfm from MAC 
      <tapa.expect>
         <tapa.rgr.sicfgcfm status="0" instId="5"/>
      </tapa.expect>

      # Verify Cell Configuration request for invalid ReTxCnt 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" siWinSize="4"
          siRetxCnt="5" />
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Verify SI Configuration request for invalid SI Id
      <tapa.send>
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="5" buffSz="47"/>
      </tapa.send>

      <tapa.expect>
      # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm status="15" instId="5"/>
      </tapa.expect>

      # Verify Cell Configuration request for invalid SI1 peridocity
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" siWinSize="4"
          siRetxCnt="3" si1Prd="50"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Verify SI-Reconfiguration scenario with a change in numSi value
      #Configure a valid SIs
      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (0,0),giving TTI upto (0,4)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" numSi="3"
           recfgType="2048" />
      </tapa.send>

       <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req />
         </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (0,5)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
     <tapa.rgr.cfgCfm instId="5" />
   </tapa.expect>

      #Re-Configure a valid SIs,with numSi set to 3
      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (0,6),giving TTI upto (0,8)
      #<tapa.send lc="TRUE">
         #<tapa.tfu.tti.ind numTti="2"/>
      #</tapa.send>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#ccpu00115364 changed test case considering changed modPrd value
# rg004.201-ADD-Added for SI Enhancement*/
#
#
#       Test:    1.59
#
#       Desc:    To test SI Scheduling using SI Enhancement
#                in the TDD mode.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.59" altid="11.22">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface in
          the TDD mode"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="620"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" siWinSize="4"
          siRetxCnt="2" recfgType="2048" modPrd="64"/>
      </tapa.send>

       #SFN,SF is (62,0),giving TTI upto (62,3)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #SIB1 is recieved
      <tapa.expset>
        <tapa.rgr.cfgCfm instId="5" />
           <tapa.tfu.cntrl.req>
              <tapa.tfu.pdcch.cntrl.req />
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req>
              <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
           </tapa.tfu.dat.req>
      </tapa.expset>

      #Modify the SI information
      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" buffSz="37"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (62,4), giving TTI upto (63,8)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      #New SI1 is recieved
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
          </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.bch.dat.req />
            <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
          </tapa.tfu.dat.req>
      </tapa.expset>
   
      #SFN,SF is (63,9), giving TTI upto (64,2)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req>
           <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>


       #SFN,SF is (64,2), giving TTI upto (64,2)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,3), giving TTI upto (64,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 
     #SFN,SF is (64,4), giving TTI upto (64,7)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,8) giving TTI upto (64,8)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,8) giving TTI upto (65,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,3) giving TTI upto (65,4)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,5) giving TTI upto (66,4)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#       rg004.201 
#
#       Test:    1.60
#
#       Desc:    Successful data path on BCCH-BCH channel
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.60" altid="6.8">>>
# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful data path on BCCH-BCH channel" 
      </tapa.desc>

      <tapa.longdesc>
         "Testing that the MAC PDU contains no subheaders for BCCH-BCH data and
          shall be transmitted at the time given by higher layers"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send BO for BCCH-BCH logical channel on RGU.
         # CM_LTE_LCH_BCCH is #defined to 1 (for lcType)
         # BCCH lcId is cfgd to be 1 (for lcId)
         # crntTime is (0, 0)
         # <tapa.rgu.cstarsp lcId="1" lcType="1" bo="55" sfOffset="4"/>
         <tapa.rgu.cstarsp lcId="1" lcType="1" bo="55" frameNum="0"
            subFrameNum="4"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get sent StaInd.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.cstaind lcId="1" lcType="1" boSatisfied="TRUE"/>
      </tapa.expect>

      <tapa.send>
         # Send BCCH-BCH data to MAC on RGU. 
         <tapa.rgu.cdatreq lcId="1" lcType="1"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.bch.dat.req/>
         </tapa.tfu.dat.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

/* rg007.201 Added MIMO Test cases */
#
#
#       Test:    1.61
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="1.61">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send DStaRsp with non-zero BO from RGU to MAC.
          3. Verify Transmit Diversity is the TX Scheme selected
             by MAC for scheduling this BO.
          4. Send CQI report from PHY with RI=2. 
          5. Send non-zero BO.
          6. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing with precInfo=0."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="150"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 To ensure TD as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="250"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3  and precInfo=2 To ensure SpaMux as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    1.62
#
#       Desc:   "To test basic DL SPS path for a UE(16)"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.62" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50" />
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
   # Do not send BO for the created SPS service on RGU at 2nd SPS ocassion
   <tapa.send>
      <tapa.tfu.tti.ind numTti="12"/>
   </tapa.send>
   
   # Do not send BO for the created SPS service on RGU at 3rd SPS ocassion
   <tapa.send>
      <tapa.tfu.tti.ind numTti="20"/>
   </tapa.send>

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect a release PDCCH over here
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
              chkFrmt1aRelPdcch="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>




###############################################################################
#
#       Test:   1.63 
#
#       Desc:   "To test basic reactivation of a UE and 
#                validate PDCCH in re-transmission(26)"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc18.xml
#
################################################################################
<tapa.testcase id="1.63" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS activation/re-activation for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "Activation of SPS in DL for a UE is done and change in CQI is 
          reported for a re-activation. 
          NACK is sent for re-activation pdsch/pdcch and the same PDCCH/PDSCH are
          expected."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

#rg009.201 - Added Check for TDD
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50" />
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   #5,5 ->5,8
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
 #### Subsequent SPS BO
      #Third BO Upd sent
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

     #5,7 ->6,0  SPS Occasion
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   
   </tapa.test>



   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    1.64
#
#       Desc:   "SPS Reactivation due to Meas gap cfg"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.64" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Successful DL SPS Disable in recfg"
      </tapa.desc>

      <tapa.longdesc>
         "Verify if DL SPS is successfully disabled for a UE already configured with SPS"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50"  maxDlHqTx="2"/>
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65" 
         DLSpsExpltRelCnt="5" DLSPSSchIntrv="20" NumSPSProc="4" 
         isMesGapEnabled="TRUE" gapPrd="40" gapOffst="34"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #5,5 ->5,8
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

 #### Subsequent SPS BO
      #Third BO Upd sent
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

     #5,7 ->6,0  SPS Occasion
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #5,8 DLSF processed for 6,0
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

 ## Recfg the meas cfg  6,0
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0"  UeReCfgType="256" 
            isMesGapEnabled="TRUE" gapPrd="40" gapOffst="35"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #6,1
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  status="0"/>
       </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #DL SPS Released due to meas gap recfg
      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
              chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HARQ Recp Req for DL SPS Release PDCCH
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      #wait of BO Upd

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #6,8 -> 7,1
        
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #6,7 ->DLSF proc for 6,9
      #DL SPS Activation due to meas gap recfg cannot be done due to Hq proc 3 busy
      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

 #### Subsequent SPS BO 9,6
      #BO Upd sent
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #9,8
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDSCH for SPS Occasion
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.65
#
#       Desc:   "To test both uplink and downlink SPS activation"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.65">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
        "To test both uplink and downlink SPS activation"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit  DLSPSMaxBw = "50"  ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11" isDlFreqSel="1" hopOffst="20"/>
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_320SF" numSPSproc="4"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="8"  prdBsrTmr="65535"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSPSOcc="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSPSOcc="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      <!--
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSPSOcc="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
-->

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" 
              validateSPS ="FALSE" DLSPSInit="FALSE"  transMode="RGR_UE_TM_3" isTb1="FALSE" chkSdu="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="FALSE" isTb1="FALSE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
   # Do not send BO for the created SPS service on RGU at 2nd SPS ocassion
   <tapa.send>
      <tapa.tfu.tti.ind numTti="12"/>
   </tapa.send>
   
   # Do not send BO for the created SPS service on RGU at 3rd SPS ocassion
   <tapa.send>
      <tapa.tfu.tti.ind numTti="20"/>
   </tapa.send>

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect a release PDCCH over here
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
              chkFrmt1aRelPdcch="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
      </tapa.send>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    1.66
#
#       Desc:    To verify successful deactivation (Explicit Release) of UL SPS
#                alone in a UE (and continue with DL SPS): Release PDCCH does
#                not reach UE and is resent (DTX).
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.66">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify successful deactivation (Explicit Release) of UL SPS alone
           in a UE (and continue with DL SPS): Release PDCCH does not reach UE and
           is resent (DTX)."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11" isDlFreqSel="1" hopOffst="20" DLSPSMaxBw="40"/>
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

     # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>
 
     # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>


      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="2000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSPSOcc="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSPSOcc="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSPSOcc="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>
      # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# Expect Release PDCCH from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
<!--
# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
            
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.67
#
#       Desc:    To verify re-activation of UL SPS due to collision with
#                measurement gap which comes in UE-Recfg.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.67">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To verify re-activation of UL SPS due to collision with
       measurement gap which comes in UE-Recfg."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70" DLSPSMaxBw="40"
      rntiSize="11" isDlFreqSel="1" hopOffst="20"/>

      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"
      isMesGapEnabled="TRUE" gapPrd="40" gapOffst="20" prdBsrTmr="65535" ueBr="2000"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
         ulQci="8" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="8" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="2000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#SPS occassion collides with meas GAP, so expect normal grant
      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" />
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
#Activation PDCCH when we dont collide with meas gap
<!--      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSPSOcc="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSPSOcc="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send UE-Reconfig with periodicity = 80 ms, with offset that collides
      with SPS occassions.
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="2"
      oldUeId="0" UeReCfgType="256" isMesGapEnabled="TRUE" gapPrd="80" 
      gapOffst="66" instId="5" />
      </tapa.send>

   # Send a Tti to get the configuration applied. 
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   #Expect positive Configuration Confirm from Scheduler
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSPSOcc="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>
   
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
      #Command To ShutDown LTEMAC Layer
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#       Test:    1.68
#
#       Desc:   "To verify SPS Retx are not scheduled in case of collision with Meas Gaps"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.68" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify SPS Retx are not scheduled in case of collision with Meas Gaps"
      </tapa.desc>

      <tapa.longdesc>
         "To verify SPS Retx are not scheduled in case of collision with Meas Gaps"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" />
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="5" DLSPSSchIntrv="20" NumSPSProc="6"
          isMesGapEnabled="TRUE" gapPrd="40" gapOffst="9"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="200"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #5,5 ->5,8
 #### Subsequent SPS BO
      #Third BO Upd sent
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="200"/>
      </tapa.send>

     #5,7 ->6,0  SPS Occasion
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for Dyn sched BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" />
        </tapa.tfu.dat.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
      #6,5
      # Send 2 Ttis to get the re-transmission data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      #6,7 
      # Expect retransmission of control request and data request and validate them 
      # with earlier received PDCCH.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="0" numTb1Lyrs="1" isSPSRetx="TRUE" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  validateSPS ="TRUE" lcId="3" chkSdu="FALSE" isTb1="FALSE" SPSretxUse="3" isSPSRetx="TRUE" />
        </tapa.tfu.dat.req>  
      </tapa.expset>
    

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
#7,1

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
#7,4
      # Send ACK for the received PDU
      <tapa.send>
          <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAck="FALSE"/>
          </tapa.tfu.hq.ind>
      </tapa.send>

      # Send 2 Ttis to get the re-transmission data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #6,7 
      # Expect retransmission of control request and data request and validate them 
      # with earlier received PDCCH.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="0" numTb1Lyrs="1" isSPSRetx="TRUE" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  validateSPS ="TRUE" lcId="3" chkSdu="FALSE" isTb1="FALSE" SPSretxUse="3" isSPSRetx="TRUE" />
        </tapa.tfu.dat.req>  
      </tapa.expset>
    

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
#7,1

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
#7,4
      # Send ACK for the received PDU
      <tapa.send>
          <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAck="FALSE"/>
          </tapa.tfu.hq.ind>
      </tapa.send>


#### MEAS GAP COLLISION HERE
      # Send 2 Ttis to get the re-transmission data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #6,7 
      # Expect retransmission of control request and data request and validate them 
      # with earlier received PDCCH.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="0" numTb1Lyrs="1" isSPSRetx="TRUE" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  validateSPS ="TRUE" lcId="3" chkSdu="FALSE" isTb1="FALSE" SPSretxUse="3" isSPSRetx="TRUE" />
        </tapa.tfu.dat.req>  
      </tapa.expset>
    

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
#7,1

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
#7,4
      # Send ACK for the received PDU
      <tapa.send>
          <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAck="FALSE"/>
          </tapa.tfu.hq.ind>
      </tapa.send>

      # Send 2 Ttis to get the re-transmission data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>



   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    1.69
#
#       Desc:   "To verify DL SPS Activation for Multiple UEs (2 UEs)"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.69" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify DL SPS Activation for Multiple UEs (2 UEs)"
      </tapa.desc>

      <tapa.longdesc>
         "To verify DL SPS Activation for Multiple UEs (2 UEs)"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "25" dlTotalBw="50"  maxSpsUePerDlSf="2"  />
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="91"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="92"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
 
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="4"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="4" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
           <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="1" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

<!--
      #PDCCH and PDSCH for FIRST BO
-->

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>



      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

<!--
      #HQ FDBK for FIRST BO
-->

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

<!--
      # ACK sent for First BO
      # Send ACK for the received PDU
-->

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="4"/>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="4" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>



      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>



      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="4"/>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" />
        </tapa.tfu.dat.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>




#These are the Test cases that correspond to TFU_UPGRADE
#
#
#       Test:    1.70
#
#       Desc:    Handling of HARQ, SRS and CQI Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="1.70" altid="20.21">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, SRS and CQI Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and CQI RR on the same TTI. 
         HARQ and CQI RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
              chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
     # Expecting a HARQ and a CQI RR.  
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.71
#
#       Desc:    To validate Data Reception Request and HARQ, RI Reception Request collision
#
#       Notes:   None
#              
#       Module:  Reception Request on PUSCH
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="1.71" altid="20.28" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI with a certain 
         Periodicity.Configure a DLSCH and a ULSCH such that the Periodicity of RI should
         collide with with ULSCH for a UE and check for Data Reception Request
          for Data and HARQ, RI together. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>
        
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" 
          riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

     <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

       <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
       <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9"
            transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        </tapa.expset>  

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point of time we are at (2,9) and Reception Request Info time is (3,1)
      # Expect data reception request, HARQ for DL Data and RI
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.dlcqi.recp.req />
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Send ACK for the received PDU
       <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

# ccpu00119953 MOD added aperiodic cqi configuration
#
#       Test:    1.72
#
#       Desc:   Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="1.72" altid="20.33">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH." 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI and RI, CQI and SRS with a certain 
         Periodicity.Send DLSCH and do not send a Feedback so as to trigger a Aperiodic CQI
         Request through DCI-0. Configure a DLSCH and a ULSCH such that the Periodicity of 
         RI, CQI, SRS should collide with with ULSCH for a UE and collide with the Aperiodic CQI
         and check for Data Reception Request  for Data and HARQ, ACQI and SRS. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
                      aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

   <tapa.repeat.start repeatCount="2"/>  
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               lcId="9" chkSdu="TRUE" saveTo="2"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Send NACK
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send NACK
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send NACK
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      #Minor correction in timing done
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send NACK
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   <tapa.repeat.end />  
      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="30" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               lcId="9" chkSdu="TRUE" saveTo="2"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      #Minor correction in timing done
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
               cqiReq="1"  vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point of time we are at (7,7) and Reception Request Info time is (7,9)
      # Expect data reception request, HARQ for DL Data and ACQI
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" 
               vldtCqi="TRUE" cqiPmiSzR1="30" cqiPmiSzRn1="30" riPres="1" ri="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.73
#
#       Desc:    To test Tx Antenna Selection through SRS using Closed-Loop Mode 
#
#       Notes:   None
#              
#       Module:  Reception Request for SRS 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="1.73" altid="20.50">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Tx Antenna Selection through SRS using Closed-Loop Mode"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a SRS with a certain 
         Periodicity and expect a SRS reception request followed by a SRS Indication.
         With Closed-Loop Transmit Antenna Selection, Antenna Ports Chosen will depend
         on CQI values received on two Ports on successive SRS Indications. A comparison will
         be done and an Antenna with a better CQI shall be chosen. "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Initialize UE
      <tapa.rg.UeInit ueId="0" ulTxAntSelPres = "TRUE" 
          selType="RGAC_RGR_UE_TX_ANT_CLOSEDLOOP"/>
   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
     <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

    # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,2)
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="9" 
          sANSrs="TRUE"   UeReCfgType="8192"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

     # At start of this step, we are at (3,0) and Reception Request Info time is (3,2)
     # Expect SRS reception request from Scheduler
      <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

     # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send SRS Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="6"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

     # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" isTxAntSel="TRUE" txAntenna="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # At start of this step, we are at (4,0) and Reception Request Info time is (4,2)
     # Expect SRS reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="7"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" isTxAntSel="TRUE" txAntenna="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # At start of this step, we are at (5,0) and Reception Request Info time is (5,2)
     # Expect SRS reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

      
      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send SRS Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="9"/>
         </tapa.tfu.srs.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#ccpu00119953 MOD added aperiodic cqi configuration
#
#       Test:    1.74
#
#       Desc:    Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="1.74" altid="20.58" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI and RI, CQI and SRS with a certain 
         Periodicity.Send DLSCH and do not send a Feedback so as to trigger a Aperiodic CQI
         Request through DCI-0. Configure a DLSCH and a ULSCH such that the Periodicity of 
         RI, CQI, SRS should collide with with ULSCH for a UE and collide with the Aperiodic CQI
         and check for Data Reception Request  for Data and HARQ, ACQI and SRS. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3" 
              aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" aprdModeEnumPres="TRUE"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      #Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="5" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "1" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="4"/>
     </tapa.send>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
     </tapa.send>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.cntrl.req numCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" saveTo="3" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC - same as NACK

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>(4,3)
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     #No harq feedback is sent- same as sending nack
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>(4,3)
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #No hq feedback sent-same as sending nack
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>
     
      <tapa.expset>(4,3)
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     #No harq feedback is sent- same as sending nack

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      
      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      # Hence, the SRS will arrive on Reception Request Info time (3,1)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="8192"
            srsCfgPres ="TRUE" srsCfgIdx ="22" />
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50"/>
      </tapa.send>

     #Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
      <tapa.expset>(4,3)
         <tapa.tfu.cntrl.req numCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
            # <tapa.tfu.pdcch.cntrl.req saveTo="1" cqiReq="TRUE" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>(4,3)
         <tapa.tfu.cntrl.req numCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="1" cqiReq="TRUE" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #At this point of time we are at (7,7) and Reception Request Info time is (7,9)
      # Expect data reception request, HARQ for DL Data and ACQI
      <tapa.expset>
          <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.srs.recp.req />
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.dlcqi.recp.req />
      #ccpu00117050 - ADD - nSrs setting
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE"  nSrs="1" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs/>
         </tapa.tfu.srs.ind>
      </tapa.send>
       # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="FALSE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
    </tapa.send>

    #Send Data Indication using TB size recieved in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="9"/>
        </tapa.tfu.dat.ind>
    </tapa.send>
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
      </tapa.expect>

 <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
    </tapa.send>
      
     <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
    </tapa.send>
 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

# ccpu00119953 MOD added aperiodic cqi configuration
# ccpu00119087 MOD changes in retransmsission when there is a DTX
#       Test:    1.75
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#           Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="1.75" altid="20.59">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
       <tapa.ifdef>
         <tapa.flag id="DLFS_INV"/>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"   dlSchdType="0"/>
      
      #Finish RACH and then do UE Configuratrion
      <tapa.rg.UeInit ueId="0" txModeEnum="RGR_UE_TM_3" prdBsrTmr="65535"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE"/>

      <tapa.rg.UeInit ueId="1" txModeEnum="RGR_UE_TM_3" prdBsrTmr="65535"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE"/>
   </tapa.cfg>
   
   # Test Steps subsection
     <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" ueId="0" />
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" ueId="1" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0" ueId="0"/>
         <tapa.crg.cfgcfm status="0" ueId="0"/>
         <tapa.crg.cfgcfm status="0" ueId="1"/>
         <tapa.crg.cfgcfm status="0" ueId="1"/>
     </tapa.expset>
    
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5" ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="0"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>
     
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               lcId="9" chkSdu="TRUE" saveTo="2"/>
         </tapa.tfu.dat.req>
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="3" ueId="1"/>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2" ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>
     
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" 
               lcId="9" chkSdu="TRUE" saveTo="2"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="3" ueId="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # No feedback sent in this TC - same as NACK

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         #Expect retransmission from MAC to PHY for both the data
         #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="0"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="1"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #rg003.301 expect HARQ reception request for 2 Data retransmitted
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
     
      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="0"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="1"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE" ueId="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>
     
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
   
      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="4" chkSdu="TRUE" 
                lcId="9" ueId="0"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req use="4" chkSdu="TRUE" 
                lcId="9" ueId="1"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" use="1" vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="4" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>
     
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
    
      # Send UE config request at RGR 
      # At start of this step, we are at (9,0) and Reception Request Info time is (9,2)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newcrnti="11" prdCqiCfg.type="TRUE" cqiPCfgIdx ="15" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" newcrnti="12" prdCqiCfg.type="TRUE" cqiPCfgIdx ="15" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>
     
      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      # Hence, the SRS will arrive on Reception Request Info time (3,1)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newcrnti="11" UeReCfgType="8192"
            srsCfgPres ="TRUE" srsCfgIdx ="15" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" UeReCfgType="8192" newcrnti="12"
            srsCfgPres ="TRUE" srsCfgIdx ="15" />
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newcrnti="11" txModeEnum="RGR_UE_TM_3"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" txModeEnum="RGR_UE_TM_3" newcrnti="12"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
      </tapa.expset>
     
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="1"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9"
               transMode = "TFU_UE_TM_3" chkSdu="TRUE" saveTo="6"/>
            <tapa.tfu.pdsch.dat.req ueId="1"  use="8" lcId="9"
               transMode = "TFU_UE_TM_3" chkSdu="TRUE" saveTo="7"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="4">
            <tapa.tfu.pdcch.cntrl.req saveTo="9" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" isUlGrant="TRUE" 
               cqiReq="TRUE"  vldtGrant="TRUE" vldtTx="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="8" ueId="1"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" isUlGrant="TRUE" 
               cqiReq="TRUE"  vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset> 
     
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" TTI="100"/>
      </tapa.send>

      #At this point of time we are at (7,7) and Reception Request Info time is (7,9)
      # Expect data reception request, HARQ for DL Data and ACQI
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
      #ccpu00117050 - ADD - nSrs setting 
           <tapa.tfu.dlcqi.recp.req ueId="0"/>
            <tapa.tfu.dlcqi.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" TTI="100"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
      #ccpu00117050 - ADD - nSrs setting 
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"
               nSrs="0" ueId="0"/>
            <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="4"
               nSrs="0" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="1" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="1"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat ueId="0" use="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat ueId="1" use="4"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
    
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
  </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    1.76
#
#       Desc:   "Verify that HD-FDD Configuration happens sucessfully."
#
#       Notes:   None
#
#       Module:  Half Duplex FDD
#
#       File:    rgac_tc1.xml
#
################################################################################
   <tapa.testcase id="1.76" altid="22.1" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
            "Verify that HD-FDD Configuration happens sucessfully."
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1, Cell#1
                2. Send Reconfigure with HD-FDD is enabled.
                3. Expect Configuration confirm iwth status = RGR_CFG_CFM_OK"
         </tapa.longdesc>

      </tapa.doc>

      # Require features and flags subsection
      <tapa.require>

         <tapa.ifdef>
            <tapa.flag id="LTEMAC_HDFDD"/>
         </tapa.ifdef>

         <tapa.ifndef>
            <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>

      </tapa.require>

      # Configuration subsection
      <tapa.cfg>

         # Layer Manager Configuration
         <tapa.rg.macInit/>

         # Cell Configuration
         <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
            rntiSize="11" />
         <tapa.rg.dbgDeInitAll/>
         <tapa.rg.dbgInitAll/>
      </tapa.cfg>

      # Test Steps subsection
      <tapa.test>
            <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
               # Send RaReqInd for one rapId
            <tapa.send>
               <tapa.tfu.tti.ind numTti="1"/>
            </tapa.send>
            <tapa.send>
               <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
                  <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
                     tpcs="1" cqiPres="TRUE" cqis="4"/>
               </tapa.tfu.rareq.ind>
            </tapa.send>

            # Ue starts expecting raResp after 3 subframes within the raResp
            # window.
            # In this TC, it shall expect raResp in the first subframe after
            # 3 Ttis.
            <tapa.send>
               <tapa.tfu.tti.ind numTti="1"/>
            </tapa.send>
            <tapa.send>
               <tapa.tfu.tti.ind numTti="1"/>
            </tapa.send>

            # Expect RaResp for the rapId sent in RaReq
            <tapa.expset>
              <tapa.tfu.dat.req datReqs="1">
                 <tapa.tfu.rarsp.req />
              </tapa.tfu.dat.req>
              <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
                 <tapa.tfu.pdcch.cntrl.req/>
              </tapa.tfu.cntrl.req>
            </tapa.expset>

            <tapa.send>
               <tapa.tfu.tti.ind numTti="6"/>
            </tapa.send>

            <tapa.expect>
               <tapa.tfu.recp.req numRntis="1" spId="1" >
                  <tapa.tfu.msg3.recp.req/>
               </tapa.tfu.recp.req>
            </tapa.expect>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="3"/>
         </tapa.send>

         #Send CRC for Msg3
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc isFailure="FALSE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="1"/>
         </tapa.send>

         # Expect HARQ ACK in PHICH For MSG3
         <tapa.expect>
            <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
               <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            </tapa.tfu.cntrl.req>
         </tapa.expect>

         # Send Message3 after receiving Message3 reception req.
         <tapa.send>
             <tapa.tfu.dat.ind datInds="1">
                <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
             </tapa.tfu.dat.ind>
         </tapa.send>


         # Expect Message3 datReq on CCCH at RGU.
         <tapa.expect>
            <tapa.rgu.cdatind lcId="4"/>
         </tapa.expect>

          # Send BO for Msg4 on RGU.
          <tapa.send>
             <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
          </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="1"/>
         </tapa.send>

         # Expect CStatInd For MSG4
         <tapa.expset>
            <tapa.rgu.cstaind lcId="4"/>
         </tapa.expset>

         # Send Msg4 on RGU.
         <tapa.send>
            <tapa.rgu.cdatreq lcId="4" lcType="3" />
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="1"/>
         </tapa.send>

         # Expect Msg4 from MAC to PHY.
         <tapa.expset>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
           </tapa.tfu.dat.req>
           <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="4"/>
         </tapa.send>

         # Recv Hq Recp Req for Msg4.
         <tapa.expect>
           <tapa.tfu.recp.req numRntis="1" spId="1">
              <tapa.tfu.hq.recp.req/>
           </tapa.tfu.recp.req>
         </tapa.expect>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="3" />
         </tapa.send>

         # Send ACK as feedback for Msg4.
         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq />
           </tapa.tfu.hq.ind>
        </tapa.send>

         # Send UE config request
         <tapa.send>
           <tapa.crg.cfgreq.cfg.ue/>
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Send UE config request
         <tapa.send>
           <tapa.rgr.cfgreq.cfg.ue hdfdd="TRUE"/>
         </tapa.send>


         # Send TTI to apply the config
         <tapa.send>
            <tapa.tfu.tti.ind/>
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>


      </tapa.test>

      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>

###############################################################################
#
#       Test:    1.77
#
#       Desc:   "Verify scheduler should schedule UP link data in sub frame n,
#                if -
#                Condition 1:  subframe n is not DL
#                Condition 1:  subframe n does not have any BCCH/PCCH occasions
#                Condition 2:  subframe n + 4 is not UL
#                Condition 3:  subframe n - 4 is not UL
#                Condition 4:  subframe n - 1 is not DL data"
#
#       Notes:   None
#
#       Module:  Half Duplex FDD
#
#       File:    rgac_tc1.xml
#
################################################################################
   <tapa.testcase id="1.77" altid="22.20" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
            "Verify scheduler should schedule UP link data in sub frame n, if
                Condition 1:  subframe n is not DL
                Condition 1:  subframe n does not have any BCCH/PCCH occasions
                Condition 2:  subframe n + 4 is not UL
                Condition 3:  subframe n - 4 is not UL
                Condition 4:  subframe n - 1 is not DL data"
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1, Cell#1
                2. Reconfigure HD-FDD is enabled.
                3. Configure DL logical Channel 1, UL logical channel group 1
                   (only one logical channel)
                4. Report BSR
                5. Schedule UL/DL data for next 10 subframes.
                6. Make sure that scheduling happens as per the UL scheduling
                   rules."
         </tapa.longdesc>

      </tapa.doc>

      # Require features and flags subsection
      <tapa.require>

         <tapa.ifdef>
            <tapa.flag id="LTEMAC_HDFDD"/>
         </tapa.ifdef>

         <tapa.ifndef>
            <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>

      </tapa.require>

   # Configuration subsection
      <tapa.cfg>

         # Initialize LTEMAC
         <tapa.rg.macInit/>

         <tapa.rg.dbgDeInitAll/>
         #Initialize CELL
         <tapa.rg.cellInit ulTotalBw="20"/>
         #Initialize UE
         <tapa.rg.UeInit hdfdd="TRUE"/>

      </tapa.cfg>

   # Test Steps subsection
      <tapa.test>

         <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3"
                     lcType="4" ulQci="8"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0"
                     dir="3" lcType="4" ulQci="8" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Send TTI indication for default cell
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="1" numTti="1"/>#tti 1
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Send SR Indication for default UE
        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr/> #DATA (A)
           </tapa.tfu.sr.ind>
        </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="2" numTti="1"/>#tti 2
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                     vldtGrant="TRUE" vldtTx="TRUE"/> #For A
           </tapa.tfu.cntrl.req>
         </tapa.expset>

        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr/> #DATA (B)
           </tapa.tfu.sr.ind>
        </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="3" numTti="1"/>#tti 3
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                     vldtGrant="TRUE" vldtTx="TRUE"/> #For C
           </tapa.tfu.cntrl.req>
         </tapa.expset>

        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr/> #DATA (C)
           </tapa.tfu.sr.ind>
        </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="4" numTti="1"/>#tti 4
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                     vldtGrant="TRUE" vldtTx="TRUE"/> #For C
           </tapa.tfu.cntrl.req>
         </tapa.expset>

        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr/> #DATA (D)
           </tapa.tfu.sr.ind>
        </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="5" numTti="1"/>#tti 5
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                     vldtGrant="TRUE" vldtTx="TRUE"/> #For D
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="6" numTti="1"/>#tti 6
         </tapa.send>

         # Expect data reception request
         <tapa.expset>
            <tapa.tfu.recp.req numRntis="1"> #For A
               <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="7" numTti="1"/>#tti 7
         </tapa.send>

         # Expect data reception request
         <tapa.expset>
            <tapa.tfu.recp.req numRntis="1"> #For B
               <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="8" numTti="1"/>#tti 8
         </tapa.send>

         # Expect data reception request
         <tapa.expset>
            <tapa.tfu.recp.req numRntis="1"> #For C
               <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="9" numTti="1"/>#tti 9
         </tapa.send>

         # Expect data reception request
         <tapa.expset>
            <tapa.tfu.recp.req numRntis="1"> #For D
               <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/># For A
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="10" numTti="1"/>#tti 10
         </tapa.send>

         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/># For B
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat use="2" lcId="9"/> #For A
          </tapa.tfu.dat.ind>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.phich.cntrl.req isAck="TRUE"/> #For A
           </tapa.tfu.cntrl.req>
            <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>#For  A
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="11" numTti="1"/>#tti 11
         </tapa.send>

         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/># For C
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat use="2" lcId="9"/> #For B
          </tapa.tfu.dat.ind>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.phich.cntrl.req isAck="TRUE"/> #For B
           </tapa.tfu.cntrl.req>
            <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>#For  B
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="12" numTti="1"/>#tti 12
         </tapa.send>

         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/># For D
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat use="2" lcId="9"/> #For C
          </tapa.tfu.dat.ind>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.phich.cntrl.req isAck="TRUE"/> #For C
           </tapa.tfu.cntrl.req>
            <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>#For  C
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="13" numTti="1"/>#tti 13
         </tapa.send>

         #Send CRC for Msg
         <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat use="2" lcId="9"/> #For D
          </tapa.tfu.dat.ind>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.phich.cntrl.req isAck="TRUE"/> #For D
           </tapa.tfu.cntrl.req>
            <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/> #For D
         </tapa.expset>
<!--
         #Sending extra tti to make sure nothing is left
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="EXTRA" numTti="5"/> #tti Extra TTI
         </tapa.send>
-->
      </tapa.test>

      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>

###############################################################################
#
#       Test:    1.78
#
#       Desc:   "Verify scheduler schedules down link data for sub frame n
#                while following conditions are met:
#                Condition 1:  subframe n is not UL
#                Condition 2:  subframe n+1 is not UL
#                Condition 3:  subframe n+4 is not DL"
#
#       Notes:   None
#
#       Module:  Half Duplex FDD
#
#       File:    rgac_tc1.xml
#
################################################################################
   <tapa.testcase id="1.78" altid="22.12" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
            "Verify scheduler schedules down link data for sub frame n while
             following conditions are met:
                Condition 1:  subframe n is not UL
                Condition 2:  subframe n+1 is not UL
                Condition 3:  subframe n+4 is not DL"
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1, Cell#1
                2. Reconfigure HD-FDD is enabled.
                3. Configure DL logical Channel 1, UL logical channel group 1
                   (only one logical channel)
                4. Report BSR
                5. Schedule UL/DL data for next 10 subframes.
                6. RLC Report BO status for DL data, make sure that scheduling
                     happens as per the DL scheduling rules."
         </tapa.longdesc>

      </tapa.doc>

      # Require features and flags subsection
      <tapa.require>

         <tapa.ifdef>
            <tapa.flag id="LTEMAC_HDFDD"/>
         </tapa.ifdef>

         <tapa.ifndef>
           <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>

      </tapa.require>

      # Configuration subsection
      <tapa.cfg>


         # Initialize LTEMAC
         <tapa.rg.macInit/>

         <tapa.rg.dbgDeInitAll/>

         #Initialize CELL
         <tapa.rg.cellInit.dlSched
            dlSchdType="0" ulSchdType="0"/>

         #Do RACH and UE Config
         <tapa.rg.UeInit ueId="0" hdfdd="TRUE"/>

      </tapa.cfg>

      # Test Steps subsection
      <tapa.test>

         # Configure a dedicated logical channel for the created UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1"
            dlQci="3" dlGbr="1000" dlMbr="2000"/>
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Configure a dedicated logical channel for the created UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="0" lcId="9" lcType="4"
            dir="1" dlQci="3" dlGbr="1000" dlMbr="2000"/>
         </tapa.send>

         # Send a Tti to get the configuration applied.
         <tapa.send>
            <tapa.tfu.tti.ind/> #tti 1
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/> # DATA (A)
         </tapa.send>

         # Send a Tti to get the transmission scheduled.
         <tapa.send>
            <tapa.tfu.tti.ind/> #tti 2
         </tapa.send>

         # Expect staInd from MAC to RLC for UE1.
         <tapa.expect>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/> #For (A)
         </tapa.expect>

         # Send DDatReq for UE1 with size equal to the allocated size on RGU.
        <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9"
                     lcType="4"/># For (A)
         </tapa.send>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/> # DATA (B)
         </tapa.send>


         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.send>
            <tapa.tfu.tti.ind /> #tti 3
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/> #For (B)
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/> #For (A)
        </tapa.tfu.cntrl.req>
      # Expect Msg4 from MAC to PHY.
        <tapa.tfu.dat.req datReqs="1">
            #This is Scheduled for actual air tx in 5, Hq is at 9, RecpReq at 7
           <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>#For (A)
        </tapa.tfu.dat.req>
      </tapa.expset>

         # Send DDatReq for UE1 with size equal to the allocated size on RGU.
        <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9"
                  lcType="4"/> #For (B)
         </tapa.send>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/> #DATA (C)
         </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="4" numTti="1"/> #tti 4
      </tapa.send>

      # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/> #For (C)
        <tapa.tfu.cntrl.req numCntrlReq="1">
            #This is Scheduled for actual air tx in 6, Hq is at 10, RecpReq at 8
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>#For (B)
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>#For (B)
        </tapa.tfu.dat.req>
      </tapa.expset>

      # Send DDatReq for UE1 with size equal to the allocated size on RGU.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/> #For (C)
      </tapa.send>

      # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/> #DATA (D)
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="5" numTti="1"/> #tti 5
      </tapa.send>

      # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
      <tapa.expset>
      <tapa.tfu.cntrl.req numCntrlReq="1">
            #This is Scheduled for actual air tx in 7, Hq is at 11, RecpReq at 9
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>#For (C)
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>#For (C)
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="6" numTti="1"/> #tti 6
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="7" numTti="1"/> #tti 7
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1">
            # This Hq f/b is received at 9(Air) and indicated in 10
           <tapa.tfu.hq.recp.req ueId="0"/>#For (A)
        </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="8" numTti="1"/> #tti 8
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1">
            # This Hq f/b is received at 10(Air) and indicated in 11
           <tapa.tfu.hq.recp.req ueId="0"/>#For (B)
        </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="9" numTti="1"/> #tti 9
      </tapa.send>

      <tapa.expset>
        <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/> #For (D)
        <tapa.tfu.recp.req numRntis="1">
            # This Hq f/b is received at 10(Air) and indicated in 11
           <tapa.tfu.hq.recp.req ueId="0"/>#For (C)
        </tapa.tfu.recp.req>
      </tapa.expset>

      # Send DDatReq for UE1 with size equal to the allocated size on RGU.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/> #For (D)
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="10" numTti="1"/> #tti 10
      </tapa.send>

      # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
      #This is Scheduled for actual air tx in 12, Hq is at 16, RecpReq at 14
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>#For (D)
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>#For (D)
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/># For (A)
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="11" numTti="1"/> #tti 11
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/># For (B)
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="12" numTti="1"/> #tti 12
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/># For (C)
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="14" numTti="2"/> #tti 13 and 14
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1">
            # This Hq f/b is received at 10(Air) and indicated in 11
           <tapa.tfu.hq.recp.req ueId="0"/>#For (C)
        </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="17" numTti="3"/> #tti 15, 16 and 17
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/># For (D)
        </tapa.tfu.hq.ind>
      </tapa.send>

      #Sending extra tti to make sure nothing is left
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="EXTRA" numTti="4"/> #tti Extra TTI
      </tapa.send>

      </tapa.test>

      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>


###############################################################################
#
#       Test:    1.79
#
#       Desc:   "Verify scheduler should not schedule uplink re transmission
#                (adaptive) at sub frame n if BCCH transmission is expecting
#                at sub frame "n"."
#
#       Notes:   None
#
#       Module:  Half Duplex FDD
#
#       File:    rgac_tc1.xml
#
################################################################################
   <tapa.testcase id="1.79" altid="22.22" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
            "Verify scheduler should not schedule uplink re transmission
            (adaptive) at sub frame n if BCCH transmission is expecting
            at sub frame "n"."
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1(SR is enabled, periodic CQI, SRS is enabled,
                   HD-FDD), Cell#1
                2. Configure BCCH data transmission instance at sub frame n
                3. SR Reported
                4. BSR Reported
                5. Scheduler should not schedule uplink data at sub frame n"
         </tapa.longdesc>

      </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
         <tapa.ifdef>
            <tapa.flag id="RGR_SI_SCH"/>
            <tapa.flag id="LTEMAC_HDFDD"/>
         </tapa.ifdef>
         <tapa.ifndef>
            <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>
   </tapa.require>

      # Configuration subsection
   <tapa.cfg>

         # Layer Manager Configuration
         <tapa.rg.macInit/>

         # Cell Configuration
         <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2"/>
         <tapa.rg.UeInit ueId="0" hdfdd="TRUE"/>
         <tapa.rg.dbgDeInitAll/>
         <tapa.rg.dbgInitAll/>
   </tapa.cfg>

   <tapa.test>
         # Starting at 2,2
         <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3"
                     lcType="4" ulQci="8"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0"
                     dir="3" lcType="4" ulQci="8" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Send TTI indication for default cell
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="23" numTti="1"/>#tti 2, 3
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expset>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expset>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         <tapa.send>
            # Send SI Configuration request for MIB
            <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
         </tapa.send>

         <tapa.expect>
            # Expect SI Cfg Cfm from MAC
            <tapa.rgr.sicfgcfm instId="5"/>
         </tapa.expect>

         # SR indication is sent at 2,5 so that UL happens on 3,2
         # Respective ACK/NACK is scheduled at 3,6, such that,
         # if NACK is to be sent at 3,6, Re-tx from UE can happen
         # in 4,0 (UL), this colides with scheduled MIB message
         # because of which no re-tx scheduling happens. Trigger for
         # re-tx is done by sending Failure CRC indication.
         # SR ind at 2,5, Grant req at 2,6, PUSCH Recp Req at 3,0
         # Crc Ind (Failure) at 3,3, Phich (Tx REq (ACK) at 3,4
         # BCH Tx Req at 3,8

         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="25" numTti="2"/> # tti 2,5
         </tapa.send>

        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr/>
           </tapa.tfu.sr.ind>
        </tapa.send>

         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="26" numTti="1"/> # tti 2,6
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         # UL is expected at 3,2. Send Harq Recp request at 3,0
         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="30" numTti="4"/> # tti 3,0
         </tapa.send>

         # Expect data reception request
         <tapa.expset>
            <tapa.tfu.recp.req numRntis="1">
               <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="33" numTti="3"/>#tti 3,3
         </tapa.send>

         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="34" numTti="1"/>#tti 3,4
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="38" numTti="2"/>#tti 3,8
         </tapa.send>

      # Expect PDU from MAC to PHY for BCCH
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        </tapa.tfu.cntrl.req>
      </tapa.expset>
<!--
         <tapa.expect>
            <tapa.tfu.dat.req>
               <tapa.tfu.bch.dat.req />
            </tapa.tfu.dat.req>
         </tapa.expect>
-->
   </tapa.test>

      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>

###############################################################################
#
#       Test:    1.80
#
#       Desc:   "Verify scheduler sends ACK instead of NACK in subframe n if n
#                has PCCH occasion."
#
#       Notes:   None
#
#       Module:  Half Duplex FDD
#
#       File:    rgac_tc1.xml
#
################################################################################
   <tapa.testcase id="1.80" altid="22.25" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
            "Verify scheduler sends ACK instead of NACK in subframe n if n has
             PCCH occasion."
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1, Cell#1
                2. Reconfigure HD-FDD is enabled.
                3. Configure DL logical Channel 1, UL logical channel group 1
                   (only one logical channel)
                4. Report BSR
                5. Schedule UL data for sub frame n
                6. Schedule DL in n+8
                7. UE sends erroneous data in n
                8. Check that ACK is sent at across TFU in subframe n+4"
         </tapa.longdesc>

      </tapa.doc>

      # Require features and flags subsection
      <tapa.require>

         <tapa.ifdef>
            <tapa.flag id="LTEMAC_HDFDD"/>
         </tapa.ifdef>

         <tapa.ifndef>
            <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>

      </tapa.require>

   # Configuration subsection
      <tapa.cfg>

         # Initialize LTEMAC
         <tapa.rg.macInit/>
         <tapa.rg.dbgDeInitAll/>
         #Initialize CELL
         <tapa.rg.cellInit ulTotalBw="20"/>
         #Initialize UE
         <tapa.rg.UeInit hdfdd="TRUE"/>

      </tapa.cfg>

   # Test Steps subsection
      <tapa.test>

         <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="4" ulQci="8"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0"
                     dir="3" lcType="4" ulQci="8" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Send TTI indication for default cell
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="1" numTti="1"/>#tti 1
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Send SR Indication for default UE for
        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr/>
           </tapa.tfu.sr.ind>
        </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="24" numTti="1"/>#tti 2
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="28" numTti="4"/>#tti 6
         </tapa.send>

         # Send BO for PCCH
         <tapa.send>
            <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="10" />
         </tapa.send>

         # Expect data reception request
         <tapa.expset>
            <tapa.tfu.recp.req numRntis="1">
               <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="31" numTti="3"/>#tti 8
         </tapa.send>

         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="32" numTti="1"/>#tti 10
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="34" numTti="2"/>#tti 14
         </tapa.send>

       #Periodic BSR timer expires. So DCI-0 grant is given.
        <tapa.expect>
          <tapa.tfu.cntrl.req numCntrlReq="2"/>
             <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                       vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.expect>
         <tapa.send lc="TRUE">
            <tapa.tfu.tti.ind TTI-Identity="35" numTti="1"/>#tti 14
         </tapa.send>
         <tapa.expset>
            <tapa.rgu.cstaind lcId="3"/>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.cdatreq bcchIdx="1" lcId="3" lcType="2" bufSize="41"/>
         </tapa.send>

         # Send TTI indication for default cell
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="36" numTti="1"/>#tti 15
         </tapa.send>

         #Expect Pdcch/Pdsch Tx Req for PCCH Data
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="2" bcchIdx="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="2" bcchIdx="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>
      </tapa.test>

      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>

###############################################################################
#
#       Test:    1.81
#
#       Desc:   "Verify that if scheduler schedules all 10 subframes in
#                downlink or uplink, No conflict occurs and all HARQ and PDCCH
#                transfers are taken care."
#
#       Notes:   None
#
#       Module:  Half Duplex FDD
#
#       File:    rgac_tc1.xml
#
################################################################################
   <tapa.testcase id="1.81" altid="22.26" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
            "Verify that if scheduler schedules all 10 subframes in downlink or
             uplink, No conflict occurs and all HARQ and PDCCH transfers are
             taken care."
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1, Cell#1
                2. Reconfigure HD-FDD is enabled.
                3. Configure DL logical Channel 1, UL logical channel group 1
                   (only one logical channel)
                4. Report BSR
                5. Schedule UL/DL data for next 10 subframes.
                6. Make sure that scheduling happens as per the UL/DL scheduling
                   rules.
                  In this test case effective subframes actually scheduled
                  are 25"
         </tapa.longdesc>

      </tapa.doc>

      # Require features and flags subsection
      <tapa.require>

         <tapa.ifdef>
            <tapa.flag id="LTEMAC_HDFDD"/>
         </tapa.ifdef>

         <tapa.ifndef>
           <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>

      </tapa.require>

   # Configuration subsection
      <tapa.cfg>

         # Initialize LTEMAC
         <tapa.rg.macInit/>

         <tapa.rg.dbgDeInitAll/>
         #Initialize CELL
         <tapa.rg.cellInit ulTotalBw="20"/>
         #Initialize UE
         <tapa.rg.UeInit hdfdd="TRUE" prdBsrTmr="160"/>

      </tapa.cfg>

   # Test Steps subsection
      <tapa.test>

         <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3"
                     lcType="4" ulQci="8"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0"
                     dir="3" lcType="4" ulQci="8" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Send TTI indication for default cell
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="1" numTti="1"/>#tti 1
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Send SR Indication for default UE for
        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr/>
           </tapa.tfu.sr.ind>
        </tapa.send>

         # Send a TTI to schedule SR
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="2" numTti="1"/>#tti 2
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="3 to 5" numTti="3"/>#tti 3 to 5
         </tapa.send>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="6" numTti="1"/>#tti 6
         </tapa.send>

         # Expect data reception request
         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
            <tapa.tfu.recp.req numRntis="1">
               <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            </tapa.tfu.recp.req>
         </tapa.expset>

         # Send DDatReq for UE1 with size equal to the allocated size on RGU.
        <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="7" numTti="1"/>#tti 7
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

        <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="8" numTti="1"/>#tti 8
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

        <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="9" numTti="1"/>#tti 9
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="10" numTti="1"/> #tti 10
         </tapa.send>

         # Expect HARQ ACK in PHICH
         <tapa.expect>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           </tapa.tfu.cntrl.req>
         </tapa.expect>

         # Send Data Indication using TB size recieved in the grant
         <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat use="2" lcId="9"/>
          </tapa.tfu.dat.ind>
         </tapa.send>

         # Expect Data Indication at RLC
         <tapa.expect>
            <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
         </tapa.expect>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="11" numTti="1"/> #tti 11
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="12" numTti="1"/> #tti 12
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="13" numTti="1"/> #tti 13
         </tapa.send>

         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="14" numTti="1"/> #tti 14
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="15" numTti="1"/> #tti 15
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="16" numTti="1"/> #tti 16
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="17 and 18" numTti="2"/> #tti 17 and 18
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="19" numTti="1"/> #tti 19
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="20" numTti="1"/> #tti 20
         </tapa.send>

         <tapa.expset>
           <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="21" numTti="1"/> #tti 21
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
           <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="22" numTti="1"/> #tti 22
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
           <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="23" numTti="1"/> #tti 23
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="24 and 25" numTti="2"/> #tti 24 and 25
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="26" numTti="1"/> #tti 26
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="27" numTti="1"/> #tti 27
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="28" numTti="1"/> #tti 28
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="29" numTti="1"/> #tti 29
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="30" numTti="1"/> #tti 30
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         #Sending extra tti to make sure nothing is left
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="EXTRA" numTti="4"/> #tti Extra TTI
         </tapa.send>

     </tapa.test>
      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>

###############################################################################
#
#       Test:    1.82
#
#       Desc:   "Verify that HD-FDD and FDD UEs can co-exist in a CELL."
#
#       Notes:   None
#
#       Module:  Half Duplex FDD
#
#       File:    rgac_tc1.xml
#
################################################################################
   <tapa.testcase id="1.82" altid="22.27" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
            "Verify that HD-FDD and FDD UEs can co-exist in a CELL."
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1, UE#2 and Cell#1
                2. Reconfigure HD-FDD is enabled in UE#1
                3. Configure DL logical Channel 1, UL logical channel group 1
                   (only one logical channel) for each UE
                4. Report BSR for both UEs
                5. Schedule UL/DL data for next 10 subframes. for both UEs
                6. Make sure that scheduling happens as per the UL/DL scheduling
                   rules for HD-FDD ue and normal scheduling happens for UE2"
         </tapa.longdesc>

      </tapa.doc>

      # Require features and flags subsection
      <tapa.require>

         <tapa.ifdef>
            <tapa.flag id="LTEMAC_HDFDD"/>
         </tapa.ifdef>

         <tapa.ifndef>
            <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>

      </tapa.require>

   # Configuration subsection
      <tapa.cfg>

         # Initialize LTEMAC
         <tapa.rg.macInit/>

         <tapa.rg.dbgDeInitAll/>
         #Initialize CELL
         <tapa.rg.cellInit ulTotalBw="20"/>
         #Initialize UE
         <tapa.rg.UeInit ueId="0" hdfdd="TRUE"/>
         <tapa.rg.UeInit ueId="1"/>

      </tapa.cfg>

   # Test Steps subsection
      <tapa.test>

         <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcgId="0"
                        dir="3" lcType="4" ulQci="8"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcgId="0"
                        dir="3" lcType="4" ulQci="8"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3"
                     lcType="4" ulQci="8" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcgId="0" dir="3"
                     lcType="4" ulQci="8" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
         </tapa.send>

         # Send TTI indication for default cell
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="1" numTti="1"/>#tti 1
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expset>
            <tapa.rgr.cfgCfm instId="5"/>
            <tapa.rgr.cfgCfm instId="5"/>
            <tapa.rgr.cfgCfm instId="5"/>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expset>

         # Send SR Indication for default UE for DATA (A)
        <tapa.send>
           <tapa.tfu.sr.ind>
              <tapa.tfu.sr ueId="0"/>
              <tapa.tfu.sr ueId="1"/>
           </tapa.tfu.sr.ind>
        </tapa.send>

         # Send a TTI to schedule SR
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="2" numTti="1"/>#tti 2
         </tapa.send>

         # Expect DCI format 0 and do basic validations of the grant
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="2">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" />
              <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" />
           </tapa.tfu.cntrl.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="3 and 4" numTti="2"/>#tti 3 and 4
         </tapa.send>

         # Send BO for the created logical channel on RGU.
         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="5" numTti="1"/>#tti 5
         </tapa.send>

         # Expect data reception request
         <tapa.expect>
            <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="5"/>
         </tapa.expect>

         # Send DDatReq for UE1 with size equal to the allocated size on RGU.
        <tapa.send>
            <tapa.rgu.ddatreq ueId="1" lchTb1Data="9" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="6" numTti="1"/>#tti 6
         </tapa.send>

         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="5"/>
            <tapa.tfu.recp.req numRntis="1">
               <tapa.tfu.pusch.recp.req ueId="0" use="1" saveTo="3"/>
               <tapa.tfu.pusch.recp.req ueId="1" use="2" saveTo="4"/>
            </tapa.tfu.recp.req>

           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="5"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req ueId="1" use="5" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         # Send DDatReq for UE1 with size equal to the allocated size on RGU.
        <tapa.send>
            <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="7" numTti="1"/>#tti 7
         </tapa.send>

         # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req ueId="0" use="6" numSdu="1"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="8 and 9" numTti="2"/>#tti 8 and 9
         </tapa.send>

         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>

         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="10" numTti="1"/> #tti 10
         </tapa.send>

         # Expect HARQ ACK in PHICH
         <tapa.expect>
           <tapa.tfu.cntrl.req numCntrlReq="2">
              <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
              <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           </tapa.tfu.cntrl.req>
         </tapa.expect>

         # Send Data Indication using TB size recieved in the grant
         <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat ueId="0" use="3" lcId="9"/>
             <tapa.tfu.dat ueId="1" use="4" lcId="9"/>
          </tapa.tfu.dat.ind>
         </tapa.send>

         # Expect Data Indication at RLC
         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="1"/>
           </tapa.tfu.recp.req>
            <tapa.rgu.ddatind ueId="0" lchTb1Data="9,1" vldtBuf="TRUE"/>
            <tapa.rgu.ddatind ueId="1" lchTb1Data="9,1" vldtBuf="TRUE"/>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="11" numTti="1"/> #tti 11
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="12" numTti="1"/># tti 12 
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1"/>
         </tapa.expset>
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="13" numTti="1"/># tti 13
         </tapa.send>
         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="1"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

<!--
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="14" numTti="1"/># tti 14
         </tapa.send>


         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0"/>
           </tapa.tfu.hq.ind>
         </tapa.send>
         #Sending extra tti to make sure nothing is left
         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="EXTRA" numTti="2"/> #tti Extra TTI
         </tapa.send>
-->
     </tapa.test>

      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>

#
#
#       Test:    1.83
#
#       Desc:    To validate L2 Measurement request
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.83" altid="21.1">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To validate L2 Measurement request received from SM"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS" />
      </tapa.ifdef>

       <tapa.ifndef>
            <tapa.flag id="TFU_TDD"/>
       </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         <tapa.lrg.schL2measreq cellId="1"/>
      </tapa.send>
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_PAR_VAL"
            cellId="1"/>
      </tapa.expect>
      <!--
      <tapa.send>
         <tapa.lrg.schL2measreq measType="25"/>
      </tapa.send>

      <tapa.delay delay="5"/>
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>
      -->
      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#rg002.301 ccpu00109543 MOD
#
#       Test:   1.84
#
#       Desc:   "To test successful calculation of Average PRB usage in DL 
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.84" altid="21.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         To test the successful calculation of average PRB usage 
         in DL in FDD mode
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="60"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1" timePrd="13"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req>
         <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indication 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HARQ ACK indication for 2nd data request
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm prbPercDl="12"/>
      </tapa.expect>

      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.85
#
#       Desc:    To test average prb usage in uplink FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.85" altid="21.4">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test average prb usage in uplink in FDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS" />
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional non-GBR DTCHs for default UE 
     
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
     
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>
  
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="8" measType="2"/>
      </tapa.send>

       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect pdcch control request
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send second TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
          <tapa.lrg.schL2meascfm prbPercUl="15"/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.86
#       
#       Desc:    Test case to determine the Random Access Preamble 
#                 for a given time period
#       
#       Notes:   None
#              
#       Module:  MAC
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.86" altid="21.6">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the Random access preamble for a given time Period"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
      <tapa.flag id="RGR_V1"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>
   <tapa.cfg>
      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      #rg003.301 [ccpu00121085]-ADD-msg3 per TTI are now restricted
      #to 4. Configure a higher limit for this test case.
      <tapa.rg.cellInit maxMsg3PerUlSf="12"/>

   </tapa.cfg>
   # Test Steps subsection
    <tapa.test>
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="2" measType="16"/>
      </tapa.send>

      #Send Ra request indication for 2 UE 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="10" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="10" numRaReq="10" 
            rapIds="1:2:3:4:5:7:8:9:30:41" timingAdvs="3:3:3:3:3:3:3:3:3:3" 
            tpcs="1:1:1:1:1:1:1:1:1:1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Expect RaResp for the rapId sent in RaReq
      #Expect L2 Measurement confirm
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" rapIds="1:2:3:4:5:7:8:9:30:41"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.lrg.schL2meascfm dedPreambles="0" preLowRange="8" preHighRange="2"/>
     </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg002.301 ccpu00109543 MOD
#
#       Test:   1.87
#
#       Desc:   "To test successful calculation of Average PRB usage per 
#                QCI in DL"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.87" altid="21.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation of average PRB usage 
         per QCI in DL in FDD mode using single UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="80"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="8" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="4" timePrd="13" numQci="1" qci="8"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req>
         <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>
     
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indication 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HARQ ACK indication for 2nd data request
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm numDlQci="1" prbPercQci="15"/>
      </tapa.expect>

      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>


#
#
#       Test:    1.88
#
#       Desc:    To test average prb usage per qci in uplink 
#                in FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.88" altid="21.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test average prb usage per qci in uplink 
          in FDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" lcId="4" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect pdcch control request
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send second TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="9" measType="8" numQci="1" qci="8"/>
      </tapa.send>
      
      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
      # Expect HARQ ACK in PHICH For MSG3
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="7"/>
          </tapa.tfu.recp.req>        
       </tapa.expset>
      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="8"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="9"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="6" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>
      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="7" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="8" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message after receiving Message reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="9" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
         <tapa.lrg.schL2meascfm numUlQci="1" avgPrbPercQciUl="3"/>
      </tapa.expset>
      # DatInd that should go in this TTI is not sent
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   1.89
#
#       Desc:   "To test successful calculation of  number of 
#                active UE per qci in DL"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.89" altid="21.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation number of active
          UE per qci in DL "
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="3" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE2 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE3 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE4 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="10" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>
     
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send BO for UE2 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE3 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE4 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>


      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #rg002.301 -MOD - made changes to recieve multiple UE Cntrl and Data. 
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>

       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      #rg002.301:ccpu0019543-MOD-changing bo size from
      #400 to 40
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      #rg002.301:ccpu0019543-MOD-changing bo size from
      #400 to 40
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      #rg002.301:ccpu0019543-MOD-changing bo size from
      #400 to 40
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      #rg002.301 -MOD - Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
         
        <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
  
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      #rg002.301:ccpu0019543-MOD-changing bo size from
      #400 to 40
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>
      
      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      #rg002.301:ccpu0019543-MOD-changing bo size from
      #400 to 40
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      #rg002.301:ccpu0019543-MOD-changing bo size from
      #400 to 40
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      #rg002.301 -MOD - Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
         
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
   
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
       
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>
      
      #Send DDatReq for UE4
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="4">
          <tapa.tfu.pdcch.cntrl.req ueId="0"/>
          <tapa.tfu.pdcch.cntrl.req ueId="1"/>
          <tapa.tfu.pdcch.cntrl.req ueId="2"/>
          <tapa.tfu.pdcch.cntrl.req ueId="3"/>
        </tapa.tfu.cntrl.req>
        
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
    
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="4" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="2"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="3"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="2"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="3"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="4" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
         <tapa.lrg.schL2meascfm numDlActQci="1" actvUeDl="0"/>
      </tapa.expset>
    --> 
      </tapa.test>
  
   #Clean subsection
   <tapa.clean>
     
   #Command To ShutDown LTEMAC Layer
   <tapa.rg.macDeInit.grp16/>
  
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.90
#
#       Desc:    To test active UE per qci in uplink
#                in FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="1.90" altid="21.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To test active UE per qci in uplink"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="1000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="2000"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueBr="3000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="13" measType="64" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="63"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="62"/>
           <tapa.tfu.dat ueId="2" use="6" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="61"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # verify grnt is recieved for UEs in descending order of ueBr amount
      # with BW constraint restricdting grnt allocation to only 2 UEs
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

     
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="0"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#rg002.301 ccpu00109543 MOD
#
#       Test:   1.91 
#
#       Desc:   "To test packet delay calculation"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.91" altid="21.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation of packet delay in MAC"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="80"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" snMapPres="TRUE"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req>
         <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
     </tapa.expset>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
<!--
      <tapa.expect>
        <tapa.rgu.hqstaind numSta="1" status="0"/>
      </tapa.expect>
-->
      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   1.92 
#
#       Desc:   "To test Uu loss calculation"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.92" altid="21.15">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successfull handling of Uu loss calculation at MAC"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE configuration
      <tapa.rg.UeInit.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5" snMapPres="TRUE"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
         <tapa.tfu.dat.req datReqs="1">
              #ccpu00119023 MOD changed added retx parameters for validation
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK
      
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
              #ccpu00119023 MOD changed added retx parameters for validation
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

<!--   
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
-->
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
              #ccpu00119023 MOD changed added retx parameters for validation
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
   # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
      <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
  <!-- 
      # Expect HARQ status indication
      <tapa.expect>
         <tapa.rgu.hqstaind numSta="1" status="0"/>
      </tapa.expect>
     --> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#ccpu00109453 MOD
#
#       Test:   1.93 
#
#       Desc:   "To test successful calculation of Average PRB usage in DL"  
#                "in TDD mode"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.93" altid="21.3">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful calculation of Average PRB usage in DL"
         "In TDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueId="0"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         #<tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1" timePrd="4"/>
      </tapa.send>

#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="750" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
     </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

     <tapa.expset>
         <tapa.lrg.schL2meascfm prbPercDl="11"/>
     </tapa.expset>
   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   #Expect PDSCH and PDCCH for the dat req for DAT1 for 1st and 2nd UE
   #Expect staInd from MAC to RLC for DAT1 for 1st UE
   #Expect L2 Measurement confirm 
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1" spId="0">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
     </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #Expect HARQ Recption Request for DAT 1st UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
  </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
  
   # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#ccpu00118453 MOD changed UL BW
#
#       Test:    1.94
#
#       Desc:    To test average prb usage in uplink TDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="1.94" altid="21.5">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test average PRB usage in uplink in TDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxUlBwPerUe="50"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" prdBsrTmr="65535" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         #old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
           ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0" prdBsrTmr="65535"/> 
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0" /> 
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         #old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"
           ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="1" prdBsrTmr="65535"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                 ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="33" measType="2"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5" TTI="TPT1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     

      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      #Expect data indication for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="2" TTI="TPT2"/>
      </tapa.send>
      
     # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expect>
    # Send a TTI to schedule SR 
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="1"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
    # Send SR Indication for 1st UE and 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5" TTI="TPT3"/>
      </tapa.send>

      # Expect DCI format 0 for 1st UE and 2nd UE
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
       #old tapa.tfu.tti.ind numTti="4"/>
       <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for 1st UE and 2nd UE
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
        <tapa.tfu.pusch.recp.req  ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="3" TTI="TPT4"/>
      </tapa.send>
   #Send CRC for Msg for 1st UE and 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>


# Send BSR for 1st UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addLongBsr="TRUE" bsr0="5"  bsr1="12" 
            bsr2="45" bsr3="60" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>
   # Send BSR for 2nd UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addLongBsr="TRUE" bsr0="5"  bsr1="12" 
            bsr2="45" bsr3="60" ueId="1"/>
      </tapa.tfu.dat.ind>
   </tapa.send>
    <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
    <tapa.send>
      <tapa.tfu.tti.ind numTti="2" TTI="TPT5" />
   </tapa.send>

     #Expect L2 Measurement confirm  
      <tapa.expect>
         <tapa.lrg.schL2meascfm prbPercUl="2"/>
      </tapa.expect>

   # Expect UL grant for 1st UE and 2nd UE
   <tapa.expect>
    <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" />
         <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" />
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
     <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expset>
      <tapa.tfu.recp.req numRntis="2" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
         <tapa.tfu.pusch.recp.req ueId="1"/>
      </tapa.tfu.recp.req>
#      <tapa.lrg.schL2meascfm prbPercUl="4"/>
   </tapa.expset>
 
</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    1.95
#
#       Desc:    To check configuration for CQI Reporting of DL Power
#                   management.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
###############################################################################

<tapa.testcase id="1.95" altid="20.62">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To check configuration for PUSH N CQI Reporting of DL Power management"
      </tapa.desc>

      <tapa.longdesc>
      " 1. Configure UE with CQI reporting enabled with N = 5
        2. Configure PCQI with some periodicity
        3. Expect Recpetion request at TFU interface and every occasion of CQI
        4. Expect StaInd at RGR interface after 5 CQIs"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="RGR_CQI_REPT"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" pushNCqiVal="5" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    1.96
#
#       Desc:   "Varify that pA configuration hapens successfuly and
#                configured pA Value is received in TfuDatReq"
#
#       Notes:   None
#
#       Module:  None
#
#       File:    rgac_tc20.xml
#
################################################################################
   <tapa.testcase id="1.96" altid="7.33" >

      # Document subsection
      <tapa.doc>

         <tapa.rfc id="" section=""/>
         <tapa.module id=""/>

         <tapa.desc>
         "Varify that pA configuration hapens successfuly and
          configured pA Value is received in TfuDatReq"
         </tapa.desc>

         <tapa.longdesc>
            "   1. Configure UE#1, Cell#1
                2. Configure DL logical Channel 1, UL logical channel group 1
                   (only one up logical channel), pA value =
                        RGAC_UE_DLPWRCNTRL_PA_DB_3
                4. RLC reports BO
                5. Expect Sts Indication from scheduler and send data from RLC
                6. Receive dat request at TFU interface with pA =
                        RGAC_UE_DLPWRCNTRL_PA_DB_3
                7. Reconfigure UE with pA = RGAC_UE_DLPWRCNTRL_PA_DB_6
                4. RLC reports BO
                5. Expect Sts Indication from scheduler and send data from RLC
                6. Receive dat request at TFU interface with pA =
                        RGAC_UE_DLPWRCNTRL_PA_DB_6"
         </tapa.longdesc>

      </tapa.doc>

      # Require features and flags subsection
      <tapa.require>

         <tapa.ifdef>
            <tapa.flag id="TFU_UPGRADE"/>
         </tapa.ifdef>

         <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         </tapa.ifndef>
         <tapa.mode mode="single"/>

      </tapa.require>

      # Configuration subsection
      <tapa.cfg>


         # Initialize LTEMAC
         <tapa.rg.macInit/>

         <tapa.rg.dbgDeInitAll/>
         #Initialize CELL
         <tapa.rg.cellInit numTxAntPorts ="2"/>

         #Finish RACH and then do UE Configuratrion
         <tapa.rg.rach/>

      </tapa.cfg>
      # Test Steps subsection
      <tapa.test>
        # Send UE config request at CRG
        <tapa.send>
           <tapa.crg.cfgreq.cfg.ue/>
        </tapa.send>
        # Expect success in cfg cfm from MAC
        <tapa.expect>
           <tapa.crg.cfgcfm/>
        </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3"
                     lcType="4" ulQci="8"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

        # Send UE config request at RGR
        # Configure pA = RGRUE_DLPWRCNTRL_PA_DB1
        <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue pAVal="5"/>
        </tapa.send>

         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0"
                     dir="3" lcType="4" ulQci="8" instId="5"/>
         </tapa.send>

        # Send TTI to apply the config
        <tapa.send>
           <tapa.tfu.tti.ind  TTI-Identity="1" numTti="1"/>
        </tapa.send>

        # Expect success in cfg cfm from Scheduler
         <tapa.expset>
          <tapa.rgr.cfgCfm instId="5"/>
          <tapa.rgr.cfgCfm instId="5"/>
          <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="9 and 10" numTti="1"/>
         </tapa.send>

         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
          </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0"
                        lcId="9" lcType="4"/>
         </tapa.send>


         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="11" numTti="1"/>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" chkPa="TRUE"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         # Send Reconfigure for other pA Value = RGRUE_DLPWRCNTRL_PA_DB_1DOT77
         <tapa.send>
            <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pAVal="3"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="12 and 13" numTti="1"/>
         </tapa.send>

         <tapa.expset>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="12 and 13" numTti="1"/>
         </tapa.send>

         <tapa.expset>
            <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
         </tapa.expset>

         <tapa.send>
            <tapa.rgu.ddatreq lchTb1Data="9" ueId="0"
                        lcId="9" lcType="4"/>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="12 and 13" numTti="1"/>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.cntrl.req numCntrlReq="1">
              <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req datReqs="1">
              <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" chkPa="TRUE"/>
           </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="12 and 13" numTti="1"/>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="16 to 18" numTti="3"/>
         </tapa.send>

         <tapa.expset>
           <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req ueId="0"/>
           </tapa.tfu.recp.req>
         </tapa.expset>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0" isAck="TRUE"/>
           </tapa.tfu.hq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind TTI-Identity="16 to 18" numTti="3"/>
         </tapa.send>

         <tapa.send>
           <tapa.tfu.hq.ind hqInds="1">
              <tapa.tfu.hq ueId="0" isAck="TRUE"/>
           </tapa.tfu.hq.ind>
         </tapa.send>


      </tapa.test>
      # Clean subsection
      <tapa.clean>
         <tapa.rg.macDeInit/>
      </tapa.clean>

      # Shutdown subsection
      <tapa.shutdown>
         # Layer Manager ShutDown
      </tapa.shutdown>
   </tapa.testcase>


#
#
#       Test:    1.97
#
#       Desc:    To test with DRX enabled, UE gets scheduled
#                only in its active time.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.97" altid="23.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that MAC schedules UE only in its active time."
      </tapa.desc>

      <tapa.longdesc>
      "Send BO in DRX period. Expect PDCCH only when On-Duration starts."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50" />
      
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="30"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="4"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.98
#
#       Desc:    Handling of SR is irrespective of the DRX state 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.98" altid="23.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify an SR received is satisified even if the UE is in its
          inactive time" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request
         with a certain Periodicity.Verify that the received SR is satisified
         even if UE is DRX Inactive or an UE is treated as DRX ACTIVE on receipt 
         of a SR and remains so till the SR is satisified.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_1" 
         isDrxEnabled="TRUE"
         drxOnDurTmr = "2"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="10"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="0"
       />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         #<tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>
       
      <tapa.send>
         # Send enough TTI's to come to SR occurence. 
         # Move till (4,6)
         <tapa.tfu.tti.ind numTti="23"/>
      </tapa.send>
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

     # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for UE to transmit) - TFU_DELTA(=2)
     # in advance that we expect datRecpReq
     <tapa.send>
        <tapa.tfu.tti.ind numTti="4"/>
     </tapa.send>

     #Expect data reception request
     <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>
           
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="2" lcId="9"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     # Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
     </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.99
#
#       Desc:    To test MAC starts Inactivity Timer. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.99" altid="23.16">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that MAC starts Inactivity Timer."
      </tapa.desc>

      <tapa.longdesc>
      "Send BO in Inactivity period. Expect PDCCH."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="300"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="4"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         # Send Status Response to collide with Inactivity timer. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="300"/>
      </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.100
#
#       Desc:   To Test that MAC moves to short DRX cycle after 
#               expiry of Inactivity timer.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.100" altid="23.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE moves to short DRX cycle on expiry of Inactivity
      timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="80"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="20"
      drxStartOffst="10"
      drxShortCycleTmr="16"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

       #Configure Logical Channel
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     #On-duration has expired. By now even the inactivity timer has expired and
     #UE has moved to short cycle. Send Status Response and expect indication when
     #the on-duration of the short cycle starts
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      
     #Send TTIs to collide with on-duration on short cycle.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

     #We received the status indication when the on-duration of the short cycle
     #starts which confirms that UE has switched to short cycle.
      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="300"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.101
#
#       Desc:    To test the functionality of HARQ RTT timer. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.101" altid="23.23">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test the HARQ RTT and DRX retx timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="40"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            saveTo="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect PDU from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="4" chkSdu="TRUE" lcId="3"
                isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req use="1" saveTo="4" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



#
#
#       Test:    1.102
#
#       Desc:    To test the functionality of HARQ Retx timer. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="1.102" altid="23.24">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test the HARQ RTT and DRX retx timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="6"/>
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="1"
      longDrxCycle="80"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="61"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      #Complete the RACH procedure of the 2nd UE. Dont expect retx of the first UE
      #as DRX retx timer has expired.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req  ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="1" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" />
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm ueId="1"/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" n1PUCCHVal="2:3:5:10"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" ueId="1" />
   </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.103
#
#       Desc:    For configuration 2, test that the UE only gets scheduled
#                during its active time.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="1.103" altid="11.46">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE only gets scheduled in its active time 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" spclSfCfgIdx="8"
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>


</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    1.104
#
#       Desc:    Msg4 collision with PBCH area.Fix for ccpu00121624.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.104" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
          "Msg4 collision with PBCH area.Fix for ccpu00121624."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>
   
   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="6"/>
  
      <tapa.rg.dbgDeInitAll/>
  
  </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   
      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.105
#
#       Desc:   "To test transmission of CCCH SDU in PBCH area." 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.105">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
          "To test transmission of CCCH SDU in PBCH area.
          Test fix for ccpu00121624" 
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="6" contResTmr="35" />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="500"/>
      </tapa.send>


      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" />
     </tapa.tfu.dat.req>   
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="400"/>
      </tapa.send>
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    1.106
#
#       Desc:    Checking the initNumRbs in pusch reception request
#                for multiple HARQ. Here retransmsission in initial grant message
#                
#
#       Notes:   None
#              
#       Module:  Uplink
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.106">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Checking the initNumRbs in pusch reception request
          for single HARQ. Here retransmsission in initial grant message."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_3" maxUlHqTx="2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      <tapa.send>

      # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="150"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 To ensure TD as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      #Expect HARQ reception request after 4 ttis
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="250"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1" lchTb2Data="9"/>
      </tapa.expect>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

       # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3  and precInfo=2 To ensure SpaMux as TX scheme
      # Expect UL grant 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect HARQ  and pusch reception request 
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
       <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
                 vldtInitNumRbs="1" initNumRbsPres="1" initNumRbsVal="6"/>
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expset>
  
  # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="250"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1" lchTb2Data="9"/>
      </tapa.expect>
      
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
  
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect NACK in PHICH as we have not sent any CRC success for UL
      # Expect pdsch dat request and pdcch control request for DL
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
     </tapa.expset>

     # Send 4 ttis to  get PUSCH retransmission also to get HARQ reception request for DL
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
       <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
                 vldtInitNumRbs="1" initNumRbsPres="1" initNumRbsVal="6"/>
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expset>

</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.107
#
#       Desc:    Checking the initNumRbs in pusch reception request
#                for different HARQ. Here retransmsission in 2nd HARQ proc
#                
#
#       Notes:   None
#              
#       Module:  Uplink
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.107">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
        "Checking the initNumRbs in pusch reception request
         for different HARQ. Here retransmsission in 2nd HARQ proc"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4"/>
      #Intialize 2 bi-directional DCCHs

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE (non-GBR)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8" />
      </tapa.send>
      
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE (non-GBR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8"  instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="4"/>
      </tapa.send>
    
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"  isTb1Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" 
            vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
    
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" TTI="100"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="2"
           vldtInitNumRbs="1" initNumRbsPres="1" initNumRbsVal="6"/>
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expset>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TRUE" />
     </tapa.tfu.hq.ind>   
  </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" />
      </tapa.expset>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="4"/>
      </tapa.send>
     
      # Send data indication using TB size recieved in the grant
    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3" addShortBsr="TRUE" bsr="6"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

      # Expect a DatInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1"/>
      </tapa.expect>
     
       # Send a TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req vldtTx="TRUE" saveTo="2" minGrantBits="152"
             vldtGrant="TRUE" isUlGrant="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="9"  isTb1Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
     </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" TTI="900"/>
      </tapa.send>

      # Expect data and HARQ reception request
      <tapa.expset>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE"
                 vldtInitNumRbs="1" initNumRbsPres="1" initNumRbsVal="6"/>
        <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>        
      </tapa.expset>
      
      #  do not send crc after 2 ttis
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>
      
      #  do not send crc after 1 ttis
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" />
      </tapa.expect>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TRUE" />
     </tapa.tfu.hq.ind>   
  </tapa.send>
    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="4"/>
      </tapa.send>

    #  do not send crc after 1 ttis
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="900"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH, data req and pdcch control request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="9"  isTb1Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
         </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
       </tapa.expset>
       
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" TTI="700"/>
      </tapa.send>

      # Expect data reception request for retransmission
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
         </tapa.tfu.cntrl.req>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE"
                 vldtInitNumRbs="1" initNumRbsPres="1" initNumRbsVal="6"/>
       </tapa.tfu.recp.req>        
        <tapa.tfu.hq.recp.req/>
      </tapa.expect>
     
      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.108
#
#       Desc:   "To test the successful C-RNTI based contention resolution with sub band size 1" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.108" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of C-RNTI based contention resolution with sub band
         size 1 and ccchCqi is 2"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.upd ccchCqi="3" size="1"/>

      # UE Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>
      # rg005.201 Removing debug prints
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.crg.cfgcfm/>
        <tapa.rgr.cfgCfm instId="5"/>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>
 
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      # and Data reception request for the UL grant sent for contention
      # resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Expect data reception request for Msg3 Re-Tx (ueId=1).
      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for UL data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For UL data 
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.109
#
#       Desc:   "To test the successful C-RNTI based contention resolution with sub band size 2" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.109" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of C-RNTI based contention resolution with sub band
         size 2 and ccchCqi is 2"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.upd ccchCqi="3" size="2"/>
      
      # UE Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>
      # rg005.201 Removing debug prints
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
                                    tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.crg.cfgcfm/>
        <tapa.rgr.cfgCfm instId="5"/>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="300"/>
      </tapa.send>
      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>
 
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      # and Data reception request for the UL grant sent for contention
      # resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Expect data reception request for Msg3 Re-Tx (ueId=1).
      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for UL data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For UL data 
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.110
#
#       Desc:   "To test the successful C-RNTI based contention resolution with sub band size 1
#                with ccchCqi as 1" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.110">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of C-RNTI based contention resolution with sub band
         size 1 and ccchCqi is 1"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.upd ccchCqi="1" size="1"/>
      # UE Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>
      # rg005.201 Removing debug prints
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
                                    tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.crg.cfgcfm/>
        <tapa.rgr.cfgCfm instId="5"/>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>
 
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      # and Data reception request for the UL grant sent for contention
      # resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Expect data reception request for Msg3 Re-Tx (ueId=1).
      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for UL data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For UL data 
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.111
#
#       Desc:   "To test the successful C-RNTI based contention resolution with sub band size 2
#                with ccchCqi as 1" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.111">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of C-RNTI based contention resolution with sub band
         size 1 and ccchCqi is 1"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.upd ccchCqi="1" size="2"/>

      # UE Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>
      # rg005.201 Removing debug prints
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
                                  tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.crg.cfgcfm/>
        <tapa.rgr.cfgCfm instId="5"/>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>
      
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      # and Data reception request for the UL grant sent for contention
      # resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Expect data reception request for Msg3 Re-Tx (ueId=1).
      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for UL data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For UL data 
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.112
#
#       Desc:   "To test multiple simultaneous random access procedures"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.112" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of multiple simultaneous random access procedures
         for multiple rapIds when maxMsg3PerUlSf is 3"
      </tapa.desc>

      <tapa.longdesc>
         "7 RAPIDs in one random access request indication shall be handled 
         and there will be 3 raRsp where 2 raRsp contains 3 rapIds and last one
         will have 1 rapId"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>
      # Cell Configuration
      <tapa.rg.cellInit size="2" numSubbands="24" ulTotalBw="60" 
       maxUePerDlSf="3"   maxMsg3PerUlSf="3" raWinSize="5"/>
      # Ue Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Configure a DTCH for the UE
      <tapa.send >
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a DTCH for the UE
      <tapa.send >
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send >
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send 1 tti for applying configuration
      <tapa.send >
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send RaReqInd for one rapId 
      <tapa.send lc="TRUE">
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="7" rapIds="18:56:35:43:53:12:13"
               timingAdvs="2:3:4:5:6:7:8" tpcs="1:2:3:4:5:6:7" cqiPres="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE"
               cqis="2:3:4:1:2:3:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaRsp for rapIds 18, 56 and 35
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" expectAll="FALSE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="100"/>
      </tapa.send>

      # Expect RaRsp for rapIds 43, 53 and 12
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" expectAll="FALSE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="200"/>
      </tapa.send>

      # Expect RaRsp for rapId 13
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" expectAll="FALSE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="3">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="2"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      
      # Expect Message3 reception req other 3 rapIds sent. 
      # Validation against the grant given in raResp shall be done
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="3">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="4"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="5"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="6"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      
      # Expect Message3 reception req for last rapId sent. 
      # Validation against the grant given in raResp shall be done
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="7"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg3 for the first raRsp
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3 for the first raRsp
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="1"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="2"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="3"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
         <tapa.rgu.cdatind ueId="3" lcId="4"/>
      </tapa.expset>

      #Send CRC for Msg3 for the 2nd raRsp
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="4" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="5" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="6" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3 for the 2nd raRsp
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="4" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="5" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="6" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="4"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="5"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="6"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Send BO for Msg4 on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="2"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="3"/>
      </tapa.send>
      

      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="4" lcId="4"/>
         <tapa.rgu.cdatind ueId="5" lcId="4"/>
         <tapa.rgu.cdatind ueId="6" lcId="4"/>
      </tapa.expset>

      #Send CRC for Msg3 for the last raRsp
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="7" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3 for the last raRsp
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="7" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.rgu.cstaind lcId="4" ueId="1"/>
         <tapa.rgu.cstaind lcId="4" ueId="2"/>
         <tapa.rgu.cstaind lcId="4" ueId="3"/>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="7"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="7" lcId="4"/>
      </tapa.expset>
      
      # Send BO for Msg4 on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="4"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="5"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="6"/>
      </tapa.send>

      # Send Msg4 on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="3" lcId="4" lcType="3" />
      </tapa.send>
      
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4" ueId="4"/>
         <tapa.rgu.cstaind lcId="4" ueId="5"/>
         <tapa.rgu.cstaind lcId="4" ueId="6"/>
        <tapa.tfu.dat.req datReqs="3">
           <tapa.tfu.pdsch.dat.req ueId="1"/>
           <tapa.tfu.pdsch.dat.req ueId="2"/>
           <tapa.tfu.pdsch.dat.req ueId="3"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
     <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="7"/>
      </tapa.send>

      # Send Msg4 on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="4" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="5" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="6" lcId="4" lcType="3" />
      </tapa.send>
      
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4" ueId="7"/>
        <tapa.tfu.dat.req datReqs="3">
           <tapa.tfu.pdsch.dat.req ueId="4"/>
           <tapa.tfu.pdsch.dat.req ueId="5"/>
           <tapa.tfu.pdsch.dat.req ueId="6"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="4"/>
           <tapa.tfu.pdcch.cntrl.req ueId="5"/>
           <tapa.tfu.pdcch.cntrl.req ueId="6"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
     # Send Msg4 on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.cdatreq ueId="7" lcId="4" lcType="3" />
      </tapa.send>

      # Send 1 TTI to get MSG4 at PHY
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="7"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="7"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.113
#
#       Desc:   "To test multiple simultaneous random access procedures"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.113" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of multiple simultaneous random access procedures
         for multiple rapIds with multiple request when maxMsg3PerUlSf is 20"
      </tapa.desc>

      <tapa.longdesc>
         "Sending multiple random access request and sending no MSG3"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>
      # Cell Configuration
      <tapa.rg.cellInit size="2" numSubbands="24" ulTotalBw="60" maxMsg3PerUlSf="20" 
         maxMsg3Tx ="2" rntiSize="30"/>
      # Ue Configuration
      <tapa.rg.UeInit.grp16 ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Configure a DTCH for the UE
      <tapa.send >
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a DTCH for the UE
      <tapa.send >
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send >
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send 1 tti for applying configuration
      <tapa.send >
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
     
      # Send RaReqInd for one rapId 
      <tapa.send lc="TRUE">
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="10" rapIds="1:2:3:4:5:6:7:8:9:10"
               tpcs="1:2:3:4:5:6:7:8:9:10" cqiPres="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE
               :TRUE:TRUE"
               cqis="2:3:4:2:3:4:2:3:4:2"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaRsp for rapIds 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" expectAll="TRUE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
     
      # Expect RaRsp for rapIds 10 11 and 12 and msg recep req
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="10">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="2"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="3"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="4"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="5"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="6"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="7"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="8"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="9"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="10"/>
         </tapa.tfu.recp.req>
      </tapa.expset>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="4" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="5" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="6" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="7" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="8" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="9" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="10" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="10" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="4" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="5" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="6" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="7" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="8" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="9" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="10" isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      #Retransmission here
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="10">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="2"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="3"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="4"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="5"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="6"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="7"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="8"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="9"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="10"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="4" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="5" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="6" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="7" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="8" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="9" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="10" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="10" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="4" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="5" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="6" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="7" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="8" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="9" isAck="FALSE"/>
            <tapa.tfu.phich.cntrl.req ueId="10" isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.114
#
#       Desc:    To test successful handover scenario with higher value of cqi
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.114">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful handover scenario." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for an Idle Ue.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49.
         Configure a HO Ue with dedPreamble Id as 50 and ccchCqi is 11"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>
      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"
            ccchCqi="11" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue cellId="3"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request with rnti not belonging to the configured rnti pool of SCH 
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
      </tapa.send>


      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # send raReq with the alloted rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="50"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      # send raReq with the alloted rapId again
      # verify that rapId-ue association is cleared in the 
      # previous raReqInd processing and that this is not honoured.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="50"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#rg002.301 ccpu00109543 MOD
#
#
#       Test:    1.115
#
#       Desc:    To verify successful UE reset for UEs pending with
#       transmissions or re-transmissions through 2 UE scenario.
#
#       Notes:   None
#              
#       Module:  "SC1 Module"
#
#       File:    rgac_tc13.xml
#
#
<tapa.testcase id="1.115">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful UE reset for UEs pending with transmissions or
         re-transmissions through 2 UE scenario.
      </tapa.desc>

      <tapa.longdesc>
         To verify successful UE reset for UEs pending with transmissions or
         re-transmissions through 2 UE scenario.
      </tapa.longdesc>

   </tapa.doc>
   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="50"  maxDlBwPerUe="25" 
         maxDlRetxBw="25"/>

      # UE Creation with periodic mode 1-0
      <tapa.rg.UeInit ueId="0" ueCatEnum="1" 
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"
         dlAmbr="15000"/>
      <tapa.rg.UeInit ueId="1" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated logical channel (DTCH) for the UE1  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure an non-ambr dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>
      
      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>
      
      # Configure a Non-GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 7 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="7" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      <tapa.send>
         # Send BO for the DCCH on RGU for UE1 
         <tapa.rgu.dstarsp ueId="0" lcId="1" lcType="5" bo="800"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="580"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="4" bo="540"/>
      </tapa.send>
      
      # Send CQI indication for periodic mode 1-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI indication for periodic mode 1-0 for UE2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="TRUE" cqiMode="0" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send UE Reset Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Reset Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5"  cellId="3" ueId="0"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # Send TTI to Scheduler
      # Expect staInd for UE2
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      

      <tapa.expect>
        # Now DTCH of UE2 shall get scheduled
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="3" />
      </tapa.expect>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="3,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send a TTI to get the PDCCH for UE2
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1" use="1" saveTo="2" validate="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 3 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
      # Send UE Reset Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Reset Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5"  cellId="3" ueId="1"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # Send TTIs to Scheduler
      # No other pending data is expected
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.116
#
#       Desc:    Harq retransmissions when no feedback comes from PHY
#               for schedType=1
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.116">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of HARQ ACK" 
      </tapa.desc>

      <tapa.longdesc>
         "Testing that MAC downlink HARQ handles absence of explit HARQ
         acknowledgement from PHY, and stops retransmissions when max number
         of downlink harq tx is exhausted."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1" ulSchdType="1"/>

      # UE configuration
      <tapa.rg.UeInit.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="100"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="FALSEE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send a tti (to get a Harq failure indication)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.117
#
#       Desc:    Harq retransmissions when no feedback comes from PHY
#               for schedType=2
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.117">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of HARQ ACK" 
      </tapa.desc>

      <tapa.longdesc>
         "Testing that MAC downlink HARQ handles absence of explit HARQ
         acknowledgement from PHY, and stops retransmissions when max number
         of downlink harq tx is exhausted."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2"/>

      # UE configuration
      <tapa.rg.UeInit.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="100"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="FALSEE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send a tti (to get a Harq failure indication)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    1.118
#
#       Desc:    Harq retransmissions when no feedback comes from PHY
#               for schedType=3
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.118">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of HARQ ACK" 
      </tapa.desc>

      <tapa.longdesc>
         "Testing that MAC downlink HARQ handles absence of explit HARQ
         acknowledgement from PHY, and stops retransmissions when max number
         of downlink harq tx is exhausted."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="3" ulSchdType="3"/>

      # UE configuration
      <tapa.rg.UeInit.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="100"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="FALSEE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send a tti (to get a Harq failure indication)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#ccpu00115364 changed test case considering changed modPrd value
#
#       Test:    1.119
#
#       Desc:    To test SI Scheduling using SI Enhancement for HDFDD
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.119">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="620"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" siWinSize="4"
          siRetxCnt="2" recfgType="2048" modPrd="64"/>
      </tapa.send>

       #SFN,SF is (62,0),giving TTI upto (62,3)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="19"/>
      </tapa.send>

      <tapa.expset>
        <tapa.rgr.cfgCfm instId="5" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      #Modify the SI information
      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" buffSz="37"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (62,4), giving TTI upto (63,8)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.bch.dat.req />
          <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
   
      #SFN,SF is (63,9), giving TTI upto (64,0)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


       #SFN,SF is (64,0), giving TTI upto (64,2)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,3), giving TTI upto (64,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,4), giving TTI upto (64,4)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,5) giving TTU upto (64,6)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
         <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="10" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,7) giving TTI upto (64,7)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="10" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,8) giving TTI upto (65,0)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="11" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,1) giving TTI upto (65,1)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="11" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,2) giving TTI upto (66,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
 
#
#       Test:    1.120
#
#       Desc:    To test Warning SI Scheduling when winSize = 5
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.120">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "5" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      
      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3" siId="6" bcchIdx="5" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.warningsicfgreq instId="5" bcchIdx="7" cellId="3" siId="7" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.warningsicfgcfm status="15" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="69"/>
      </tapa.send>
       
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>



   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#       Test:    1.121
#
#       Desc:    To test SI Scheduling Stop Req
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.121">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling Stop Req at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="45"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.warningsistopreq instId="5" siId="4" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="80"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>  

 
#
#       Test:    1.122
#
#       Desc:    To test Warning SI Scheduling when winSize = 15
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.122">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="3"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3" siId="5" bcchIdx="5" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.warningsicfgreq instId="5" bcchIdx="7" cellId="3" siId="6" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.warningsicfgcfm status="15" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="29"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>
       
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>      

  
#
#       Test:    1.123
#
#       Desc:    To test Warning SI Scheduling when winSize = 1,
#                in this case if SFN%2 is 0 and SF is 5, then 
#                this PDU should be schduled in next SF.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.123">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "1" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="46"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="100"/>
      </tapa.send>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>      
 
  
#
#       Test:    1.124
#
#       Desc:    To test SI Scheduling when winSize = 15
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.124">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>
      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="6" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5"  bcchIdx="3"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="7" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <!--
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      -->
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>   

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5"  vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
     

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.dat.req>
        </tapa.tfu.dat.req>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>


      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>      

    
#
#       Test:    1.125
#
#       Desc:    To test SI Scheduling when winSize = 15
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.125">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>
      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="6" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5"  bcchIdx="3"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="7" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         


      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" siWinSize="5"
          siRetxCnt="2" recfgType="2048" modPrd="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #[0,3]
      <tapa.expset>
        <tapa.rgr.cfgCfm instId="5" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>#SIB1
        </tapa.tfu.dat.req>
      </tapa.expset>

     #Modify the SI information
     # <tapa.send>
         # Send SI Configuration request for SIB1
         #<tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
     # </tapa.send>

     # <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         #<tapa.rgr.sicfgcfm instId="5"/>
     # </tapa.expect>
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #[1,3]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>   

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #[2,3]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5"  vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      #[4,3]
      <tapa.expset>
        <tapa.tfu.dat.req>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #[4,4]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      #[5,8]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #[6,3]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      #[7,8]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      
      #[8,3]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>


      #[9,3]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>


      #[10,3]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      #[12,3]
      <tapa.expset>
        <tapa.tfu.dat.req>
        </tapa.tfu.dat.req>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #[12,4]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>


      #[13,8]
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      #[14,3]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      #[15,8]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>      
                                
#
#       Test:    1.126
#
#       Desc:    To test Warning SI Scheduling if reTxCnt is 2
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.126">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Warning SI Scheduling if reTxCnt is 2"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="45"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="65"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>  
  
#
#       Test:    1.127
#
#       Desc:    To test two Warning SI with same siId
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.127">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="RG_INVALID"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3" siId="4" bcchIdx="5" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.warningsicfgreq instId="5" bcchIdx="7" cellId="3" siId="5" buffSz="32" numSeg="2"/>
      </tapa.send>

     # <tapa.send>
         #<tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="6"  bcchIdx="11"  buffSz="32" numSeg="2"/>
     # </tapa.send>


      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="7"  bcchIdx="13"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.warningsicfgcfm status="15" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="45"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <!--
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="11" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      -->


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
       
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <!--
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="12" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      -->

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="8" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>      
 
   
#
#       Test:    1.128
#
#       Desc:    To test two Warning SI with same siId with three seg
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.128">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="RG_INVALID"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="4" buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3" siId="4" bcchIdx="7" buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.warningsicfgreq instId="5" bcchIdx="11" cellId="3" siId="5" buffSz="32" numSeg="3"/>
      </tapa.send>

      #<tapa.send>
         #<tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="6"  bcchIdx="14"  buffSz="32" numSeg="3"/>
      #</tapa.send>


      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="7"  bcchIdx="20"  buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.warningsicfgcfm status="15" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="45"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <!--
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="14" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      -->


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
       
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <!--
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="15" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      -->

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>


      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <!--

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="16" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      -->

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="11" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="8" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="12" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="9" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="13" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>          

    
#
#       Test:    1.129
#
#       Desc:    To test two Warning SI with same siId with three seg
#                Check for Free index.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.129">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="RG_INVALID"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "15" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="4" buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3" siId="4" bcchIdx="7" buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.warningsicfgreq instId="5" bcchIdx="11" cellId="3" siId="5" buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="7"  bcchIdx="20"  buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.warningsicfgcfm status="15" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="45"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
       
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>


      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="20"  buffSz="32" numSeg="3"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="14" buffSz="32" numSeg="3" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="11" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="8" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="12" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="9" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="13" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>



       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="20" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                           

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="14" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                           

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="21" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                           


       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="15" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                           

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="22" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                           

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="16" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                           

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>           
    
#
#       Test:    1.130
#
#       Desc:    To test SI Scheduling when winSize = 5
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="1.130">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit siWinSize = "5" siRetxCnt ="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>
      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="6" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5"  bcchIdx="3"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="7" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <!--
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      -->
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>   

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1"  vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3"  vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
         
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>      
  
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>   

        
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>  


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>  

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="19"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.dat.req>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>      
 
  
#
#
#       Test:    1.131
#
#       Desc:   "To test the Prb Usage" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.131" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of Prb Usage"
      </tapa.desc>

      <tapa.longdesc>

     </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgm.cfgprdrprt periodicity="10" cfgType="TRUE"/>
      </tapa.send>

              
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind />
      </tapa.expect>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind />
      </tapa.expect>

      <tapa.send>
         <tapa.rgm.cfgprdrprt periodicity="10" cfgType="FALSE"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>        

  
#
#
#       Test:    1.132
#
#       Desc:   "To test the Prb Usage stop" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.132" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario to stop Prb Usage"
      </tapa.desc>

      <tapa.longdesc>

     </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="TRUE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="FALSE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="100"/>
      </tapa.send>


      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>   

   
#
#
#       Test:    1.133
#
#       Desc:   "To test the Prb Usage with 20" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.133" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of Prb Usage"
      </tapa.desc>

      <tapa.longdesc>

     </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="TRUE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind/>
      </tapa.expect>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind/>
      </tapa.expect>


      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="20" cfgType="TRUE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="FALSE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="100"/>
      </tapa.send>


      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>      

 
#
#
#       Test:    1.134
#
#       Desc:    Verify UL PRB Usage Calculation 
#
#       Notes:   None
#              
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="1.134" altid="15.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify UL PRB Usage Calculation" 
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      #UE1 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="TRUE" />
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.rgm.cfgprdrprtind />
        <tapa.tfu.recp.req>
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
         <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="400"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="400"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind />
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>            

 
#
#
#       Test:    1.135
#
#       Desc:    To test DL PRB Usage
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.135">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test DL PRB Usage"
      </tapa.desc>

      <tapa.longdesc>
         "Configure 8 Ues, first four with 1 GBR svc each and the next four with 1 AMBR svc each. GBR is sufficient and same (say 200). So is AMBR. Report BO for GBR SVCs are 50, 40,30,20 and follow the same for each AMBR svc. Verify the order of scheduling to be UE1,2,3,4,5,6,7,8. Now again send the staRsps, now reversing the BO. (i.e now UE1-svc shud be updated with 20). Verify the scheduling order this time to be UE4,3,2,1,8,7,6,5."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched2 ulSchdType="0"  dlSchdType="0"/>

      #Do RACH and UE Config
      <tapa.rg.UeInit.grp16 ueId="0"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
  <tapa.send>
     <tapa.tfu.dlcqi.ind>
         <tapa.tfu.dlcqi  ueId="0" cqiIdx="15"/>
     </tapa.tfu.dlcqi.ind>
  </tapa.send>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="300"  dlMbr="2000"
         instId="5"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="TRUE" />
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10000000"/>
      </tapa.send>


      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>


      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>


      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgm.cfgprdrprtind/>
         <tapa.tfu.recp.req numRntis="8">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
                    
 
 
#
#
#       Test:    1.136
#
#       Desc:   "To test the Prb Usage" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.136" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of Prb Usage"
      </tapa.desc>

      <tapa.longdesc>

     </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgm.cfgprdrprt periodicity="10" cfgType="TRUE"/>
      </tapa.send>

              
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind />
      </tapa.expect>


      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind />
      </tapa.expect>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>        
                  
   
#
#
#       Test:    1.137
#
#       Desc:   "To test the Prb Usage stop" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="1.137" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario to stop Prb Usage"
      </tapa.desc>

      <tapa.longdesc>

     </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="TRUE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="FALSE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="100"/>
      </tapa.send>


      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>   

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend
#/********************************************************************30**
#
#         End of file:
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------- -------- ---- ---------------------------------------------
#$SID$         ---     ps   1. Initial Release.
#              rg004.201 rnt  1. Modified for SI Enhancement
#              rg005.201 sm   1. Removing debug prints
#              rg006.201 ms    1. ccpu00111742: Sending NACK in PHICH for failed UL TX
#              rg007.201 gjahagirdar 1. Added TEst cases for SU-MIMO
#              rg008.201 rsharon 1. Added Test cases for SPS
#              rg009.201 rsharon 1. Added check for TDD.
#$SID$         ---       gvj  1. LTE MAC 3.1 Release
#              rg001.301 nudupi  1. Modified the test case to verify the CR ccpu00118788.
#                                2. Modified the test case for the CR ccpu00119023
#$SID$         rg002.301 asehgal 1.added changes for ccpu00109543
#                                2. Modified the test case for the CR ccpu00119023.
#                                3. Modified the test case 1.89 to incorporate
#                                    commented code section.
#                                4. Added ccpu00120621 related changes.
#$SID$                           5. ccpu00118351: Removed "saveTo" from cntrl.req as not required.
              rg003.301 draju    1. changes done for the CR ccpu00121749
#$SID$        ---         rt     1. LTE MAC 4.1 Release
#*********************************************************************91*/
