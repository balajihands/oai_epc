#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases For TDD 
#
#     File:    rgac_tc11.xml
#
#     Sid:      rgac_tc11.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#     Prg:     ns 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:hn:rgac_tc11.xml

<tapa.testcase id="11.1">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 data transfer for a UE in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure at UE. Then UE sends data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgInitAll/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        #<tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
        #<tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        #<tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
          vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.2">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Data Transfer for 2 UEs in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs. It then sends DL data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20"/>

   </tapa.cfg>
 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     # old tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     # old tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         # old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         # old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="1"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                 ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Expect data indication for 1st UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Data Indication at RLC for 2nd UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expset>


#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 2nd UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>


   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>


   # Send data with size equal to the allocated size for DAT1 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TPT1"/>
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0" />
        <tapa.tfu.pdsch.dat.req ueId="1" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
        <tapa.tfu.pdcch.cntrl.req ueId="1" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
    # Send BO for the created logical channel for DAT2 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT2 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="1"/>
    </tapa.send>

   <tapa.send>
      #old tapa.tfu.tti.ind numTti="2" />
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT2 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT2 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TPT2"/>
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0" />
        <tapa.tfu.pdsch.dat.req ueId="1" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
        <tapa.tfu.pdcch.cntrl.req ueId="1" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT3 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT3 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
   </tapa.expset>
 
   # Send data with size equal to the allocated size for DAT3 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT3 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT3 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0" />
        <tapa.tfu.pdsch.dat.req ueId="1" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
        <tapa.tfu.pdcch.cntrl.req ueId="1" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT4 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT4 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT4 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT3 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT3 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT4 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req />
        <tapa.tfu.pdsch.dat.req ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req />
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2 for 1st and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   #Retx
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req />
        <tapa.tfu.pdsch.dat.req ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req />
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 3,4 for 1st UE and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   # Removing some steps as already more data sent and recieved in DL/UL
   # Because the testcase is large enough
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.3">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Retransmission scenario in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxDlRetxBw="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Downlink data now 
       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
<!--	
   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
-->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2
    <tapa.send>
       #old tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="3" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   <tapa.send>
      #old tapa.tfu.tti.ind numTti="1" />
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
   
    <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
<!--
# Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
    
	<tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
  
# Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
-->	
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

  <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
#send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

    <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
# Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
  
 <tapa.send>
   # old tapa.tfu.tti.ind numTti="3" />
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
<!--
# Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
-->
</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.4">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Retransmission scenario in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxDlRetxBw="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Downlink data now 
       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
<!--
  #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
-->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
<!--
# Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
-->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
  #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
 <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect Retransmission for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
<!--
# Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
-->

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #send HARQ Recption Request for DAT 2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   <tapa.send>

      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

# Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.5">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Data Transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
            
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.6">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Data Transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs. It then sends DL data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" 
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
    <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
    #Expect data indication for 1st UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expset>
#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 2nd UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT1 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2" spId="0">
        <tapa.tfu.pdsch.dat.req />
        <tapa.tfu.pdsch.dat.req ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="1"/>
    </tapa.send>
    
    <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TEST0" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT2 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   
   # Send data with size equal to the allocated size for DAT2 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>
    <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st and 2nd  UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  />
        <tapa.tfu.pdsch.dat.req  ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req />
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT3 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT3 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT3 for 1st UE
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expset>

   # Send data with size equal to the allocated size for DAT3 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   # Send data with size equal to the allocated size for DAT3 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   #HARQ Recption Request for DAT 1,2 for 1st and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT3 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0" />
        <tapa.tfu.pdsch.dat.req ueId="1" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
        <tapa.tfu.pdcch.cntrl.req ueId="1" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT4 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT4 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="19" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT4 for 1st UE
   <tapa.expset>
      <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
   </tapa.expset>

   # Send data with size equal to the allocated size for DAT4 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT4 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT4 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req />
        <tapa.tfu.pdsch.dat.req ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req />
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   #send HARQ Recption Request for DAT 3,4 for 1st UE and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.7">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 0,UL Data Transfer for 2 UEs"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 0, the procedure initiates RACH followed
          by RB setup procedure for 2 UEs with UL data transfer."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" 
         raWinSize="10"/>

   </tapa.cfg>

# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0" />
           <tapa.tfu.sr ueId="1" />
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req  saveTo="3" ueId="0" use="0"/>
        <tapa.tfu.pusch.recp.req  saveTo="4" ueId="1" use="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


<tapa.testcase id="11.8">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 0 Data Transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 0, the procedure initiates RACH followed
          by RB setup procedure for 2 UEs with data transfer."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" 
         raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
      <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
       <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0" />
           <tapa.tfu.sr ueId="1" />
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req  saveTo="3" ueId="0" use="0"/>
        <tapa.tfu.pusch.recp.req  saveTo="4" ueId="1" use="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
   # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Ack/Nack repetiton for configuration 2"
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE for
       configuration 2."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="0"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" isAckNackEnabled="TRUE" 
            pucchAckNackRep="1001"  ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Expect Dat Request from RLC to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send HARQ Feedback for the last one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configuration 2 successful handover scenario." 
      </tapa.desc>

      <tapa.longdesc>
         "Send RACH request with a dedicated preamble and expect RA 
          Response for the UE."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched.tddraocc ulDlCfgIdx="2" 
            numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            numRsc="2" freqIdxLst="0:0" sfnLst="2:2" halfFrmLst="0:1"
            ulStartSfIdxLst="0:0" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

        # Send UE config request
         <tapa.send>
            <tapa.crg.cfgreq.cfg.ue cellId="3" isHoUe="TRUE"/>
         </tapa.send>

        # Expect success in cfg cfm
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Send UE config request with dedicated preamble
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" 
                           dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>
   
         # Configure DL LC on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="4"/>
         </tapa.send>

         # Send raReq with the preconfigured rapId
         <tapa.send>
            <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
               <tapa.tfu.rareq  numRapId="1" rapIds="50" raRnti="3"
                     tpcs="1" cqiPres="TRUE" cqis="4"/>
            </tapa.tfu.rareq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="3"/>
         </tapa.send>

         # Expect RaResp for the rapId sent in RaReq
         <tapa.expset>
            <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
               <tapa.tfu.pdcch.cntrl.req/>
            </tapa.tfu.cntrl.req>
            <tapa.tfu.dat.req datReqs="1">
               <tapa.tfu.rarsp.req poHoUeId="0" expectAll="TRUE"/>
            </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="9"/>
         </tapa.send>

         # Expect a reception request for this UE.
         <tapa.expect>
            <tapa.tfu.recp.req expRecpReq="1">
               <tapa.tfu.pusch.recp.req ueId="0" use="0" saveTo="2"/>
            </tapa.tfu.recp.req>   
         </tapa.expect>

         # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
         <tapa.send>
            <tapa.tfu.tti.ind numTti="4"/>
         </tapa.send>
      
         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>
     
         <tapa.send>
            <tapa.tfu.tti.ind numTti="2"/>
         </tapa.send>

         # Send Data Indication using TB size recieved in the grant
         <tapa.send>
            <tapa.tfu.dat.ind datInds="1">
                <tapa.tfu.dat use="2" lcId="1"/>
            </tapa.tfu.dat.ind>
         </tapa.send>

         # Expect Data Indication at RLC
         <tapa.expect>
            <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
         </tapa.expect>
     
         <tapa.send>
            <tapa.tfu.tti.ind numTti="1"/>
         </tapa.send>

         # Expect HARQ ACK in PHICH
         <tapa.expect>
            <tapa.tfu.cntrl.req expCntrlReq="1">
               <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            </tapa.tfu.cntrl.req>
         </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configuration 2 Measurement GAP with 40ms for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE configuration with measurement GAP is successful and
         validate that the UE is not scheduled during measurement GAP in
         downlink for Configuration 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" isMesGapEnabled="TRUE"
             gapPrd="40" gapOffst="32"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>
      
      # Send BO for the logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after (6 - DL_DELTA) = 3
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect staInd from MAC to RLC 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send Dat Request from RLC to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect PDCCH and PDSCH
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   # Expect HARQ Reception Request
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # Expect HARQ ACK
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
 
<tapa.testcase id="11.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configuration 2 Measurement GAP with 80ms for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE configuration with measurement GAP is successful and
         validate that the UE is not scheduled during measurement GAP in
         downlink for Configuration 2."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" isMesGapEnabled="TRUE"
             gapPrd="80" gapOffst="32"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>
      
      # Send BO for the logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after (6 - DL_DELTA) = 3
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect staInd from MAC to RLC 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send Dat Request from RLC to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect PDCCH and PDSCH
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   # Expect HARQ Reception Request
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # Expect HARQ ACK
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.13">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 5 , UL data tranfer for 2 UEs"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 5, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs with UL data transfer."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="5" 
         raWinSize="10" contResTmr="56"/>

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:1" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" ueId="0"/>
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" ueId="1"/>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="9"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" 
            isAckLst="TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" 
            isAckLst="TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5" ueId="0"/>
      <tapa.rgr.cfgCfm instId="5" ueId="1"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                     vldtGrant="TRUE" vldtTx="TRUE" ueId="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                     vldtGrant="TRUE" vldtTx="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="0"  saveTo="3" ueId="0"/>
        <tapa.tfu.pusch.recp.req use="0"  saveTo="4" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.14">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 4,UL data transfer for 2 UEs "
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 4, the procedure initiates RACH followed"
         " by RB setup with UL data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="4"  
            raWinSize="10" contResTmr="56"/>

   </tapa.cfg>


# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                  ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                  ueId="1"   vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0"  saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.15">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 3, UL data transfer for 2 UEs"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 3, the procedure initiates RACH followed"
         " by RB setup with UL data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="3"  
            raWinSize="10" />

   </tapa.cfg>
 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:1" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="5"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  ueId="0"/>
        <tapa.tfu.pdsch.dat.req  ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                     ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                     ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0" saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


<tapa.testcase id="11.16">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1,UL data transfer for 2 UEs."
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by RB setup with UL data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1"  
            raWinSize="10" />

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:3" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>
   <tapa.delay delay="1"/>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                        ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="0" saveTo="3" ueId="0"/>
        <tapa.tfu.pusch.recp.req use="0" saveTo="4" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.17">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 6, UL data transfer for 2 UEs"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 6, the procedure initiates RACH followed"
         " by RB setup with  UL data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="6" 
         raWinSize="5"/>

   </tapa.cfg>

# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

         # Send it in the 0th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="5" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                           ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                           ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0" saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
<!--
 # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                           ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE"
                           ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
-->
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>
</tapa.testcase>

<tapa.testcase id="11.18">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 4, UL data transfer for 2 UEs"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 4, the procedure initiates RACH followed"
         " by RB setup with UL data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="4"  
            raWinSize="10" contResTmr="56"/>

   </tapa.cfg>

# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req  validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                  ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                  ueId="1"   vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0"  saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.19">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 3,UL data transfer for 2 UEs"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 3, the procedure initiates RACH followed"
         " by RB setup with UL data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="3"  
            raWinSize="10" />

   </tapa.cfg>

# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:1" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="5"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  ueId="0"/>
        <tapa.tfu.pdsch.dat.req  ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1"  isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                     ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" 
                     ueId="1" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="0" ueId="0" saveTo="3"/>
        <tapa.tfu.pusch.recp.req use="0" ueId="1" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.20
#
#       Desc:    To test UE Configuration at CRG/RGR
#                with DRX parameters(Includes both unsuccessful
#                and successful cases)
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.20">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful UE config at CRG/RG with DRX params"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Send Invalid values of DRX params and
         expect negative confirm. Finally, send valid values and expect 
         positive confirm.
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="LTEMAC_R9" />
         <tapa.flag id="RGR_V2" />
         <tapa.flag id="TFU_TDD" />
         </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR  with invalid value of onDurTmr
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="32"   
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
     
     # Send UE config request at RGR with an invalid drx-inactivity tmr val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid drx-retx tmr val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid long-Drx val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="21"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with drx-offset 
    # invalid 
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="32"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with onduation  
    # timer bigger than Long DRX Cycle 
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           drxStartOffst="10"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with an invalid short-cycle val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="5"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with an invalid short-cycle timer val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="2"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="17"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with longdrx Cycle
    # as not a multiple of short-drx cycle
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="2"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="10"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with onduation  
    # timer bigger than Short DRX Cycle 
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="10"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="40"
           drxStartOffst="10"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="10"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with invalid drx params 
    # configure onduration tier in such a way that sometimes
    # crosses Long DRX cycle, based on TDD config mode
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="20"
           drxInactvTmr="3"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="10"
          />
     </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect positive cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with invalid drx params 
    # configure onduration tier in such a way that sometimes
    # crosses short DRX cycle, based on TDD config mode
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="5"
           drxInactvTmr="3"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="10"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
          />
     </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect positive cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with valid drx params(including cqi Mask)
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="3"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="10"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
           cqiMask="TRUE"
          />
     </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect positive cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
    <tapa.rg.macDeInit/>
   </tapa.clean>

    #Request to ShutDown LTEMAC
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.21
#
#       Desc:    To Validate CRG/RGR Cell Configuration 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.21">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To Validate RGR Cell Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Binding RGR and CRG SAPS, Creatting CELL in CRG Interface, creating 
         common logical channels(BCCH/BCH, BCCH/DLSCH, PCCH, CCCH) and RGR
         CELL configuration to validate Scheduler related information"
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

 
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
      
      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>
      
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell dlTotalBw="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell ulTotalBw="115"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell maxMsg3Tx="0"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Sending RGR CELL Configuration with Invalid Id
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" cellId="4"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      #Sending RGR CELL Configuration with Invalid Maximum MSG4 transmissions
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" maxDlHqTx="0" maxMsg4HqTx="0"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      #Sending RGR CELL Configuration with invalid CFI
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" cfi="0"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration with invalid trgCqi 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" trgCqi="17"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration with invalid dlCcchCqi 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" dlCcchCqi="0"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration with Invalid maxstartrnti
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" startRnti="10"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      #Sending RGR CELL Configuration with Invalid dlSchedType
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" dlSchdType="10"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration with Invalid dlSchedType
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" ulSchdType="10"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration with Invalid dlfsSchdType
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" dlfsSchdType="10"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validation 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" numTxAntPorts="0" instId="5" />
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      #Send RGR Cell Configuration for Validation 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" isDurExtend="TRUE" instId="5" />
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validation 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" isDurExtend="TRUE" dlTotalBw="9" 
            instId="5" cfi="1"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      #Send RGR Cell Configuration for Validation 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" isDurExtend="TRUE" dlTotalBw="25" 
            instId="5" cfi="2"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      #Send RGR Cell Configuration for Validation 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" resourceSize="0"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validation 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" srsBwEnum="RGAC_RGR_SRS_BWCFG_ERR"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating dlTotalBw 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" dlTotalBw="111"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating dlTotalBw 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" dlTotalBw="4"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating ulTotalBw 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" ulTotalBw="120"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating SI Win Size
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" siWinSize="50" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration with invalid preamble Format 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" preambleFormat="5" />
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating RAR window Size 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" raWinSize="1" />
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating MaxMs3TX 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" maxMsg3Tx="0"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating Preamble Count 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" numRaPreamble="3"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating Grp A Preamble Count 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" numRaPreamble="30" sizeRaPreambleGrpA="35"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating Grp A Preamble Count 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" numRaPreamble="40" 
              preambleSetPres="1" preambleStart="39"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating Grp A Preamble Count 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" numRaPreamble="40" 
              preambleSetPres="1" preambleStart="45" preambleSize="20"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration for Validating Preamble Count 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" contResTmr="24"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration with Ext CP in DL 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" isCpDlExtend="TRUE" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Send RGR Cell Delete 
      <tapa.send>
         <tapa.rgr.cfgreq.del DelType="1" cellId="3" instId="5" />
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      #Send RGR Cell Configuration with Ext CP in UL 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  cellId="3" instId="5" isCpUlExtend="TRUE" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"/>
      </tapa.send>

      #Expect Negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

   </tapa.test>

   #ShutDown the LTEMAC Layer
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


# rg004.201-ADD-Added for SI Enhancement*/
#
#
#       Test:    11.22
#
#       Desc:    To test SI Scheduling using SI Enhancement
#                in the TDD mode.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.22">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface in
          the TDD mode"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="620"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" siWinSize="4"
          siRetxCnt="2" recfgType="2048" modPrd="64"/>
      </tapa.send>

       #SFN,SF is (62,0),giving TTI upto (62,3)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #SIB1 is recieved
      <tapa.expset>
        <tapa.rgr.cfgCfm instId="5" />
           <tapa.tfu.cntrl.req>
              <tapa.tfu.pdcch.cntrl.req />
           </tapa.tfu.cntrl.req>
           <tapa.tfu.dat.req>
              <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
           </tapa.tfu.dat.req>
      </tapa.expset>

      #Modify the SI information
      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" buffSz="37"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (62,4), giving TTI upto (63,8)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      #New SI1 is recieved
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
          </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.bch.dat.req />
            <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
          </tapa.tfu.dat.req>
      </tapa.expset>
   
      #SFN,SF is (63,9), giving TTI upto (64,2)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req>
           <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>


       #SFN,SF is (64,2), giving TTI upto (64,2)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,3), giving TTI upto (64,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 
     #SFN,SF is (64,4), giving TTI upto (64,7)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,8) giving TTI upto (64,8)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,8) giving TTI upto (65,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,3) giving TTI upto (65,4)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,5) giving TTI upto (66,4)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.23
#
#       Desc:    To test SI Scheduling using SI Enhancement
#                in the TDD mode.
#
#       Notes:   None
#
#       Module:  None
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.23">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Data Transfer for a UE in bundling mode -
          Verification of dai sent in UL DCI"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs. It then sends DL data. Verifies the
           DAI sent in UL DCI"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20"/>
 </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
 # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>
 # Send BO for Msg4 on RGU for UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
 # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ambrPres="TRUE" dlAmbr="10000"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
# Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5"
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 # Expect configuration confirm after the TTI for UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>


      # Configure bi-directional DTCH for default UE for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5"
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for  UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5"
                   ueId="0"/>
      </tapa.send>


      # Configure UL LCG on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 # Expect configuration confirm after the TTI for UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 # Send Data Indication using TB size recieved in the grant for UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Expect data indication for UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

#DLDATA
  # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
 # Send data with size equal to the allocated size for DAT1 for UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1 for
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1" spId="0">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2 for UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect staInd from MAC to RLC for DAT2 for UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2 for UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT2 for UE
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
   </tapa.expset>
    # Send BO for the created logical channel for DAT3 for UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="18" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT3 for UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

 # Send data with size equal to the allocated size for DAT3 for UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
 #send HARQ Recption Request for DAT 1,2 for UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT3 for UE
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
# Send feedback for DAT 1,2 for UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
<tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   #send HARQ Recption Request for DAT 1,2 for UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
# Send feedback for DAT 1,2 for UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>


    # Send SR Indication for UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      # Expect DCI format 0 for UE
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
        <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for UE
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
        <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   #Send CRC for Msg for UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
        <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send BSR for UE
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="5" ueId="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect PHICH for UE
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5" />
      </tapa.send>

      # Expect DCI format 0 for UE
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
                                  vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

        <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect data reception request for UE
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
        <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   #Send CRC for Msg for UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
        <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Expect PHICH for UE
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.24
#
#       Desc:   "To test basic DL SPS path for a UE(15) in TDD"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.24" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
  
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.25
#
#       Desc:    To verify basic UL SPS (TDD) with two interval config
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify basic UL SPS (TDD) with two interval config."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         ulTotalBw="100" rntiSize="2" hopOffst="20"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # UE entry and config begin

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE" DLSPSEnFlag="FALSE"
            SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSPcktSize="80" 
            ULSPSimpRls="2" ULSPSTwoIntConf="TRUE" prdBsrTmr="65535"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # UE entry and config end
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
#Getting DCI format 1A with Txmode =0 and it needs to be analysed in the code and tested
<!--
        <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
        #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="2"/>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>
      
	<tapa.send>
         #old tapa.tfu.tti.ind numTti="1"/>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="24"/>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.26
#
#       Desc:   "To test basic DL SPS path for a UE in TDD"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.26" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      #<tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"   DLSPSSchIntrv="32" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            # Added Np Validation - ccpu00109160
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "2" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Not going further, this TC was to validate DAI only

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.27
#
#       Desc:   "To test harq feedback for DL configured grant, when feedback
#                arrives with format 0 based PUSCH"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.27" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "HARQ feedback for DL configured grant on regular PUSCH - to be
         corrected"
      </tapa.desc>

      <tapa.longdesc>
         "To test harq feedback for DL configured grant, when feedback
         arrives with format 0 based PUSCH - harq feedback is not not sent
         at the correct position because MAC is not handling feedback on
         PUSCH correctly."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      #<tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"  DLSPSSchIntrv="32" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            # Added Np Validation - ccpu00109160
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "2" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send ACK for the received PDU
      # TODO antz - right now the last 4th fdbk has been set to TRUE. This is
      # because MAC currently is not handling the case of feedbacks appearing
      # over PUSCH, always behaving as if they appear over PUCCH. And for SPS,
      # when appearing over PUSCH, since feedback for DL cfgd grant is the
      # last one, this is literally interpreted as is.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:TRUE" isPusch="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.28
#
#       Desc:   "To test retransmission of DL SPS cfgd grant for a UE in TDD"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.28" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "Verify HARQ retransmission for SPS data"
      </tapa.desc>

      <tapa.longdesc>
        "Verify HARQ retransmission for SPS data"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" saveTo="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="5" DLSPSInit="FALSE" ueId="0"
               isSPSRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="3" chkSdu="TRUE"
               transMode="TFU_UE_TM_3" isRetx="TRUE" retxUse="4" validateSPS="TRUE" SPSretxUse="4" isSPSRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>


      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>


</tapa.testcase>


###############################################################################
#
#       Test:    11.29
#
#       Desc:   "To verify DL SPS activation on TM1 eventhough UE configured TM 3"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.29" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify correct DL SPS activation PDCCH for UE with TM 3"
      </tapa.desc>

      <tapa.longdesc>
         "To verify correct DL SPS activation PDCCH for UE with TM 3"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            # Added Np Validation - ccpu00109160
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="160" NumSPSProc="2"
            n1PucchVal0="0" n1PucchVal1="1"  n1PucchVal2="2" n1PucchVal3="3"
            NumPucchVal="4" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="160"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Format 2A will not be scheduled eventhough UE is in TM3
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0"
               isFormat2a="FALSE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" numTb1Lyrs="1"/>
         </tapa.tfu.dat.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # This TC was all about ensuring that we get a valid activation PDCCH
      # with the given configuration - so end here.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.30
#
#       Desc:   " TC_MAC_TDD_SPS_30 Verify successful transmission of SID Packets
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.30" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify successful transmission of SID Packets"
      </tapa.desc>

      <tapa.longdesc>
         "Verify successful transmission of SID Packets"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
#####first bo end

      <tapa.send>
         <tapa.tfu.tti.ind numTti="90"/>
      </tapa.send>

      ###SID BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
#####first bo end



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.31
#
#       Desc:    To verify basic UL SPS (TDD) with two interval config
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="11.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify basic UL SPS (TDD) with two interval config."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
          ulTotalBw="100" rntiSize="2" hopOffst="20"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # UE entry and config begin

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            # Added Np Validation - ccpu00109160
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE"
            DLSPSEnFlag="FALSE" SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
            ULSPSPcktSize="80" ULSPSimpRls="2" ULSPSTwoIntConf="TRUE" prdBsrTmr="65535"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # UE entry and config end

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#TFU_UPGRADE Specific Test Cases from 32 till 42
#
#       Test:    11.32
#
#       Desc:    To test successful UE Configuration at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR enabled.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="11.32" altid="20.4">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and expect a positive configuration confirmation 
         from LTE MAC"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request at RGR 
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
        aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE" srCfgPres="TRUE"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect> 

     # Send UE config request for same Ue again to confirm above UE config
     # If not given default ueId is 0
     <tapa.send>
       <tapa.crg.cfgreq.cfg.ue ueId="0"/>
     </tapa.send>
     # Expect failure in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm ueId="0" status="15"/>
     </tapa.expect>

     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
    </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>
     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" ueId="0" status="15"/>
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.33
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#		      Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="11.33" altid="20.5">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" 
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
      
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
	   srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="315" cqiRepType="2" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD20" UeReCfgType="4096" />
      </tapa.send>


       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
      
    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>


    # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="314"  riCfgIdx = "555"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="312"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

  #Request to ShutDown LTEMAC

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.34
#
#       Desc:    To test Failure Handling of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled, configured with Out-of-Range values
#                    and released and later configure them with proper Configuration parameters.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="11.34" altid="20.6">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test failure handling for UE PCQI, RI, SR, SRS and ACQI Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Later reconfigure them Out-Of-Range PCQI,RI,
         ACQI,SRS and SR for UEID 0 and later reconfigure them with allowed range "
      </tapa.longdesc>
   </tapa.doc>

     # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" 
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
      aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
      aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>  

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_1" UeReCfgType="1" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3" UeReCfgType="1" />
      </tapa.send>

         # Send UE PCQI/RI ReConfiguration for the same UE-0 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>


      # Send UE SR ReConfiguration for the same UE-0 created above for  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
         srCfgPres="TRUE" srCfgIdx="253"
        UeReCfgType="16384" />
      </tapa.send>
    
        # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>


      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="253"
        UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3" UeReCfgType="1" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1" />
         <tapa.rgr.cfgCfm ueId="1" />
         <tapa.rgr.cfgCfm ueId="0" status="15" />
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>

      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>


      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
          txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="311"  riCfgIdx = "501"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="315"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>
             
  #Request to ShutDown LTEMAC

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.35
#
#       Desc:    To test PCQI periodicity with PCQI configured with a certain 
#                 Periodicity for WideBand CQI in case of TDD config 2.
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE 
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="11.35" altid="20.52">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test PCQI periodicity with PCQI configured with a certain Periodicity
         for WideBand CQI."
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
           <tapa.flag id="TFU_UPGRADE"/>
           <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
        numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
        ulStartSfIdxLst="10:10" numTxAntPorts ="4"/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index time:(0,3) 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq time:(0,7)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp time:(1,6)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3 time:(1,9)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.expect> time:(2,2)
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4 time(2,3)
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY. time:(2,4)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. time:(3,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4. time(3,4)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request(3,4)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0"  codeBookResPrsnt="TRUE" txModeEnum="RGR_UE_TM_3" prdCqiCfg.type="TRUE" 
              cqiPCfgIdx ="3" sANCQI="TRUE" 
                riEna = "FALSE"  riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>
     
     
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect success in cfg cfm(3,5)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #For the confiuration parameters set offset=2 and perioditicity=5.
      #Thus (37-2)%5=0 So expect the CQI RR at 35 time:(3,5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication (3,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #(42-2)%5=0 So expect the CQI RR at 40 time:(4,0)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #(47-2)%5=0 So expect the CQI RR at 45 time:(4,5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
   #Send Raw CQI Indication (4,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.36
#
#       Desc:    Handling of HARQ, PCQI and RI Reception requests in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.36" altid="20.53">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of HARQ, PCQI and RI Reception requests in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a  RI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="4" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq (0,7)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp (1,6)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3 (2,0)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req. (2,1)
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3 (2,2)
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4 (2,3)
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY. (2,4)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. (3,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4. (3,4)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request(3,4)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_4"  codeBookResPrsnt="TRUE"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" sANCQI="TRUE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD21"
            riEna = "TRUE"  cqiRepType="2" riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,5)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send> 
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

     #For configuration set above offset=2 and periodicity=10 (42-2)%10=0
     #Thus expect CQI RR here at 42
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>
      </tapa.expset>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Send Raw CQI Indication (4,5)
      <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
           <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
        
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
        
        #For the data sent 4 tti's earlier expect HQ RR and (52-2)%10=0
        #Thus expect both HQ RR and CQI RR
      <tapa.expset>
          <tapa.tfu.recp.req expRecpReq="1">
              <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.37
#
#       Desc:    Handling of HARQ, PCQI and SR Reception requests in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="11.37" altid="20.54">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, PCQI and SR Periodicity for a Reception Request in TDD" 
      </tapa.desc>

      <tapa.longdesc>
        "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, PCQI RR and SR RR on the same TTI. 
         HARQ, PCQI and SR RR should  be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"  codeBookResPrsnt="TRUE"
            srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
         <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.sr.recp.req/>
             <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="4"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>(4,7)
         <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.pusch.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expset>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    11.38
#
#       Desc:    Handling of HARQ, PCQI, SRS and SR Reception requests
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="11.38" altid="20.55">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of HARQ, PCQI, SRS and SR Reception requests in TDD"
      </tapa.desc>

      <tapa.longdesc>
        "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and SR RR on the same TTI. 
         HARQ, SRS and SR RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"  codeBookResPrsnt="TRUE"
            srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      #Configure SRS
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="32" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>
      
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiPCfgIdx ="13" sANCQI="TRUE" 
              riEna="TRUE"  riCfgIdx="0" cqiRepType="2" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
      
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Since CQI and SRS periodicities collide, SRS RR will still not be dropped. 
      # This is non-deterministic in nature hence eNB sends RR type as
      # TFU_PUCCH_HARQ_SR_CQI_SRS  
      # ccpu00116923 - ADD - New Reception Request types for CQI and SRS with SR 
      <tapa.expset>(4,7)
          <tapa.tfu.recp.req expRecpReq="1">
              <tapa.tfu.hq.recp.req/>
              <tapa.tfu.sr.recp.req/>
              <tapa.tfu.srs.recp.req/>
             <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="4"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
   # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

     <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="1"/>
        </tapa.tfu.recp.req>
      </tapa.expset>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.39
#
#       Desc:    Handling of HARQ, SRS and CQI Reception requests
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="11.39" altid="20.56">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of HARQ, SRS and CQI Reception requests in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and RI RR on the same TTI. 
         HARQ and RI RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="26" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" 
              riEna="TRUE"  riCfgIdx="0" txModeEnum="RGR_UE_TM_3" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1" TTI="THIS"/>
     </tapa.send>
      
      (4,1)
      <tapa.expset>
          <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.srs.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req expRecpReq="1">
              <tapa.tfu.hq.recp.req/>
             <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="4"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>
	
      <tapa.expset>(4,7)
         <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.pusch.recp.req use="1"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.40
#
#       Desc:    To validate Data Reception Request and HARQ, RI, SRS Reception Request collision in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="11.40" altid="20.57">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To validate Data Reception Request and HARQ, RI, SRS Reception 
         Request collision in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI, CQI and SRS with a certain 
         Periodicity.Configure a DLSCH and a ULSCH such that the Periodicity of RI, CQI, SRS 
         should collide with with ULSCH for a UE and check for Data Reception Request
          for Data and HARQ, SRS, RI together. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
	    <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      #Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="5" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "1" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="22"
      sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" 
              riEna="TRUE"  riCfgIdx="0" txModeEnum="RGR_UE_TM_3" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="10"/>
     </tapa.send>

     #Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
    # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.pusch.recp.req use="1" saveTo="2" vldtDatRecp="TRUE" 
                nSrs="1" vldtInitNumRbs="1" initNumRbsPres="1" />
             <tapa.tfu.hq.recp.req/>
             <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.srs.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>

     #Send CRC for Msg
     <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
     </tapa.send>
     
     # Send SRS Indication
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs widecqipres="FALSE" ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
    </tapa.send>
    
    #Send Data Indication using TB size recieved in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="9"/>
        </tapa.tfu.dat.ind>
    </tapa.send>
      <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
      </tapa.expect>
     <tapa.send>
        <tapa.tfu.tti.ind numTti="2"/>
    </tapa.send>

 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.41
#
#       Desc:    To validate Data Reception Request and HARQ, SRS Reception 
#                Request collision in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc11.xml

<tapa.testcase id="11.41">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To validate Data Reception Request and HARQ SRS Reception 
         Request collision in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a SRS with a certain 
         Periodicity.Configure a DLSCH and a ULSCH such that the Periodicity of
         SRS should collide with with ULSCH for a UE and check for Data 
         Reception Request for Data and HARQ, SRS together. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
	    <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      #Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="5" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "1" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="22"
      sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>(4,0)
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="10"/>
     </tapa.send>

     #Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.pusch.recp.req use="1" saveTo="2" vldtDatRecp="TRUE" 
                nSrs="1" vldtInitNumRbs="1" initNumRbsPres="1" />
             <tapa.tfu.hq.recp.req/>
             <tapa.tfu.srs.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>

     #Send CRC for Msg
     <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
     </tapa.send>
     
     # Send SRS Indication
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs widecqipres="FALSE" ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
    </tapa.send>
    
    #Send Data Indication using TB size recieved in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="9"/>
        </tapa.tfu.dat.ind>
    </tapa.send>
      <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
      </tapa.expect>
     <tapa.send>
        <tapa.tfu.tti.ind numTti="2"/>
    </tapa.send>

 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.42
#
#       Desc:    Handling of PCQI and SR Reception requests in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="11.42" altid="20.61">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify  PCQI and SR Periodicity for a Reception Request in TDD" 
      </tapa.desc>

      <tapa.longdesc>
        "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. PCQI RR(Reception Request) and SR RR on 
         the same TTI. PCQI and SR RR should  be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"  codeBookResPrsnt="TRUE"
            srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="7"/>
     </tapa.send>

      <tapa.expset>(4,7)
         <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.sr.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="4"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

     <tapa.expset>(4,7)
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req/>
        </tapa.tfu.recp.req>
     </tapa.expset>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.43">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 0,UL Data Transfer for 2 UEs"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 0, the procedure initiates RACH followed
          by RB setup procedure for 2 UEs with UL data transfer."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" 
         raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
                     ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0" />
           <tapa.tfu.sr ueId="1" />
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req  saveTo="3" ueId="0" use="0"/>
        <tapa.tfu.pusch.recp.req  saveTo="4" ueId="1" use="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" lcId="1" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE" ueId="1"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#rg002.301 ccpu00109543 MOD 
#
#       Test:   11.44 
#
#       Desc:   "To test successful calculation of Average PRB usage in DL"  
#                "in TDD mode"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.44" altid="21.3">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful calculation of Average PRB usage in DL"
         "In TDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueId="0"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         #<tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>
    
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1" timePrd="0"/>
      </tapa.send>
#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="750" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
     </tapa.expset>

   <tapa.send>
      <tapa.lrg.schL2sendmeasreq/> 
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.expset>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
      <tapa.lrg.schL2meascfm prbPercDl="14"/>
      <tapa.tfu.dat.req datReqs="1" spId="0">
         <tapa.tfu.pdsch.dat.req />
      </tapa.tfu.dat.req>
   </tapa.expset>

   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   #Expect PDSCH and PDCCH for the dat req for DAT1 for 1st and 2nd UE
   #Expect staInd from MAC to RLC for DAT1 for 1st UE
   #Expect L2 Measurement confirm 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #Expect HARQ Recption Request for DAT 1st UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
  </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
  
   # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.45
#
#       Desc:    To test average prb usage in uplink TDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="11.45" altid="21.5">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test average PRB usage in uplink in TDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="50"/>

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" prdBsrTmr="65535" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         #old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
           ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0" prdBsrTmr="65535"/> 
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0" /> 
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         #old tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"
           ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="1" prdBsrTmr="65535"/>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                 ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="0" measType="2"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5" TTI="TPT1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     

      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      #Expect data indication for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="2" TTI="TPT2"/>
      </tapa.send>
      
     # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expect>
    # Send a TTI to schedule SR 
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="1"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
    # Send SR Indication for 1st UE and 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5" TTI="TPT3"/>
      </tapa.send>

      # Expect DCI format 0 for 1st UE and 2nd UE
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
       #old tapa.tfu.tti.ind numTti="4"/>
       <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for 1st UE and 2nd UE
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
        <tapa.tfu.pusch.recp.req  ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" TTI="TPT4"/>
       </tapa.send>

   #Send CRC for Msg for 1st UE and 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Send BSR for 1st UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addLongBsr="TRUE" bsr0="5"  bsr1="12" 
            bsr2="45" bsr3="60" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   # Send BSR for 2nd UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addLongBsr="TRUE" bsr0="5"  bsr1="12" 
            bsr2="45" bsr3="60" ueId="1"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   <tapa.send>
      <tapa.lrg.schL2sendmeasreq/> 
   </tapa.send>

    <tapa.send>
       <tapa.tfu.tti.ind numTti="2" TTI="TPT5" />
    </tapa.send>

     #Expect L2 Measurement confirm  
      <tapa.expect>
         <tapa.lrg.schL2meascfm prbPercUl="8"/>
      </tapa.expect>

   # Expect UL grant for 1st UE and 2nd UE
   <tapa.expect>
    <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
         <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtGrant="TRUE" />
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" />
         <tapa.tfu.phich.cntrl.req  isAck="TRUE" />
         <tapa.tfu.phich.cntrl.req  isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
     <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expset>
      <tapa.tfu.recp.req expRecpReq="2" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
         <tapa.tfu.pusch.recp.req ueId="1"/>
      </tapa.tfu.recp.req>
#      <tapa.lrg.schL2meascfm prbPercUl="4"/>
   </tapa.expset>
 
</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.46
#
#       Desc:    For configuration 2, test that the UE only gets scheduled
#                during its active time.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.46">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE only gets scheduled in its active time 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

  <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
   -->

</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.47
#
#       Desc:    For configuration 2, test that the once the UE 
#                gets scheduled in its active time, drxInactivity
#                timer is started.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.47">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE drxInactivity timer running. 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- The inactivity timer for 5pfs for UE 0 would have started.
      This means we can still send more downlink data -->

      # RLC--->MAC_SH (StaRsp). This is (4,8)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="30"/>
      </tapa.send>

      #Give 2 TTI's to bring it to (5,0) as we look at 
      #3 tti's ahead. (5,3) is a DL subframe.
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- bring it to (5,5) --> 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

   <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  <!-- send 2 TTI's (TFU_DELTA + RG_UL_DELTA) -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="2"/>
  </tapa.send>

  # Send ACK as feedback for the received PDU.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

  <!--
  <tapa.send>
     <tapa.tfu.tti.ind numTti="6"/>
  </tapa.send>
  -->


</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.48
#
#       Desc:    For configuration 2, test that the once the UE 
#                gets scheduled in its active time, after drx-inactiviy
#                timer expires, the UE switches to short cycle.
#                
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.48">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE switching from long to short cycle. 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
<!--
   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="TRUE"
        shortDrxCycle="8"
        drxShortCycleTmr="2" 
        drxStartOffst="10"
        />
   </tapa.send>
-->
# Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5"
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        maxUlHqTx="4"
        prdBsrTmr="65535"
        />
   </tapa.send>
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- The inactivity timer for 5pfs for UE 0 would have started.
      This means we can still send more downlink data -->

      # RLC--->MAC_SH (StaRsp). This is (4,8)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="30"/>
      </tapa.send>

      #Give 2 TTI's to bring it to (5,0) as we look at 
      #3 tti's ahead. (5,3) is a DL subframe.
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- bring it to (5,5) --> 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

   <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
  <!-- cycle should switch to short cycle -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  <!-- bring it to (5,8) (TFU_DELTA(2) + RG_UL_DELTA(1) to receive harq -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="2"/>
  </tapa.send>

  # Send ACK for the received PDU's 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

  <!-- bring it to (6,3). onDuration in DL starts.
       Should expire at (7,2)-->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="5" />
  </tapa.send>


  <!-- bring it to (6,4). onDuration in UL starts.
       Next onDuration start is calculated as
       (7,4)
   -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1" />
  </tapa.send>

  <!-- bring the system to (6,9). onDuration 
       expires in DL -->

   <tapa.send>
      <tapa.tfu.tti.ind numTti="5" />
   </tapa.send>

   <!-- bring the system to (7,0). onDuration
        expires in UL -->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <!-- bring the system to (7,1). Next onDuration
        starts in DL -->
    <tapa.send>
       <tapa.tfu.tti.ind numTti="1" />
    </tapa.send>

    <!-- bring the sytem to (7,2). onDuration 
      starts in UL & short Cycle expires in DL ergo we switch to long cycle -->
    <tapa.send>
       <tapa.tfu.tti.ind numTti="1" />
    </tapa.send>

</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.49
#
#       Desc:    For configuration 2, test the functioning of
#                drx-Retransmission timer.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.49">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE switching from long to short cycle. 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
<!--
   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="TRUE"
        shortDrxCycle="8"
        drxShortCycleTmr="2" 
        drxStartOffst="10"
        />
   </tapa.send>
-->
 # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5"
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        maxUlHqTx="4"
        prdBsrTmr="65535"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- The inactivity timer for 5pfs for UE 0 would have started.
      This means we can still send more downlink data -->

      # RLC--->MAC_SH (StaRsp). This is (4,8)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="30"/>
      </tapa.send>

      #Give 2 TTI's to bring it to (5,0) as we look at 
      #3 tti's ahead. (5,3) is a DL subframe.
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- bring it to (5,5) --> 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

   <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
  <!-- cycle should switch to short cycle -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  <!-- bring it to (5,8) (TFU_DELTA(2) + RG_UL_DELTA(1) to receive harq -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="2"/>
  </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

  <!-- bring it to (6,3). onDuration in DL starts at (6,6).
  Should expire at (7,2)-->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="3" />
  </tapa.send>
  
  <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
          <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
     </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req expCntrlReq="1">
     <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
    </tapa.tfu.cntrl.req>
   </tapa.expset>


  <!-- bring it to (6,4). onDuration in UL starts at (6,6).
       Next onDuration start is calculated as
       (7,4) -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1" />
  </tapa.send>

  <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
          <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
     </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req expCntrlReq="1">
     <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
    </tapa.tfu.cntrl.req>
   </tapa.expset>

  <!-- bring it to (6,5) for the reception request -->
  <tapa.send>
     <tapa.tfu.tti.ind numTti="3" />
  </tapa.send>
  
   <tapa.expect>
   <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>
  
</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.50
#
#       Desc:    For configuration 2, test that the UE only gets scheduled
#                during its active time.Harq Feedback comes in the DRX period.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.50">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE only gets scheduled in its active time and feedback is
         processed even if it falls in the DRX period." 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
#Configuring small on-duration and inactivity timer so that feedback falls in
#the DRX period.
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="1"
        drxInactvTmr="1"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    11.51
#
#       Desc:    For configuration 2, test that the UE only gets scheduled
#                during its active time for UL.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.51">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 data transfer for a UE in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure at UE. Then UE sends data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>
      #   ulStartSfIdxLst="10:10" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" TTI="TEST1" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <!--
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" />
   </tapa.send>
-->
<!--
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="3"
        drxInactvTmr="1"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="20"
        maxUlHqTx="4"
        prdBsrTmr="65535"
        />
   </tapa.send>
-->
 # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5"
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        maxUlHqTx="4"
        prdBsrTmr="65535"
        />
   </tapa.send>


   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5" TTI="TEST2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           # Added DAI validation - ccpu00109162
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          #old tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="5"/>
          <tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="5"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect UL grant for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" />
      </tapa.tfu.cntrl.req>
   </tapa.expect>

<!--
#why this is not required?
   # Expect UL grant for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" />
      </tapa.tfu.cntrl.req>
   </tapa.expect>
-->

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.recp.req expRecpReq="1" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
      </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="5" TTI="TEST4"/>
   </tapa.send>

   #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.phich.cntrl.req  isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.recp.req expRecpReq="1" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
      </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="5" />
   </tapa.send>

   #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect PHICH for 1st UE and 2nd UE
   <tapa.expset>
     #old tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

#5000 TTIs
  <tapa.send>
    <tapa.tfu.tti.ind numTti="500" />
  </tapa.send>
 <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>

#10000 TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
#15000 TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
#20000 TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
   </tapa.send>
   <tapa.delay delay="10"/>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.52
#
#       Desc:    For configuration 2, configure a UE,then reconfigure
#                and then delete the UE
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.52">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE only gets scheduled in its active time 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Reconfigure the UE
      
      #Send UE ReConfiguration to disable cqi-Mask
      # RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="TRUE"
            shortDrxCycle="5"
            drxStartOffst="10"
            cqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      #Send UE ReConfiguration to disable cqi-Mask
      # RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="FALSE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="TRUE"
            shortDrxCycle="5"
            drxStartOffst="10"
            cqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      #Send UE ReConfiguration to disable cqi-Mask
      # RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="TRUE"
            shortDrxCycle="5"
            drxStartOffst="10"
            cqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send CELL Delete Request for the same CELL created above. 
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" DelType="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      # Send CELL Delete Request for the same CELL created above at RGR. 
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" DelType="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.53
#
#       Desc:    For configuration 2, test that the UE only gets scheduled
#                during its active time for UL.Keep the Timers large enough
#                so that "distance" variable gets set.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.53">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "For configuration 2, test that the UE only gets scheduled
          during its active time for UL.Keep the Timers large enough
          so that "distance" variable gets set."
      </tapa.desc>

      <tapa.longdesc>
         "For configuration 2, test that the UE only gets scheduled
          during its active time for UL.Keep the Timers large enough
          so that "distance" variable gets set."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        # Added Np Validation - ccpu00109160
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <!--
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" />
   </tapa.send>
-->
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="200"
        drxInactvTmr="80"
        drxRetxTmr="16"
        longDrxCycle="256"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="64"
        maxUlHqTx="4"
        />
   </tapa.send>
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="247"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7000"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

# ccpu00116923 - ADD - Test case to test notification of cell-specific SRS 
#
#       Test:    11.54
#
#       Desc:    To test Cell-specific SRS occurrence for a certain
#                  cell configured SRS subframe configuration. 
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.54" altid="20.64">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test cell specific SRS occurrence in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL configuration with certain SRS subframe, Common Logical
         channel  configurations at CRG and RGR and also finish RACH and then
         send UE configuration request to LTEMAC from Dummy RRC and configure a
         UL signalling Info like PCQI so as to set up a reception request and
         expect a PCQI reception request followed by a RAW CQI Indication. 
         Validate the reception request for SRS as per config"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
           <tapa.flag id="TFU_UPGRADE"/>
           <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" 
        numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
        ulStartSfIdxLst="10:10" numTxAntPorts ="4" srsSubFrameCfg="1"/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index time:(0,3) 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq time:(0,7)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp time:(1,6)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3 time:(1,9)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      <tapa.expect> time:(2,2)
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4 time(2,3)
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY. time:(2,4)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. time:(3,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4. time(3,4)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request(3,4)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0"  codeBookResPrsnt="TRUE" txModeEnum="RGR_UE_TM_3" prdCqiCfg.type="TRUE" 
              cqiPCfgIdx ="3" sANCQI="TRUE" 
                riEna = "FALSE"  riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>
     
     
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect success in cfg cfm(3,5)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #For the confiuration parameters set offset=2 and perioditicity=5.
      #Thus (37-2)%5=0 So expect the CQI RR at 35 time:(3,5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1" vldtSrsPres="1" srsPres="1" >
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication (3,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #(42-2)%5=0 So expect the CQI RR at 40 time:(4,0)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1" vldtSrsPres="1" srsPres="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #(47-2)%5=0 So expect the CQI RR at 45 time:(4,5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1" vldtSrsPres="1" srsPres="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
   #Send Raw CQI Indication (4,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

<!--rg002.301 ccpu00119494-ADD-test case to add DTX functionality -->
<tapa.testcase id="11.55">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Retransmission on receiving DTX"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets NO feedback
          for it. It then retransmits the data without changing RV and then 
          gets an ACK for it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxDlRetxBw="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

      # Send Downlink data now 
       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>
<tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
<tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
 # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
# Expect data reception request
<tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
 <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
<tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

# Expect data reception request
<tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
# Send ACK feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>


   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
#send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
# Send ACK feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        #old tapa.tfu.pdcch.cntrl.req ueId="0" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="2" />
        <tapa.tfu.pdcch.cntrl.req ueId="0" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send ACK feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

 # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
 <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

 # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>


</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.56">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Ack/Nack repetiton for configuration 2"
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE for
       configuration 2."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" isAckNackEnabled="TRUE" 
            pucchAckNackRep="1001"  ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Expect Dat Request from RLC to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>
      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send HARQ Feedback for the last one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      <!--expect a retransmission since all was DTX --> 
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req vdtRetx="TRUE" vdlRvIdx="TRUE" rvIdx="2" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.57
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 1-1 for 2 Antenna Ports. 
#
#       Notes:   None
#              
#       Module:  "CQI-RI"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.57">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI RI Decoding with longest periodicityi for multi UE. 
          RI Periodicity as 320, equal to SrSrsCqiRi Queue size"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Set a Raw CQI and verify whether the Decoding is proper."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="2"/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>  
 
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue />
     </tapa.send>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue ueId="1"/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expset>
        <tapa.crg.cfgcfm/>
        <tapa.crg.cfgcfm/>
     </tapa.expset>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4"
          prdModeEnum="RGAC_RGR_PRD_CQI_MOD11" prdCqiCfg.type="TRUE" cqiPCfgIdx = "158" 
          cqiRepType="1"  riEna = "TRUE"  riCfgIdx = "166" cqiPResIdx="0"/>
     </tapa.send>

     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_4"
          prdModeEnum="RGAC_RGR_PRD_CQI_MOD11" prdCqiCfg.type="TRUE" cqiPCfgIdx = "158" 
          cqiRepType="1"  riEna = "TRUE"  riCfgIdx = "166"  cqiPResIdx="1"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
       <tapa.rgr.cfgCfm instId="5" ueId="1"/>
    </tapa.expset>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="126"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
           <tapa.tfu.dlcqi.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="50"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="152"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler, this would be a RI RR
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.58
#
#       Desc:   "To verify UL SPS(TDD) activation to deactivation with 
#                two interval config true and UL/DL Config 2
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.58">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify basic UL SPS (TDD) with two interval config."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         ulTotalBw="100" rntiSize="2" hopOffst="20"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd2 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535"/>

      # UE entry and config end
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
        #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	# Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Nothing should be there, as there is no BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
      #1st empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      #2nd empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

###############################################################################
#
#       Test:    11.59
#
#       Desc:   "To test retransmission of Msg4 in TDD"
#
#       Notes:   None
#              
#       Module:  "Random Access"
#
#       File:    rgac_tc11.xml
#
################################################################################

<tapa.testcase id="11.59">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test retransmission of Msg4 in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "To test retransmission of Msg4 in TDD"
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" maxMsg4HqTx="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
  <!--
   # Send Nofeedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
  -->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #Expect MSG4 retx.
   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   
   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
  
  <tapa.send>
      <tapa.tfu.tti.ind numTti="7" />
   </tapa.send>
   

</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
#****************************END OF TFU_UPGRADE TESTCASES *****************
<tapa.testcase id="11.60">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 UL data transfer for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by RB setup procedure at UE. Then UE sends data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1"  
            raWinSize="10" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   
   # Do RACH init
   <tapa.rg.rachtdd1/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
    
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.61">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "For TDD configuration 1, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1"  
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
      <tapa.rg.rachtdd1/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5"  prdBsrTmr="65535" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
    
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" ueId="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Downlink data now 
      # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="1" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="1" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   <!--
# Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
-->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2
    <tapa.send>
       <tapa.rgu.dstarsp lcId="1" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="1" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
  
   #expect HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

  # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
<!--
    # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
 -->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
 
   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   
   #expect HARQ Recption Request for DAT 2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
  
   # Send feedback for DAT 1 and 2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
     <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

   # Send feedback for DAT 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.62">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 Retransmission scenario in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates NACK for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1"  
            raWinSize="10" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
      <tapa.rg.rachtdd1/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"  prdBsrTmr="65535"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
    
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="1" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" ueId="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Downlink data now 
      # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="1" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="1" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
<!--
# Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
-->
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2
    <tapa.send>
       <tapa.rgu.dstarsp lcId="1" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

   <tapa.send>
      #old tapa.tfu.tti.ind numTti="4" />
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="1" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   
   #expect HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
   #expect HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
  
   #expect HARQ Recption Request for DAT 2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
       # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
# Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
  

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.expset>
      <tapa.tfu.cntrl.req expCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
            vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
  
   # Send feedback for DAT 1 and 2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
  
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.pusch.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.63">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 Data Transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs. It then sends DL data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         maxUlBwPerUe="20" raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 5 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"  prdBsrTmr="65535"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"  prdBsrTmr="65535"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
     </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      
      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      #Expect data indication for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expect>
     
#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 2nd UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for 1st UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Expect staInd from MAC to RLC for DAT1 for 2nd UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT1 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2" spId="0">
        <tapa.tfu.pdsch.dat.req />
        <tapa.tfu.pdsch.dat.req ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
    # Send BO for the created logical channel for DAT2 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT2 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 1st UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 2nd UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>
   
   #Expect HARQ Reception Request for DAT 1 for 1st and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
  </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   
   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st and 2nd  UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  />
        <tapa.tfu.pdsch.dat.req  ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" >
        <tapa.tfu.pdcch.cntrl.req />
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   
   # Send feedback for DAT 1 for 1st UE and 2nd UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect HARQ Reception Request for DAT 2 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
  </tapa.expset>
  
  <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   
   # Send feedback for DAT 2 for 1st and 2nd UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
  
    # Send SR Indication for 1st UE and 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 for 1st UE and 2nd UE
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
           vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request for 1st UE and 2nd UE
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
        <tapa.tfu.pusch.recp.req  ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg for 1st UE and 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   # Send BSR for 1st UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="15" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   # Send BSR for 2nd UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="15" ueId="1"/>
      </tapa.tfu.dat.ind>
   </tapa.send>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TEST1" />
   </tapa.send>

   # Expect PHICH for 1st UE and 2nd UE
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtGrant="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtGrant="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="5" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.recp.req expRecpReq="2" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
         <tapa.tfu.pusch.recp.req ueId="1"/>
      </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PHICH for 1st UE and 2nd UE
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.64">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Ack/Nack repetiton for configuration 1"
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE for
       configuration 1."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1"  
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" isAckNackEnabled="TRUE" 
            pucchAckNackRep="1001"  ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
     
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>
      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Expect Dat Request from RLC to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
     
      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      
      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
#tti 42

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send HARQ Feedback for the last one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.65">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configuration 1 successful handover scenario." 
      </tapa.desc>

      <tapa.longdesc>
         "Send RACH request with a dedicated preamble and expect RA 
          Response for the UE."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched.tddraocc ulDlCfgIdx="1" 
            numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            numRsc="2" freqIdxLst="0:0" sfnLst="2:2" halfFrmLst="0:1"
            ulStartSfIdxLst="0:0" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

        # Send UE config request
         <tapa.send>
            <tapa.crg.cfgreq.cfg.ue cellId="3" isHoUe="TRUE"/>
         </tapa.send>

        # Expect success in cfg cfm
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Send UE config request with dedicated preamble
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" 
                           dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>
   
         # Configure DL LC on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Expect configuration confirm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Expect configuration confirm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="3"/>
         </tapa.send>

         # Send raReq with the preconfigured rapId
         <tapa.send>
            <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
               <tapa.tfu.rareq  numRapId="1" rapIds="50" raRnti="3"
                     tpcs="1" cqiPres="TRUE" cqis="4"/>
            </tapa.tfu.rareq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="5"/>
         </tapa.send>

         # Expect RaResp for the rapId sent in RaReq
         <tapa.expset>
            <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
               <tapa.tfu.pdcch.cntrl.req/>
            </tapa.tfu.cntrl.req>
            <tapa.tfu.dat.req datReqs="1">
               <tapa.tfu.rarsp.req expectAll="TRUE"/>
            </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="8"/>
         </tapa.send>

         # Expect a reception request for this UE.
         <tapa.expect>
            <tapa.tfu.recp.req expRecpReq="1">
               <tapa.tfu.pusch.recp.req ueId="0" use="0" saveTo="2"/>
            </tapa.tfu.recp.req>   
         </tapa.expect>
        
         # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
         <tapa.send>
            <tapa.tfu.tti.ind numTti="4"/>
         </tapa.send>
      
         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>
     
         <tapa.send>
            <tapa.tfu.tti.ind numTti="1"/>
         </tapa.send>
         
         # Expect HARQ ACK in PHICH
         <tapa.expect>
            <tapa.tfu.cntrl.req expCntrlReq="1">
               <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            </tapa.tfu.cntrl.req>
         </tapa.expect>

         # Send Data Indication using TB size recieved in the grant
         <tapa.send>
            <tapa.tfu.dat.ind datInds="1">
                <tapa.tfu.dat use="2" lcId="1"/>
            </tapa.tfu.dat.ind>
         </tapa.send>

         # Expect Data Indication at RLC
         <tapa.expect>
            <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
         </tapa.expect>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.66">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configuration 1 Measurement GAP with 40ms for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE configuration with measurement GAP is successful and
         validate that the UE is not scheduled during measurement GAP in
         downlink for Configuration 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
      <tapa.rg.rachtdd1/>
  
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" isMesGapEnabled="TRUE"
             gapPrd="40" gapOffst="32"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>
      
      # Send BO for the logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after (6 - DL_DELTA) = 3
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect staInd from MAC to RLC 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send Dat Request from RLC to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect PDCCH and PDSCH
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   # Expect HARQ Reception Request
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # Expect HARQ ACK
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.67">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration when TDD Cell config is 1"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and expect a positive configuration confirmation 
         from LTE MAC"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         maxUlBwPerUe="20" numTxAntPorts ="2" raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
      <tapa.rg.rachtdd1/>
  
   # Send UE config request for UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request at RGR 
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
        aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE" srCfgPres="TRUE"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect> 

     # Send UE config request for same Ue again to confirm above UE config
     # If not given default ueId is 0
     <tapa.send>
       <tapa.crg.cfgreq.cfg.ue ueId="0"/>
     </tapa.send>
     # Expect failure in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm ueId="0" status="15"/>
     </tapa.expect>

     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
    </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>
     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" ueId="0" status="15"/>
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.68" >

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
         Reconfiguration, config params setting and Release when TDD
         cell is config 1"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         numTxAntPorts ="2" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 3rd frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 5 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 5 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   
   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
  
   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
   
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
    # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
    # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
	srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

      # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="315" cqiRepType="2" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD20" UeReCfgType="4096" />
      </tapa.send>


       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
      
    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>
     
    # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
    # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="314"  riCfgIdx = "555"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="312"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>
      
  #Request to ShutDown LTEMAC

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.69" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test PCQI periodicity with PCQI configured with a certain Periodicity
         for WideBand CQI for TDD configuration 1"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
           <tapa.flag id="TFU_UPGRADE"/>
           <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" 
        numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
        ulStartSfIdxLst="10:10" numTxAntPorts ="4" raWinSize="10"/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
   # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0"  codeBookResPrsnt="TRUE" txModeEnum="RGR_UE_TM_3" prdCqiCfg.type="TRUE" 
              cqiPCfgIdx ="3" sANCQI="TRUE" 
                riEna = "FALSE"  riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>
     
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect cqi reception request
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
     </tapa.expset>
      
      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #expect the CQI RR
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #expect the CQI RR
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
   #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.70">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of HARQ, PCQI and RI Reception requests in TDD config 1"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a  RI reception request followed by a RAW CQI 
         Indication."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="4" raWinSize="10" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
   # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_4"  codeBookResPrsnt="TRUE"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" sANCQI="TRUE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD21"
            riEna = "TRUE"  cqiRepType="2" riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
     
      <tapa.send> 
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

     #Thus expect CQI RR here
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>
      </tapa.expset>
      
      <tapa.send>
         # Send 3 TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    
      #Send Raw CQI Indication
      <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
           <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
        
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 3 TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
        
       #Expect  CQI RR
      <tapa.expect>
          <tapa.tfu.recp.req expRecpReq="1">
              <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0"/>
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>
      
      #For the data sent 4 tti's earlier expect HQ RR 
      <tapa.expect>
          <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
   
    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.71" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify  PCQI and SR Periodicity for a Reception Request in TDD configuration 1" 
      </tapa.desc>

      <tapa.longdesc>
        "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. PCQI RR and SR RR on the same TTI. 
         PCQI and SR RR should  be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
       <tapa.rg.cellInit ulDlCfgIdx="1" 
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" raWinSize="10"/>
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

   # Do RACH init
   <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"  codeBookResPrsnt="TRUE"
            srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
     
      <tapa.send>
         # Send  TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
        <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send UE config request
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="7"/>
     </tapa.send>
    
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
             <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.sr.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      
      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
     
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>
    
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.72">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 Data Transfer for 2 UEs in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by RB setup with data transfer for 2 UEs."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
            
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.73">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 Data Transfer for a UE in bundling mode -
          Verification of dai sent in DCI"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         "by RB setup procedure for 2 UEs. It then sends DL data."
         "Verifies the DAI sent in UL DCI"
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         maxUlBwPerUe="20" raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request for UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" 
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>
      
      # Configure UL LCG on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for  UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Expect data indication for UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant for UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>
     
#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
     
   # Send data with size equal to the allocated size for DAT1 for UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT1 for 
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1" spId="0">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
 # Expect staInd from MAC to RLC for DAT2 for UE
   # HARQ Recption Request for DAT 1,2 for UE
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
 <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

<!--
 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
-->
  
    # Send BO for the created logical channel for DAT2 for UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

 <tapa.send>
      <tapa.tfu.tti.ind numTti="5" />
   </tapa.send>
 # Expect staInd from MAC to RLC for DAT1 for UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
 
 # Send data with size equal to the allocated size for DAT2 for UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
 
   # Expect PDSCH and PDCCH for the dat req for DAT2 for UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   
  <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

<tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

 # HARQ Recption Request for DAT 2 for UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

<tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 1 for UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
  <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   # HARQ Recption Request for DAT 2 for UE 
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 2 for UE 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
 
    # Send SR Indication for UE 
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
# Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 for UE
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for UE 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
<tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   #Send CRC for Msg for UE 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
   # Send BSR for UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

 # HARQ Recption Request for DAT 2 for UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 2 for UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect UL grant for UE
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtGrant="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.74" >

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test failure handling for UE PCQI, RI, SR, SRS and ACQI Configuration
         when TDD configuration is 1"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Later reconfigure them Out-Of-Range PCQI,RI,
         ACQI,SRS and SR for UEID 0 and later reconfigure them with allowed range "
      </tapa.longdesc>
   </tapa.doc>

     # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 5 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 5 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   
   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
  
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
      aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
      aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>  

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_1" UeReCfgType="1" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3" UeReCfgType="1" />
      </tapa.send>

         # Send UE PCQI/RI ReConfiguration for the same UE-0 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>


      # Send UE SR ReConfiguration for the same UE-0 created above for  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
         srCfgPres="TRUE" srCfgIdx="253"
        UeReCfgType="16384" />
      </tapa.send>
    
        # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>


      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="253"
        UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3" UeReCfgType="1" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1" />
         <tapa.rgr.cfgCfm ueId="1" />
         <tapa.rgr.cfgCfm ueId="0" status="15" />
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>
      
      # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>

      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
          txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="311"  riCfgIdx = "501"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="315"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>
             
    #Request to ShutDown LTEMAC
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.75">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configuration 1 Measurement GAP with 80ms for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE configuration with measurement GAP is successful and
         validate that the UE is not scheduled during measurement GAP in
         downlink for Configuration 1."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   # RACH Init
   <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" isMesGapEnabled="TRUE"
             gapPrd="80" gapOffst="32"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>
      
      # Send BO for the logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect staInd from MAC to RLC 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send Dat Request from RLC to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect PDCCH and PDSCH
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   # Expect HARQ Reception Request
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # Expect HARQ ACK
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.76">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE only gets scheduled in its active time in TDD configuration 1" 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      #RACH init
      <tapa.rg.rachtdd1/>
      
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # RLC--->MAC_SH (StaRsp)
     
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>
     
      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.77">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE drxInactivity timer running for tdd configuration 1"
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- The inactivity timer for 5pfs for UE 0 would have started.
      This means we can still send more downlink data -->

      # RLC--->MAC_SH (StaRsp). This is (4,8)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="30"/>
      </tapa.send>

      #Give 2 TTI's to bring it to (5,1) as we look at 
      #3 tti's ahead. (5,4) is a DL subframe.
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>(5,2)
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- bring it to (5,5) --> 
      <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #HARQ reception for 1st data
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  #HARQ reception for 2nd data
  <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>
  
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  # Send ACK as feedback for the received PDU.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>


</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#rg003.301 [ccpu00121751]-ADD-added missing measurement gap
#functionality.
<tapa.testcase id="11.78">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "This test case tests the MAC behaviour in Uplink when Measurement timer 
         is running."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" TTI="MSG4"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" isMesGapEnabled="TRUE"
        maxUlHqTx="4" gapPrd="40" gapOffst="30" prdBsrTmr="65535" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" isMesGapEnabled="TRUE"
        maxUlHqTx="4" gapPrd="40" gapOffst="30" prdBsrTmr="65535" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                 ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      #Expect data indication for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expect>
 <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
#DL part is removed because the TC requires to test UL
 # Send SR Indication for 1st UE and 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 for 1st UE and 2nd UE
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for 1st UE and 2nd UE
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
        <tapa.tfu.pusch.recp.req  ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg for 1st UE and 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # Send BSR for 1st UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         #<tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="0"/>
         <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="5" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   # Send BSR for 2nd UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         #<tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="1"/>
         <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="5" ueId="1"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
 # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
 # Expect UL grant for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" />
         <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" />
      </tapa.tfu.cntrl.req>
   </tapa.expect>
<tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.recp.req expRecpReq="2" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
         <tapa.tfu.pusch.recp.req ueId="1"/>
      </tapa.tfu.recp.req>
   </tapa.expect>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect PHICH for 1st UE and 2nd UE
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="FALSE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="FALSE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

#ChangeRequest  ccpu00127529 Assigned Retransmission fails during measurement gap   
#raised the CR but rejected and removed the script since the behaviour is as per design.

</tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.79
#
#       Desc:    For configuration 1, validate UL Adap retx
#
#       Notes:   None
#              
#       Module:  TDD
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.79">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="tdd ul"/>

      <tapa.desc>
         "To test that For configuration 1, Validate UL Adap Retx"
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the Adap retx is happening when the new tx is overlaping 
             with some other allocation in retx subframe."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" 
           prdBsrTmr="65535" maxUlHqTx="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send RA Req such that MSG3 alloc will overlap with retx of PUSCH
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="0" saveTo="3" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      #Dont send CRC Indication- such that it will be considered NACK
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # As the retx of PUSCH data is overlapping with MSG3 alloc, 
      # Adap retx will be happening 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="7" vldtGrant="TRUE" vldtRetx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
            <tapa.tfu.pusch.recp.req ueId="0" use="7" vldtDatRecp="TRUE" 
               saveTo="4" isRetx="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:   11.80 
#
#       Desc:   "To test successful execution of Adap Msg3 retx"  
#                "in TDD mode"
#       Notes:   None
#              
#       Module:  "RACH Module"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.80" >>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful execution of Adap MSg3 retx"
         "In TDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC Failure for Msg3 for UE-0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3 of UE-0
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="4" vldtGrant="TRUE" vldtRetx="TRUE"
            isUlGrant="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
            <tapa.tfu.pusch.recp.req ueId="0" use="4" isRetx="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.81
#
#       Desc:   "To test the successful DL path for a UE with UE configured to 
#                report CQI in periodic mode 1-0 for a frequency selective cell."
#
#       Notes:   None
#              
#       Module:  "DLFS Module"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.81">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Successful DL path for a UE in frequency selective cell and periodic
         CQI report for mode 1-0.
      </tapa.desc>

      <tapa.longdesc>
         Testing that UE recieves DL data successfully on reporting CQI through
         periodic CQI reporting mode 1-0 in a frequency selective cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	#<tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      #Initialize CELL
      #<tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  isDlFreqSel="1"/>
      <tapa.rg.cellInit dlTotalBw="25" ulDlCfgIdx="2"  isDlFreqSel="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" TTI="TEST0"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="5" TTI="TEST01" />
   </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" ueId="0"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TEST02"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
    #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="TEST1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="TEST2"/>
      </tapa.send>
      
    # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3" TTI="TEST20"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST3"/>
      </tapa.send>
  
    <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE" vldtSbAlloc="TRUE"
           allocSbIds="0:1" chkGrant="TRUE" use="1"/>
     </tapa.tfu.dat.req>
   </tapa.expset>
      
	<tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4" TTI="TEST4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="4" TTI="TEST5"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    12.3
#
#       Desc:   "To test the successful DL path for a MAC PDU for a frequency
#                selective cell with UE configured to report through aperiodic mode
#                2-0"
#
#       Notes:   None
#
#       Module:  "DLFS Module"
#
#       File:    rgac_tc12.xml
#
#
<tapa.testcase id="11.82">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Successful DL path for a UE in frequency selective cell and periodic
         CQI report for mode 2-0.
      </tapa.desc>

      <tapa.longdesc>
         Testing that UE recieves DL data successfully on reporting CQI through
         periodic CQI reporting mode 2-0 in a frequency selective cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="1" dlTotalBw="100"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" TTI="TEST0"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   <tapa.send>
      #<tapa.tfu.tti.ind numTti="3" />
      <tapa.tfu.tti.ind numTti="5"/>
   </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" ueId="0"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
    #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
    # Send CQI indication for aperiodic mode 2-0
	<tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi isPucchInfo="FALSE" cqiMode="1" wbCqi="8" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:12:80:16:60" numRbLst = "4:4:4:4:4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    #added  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
    <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE" vldtSbAlloc="TRUE"
           allocSbIds="0:3:20:4:15" chkGrant="TRUE" use="1"/>
     </tapa.tfu.dat.req>
   </tapa.expset>
      
	<tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4" TTI="TEST4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
</tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

# TCs from g14
#
#
#       Test:    14.3
#
#       Desc:   "Verify that signaling channel is given higher priority over
#                data with priority 0."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#

<tapa.testcase id="11.83">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
       "Verify that signaling channel is given higher priority over data
         with priority 0."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that signaling channel is given higher priority over data
         with priority 0."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="1" ulDlCfgIdx="2"  maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

	<tapa.send>
      # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>
      # Expect configuration confirm after the TTI for 1st UE	
      <tapa.expect>
	  <tapa.crg.cfgcfm/>
	</tapa.expect>
      <tapa.send>
      # Configure a DTCH at MAC (not scheduler) for UE 1
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE	
	<tapa.expect>
	  <tapa.crg.cfgcfm/>
	</tapa.expect>
      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      # rg002.301:ccpu00120621-MOD-changed qci from o to 1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" dlQci="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

 # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the DTCH on RGU.
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="3000"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the DCCH on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

 <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST2"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for both DCCH and DTCH
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
 # Scheduler meanwhile would have scheduled for DTCH
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.84
#
#       Desc:   PFS behaviour with two UEs in uplink
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
<tapa.testcase id="11.84">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
     "Configure two UEs with same PFS priorities and ueBR. Send the BSR for both
      UEs (with a value of BSR index value such as grant can be satisfied in one SF for both UEs)
      in SF N so that all the grant for both UEs can be accommodated in one TTI.
      Verify that both UE1 and UE2 are scheduled in SF N+1.
      Then in SF N+2 verify that again both UEs are getting scheduled. And so on for 3-4 TTIs"
     </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by RB setup procedure for 2 UEs. It then sends DL data."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1" ulDlCfgIdx="2" />
   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" ueBr="4000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" />
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1" ueBr="4000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

#Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure LCG 1 and 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 and 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

 # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="1" bsr="20" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="1" bsr="20" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
  # Expect dci format 0 and do basic validations of the grant for UE0 and UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
# TCs from g13
#
#       Test:    13.2
#
#       Desc:   "To test the successful DL path for a Re-Tx UE with UE configured to
#                report CQI in periodic mode 1-0 using MAX C/I scheduling for
#                GBR/NON-GBR/AMBR services."
#
#       Notes:   None
#
#       Module:  "MAX C/I Module"
#
#       File:    rgac_tc13.xml
<tapa.testcase id="11.85">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Successful DL path for a Tx UE using MAX C/I scheduling and periodic
         CQI report for mode 1-0 for GBR/NON-GBR/AMBR services.
      </tapa.desc>

      <tapa.longdesc>
  	 Testing that Re-Tx UE recieves DL data successfully on reporting CQI through
         periodic CQI reporting mode 1-0 using MAX C/I scheduler for
         GBR/NON-GBR/AMBR services.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlTotalBw="75" dlSchdType="3" maxDlRetxBw="75" ulDlCfgIdx="2" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"  
           prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" dlAmbr="15000"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" />
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 #Till now RACH and basic UE context is setup
 <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure an AMBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="6" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      <tapa.send>
         # Configure an non-ambr dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Configure an AMBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 7 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="6" dir="1" lcType="4"
            dlQci="7" instId="5" />
      </tapa.send>
 # Configure an Non-AMBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 7 for UE2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="7" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send CQI indication for periodic mode 1-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 <tapa.send>
         # Send BO for the DCCH on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="1" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="5" lcType="4" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the AMBR DTCH on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="6" lcType="4" bo="80"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the Non-AMBR DTCH on RGU.
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="4" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for DCCH and DTCH
         <tapa.rgu.dstaind ueId="0" numLchTb1="3" lchTb1Data="1:5:6" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="3" />
      </tapa.expset>

      <tapa.send>
         # Send data for UE1
         <tapa.rgu.ddatreq ueId="0" numLchTb1="3" lchTb1Data="1,0,1:5,0,1:6,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="3,0,1"/>
      </tapa.send>
                          <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

 <tapa.send>
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.cntrl.req expCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0" validate = "TRUE" use="1" saveTo="5"
           vldtRetx="TRUE"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" validate = "TRUE" use="1" saveTo="6"
           vldtRetx="TRUE"/>
     </tapa.tfu.cntrl.req>
     #TODO: Set chkSdu="TRUE"
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0" validate="TRUE"
           use="5" retxUse="3" chkSdu="FALSE" lcId="1:5:6" isRetx="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" validate="TRUE"
           use="6" retxUse="4" chkSdu="FALSE" lcId="3" isRetx="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#TCs from  g15
#
#
#       Test:    15.4
#
#       Desc:    Verify that in a multiple UE Scenario, the UEs shall be
#       scheduled in RR fashion based on SR
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.86">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that in a multiple UE Scenario, the UEs shall be
          scheduled in RR fashion based on SR"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 #Till now RACH and basic UE context is setup
#UE1 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 #UE2 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

 # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="4" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
 # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    15.10
#
#       Desc:    Verify that in a multiple UE Scenario, the UEs shall be
#       scheduled in RR fashion based on Trunc BSR
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.87">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that in a multiple UE Scenario, the UEs shall be
            scheduled in RR fashion based on Trunc BSR"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 #Till now RACH and basic UE context is setup
 #UE1 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 #UE2 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

# Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="4" addTruncBsr="TRUE" bsr="9" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="1" use="8" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

   </tapa.test>
# Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    15.9
#
#       Desc:    Verify that in a multiple UE Scenario, the UEs shall be
#       scheduled in RR fashion based on Short BSR
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.88">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that in a multiple UE Scenario, the UEs shall be
            scheduled in RR fashion based on Short BSR"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 #Till now RACH and basic UE context is setup
 #UE1 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 #UE2 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

# Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="4" addShortBsr="TRUE" bsr="9" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="1" use="8" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>
-->
   </tapa.test>
# Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    15.6
#
#       Desc:    Verify that in a multiple UE Scenario, the UEs shall be
#       scheduled in RR fashion based on long BSR
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.89">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that in a multiple UE Scenario, the UEs shall be
            scheduled in RR fashion based on long BSR"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 #Till now RACH and basic UE context is setup
 #UE1 Configuration
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 #UE2 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" addLongBsr="TRUE"
            bsr0="4" bsr1="0" bsr2="0" bsr3="0"/>
          <tapa.tfu.dat ueId="1" use="4" addLongBsr="TRUE"
            bsr0="9" bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>


      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE" saveTo="7"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="7" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="8" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
 # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:   11.90
#
#       Desc:   "To test successful calculation of Average PRB usage per
#                QCI in DL"
#       Notes:   None
#
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.90">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation of average PRB usage
         per QCI in DL in TDD mode using single UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTE_L2_MEAS"/>

      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="1" dlTotalBw="80" dlSchdType="0" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4" timingAdvs="3" tpcs="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send lc="TRUE">
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send lc="TRUE">
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
	aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
#UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5"
           dlQci="8" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="4" timePrd="0" numQci="1" qci="8"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      # Send a Tti to get the transmission scheduled.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="BO1"/>
      </tapa.send>
 # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="BO1"/>
      </tapa.send>

     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req>
         <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
     </tapa.expset>



      <tapa.delay delay="5"/>

      # Send DDatReq for UE1
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2" TTI="BO2"/>
      </tapa.send>
      <tapa.delay delay="5"/>
 #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

 # Send DDatReq for UE1
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>
      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2" TTI="BO3"/>
      </tapa.send>

      <tapa.delay delay="5"/>

    # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>


 #Reception request for 3rd data request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
#Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
      </tapa.expset>
#Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HARQ ACK indication for 2nd data request
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HARQ ACK indication for 2nd data request
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
    

   #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
      </tapa.expset>

   <tapa.send>
      <tapa.lrg.schL2sendmeasreq/> 
   </tapa.send>

      #Send tti indication
      <tapa.send  lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #Expect L2 Measurement confirm
      <tapa.expect>
         <tapa.lrg.schL2meascfm numDlQci="1" prbPercQci="15"/>
      </tapa.expect>
      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>
	 # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#TCs from g10
#
#       Test:    10.19
#
#       Desc:    "Verify correctness of PUCCH TPC command"
#
#       Notes:   None
#
#       Module:  "Power"
#
#       File:    rgac_tc10.xml
#
#
<tapa.testcase id="11.91">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify correctness of PUCCH TPC command"
      </tapa.desc>

      <tapa.longdesc>
         "Verify correctness of PUCCH TPC command"
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
 # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ueCatEnum="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 # Configure LCs
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="0" lcId="1"
            lcType="5" dir="3"/>
      </tapa.send>
      <tapa.send>
         #rg002.301:ccpu00120621-MOD-give dlQci as 5 to
         #have priority 0
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1"
            lcType="5" instId="5" dlQci="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" TTI="TEST1"/>
      </tapa.send>

      # Send PUCCH delta indication.CfgdpucchDeltaPwr = -127 + pucchDeltaPwr
      <tapa.send>
         <tapa.tfu.pucchdelta.ind>
            <tapa.tfu.pucchdelta ueId="0" pucchDeltaPwr="131"/>
         </tapa.tfu.pucchdelta.ind>
      </tapa.send>
<tapa.send>
         # Send BO for the DTCH on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="3000"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST2"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for both DCCH and DTCH
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="TEST3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtTpc="TRUE"
               tpcCmd="3"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="TEST4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtTpc="TRUE"
               tpcCmd="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="TEST5"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtTpc="TRUE"
               tpcCmd="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
   
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.92
#
#       Desc:    "Verify PUSCH group power control"
#
#       Notes:   None
#
#       Module:  "Power"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.92">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUSCH group power control"
      </tapa.desc>

      <tapa.longdesc>
         "Verify PUSCH group power control"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="IGNORE_FOR_NOW"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
        pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
        pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
        puschFmt3StartRnti="300" puschFmt3RntiSize="4"
        puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
 # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
 # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0" addPhr="TRUE" phr="46"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1" addPhr="TRUE" phr="46"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
 # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

 # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
        isAccumulated="TRUE" trgCqi="14" puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
        isAccumulated="TRUE" trgCqi="5" puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="2"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
#Till now RACH and basic UE context is setup
 # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="2"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="7"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" TTI="TEST1"/>
      </tapa.send>
 # Expect DCI format 3A
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2" tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
 <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2" isUlPdcchLst="TRUE"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5" TTI="TEST2"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
 # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5" TTI="TEST3"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5" TTI="TEST4"/>
      </tapa.send>
 #rg001.301 - MOD - [ccpu00118788] Expecting yet another DCI to match the power CQI
      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2" isUlPdcchLst="TRUE" 
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      #ccpu00117270-ADD-trgCqi interanally gets set to '11'
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Note that trgCqi internally was set to '9' for UE 0 due to
      # UE's capability. So no more power commands are sent for it.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 </tapa.test>
 # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.93
#
#       Desc:    "Verify PUSCH group power control with non-group power
#                 control"
#
#       Notes:   None
#
#       Module:  "Power"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.93">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUSCH group power control with non-group power control"
      </tapa.desc>

      <tapa.longdesc>
         "Configure UE for PUSCH group power control using format 3 (2 bit cmd
         mode). Report CQI different from target CQI.
         Verify that usual power control will kick in when SR is reported,
         that group power control will not happen while usual allocation goes
         out.
         Also verify that the usual allocation causes the UE to not be
         scheduled for group power control."
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="IGNORE_FOR_NOW"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
	pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
	puschFmt3StartRnti="300" puschFmt3RntiSize="4"
	puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
 # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0" addPhr="TRUE" phr="46"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
 # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
 # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
         isAccumulated="TRUE" trgCqi="12" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
 # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="5"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
 # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 (only - no format 3)
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"
              vldtTpc="TRUE" tpcCmd="3"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Now group power control kicks in
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2:0:1:3:4:10" isUlPdcchLst="TRUE"
               tpcCmds="3:1:1:1:1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
 # Expect DCI format 3 - this one would have the final reduced
      # command.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2" tpcCmds="3" isUlPdcchLst="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
   </tapa.test>
 # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>




#
#
#       Test:    10.20
#
#       Desc:    "Verify PUCCH group power control"
#
#       Notes:   None
#
#       Module:  "Power"
#
#       File:    rgac_tc10.xml
#
#
<tapa.testcase id="11.94">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUCCH group power control"
      </tapa.desc>

      <tapa.longdesc>
         "Verify PUCCH group power control"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
 	pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
         pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
         puschFmt3StartRnti="300" puschFmt3RntiSize="4"
         puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 isAccumulated="TRUE" trgCqi="12"
         ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="2"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>

   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send PUCCH delta indication. CfgdpucchDeltaPwr = -127 + pucchDeltaPwr
      <tapa.send>
         <tapa.tfu.pucchdelta.ind>
            <tapa.tfu.pucchdelta ueId="0" pucchDeltaPwr="134"/>
         </tapa.tfu.pucchdelta.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
 # Expect DCI format 3
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="100" tpcIndices="2" tpcCmds="3"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3. Also choose some other indices and verify
      # that these correspond to 0 dB TPC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="100" tpcIndices="2:0:1:3:4:10"
               tpcCmds="3:1:1:1:1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>

      # Expect DCI format 3 - this one would have the final reduced
      # command.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="100" tpcIndices="2" tpcCmds="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # No more commands now
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>
 # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.95
#
#       Desc:   Verify that RR schedules a single UE in DL.
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.95">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that RR schedules a single UE in DL."
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"   dlSchdType="2" ulSchdType="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a dedicated logical channel for the created UE
   <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
# Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>
<tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

     <tapa.send>
        <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi ueId="0" cqiIdx="15"/>
        </tapa.tfu.dlcqi.ind>
     </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
   
</tapa.test>
 # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.96
#
#       Desc:    Verify that RR schedules a single UE in UL
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.96">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that RR schedules a single UE in UL"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"   dlSchdType="2" ulSchdType="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="9"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" TTI="TEST1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#added as part of g15 functionality from g1
#
#       Test:    1.13
#
#       Desc:    To test UE reset at both CRG and RGR Interface with Data Path
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="11.97">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test UE reset at CRG/RGR interface with Data Path
      </tapa.desc>

      <tapa.longdesc>
         "Create a CELL at CRG and RGR Interface and then create UE at CRG and
         RGR interface and start Downlink Data Path and then Send UE Reset
         Request at CRG/RGR interfaces after Status Indication from MAC"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlSchdType="2" ulSchdType="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send lc="TRUE">
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send lc="TRUE">
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" ulAmbr="1024"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

<tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="1024"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
#need to justify below commented flow after UE Reset
<!--
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
<tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" TTI="TEST2" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>
      </tapa.send>
-->
   </tapa.test>
 # Clean subsection
   <tapa.clean>
      #Request to ShutDown LTEMAC
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#added as part of g15 functionality from g11.33
#
#
#       Test:    11.98
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#		      Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="11.98">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0"  dlSchdType="2" ulSchdType="2"
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
     # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>


    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
      
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
	srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="315" cqiRepType="2" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD20" UeReCfgType="4096" />
      </tapa.send>


       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
      
    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>


    # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="314"  riCfgIdx = "555"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="312"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

  #Request to ShutDown LTEMAC

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#rg002.301 ccpu00109543 MOD cqi to mcs violation
#
#       Test:    14.8
#
#       Desc:   "Verify that, among GBR channels, channels with
#                higher priority (lower priority value) are
#                satisfied first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="11.99">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among GBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among GBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.longdesc>

   </tapa.doc>
   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 1 (QCI 1) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            dlGbr="1000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 2 (QCI 2) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="5"
            dlGbr="1000" dlMbr="6000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
    # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="350" oldestSduDelay="100"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="600"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
      # Send data corresponding to staInds
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST2"/>
      </tapa.send>
      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
	 <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel which did not have BO satisifed
         # completely last time.
         # rg002.301:ccpu00120621-MOD-priorities have changed.
         # Now, Priority(5) > Priority(3)
        # <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.100
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority (lower priority value) are
#                satisfied first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.100">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            dlGbr="1000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
            dlGbr="1000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
 # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="350"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="350"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST0"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInds
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>
     
     
      # Send data corresponding to staInds
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

 	<tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
	
	    <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel which did not have BO satisifed
         # completely last time.
         #<tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg002.301 ccpu00109543 MOD cqi to mcs violation
#
#
#       Test:    14.11
#
#       Desc:   "Verify that remaining rate is considered
#                for AMBR channels"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="11.101">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that remaining rate is cnosidered for
          AMBR channels."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that remaining rate is cnosidered for
          AMBR channels."
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ambrPres="TRUE" dlAmbr="1000"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ambrPres="TRUE" dlAmbr="1000"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
# Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
# Send some BO to satisfy the higher priority LC,
      # So that its remaining rate goes down.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="400"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      # Also, now send more BO updates, so that the lower
      # priority LC also has some BO.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="400"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="5000"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST2"/>
      </tapa.send>
      
	# Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#added as part of g14 functionality from g11.33
#
#
#       Test:    11.98
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#		      Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="11.102">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0"  dlSchdType="1" ulSchdType="1"
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

 # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>


      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
      
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
	srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="315" cqiRepType="2" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD20" UeReCfgType="4096" />
      </tapa.send>


       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
      
    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>


    # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="314"  riCfgIdx = "555"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="312"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

  #Request to ShutDown LTEMAC
   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#rg003.301 ccpu00119087 MOD
#rg002.301 ccpu00109543 MOD cqi to mcs violation
#
#
#       Test:    14.20
#
#       Desc:   "Verify that HARQ proc with signaling/TA receives higher
#                priority than proc carrying DTCH of priority 0.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="11.103">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0."
      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="28" maxDlBwPerUe="28" dlSchdType="1"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
<tapa.send>
         # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0"
            dir="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a DTCH at MAC (not scheduler) for UE 1
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5"
           dlQci="5" instId="5"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Get all the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TA for UE and BO for the DTCH on RGU.
      <tapa.send>
         <tapa.tfu.timingadv.ind>
            <tapa.tfu.timingadv ueId="0" timingAdv="3"/>
         </tapa.tfu.timingadv.ind>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="800"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="1" lcId="3"/>
      </tapa.send>
 <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3"
               chkTA="TRUE" taVal="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4"
               validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
# NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" TTI="TEST1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtRetx="TRUE"
               use="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Ending TC here, what needed to be verified is achieved.
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    14.28
#
#       Desc:    "Verify that CQI is considered to determine UE
#                 priority while scheduling"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="11.104">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that CQI is considered to determine UE
           priority while scheduling"
      </tapa.desc>

      <tapa.longdesc>
         "Set up two similar UEs, UE 1 having CQI = 10 and UE 2 having CQI = 3.
         Report BSR for LCG 1,3 for UE 1 and BSR for LCG 2 for UE 2, such that
         both UEs together cannot be completely satisfied in the same
         subframe. Ensure during cell config that difference in difference in
         CQI levels more than compensates for difference in LCG priorities.
         Verify that UE 2 is satisifed first completely before UE 1 (despite
         UE 2 having data for lower priority LCG)."
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="28" maxDlBwPerUe="28"
      dlSchdType="1" ulSchdType="1" ulThroughputFactor="10" ulFairnessFactor="0"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 # Configure LCG 1 and 3 at MAC (not scheduler) for UE 0
   <tapa.send>
   <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="3"
         lcType="4" dir="2"/>
   </tapa.send>

      # Configure LCG 2 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="3" lcId="3"
            lcType="4" dir="3"/>
      </tapa.send>

      # Configure LCG 1 and 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="3" dir="3"
          lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5"/>
      </tapa.send>

      # Configure LCG 2 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="3" dir="3"
          lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
# Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
	 # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE" 
               lcgId="3" bsr="60" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="3" bsr="60" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="7"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="10"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

       <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect HARQ ACK in PHICH
      <tapa.expect>
          <tapa.tfu.cntrl.req expCntrlReq="4">
             <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
                vldtGrant="TRUE" vldtTx="TRUE" rbStart="2" numRb="36"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE"
                  vldtGrant="TRUE" vldtTx="TRUE" rbStart="38" numRb="54"/>
            <tapa.tfu.phich.cntrl.req ueId="0" />
            <tapa.tfu.phich.cntrl.req ueId="1" />
         </tapa.tfu.cntrl.req>
      </tapa.expect>

</tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#added as part of g11 functionality from g11.33
#
#
#       Test:    11.98
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#		      Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="11.105">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="0"  dlSchdType="3" ulSchdType="3"
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
      
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
	srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="315" cqiRepType="2" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD20" UeReCfgType="4096" />
      </tapa.send>


       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
      
    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>


    # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="314"  riCfgIdx = "555"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="312"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

  #Request to ShutDown LTEMAC

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.106
#
#       Desc:    To verify successful UE delete for the UEs which are 
#                pending with transmissions or re-transmissions through
#                2 UE scenario.
#
#       Notes:   None
#
#       Module:  "MAX C/I Module"
#
#       File:    rgac_tc13.xml
#
#
<tapa.testcase id="11.106">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful UE delete for UEs,which are pending with 
         transmissions or re-transmissions through 2 UE scenario.
      </tapa.desc>

      <tapa.longdesc>
         To verify successful UE delete for UEs pending with transmissions or
         re-transmissions through 2 UE scenario.
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="50" dlSchdType="3" maxDlBwPerUe="25"
         maxDlRetxBw="25"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" dlAmbr="15000"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" dlAmbr="15000"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
<tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure an non-ambr dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>
 # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>

      # Configure a Non-GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 7 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="7" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the DCCH on RGU for UE1
         <tapa.rgu.dstarsp ueId="0" lcId="1" lcType="5" bo="800"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="580"/>
      </tapa.send>
 <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="4" bo="580"/>
      </tapa.send>

      # Send CQI indication for periodic mode 1-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" cqiMode="0" cqiIdx="6"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI indication for periodic mode 1-0 for UE2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="TRUE" cqiMode="0" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send UE Delete Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE Delete Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
 # Send TTI to Scheduler
      # Expect config confirm
      # Expect staInd for UE2
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      <tapa.expect>
        # Now DTCH of UE2 shall get scheduled
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="3" />
      </tapa.expect>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="3,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send a TTI to get the PDCCH for UE2
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1" use="1" saveTo="2" validate="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="8" TTI="TEST1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

      <tapa.send>
         # Send a 3 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

      # Send UE Delete Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="1" DelType="2"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE Delete Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="1" DelType="2"/>
      </tapa.send>
 <tapa.send>
       # Send 2 Ttis (one for scheduling, one for retransmission,
       # if scheduled and hence NACK is successfully handled)
       # Expect config confirm
       <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # Send TTIs to Scheduler
      # No other pending data is expected
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    11.107
#
#       Desc:    To validate that for Uplink scheduling MAX CI chooses a UE with
#       higher wideband CQI.
#
#       Notes:   None
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
###############################################################################
<tapa.testcase id="11.107">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate that for Uplink scheduling MAX CI chooses a UE with
         higher wideband CQI."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  ulTotalBw="20" ulSchdType="3"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
# Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
# Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="6" />
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="8" />
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
 # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
#Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE" lcgId="1" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
	   <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE" />
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

###############################################################################
#
#       Test:    13.25
#
#       Desc:    To validate that for Uplink scheduling MAX CI chooses a UEs with
#       different wideband CQI such that the UE with the best CQI gets
#       allocations ahead of other UEs. (LONG BSR)
#
#       Notes:   None
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc13.xml
#
#
###############################################################################
<tapa.testcase id="11.108">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate that for Uplink scheduling MAX CI chooses a UEs with
         different wideband CQI such that the UE with the best CQI gets
         allocations ahead of other UEs."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  ulTotalBw="30" ulSchdType="3" maxUlUeNewTxPerTti="4"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
# Configure bi-directional DTCH for default UE0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
# Configure bi-directional DTCH for default UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Indicate the same CQI for both
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12" />
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" />
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
	# Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
	# Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
	# Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" ueId="0" addLongBsr="TRUE" bsr0="0" bsr1="50"
             bsr2="0" bsr3="0"/>
          <tapa.tfu.dat use="6" ueId="1" addLongBsr="TRUE" bsr0="0" bsr1="50"
             bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" vldtDatRecp="TRUE" saveTo="5"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
   # Send a TTI to schedule BSR
     <tapa.send>
        <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
 
   # Send a TTI to schedule BSR
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>
 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" vldtDatRecp="TRUE" saveTo="5"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
   # Send a TTI to schedule BSR
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
   # Send a TTI to schedule BSR
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     # Expect DCI format 0 and do basic validations of the grant
   
<tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
          <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    13.16
#
#       Desc:    To validate that for Uplink scheduling MAX CI chooses a UE with
#       lcg0 data even if it has a lower wideband CQI.
#
#       Notes:   None
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc13.xml
#
#
###############################################################################
<tapa.testcase id="11.109">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate that for Uplink scheduling MAX CI chooses a UE with
         lcg0 data even if it has a lower wideband CQI."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  ulTotalBw="30" ulSchdType="3" maxUlUeNewTxPerTti="4"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>
	# Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expset>
 # Send UL CQI such that ue2 has a lower CQI
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="9" />
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" />
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant Send LCG0 for
      # ue2
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE" lcgId="0" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>


   </tapa.test>
# Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#Added as part of g13
<tapa.testcase id="11.110">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate that for Uplink scheduling MAX CI chooses a UE with
         lcg0 data even if it has a lower wideband CQI."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  ulTotalBw="30" ulSchdType="3" maxUlUeNewTxPerTti="4"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>
	# Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expset>
 # Send UL CQI such that ue2 has a lower CQI
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="9" />
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" />
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant Send LCG0 for
      # ue2
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" ueId="0" addTruncBsr="TRUE" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="4" ueId="1" addTruncBsr="TRUE" lcgId="0" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>


   </tapa.test>
# Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#added as part of g13 functionality from g1
#
#       Test:    11.111
#
#       Desc:    To test UE reset at both CRG and RGR Interface with Data Path
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="11.111">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test UE reset at CRG/RGR interface with Data Path
      </tapa.desc>

      <tapa.longdesc>
         "Create a CELL at CRG and RGR Interface and then create UE at CRG and
         RGR interface and start Downlink Data Path and then Send UE Reset
         Request at CRG/RGR interfaces after Status Indication from MAC"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlSchdType="3" ulSchdType="3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send lc="TRUE">
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send lc="TRUE">
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" ulAmbr="1024"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

<tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="1024"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
#need to justify below commented flow after UE Reset
<!--
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
<tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" TTI="TEST2" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>
      </tapa.send>
-->
   </tapa.test>
 # Clean subsection
   <tapa.clean>
      #Request to ShutDown LTEMAC
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#added as part of g13
#
#
#       Test:    14.20
#
#       Desc:   "Verify that HARQ proc with signaling/TA receives higher
#                priority than proc carrying DTCH of priority 0.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="11.112">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0."
      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="28" maxDlBwPerUe="28" dlSchdType="3"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
<tapa.send>
         # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0"
            dir="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a DTCH at MAC (not scheduler) for UE 1
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5"
           dlQci="5" instId="5"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Get all the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TA for UE and BO for the DTCH on RGU.
      <tapa.send>
         <tapa.tfu.timingadv.ind>
            <tapa.tfu.timingadv ueId="0" timingAdv="3"/>
         </tapa.tfu.timingadv.ind>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="800"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="1" lcId="3"/>
      </tapa.send>
 <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3"
               chkTA="TRUE" taVal="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4"
               validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
# NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" TTI="TEST1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtRetx="TRUE"
               use="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Ending TC here, what needed to be verified is achieved.
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    1.113
#
#       Desc:    To test successful CRG/RGR Logical Channel Delete Request
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="11.113">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG/RGR Logical Channel Delete Request"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, RACH and UE configurations and then call Logical Channel
         Delete Request and expect configuration confirm"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
	pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
	puschFmt3StartRnti="300" puschFmt3RntiSize="4"
	puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 isAccumulated="TRUE" trgCqi="12" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
# Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="1" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="1" dir="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="1" dir="2" lcType="4" />
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Configure uplink DTCH for default UE  at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="2" dir="2" lcType="4" />
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="3" dir="2" lcType="4"  />
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="1" lcgId="0" dir="3"
            lcType="4"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="2" lcgId="1" dir="2"
            lcType="4" />
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>
 # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="3" lcgId="2" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="4" lcgId="3" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>
      # Send TTI indication for default cell at RGR.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect configuration confirm after the TTI from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del DelType="3" cellId="3" ueId="0" lcId="1" dir="3"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="2" dir="2"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="3" dir="2"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="4" dir="2"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
# Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="1" dir="3"/>
      </tapa.send>
      # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="0"/>
      </tapa.send>
      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="2" dir="2"/>
      </tapa.send>
      # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>
      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="3" dir="2"/>
      </tapa.send>
      # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="2"/>
      </tapa.send>
      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="4" dir="2"/>
      </tapa.send>
# Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.114
#
#       Desc:    To test successful CRG and RGR Logical Channel Re Configuration
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.114">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG/RGR Logical Channel Re Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Send CELL/UE configuration request to LTEMAC/Scheduler from Dummy RRC and
         from RRM respectively and expect a positive configuration confirmation
         from LTE MAC and Scheduler respectively and then send a configuration
         for  Dedicated Logical Channels from Dummy RRC and RRM to LTEMAC and
         Scheduler respectively and expect a configuration confirm"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
	pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
	puschFmt3StartRnti="300" puschFmt3RntiSize="4"
	puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 isAccumulated="TRUE" trgCqi="12" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a dedicated logical channel for the created UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="0" lcId="9" lcType="5" dir="2" dlQci="1"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcId="9" dir="1"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcId="9"
             dir="2"/>
      </tapa.send>
      # Send LCG ReConfiguration for the same LCG created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lcg instId="5" lcgId="0"/>
       </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="3" lcgId="0" dir="3"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="4" lcgId="1" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="5" lcgId="2" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="6" lcgId="3" dir="2"
            lcType="4"/>
      </tapa.send>
# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect configuration confirm after the TTI from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="2" lcId="3"
             dir="3"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="2"
            lcId="3" dir="3"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="1" lcId="4"
             dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="1"
            lcId="4" dir="2"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    2.15
#
#       Desc:    To Validate Logical Channel re Configuration
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc2.xml
#
<tapa.testcase id="11.115">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To Validate Logical Channel re Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, RACH and UE configurations and then call Logical Channel
         Configuration request to validate different parameters"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
	pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
	puschFmt3StartRnti="300" puschFmt3RntiSize="4"
	puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 isAccumulated="TRUE" trgCqi="12" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
# Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" />
      </tapa.send>
      #Expect a positive cfg cfm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
# Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send LC Recfg with Invalid Cellid at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.lch cellId="5" ueId="0" lcId="1" lcType="5" dir="1"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      # Send LC Recfg with Invalid Cellid at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5" cellId="5" ueId="0" lcId="1"
            lcType="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect negative in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm status="15" instId="5" />
      </tapa.expect>
# Send LC Recfg with Invalid ueId at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.lch cellId="3" ueId="3" lcId="1"
            lcType="5"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      # Send LC Recfg with Invalid ueId at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5" cellId="3" ueId="3" lcId="1"
            lcType="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm status="15" instId="5" />
      </tapa.expect>
 # Send LC Recfg with Invalid lcId at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.lch cellId="3" ueId="0" lcId="15" />
      </tapa.send>
      # Expect success in cfg cfm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      # Send LC Recfg with Invalid lcId at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5" cellId="3" ueId="0" lcId="15"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect negative in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm status="15" instId="5" />
      </tapa.expect>
 # Send LC Recfg with Invalid lcgId at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.lch cellId="3" ueId="0" lcgId="8" lcId="1"/>
      </tapa.send>
      # Expect success in cfg cfm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      # Send LCG Recfg with Invalid lcgId at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lcg instId="5" cellId="3" ueId="0" lcgId="8"
            lcId="1"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm status="15" instId="5" />
      </tapa.expect>
 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#Added as part of g13 to to the LC Reconfig
#
#       Test:    2.6
#
#       Desc:    To test successful CRG and RGR Logical Channel Re Configuration
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc2.xml
#
<tapa.testcase id="11.116">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG Logical Channel Re Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Send CELL/UE configuration request to LTEMAC/Scheduler from Dummy RRC and
         from RRM respectively and expect a positive configuration confirmation
         from LTE MAC and Scheduler respectively and then send a configuration
         for  Dedicated Logical Channels from Dummy RRC and RRM to LTEMAC and
         Scheduler respectively and expect a configuration confirm"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
	pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
	puschFmt3StartRnti="300" puschFmt3RntiSize="4"
	puschFmt3aStartRnti="400" puschFmt3aRntiSize="4" dlSchdType="3" ulSchdType="3"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 isAccumulated="TRUE" trgCqi="12" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a dedicated logical channel for the created UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="0" lcId="9" lcType="5" dir="2" dlQci="1"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcId="9" dir="1"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcId="9"
             dir="2"/>
      </tapa.send>
      # Send LCG ReConfiguration for the same LCG created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lcg instId="5" lcgId="0"/>
       </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
ulQci="8" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="3" lcgId="0" dir="3"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="4" lcgId="1" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="5" lcgId="2" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="6" lcgId="3" dir="2"
            lcType="4"/>
      </tapa.send>
# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect configuration confirm after the TTI from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="2" lcId="3"
             dir="3"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="2"
            lcId="3" dir="3"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="1" lcId="4"
             dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="1"
            lcId="4" dir="2"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.117
#
#       Desc:    To test successful CRG Logical Channel Delete Request
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc2.xml
#
<tapa.testcase id="11.117">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG Logical Channel Delete Request"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, RACH and UE configurations and then call Logical Channel
         Delete Request and expect configuration confirm"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
	pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
	puschFmt3StartRnti="300" puschFmt3RntiSize="4"
	puschFmt3aStartRnti="400" puschFmt3aRntiSize="4" dlSchdType="3" ulSchdType="3" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 isAccumulated="TRUE" trgCqi="12" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
# Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="1" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="1" dir="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="1" dir="2" lcType="4" />
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Configure uplink DTCH for default UE  at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="2" dir="2" lcType="4" />
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="3" dir="2" lcType="4"  />
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="1" lcgId="0" dir="3"
            lcType="4"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="2" lcgId="1" dir="2"
            lcType="4" />
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>
 # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="3" lcgId="2" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="4" lcgId="3" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>
      # Send TTI indication for default cell at RGR.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect configuration confirm after the TTI from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del DelType="3" cellId="3" ueId="0" lcId="1" dir="3"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="2" dir="2"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="3" dir="2"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="4" dir="2"/>
      </tapa.send>
      # Expect configuration confirm from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
# Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="1" dir="3"/>
      </tapa.send>
      # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="0"/>
      </tapa.send>
      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="2" dir="2"/>
      </tapa.send>
      # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>
      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="3" dir="2"/>
      </tapa.send>
      # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="2"/>
      </tapa.send>
      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="4" dir="2"/>
      </tapa.send>
# Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.118
#
#       Desc:    To test UE reset at both CRG and RGR Interface with Data Path
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.118">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test UE reset at CRG/RGR interface with Data Path
      </tapa.desc>

      <tapa.longdesc>
         "Create a CELL at CRG and RGR Interface and then create UE at CRG and
         RGR interface and start Downlink Data Path and then Send UE Reset
         Request at CRG/RGR interfaces after Status Indication from MAC"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlSchdType="0" ulSchdType="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send lc="TRUE">
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send lc="TRUE">
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" ulAmbr="1024"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

<tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="1024"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
#need to justify below commented flow after UE Reset
<!--
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
<tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" TTI="TEST2" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>
      </tapa.send>
-->
   </tapa.test>
 # Clean subsection
   <tapa.clean>
      #Request to ShutDown LTEMAC
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#added as part of g14 functionality from g1
#
#       Test:    1.13
#
#       Desc:    To test UE reset at both CRG and RGR Interface with Data Path
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc16.xml
#
<tapa.testcase id="11.119">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test UE reset at CRG/RGR interface with Data Path
      </tapa.desc>

      <tapa.longdesc>
         "Create a CELL at CRG and RGR Interface and then create UE at CRG and
         RGR interface and start Downlink Data Path and then Send UE Reset
         Request at CRG/RGR interfaces after Status Indication from MAC"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlSchdType="1" ulSchdType="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send lc="TRUE">
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send lc="TRUE">
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" ulAmbr="1024"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

<tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="1024"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
#need to justify below commented flow after UE Reset
<!--
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
<tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" TTI="TEST2" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>
      </tapa.send>
-->
   </tapa.test>
 # Clean subsection
   <tapa.clean>
      #Request to ShutDown LTEMAC
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#Added as part of g15 to to the LC Reconfig
#
#       Test:    2.6
#
#       Desc:    To test successful CRG and RGR Logical Channel Re Configuration
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc2.xml
#
<tapa.testcase id="11.120">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG Logical Channel Re Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Send CELL/UE configuration request to LTEMAC/Scheduler from Dummy RRC and
         from RRM respectively and expect a positive configuration confirmation
         from LTE MAC and Scheduler respectively and then send a configuration
         for  Dedicated Logical Channels from Dummy RRC and RRM to LTEMAC and
         Scheduler respectively and expect a configuration confirm"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" 
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
	pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
	puschFmt3StartRnti="300" puschFmt3RntiSize="4"
	puschFmt3aStartRnti="400" puschFmt3aRntiSize="4" dlSchdType="2" ulSchdType="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 isAccumulated="TRUE" trgCqi="12" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a dedicated logical channel for the created UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="0" lcId="9" lcType="5" dir="2" dlQci="1"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcId="9" dir="1"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcId="9"
             dir="2"/>
      </tapa.send>
      # Send LCG ReConfiguration for the same LCG created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lcg instId="5" lcgId="0"/>
       </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="3" lcgId="0" dir="3"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="4" lcgId="1" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="5" lcgId="2" dir="2"
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="6" lcgId="3" dir="2"
            lcType="4"/>
      </tapa.send>
# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect configuration confirm after the TTI from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="2" lcId="3"
             dir="3"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="2"
            lcId="3" dir="3"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 # Send LC ReConfiguration for the same LC created above at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="1" lcId="4"
             dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="1"
            lcId="4" dir="2"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.121
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE.
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.121">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send DStaRsp with non-zero BO from RGU to MAC.
          3. Verify Transmit Diversity is the TX Scheme selected
             by MAC for scheduling this BO.
          4. Send CQI report from PHY with RI=2.
          5. Send non-zero BO.
          6. Verify 2 TB scheduling using TX scheme as Spatial
             Multiplexing with precInfo=0."
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_3"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 To ensure TD as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>
 # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3  and precInfo=2 To ensure SpaMux as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7" TTI="TEST2"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>
 # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE" isAckLstTb2="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect Format2A, mode=3  and precInfo=2 To ensure SpaMux as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.122
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE with subsequent retx of both TB1 and TB2.
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.122">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE with subsequent retx of TB1 and TB2."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send CQI report from PHY with RI=4.
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Expect RETX for both the TBs with precInfo = 2"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
	 <tapa.flag id="LTEMAC_RGU_PAD"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="60"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9"
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb1="TRUE" isAckLst= "FALSE:FALSE:FALSE:FALSE" isTb2="TRUE" isAckLstTb2= "FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>
 # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
         #  <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
	 <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
 # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#       Test:    17.9
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-4 UE with retx of both TB1 and TB2.
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.123">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-4 UE with retx of TB1 and TB2."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4.
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Expect RETX for both the TBs with precInfo according to latest
             Aperiodic report"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>

# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
<tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
 # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9"
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

 <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>
 # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb1="TRUE" isAckLst= "FALSE:FALSE:FALSE:FALSE" isTb2="TRUE" isAckLstTb2= "FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST2"/>
      </tapa.send>
      # Expect Format2, mode=4 SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   </tapa.test>
# Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    17.11
#
#       Desc:    Validation of PMI.
#                Incase of Precoding Information Signalling to a UE is implicit
#                then MAC Scheduler Shall explicitely inform the PHY layer as to
#                what are the sub band and PMI mappings.
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.124">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation of PMI.
          Incase of Precoding Information Signalling to a UE is implicit
          then MAC Scheduler Shall explicitely inform the PHY layer (In PDSCH)
          as to what are the sub band and PMI mappings"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Feedback report using Aperiodic mode 3 - 1
             and RI=4 from the TFU Interface.
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial
             Multiplexing.
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9"
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 # Expect Format2, mode=4, pmi = 50 and PUSCHMODE = MODE31 in pusch
      # SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"
              vldPuschPmiInfo="TRUE" puschMode="TFU_PUSCH_CQI_MODE_31"
              vldPuschRptUsd="TRUE" puschRptUsd="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#       Test:    17.23
#
#       Desc:    To test the MAC whether it supports TM6 or not.
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.125">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC whether it supports TM6 or not."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6.
          2. Configure a Cell with 4 Tx Antenna
          3. Send PMI Feedback.
          4. Schedule the UE.
          5. Expect TB in PDSCH
          6. Expect DCI Format 1B in PDCCH"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6" ueCatEnum="CM_LTE_UE_CAT_1"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B, mode=3 and precInfo=8 CLSM - Single Layer as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
 <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.126
#
#       Desc:    Validate that Latest aperiodic PUSCH report from the
#                UE is honoured till new reception
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.126">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Latest aperiodic PUSCH report from the
                UE is honoured till new reception"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6.
          2. Configure a Cell with 4 Tx Antenna
          3. Send PMI Feedback using periodic Mode.
          4. Schedule the UE.
          5. Expect a TB in PDSCH and DCI Format 1B in PDCCH
          6. Send Harq F/B and PMI F/B using Aperiodic Mode
          7. Schedule the UE
          8. Expect a TB in PDSCH and DCI Format 1B in PDCCH
          9. Send Harq Feedback and No Control F/B
          10.Schedule the UE
          11.Expect the DCI Format 1B using previous Control F/B
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6" ueCatEnum="CM_LTE_UE_CAT_1"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"
            dlQci="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B and precInfo=8 CLSM - Single Layer as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>
     </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="1" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="0:0:0:0:0" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="2" TTI="TEST1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B and precInfo=10 CLSM - Single Layer as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="10" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

 <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4" TTI="TEST2"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
	   <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      #No Control F/B from the UE
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="3" TTI="TEST3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>
<tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      # Expect Format1B and precInfo=10 CLSM - Single Layer as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="10" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST4"/>
      </tapa.send>

 # Expect Format1B and precInfo=10 CLSM - Single Layer as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="10" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST5"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#       Test:    17.32
#
#       Desc:    Validation of transmission scheme incase of invalid PMI
#                Report for the first time (TM4)
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.127">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation of transmission scheme incase of invalid PMI
          Report for the first time (TM4)"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Configure Cell with 2 TX Antenna Ports.
          3. Send Feedback report using Aperiodic mode 3-1
             and RI,CQI and invalid PMI
          4. Send non-zero BO.
          5. Expect a TB in PDSCH and DCI Format1A in PDCCH
             Because of invalid PMI report (Incase of first time),
             It should choose transmission scheme as transmit diversity.
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" ueCatEnum="CM_LTE_UE_CAT_4"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      #ccpu00118150 changed pmiIdx =2 from 1 since validation is for invalid PMI
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="2"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A in PDCCH
      # Expect transmission scheme as transmit diversity
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="FALSE"
              vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
 <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#       Test:    17.33
#
#       Desc:    Validate that Retransmission TB should map to 2 layers
#                incase of TX+ReTx when reported ri = 3
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.128">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Retransmission TB should map to 2 layers
          incase of TX+ReTx when reported ri = 3"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4.
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial
             Multiplexing.
          5. Send HqFdbk as NACK for TB1 and ACK for TB2
          6. Send Control Feedback(PMI,CQI and RI =3) from the TFU interface
          7. Validate that ReTx TB should map to cw1 (2 layers) and
             New Tx TB should map to CW0 (single layer).
             Validate the CW Swap flag. It should set TRUE
          8. Expect RETX of TB2 along with New Tx TB1"
      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9"
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
<tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
	
	# Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb1="TRUE" isAckLst= "FALSE:FALSE:FALSE:FALSE" isTb2="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="3"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb2Data="9" saveTo="3" numLchTb2="1" numLchTb1="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb2="1" lchTb2Data="9" lcType="5" numLchTb1="0"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect Format2, mode=4 SpaMux as TX Scheme
      # Expect cwSwapFlag as TRUE
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"
                              vldCWSwapFlag="TRUE" cwSwapFlag="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
 <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>
 # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    17.35
#
#       Desc:    To test the MAC - whether it supports TM7 or not.
#                Also validate that support of TM7 with Resource
#                Allocation Type
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.129">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC whether it supports TM7 or not.
           Also validate that support of TM7 with Resource Allocation Type"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM7.
          2. Configure a Cell with 4 Tx Antenna and with DLFS.
          3. Send CQI Feedback.
          4. Schedule the UE.
          5. Expect TB in PDSCH
          6. Expect DCI Format 1 in PDCCH
             (Expect DCI Fmt 1 if RAType=0 or DCI Fmt 1A if RAType =2)"
      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4" isDlFreqSel="1"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_7" tm="CRG_UE_TM_7" ueCatEnum="CM_LTE_UE_CAT_1"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
<tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="800"/>
      </tapa.send>

 <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1 in PDCCH as RAType = 0
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_7" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1="TRUE"
              isTb1Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
 <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAckLst="FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect Format1A, mode=2 TD as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_7" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1="TRUE"
                                     isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
 <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq sAckLst="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#       Test:    17.36
#
#       Desc:    Incase of TM7 Ues, MAC shall be able to indiacte the PHY
#                reported DOA(Direction of Arrival) Indicator back to PHY
#                as part of subsequent PDSCH datarequest
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.130">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
           "Incase of TM7 Ues, MAC shall be able to indiacte the PHY
            reported DOA(Direction of Arrival) Indicator back to PHY
            as part of subsequent PDSCH datarequest"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM7.
          2. Configure a Cell with 4 Tx Antenna
          3. Send CQI Feedback.
          4. Send DOA report from the TFU Interface
          5. Schedule the UE.
          6. Expect TB in PDSCH
          7. Expect DCI Format 1A in PDCCH (RAType =2)
          8. Expect previously reported DOA Value in this
             PDSCH DatRequest"
       </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_7" tm="CRG_UE_TM_7" ueCatEnum="CM_LTE_UE_CAT_1"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
 # Send DOA(Direction of Arrival) for the received PDU
      <tapa.send>
        <tapa.tfu.doa.ind>
           <tapa.tfu.doa doa="10"/>
        </tapa.tfu.doa.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# Expect Format1A in PDCCH as RAType = 2
      # Expect DOA value(Reported Previously) in this PDSCH DatRequest
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_7" isTb1="TRUE" vldDoa="TRUE" doaVal="10"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq sAckLst ="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
  </tapa.test>
# Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#       Test:    17.5
#
#       Desc:    To test the MAC whether it supports TM2 or not.
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="11.131">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC whether it supports TM2 or not."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM2.
          2. Configure a Cell with 4 Tx Antenna
          3. Send CQI Report from the UE.
          4. Schedule the UE.
          6. Expect DCI Format 1A in PDCCH"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_2" tm="CRG_UE_TM_2"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with CQI = 9
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="9"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>
 <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=2 Transmit diversity as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_2" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                                     isTb1Pres="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
 <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAckLst="FALSE" />
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect Format1A, mode=2 TD as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_2" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                                     isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
 <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAckLst="TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.132
#
#       Desc:    Validate that Rank of Transmission is less than
#                the reported rank.
#
#       Notes:   None
#
#       Module:
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.132">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Rank of transmission is less than the
          Reported rank."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Aperiodeic Feedback.
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial
             Multiplexing.
          5. Send HqFdbk as NACK for 1TB and ACK for another TB.
             and Report Periodic Feedback RI =4.
          6. Expect RETX of 1TB using 2 Layer"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
	 txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   <tapa.send>
      # Configure a dedicated logical channel for the created UE
      # lcType=5 for DCCH
      <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
   </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>


      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9"
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb1="TRUE" isAckLst= "TRUE:FALSE:FALSE:FALSE" isTb2="TRUE" isAckLstTb2= "FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
  # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="1" riIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect Format2, mode=4 SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcIdTb2="9" chkSduTb2="TRUE"
            transMode="TFU_UE_TM_4" isTb1="FALSE" isTb2="TRUE" chkSdu="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="FALSE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
      </tapa.expect>
 # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAckLst="TRUE" />
        </tapa.tfu.hq.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    11.133
#
#       Desc:    "TDD Configuration 2, Validate scheduling MSG4 and CCCH SDU 
#                 seperately and retransmission of ccchSdu and Ue Delete"
#
#       Notes:   None
#
#       Module:  "RACH"
#
#       File:    rgac_tc11.xml
#
################################################################################
<tapa.testcase id="11.133">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2, Validate scheduling MSG4 and CCCH SDU seperately
          and retransmission of ccchSdu and Ue Delete"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by MSG4 alone scheduling on expiry of CR-Gaurd timer and CCCH SDU tx-retx."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgInitAll/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send TTIs such that only MAC CR CE is scheduled
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send BO for CCCH SDU on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect CStatInd For CCCH SDU
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
   
      # Send UE Delete Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE Delete Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.134
#
#       Desc:   "To test the successful DL path for a UE on cell reconfiguration
#       from frequency non-selective cell to a frequency selective cell."
#
#       Notes:   None
#
#       Module:  "DLFS Module"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.134">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Successful DL path for a UE on cell re-configuration from frequency
         non-selective cell to frequency selective cell.
      </tapa.desc>

      <tapa.longdesc>
         Testing that UE recieves DL data successfully on cell re-configuration
         from frequency non-selective cell to frequency selective cell.
      </tapa.longdesc>

   </tapa.doc>


# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="0" dlTotalBw="50"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" aprdModeEnumPres = "TRUE"
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
<tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

         # Cell reconfiguration to enable frequency selective cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" isDlFreqSel="1"
            recfgType="512"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.rgr.cfgCfm instId="5" />
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>
 <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

    # Send CQI indication for aperiodic mode 2-0
    <tapa.send>
     <tapa.tfu.dlcqi.ind>
       <tapa.tfu.dlcqi isPucchInfo="FALSE" cqiMode="1" wbCqi="7" cqiIdx="12"
        numOfSubbands = "4" rbStartLst = "3:12:18:48" numRbLst =
        "3:3:3:2" />
     </tapa.tfu.dlcqi.ind>
    </tapa.send>

    <tapa.send>
       # Send BO for the created logical channel on RGU.
       <tapa.rgu.dstarsp lcId="1" lcType="5" bo="80"/>
    </tapa.send>

    <tapa.send>
       # Send a Tti to get the transmission scheduled.
       <tapa.tfu.tti.ind numTti="2"/>
    </tapa.send>
 <tapa.expect>
       # Expect staInd from MAC to RLC for Msg4
       <tapa.rgu.dstaind lchTb1Data="1" />
    </tapa.expect>

    <tapa.send>
       # Send data with size less than the allocated on RGU.
       # if we can send less data from TA or to report a BO which
       # will surely result in padding
       <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
    </tapa.send>

   <tapa.send>
      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE" vldtSbAlloc="TRUE"
           allocSbIds="1:4:6:16" chkGrant="TRUE" use="1"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expset>
 <tapa.send>
         # Send a 3 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   # Cell reconfiguration to change the threshold value for a
   # frequency-selective cell
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.cell instId="5" isDlFreqSel="1"
         recfgType="512" />
   </tapa.send>

    <tapa.send>
       # Send a 1 TTIs to get the reconfiguration confirmation
       <tapa.tfu.tti.ind numTti="1"/>
    </tapa.send>

    <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" />
    </tapa.expect>

    # Send CQI indication for aperiodic mode 2-0 with CQI value less than
    # threshold value
    <tapa.send>
     <tapa.tfu.dlcqi.ind>
       <tapa.tfu.dlcqi isPucchInfo="FALSE" cqiMode="1" wbCqi="7" cqiIdx="7"
        numOfSubbands = "4" rbStartLst = "3:12:18:48" numRbLst =
        "3:3:3:2" />
     </tapa.tfu.dlcqi.ind>
    </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.98
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#		      Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="11.135">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="0"  dlSchdType="3" ulSchdType="3"
         raWinSize="10" numTxAntPorts ="2" isDlFreqSel="1"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
      
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
	srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="315" cqiRepType="2" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD20" UeReCfgType="4096" />
      </tapa.send>


       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
      
    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>


    # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="314"  riCfgIdx = "555"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="312"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

  #Request to ShutDown LTEMAC

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#       Test:    11.136
#
#       Desc:    To test validation of CRG Cell Re configuration 
#                 for scheduler type 1
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.136">
   
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test validation of CRG Cell Re configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Send CELL configuration request to LTEMAC from Dummy RRC and expect a
         positive configuration confirmation from LTE MAC and then send a Re
         configuration for CELL to test validation of differet parameters of re
         configuration"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>
   
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      # Cell Configuration

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>
      
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP to Scheduler
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>
      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration If cellId not given it will take default as
      # 3.
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell  cellId="3" />
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send RGR Cell Configuration If cellId not given it will take default as
      # 3.
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>

      # Send CELL ReConfiguration With Invalid CellId at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.cell  cellId="4"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      # Send CELL ReConfiguration With Invalid CellId at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  instId="5" cellId="4" dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      #Expect negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send CELL ReConfiguration With Invalid resource Size at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  cellId="3" resourceSize="0"
            recfgType="64" instId="5" dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="0"/>
      </tapa.expect>

      # Send CELL ReConfiguration With Invalid deltaShift at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  cellId="3" deltaShift="0"
            recfgType="64" instId="5" dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid deltaShift at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  cellId="3" deltaShift="4"
            recfgType="64" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid cyclicShift at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  cellId="3" cyclicShift="8"
            recfgType="64" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid raWinSize at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell recfgType="256"  cellId="3" raWinSize="0"
            instId="5" dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid SRS configuration at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell cellId="3" recfgType="2"
            srsBwEnum="RGAC_RGR_SRS_BWCFG_ERR" instId="5" 
            dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid raWinSize at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell   recfgType="256" cellId="3"
            raWinSize="11" instId="5" dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid preambleFormat at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  recfgType="256" cellId="3"
            preambleFormat="11" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid maxMsg3Tx at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.cell  CellReCfgType="4" cellId="3" maxMsg3Tx="0"
         dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      # Send CELL ReConfiguration With Invalid maxMsg3Tx at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  recfgType="256" cellId="3" maxMsg3Tx="0"
            instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect negative Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid numRaPreamble at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  recfgType="256" cellId="3"
            numRaPreamble="3" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration With Invalid numRaPreamble at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  recfgType="256" cellId="3"
            numRaPreamble="65" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send CELL ReConfiguration With Invalid numRaPreamble and
      # sizeRaPreambleGrpA at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  cellId="3" numRaPreamble="60"
            sizeRaPreambleGrpA="100" recfgType="256" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      # Send CELL ReConfiguration
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  recfgType="128" cellId="3" instId="5" dlSchdType="1" ulSchdType="1"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
      # Send CELL ReConfiguration 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell  recfgType="256" cellId="3" instId="5" 
            raWinSize="4" preambleFormat="0" maxMsg3Tx="2" numRaPreamble="60" sizeRaPreambleGrpA="60" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>

      # Send UnBind Request to SCH SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq elmntType="STGEN" action="ASHUTDOWN"/>
      </tapa.send>
      
      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.ubndreq spId="1" />
      </tapa.expect>

      #Expect a Control Confirm from Scheduler
      <tapa.expect>
         <tapa.lrg.schcntrlcfm/>
      </tapa.expect>

      #Send Control Request to LTEMAC for ShutDown 
      <tapa.send>
         <tapa.lrg.cntrlreq action="ASHUTDOWN" elmntType="STGEN" />
      </tapa.send>
      # Expect Cntrl Confirm from LTEMAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
   
</tapa.testcase>

#       Test:    12.4
#
#       Desc:   "To test the successful DL path for a MAC PDU for a frequency
#                selective cell with UE configured to report through aperiodic mode
#                3-0"
#
#       Notes:   None
#
#       Module:  "DLFS Module"
#
#       File:    rgac_tc12.xml
#
#
<tapa.testcase id="11.137">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Successful DL path for a UE in frequency selective cell and aperiodic
         CQI report for mode 2-0.
      </tapa.desc>

      <tapa.longdesc>
         Testing that UE recieves DL data successfully on reporting CQI through
         aperiodic CQI reporting mode 2-0 in a frequency selective cell.
      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="1" dlTotalBw="50" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

 # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
 # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
 # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
          aprdModeEnum = "RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE" />

   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
<tapa.send>
         # Configure a dedicated logical channel for the created UE
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 # TODO: This should be sent only after request for aperiodic CQI
      # Send CQI indication for aperiodic mode 3-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
           <tapa.tfu.dlcqi isPucchInfo="FALSE" cqiMode="3" wbCqi="8"
            numOfSubbands = "4" rbStartLst = "0:4:8:12" numRbLst =
            "4:4:4:3" cqiIdxLst="11:12:8:7"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU.
         # if we can send less data from TA or to report a BO which
         # will surely result in padding
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE" vldtSbAlloc="TRUE"
           allocSbIds="0:1:2:3" chkGrant="TRUE" use="1"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>
 # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.138
#
#       Desc:    To validate numPduTxmit statistics in tfu and rgu interface
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="11.138">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "To validate numPduTxmit statistics in tfu and rgu interface"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="1" dlTotalBw="50"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3 for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
 # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
 # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
          maxUlHqTx="4" ueBr="4000" />

   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure bi-directional non-GBR DTCHs for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
 
      # Send a TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" TTI="TEST1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stsreq elmntType="STRGUSAP"  action="4"/>
      </tapa.send>

      # Expect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STRGUSAP" numPduTxmit="2" numPduRcvd="1"
           numPduDrop="0"  validateSts="TRUE"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#       Test:    11.139
#
#       Desc:    To test various uncovered code legs in LRG.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.139">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test various uncovered code legs in LRG."
      </tapa.desc>

      <tapa.longdesc>
         "1. Send sts request for general with action as RST.
2. Send sts request individually for rgu, rgr, crg and tfu saps with action as RST.
3. Send sts request with an invalid element.
4. Send Status request for an invalid element.
5. Send Control Request for an invalid element.
6. Send the configuration for rgr, rgu, crg and tfu saps with invalid selector value.
7. Try to send the general configuration twice.
8. Try to disable the trc and usta (general elements) through control request.
9. Try sending the bind and unbind control request to TFU without configuring the sap.
10. Configure tfu,rgr,crg,rgu sap and delete it.
11. Send a bind confirm from tfu with status something differnt from CM_BND_OK.
12."
      </tapa.longdesc>
   </tapa.doc>

 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.lrg.cfg.gen elmntType="STGEN"/>
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.cfgcfm   status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_MSGTYPE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stsreq elmntType="STGEN" action="4"/>
      </tapa.send>
 # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stscfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stsreq elmntType="STTFUSAP"  action="4"/>
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STTFUSAP" />
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stsreq elmntType="STRGUSAP"  action="4"/>
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STRGUSAP" />
      </tapa.expect>
 <tapa.send>
         <tapa.lrg.stsreq elmntType="STCRGSAP"  action="4"/>
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STCRGSAP" />
      </tapa.expect>

      # some invalid elmnt
      <tapa.send>
         <tapa.lrg.stsreq elmntType="RGAC_RGR_SRS_BWCFG_7"  action="4"/>
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="RGAC_RGR_SRS_BWCFG_7" status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_ELMNT"/>
      </tapa.expect>

      # some invalid elmnt
      <tapa.send>
         <tapa.lrg.stareq elmntType="RGAC_RGR_SRS_BWCFG_7"/>
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm  status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_ELMNT"/>
      </tapa.expect>

      # some invalid elmnt
      <tapa.send>
         <tapa.lrg.cntrlreq elmntType="RGAC_RGR_SRS_BWCFG_7"/>
      </tapa.send>
# Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm  status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ADISIMM" elmntType="STGEN" subAction="SATRC"/>
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ADISIMM" elmntType="STGEN" subAction="SAUSTA"/>
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ADEL" elmntType="STRGUSAP"/>
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm  elmntType="STRGUSAP"/>
      </tapa.expect>
 <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ADEL" elmntType="STCRGSAP"/>
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm  elmntType="STCRGSAP"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ADEL" elmntType="STTFUSAP"/>
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expset>
         <tapa.lrg.cntrlcfm/>
      # Ecpect Dummy TFU UnBind Request
         <tapa.tfu.ubndreq/>
      </tapa.expset>

      # Send UnBind Request to RGU SAP
      <tapa.send>
         <tapa.rgu.ubndreq/>
      </tapa.send>

      # Send UnBind Request to CRG SAP
      <tapa.send>
         <tapa.crg.ubndreq/>
      </tapa.send>
 #Send Control Request to LTEMAC for ShutDown
      <tapa.send>
         <tapa.lrg.cntrlreq action="ASHUTDOWN" elmntType="STGEN" />
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to LTEMAC for ShutDown
      <tapa.send>
         <tapa.lrg.schcntrlreq action="ASHUTDOWN" elmntType="STGEN" />
      </tapa.send>

      # Expect Dummy TFU UnBind Request
      <tapa.expect>
         <tapa.tfu.sch.ubndreq instId="5" spId="1"/>
      </tapa.expect>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#       Test:    16.2
#
#       Desc:    To test sap status.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="11.140">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test sap status"
      </tapa.desc>

      <tapa.longdesc>
         "To test sap status."
      </tapa.longdesc>
   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>
 # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.lrg.stareq elmntType="STGEN" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stareq elmntType="STTFUSAP" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm sapState="LRG_BND"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="AUBND" elmntType="STTFUSAP" />
      </tapa.send>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.ubndreq/>
      </tapa.expect>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>
 <tapa.send>
         <tapa.lrg.stareq elmntType="STRGUSAP" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm sapState="LRG_BND"/>
      </tapa.expect>
 <tapa.send>
         <tapa.lrg.stareq elmntType="STCRGSAP" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm sapState="LRG_BND"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stareq elmntType="STTFUSAP" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm sapState="LRG_UBND"/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
 # Ecpect Dummy TFU Bind Request
      <tapa.send>
         <tapa.tfu.bndcfm/>
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stareq elmntType="STTFUSAP" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm sapState="LRG_BND"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    16.9
#
#       Desc:    To test Other Scenarios.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="11.141">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test lower sap bind retries at Scheduler"
      </tapa.desc>

      <tapa.longdesc>
         "Other scenarios at LRG,CRG, RGR and TFU interfaces"
      </tapa.longdesc>
   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      # Send General Configuration for LTEMAC
      <tapa.send>
         <tapa.lrg.cfg.gen tmrRes="10"/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>

      # Enable USTA
      <tapa.send>
         <tapa.lrg.cntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>
      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

#Send Bind Request for RGU SAP without Configuring It.
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      # Expect Status Indication for SAP Not available
      <tapa.expect>
         <tapa.lrg.staind category="2" event="0" cause="2" />
      </tapa.expect>
      # Expect negative Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm status="2" />
      </tapa.expect>
      #Send Unbind Without Binding
      <tapa.send>
         <tapa.rgu.ubndreq/>
      </tapa.send>

      #Send RGU  SSAP Configuration to LTEMAC */
      <tapa.send>
         <tapa.lrg.cfg.rgusap/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>
      #Send Bind Request for RGU SAP
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm  />
      </tapa.expect>
      # Expect Status Indication for Bind Enabled
      <tapa.expect>
         <tapa.lrg.staind category="2" event="256" cause="0" />
      </tapa.expect>
 #Send Bind Request for RGU SAP
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm  />
      </tapa.expect>

      #Send Bind Request for RGU SAP without Configuring It.
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.lrg.staind category="2" event="0" cause="2" />
      </tapa.expect>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm status="2" />
      </tapa.expect>

      #Send Unbind Without Binding
      <tapa.send>
         <tapa.crg.ubndreq/>
      </tapa.send>

      #Send CRG  SSAP Configuration to LTEMAC */
      <tapa.send>
         <tapa.lrg.cfg.crgsap/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>
      #Send Bind Request for CRG SAP
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
 # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm  />
      </tapa.expect>
      # Expect Status Indication for Bind Enabled
      <tapa.expect>
         <tapa.lrg.staind category="2" event="257" cause="0" />
      </tapa.expect>

      #Send TFU Cfg Request
      <tapa.send>
         <tapa.lrg.cfg.tfusap/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
      #Expect Cntrl Confirm from LTE MAC
 # Enable USTA
      <tapa.send>
         <tapa.lrg.schcntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>
      # Expect Negative Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>
      #Send Bind Request for RGR SAP without configuring it.
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      # Expect negative Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm status="2" instdId="1" />
      </tapa.expect>

      # Send Cntrl request to Scheduler to Enable TFU Sap without configure it.
      <tapa.send>
         <tapa.lrg.schcntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      # Expect Negative Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5" status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>

      #Send RGR/TFU SSAP Configuration to LTEMAC */
      <tapa.send>
         <tapa.lrg.cfg.schins numSaps="1" instId="5" rgr_suId="0" rgr_spId="0"
            tfu_suId="0" tfu_spId="1" rgm_suId="0" rgm_spId="0" bndTimerValue="5" />
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.schcfgcfm instId="5"/>
      </tapa.expect>
#Send Unbind Without Binding
      <tapa.send>
         <tapa.rgr.ubndreq/>
      </tapa.send>

      # Enable USTA
      <tapa.send>
         <tapa.lrg.schcntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>
      # Expect Negative Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm />
      </tapa.expect>
      #Send Bind Request for RGR SAP
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      # Expect Positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm instdId="1" />
      </tapa.expect>
      # Expect Status Indication for Bind Enabled
      <tapa.expect>
         <tapa.lrg.sch.staind category="2" event="258" cause="0" />
      </tapa.expect>
      #Send Bind Request for RGR SAP Again
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      # Expect Postive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm instdId="1" />
      </tapa.expect>
 #Send Control Request to Enable TFU SAP at Scheduler
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>
      #Expect positive Control Confirm from LTE MAC
      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1" />
      </tapa.expect>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>
      # Expect Status Indication for SAP Not available
      <tapa.expect>
         <tapa.lrg.sch.staind instId="5" category="2" event="11" cause="256" />
      </tapa.expect>
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.142
#
#       Desc:    To test Un solicited Status Indication in case of Lower Layer
#                bind request.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="11.142">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test status indication when lower layer bound"
      </tapa.desc>

      <tapa.longdesc>
         "When lower TFU bind request sent stack should send control confirm
         with NOK first and then send TFU bind request to Physical layer and
         then stack should send un solicited status indication if USTA enabled
         and then send confirm received from physical layer."
      </tapa.longdesc>
   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      # Send General Configuration for LTEMAC
      <tapa.send>
         <tapa.lrg.cfg.gen tmrRes="10"/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>

      # Enable USTA
      <tapa.send>
         <tapa.lrg.cntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>

      # Expect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send RGU  SSAP Configuration to LTEMAC */
      <tapa.send>
         <tapa.lrg.cfg.rgusap/>
      </tapa.send>
 # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>

      #Send Bind Request for RGU SAP
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>

      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm  />
      </tapa.expect>

      # Expect Status Indication for Bind Enabled
      <tapa.expect>
         <tapa.lrg.staind category="2" event="256" cause="0" />
      </tapa.expect>

      #Send CRG  SSAP Configuration to LTEMAC */
      <tapa.send>
         <tapa.lrg.cfg.crgsap/>
      </tapa.send>

      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>

      #Send Bind Request for CRG SAP
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>

# Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm  />
      </tapa.expect>

      # Expect Status Indication for Bind Enabled
      <tapa.expect>
         <tapa.lrg.staind category="2" event="257" cause="0" />
      </tapa.expect>

      #Send TFU Cfg Request
      <tapa.send>
         <tapa.lrg.cfg.tfusap/>
      </tapa.send>

      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.cfgcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      #Expect Cntrl Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
 # Enable USTA
      <tapa.send>
         <tapa.lrg.schcntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>

      # Expect Negative Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>

      #Send Bind Request for RGR SAP without configuring it.
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>

      # Expect negative Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm status="2" instdId="1" />
      </tapa.expect>

      # Send Cntrl request to Scheduler to Enable TFU Sap without configure it.
      <tapa.send>
         <tapa.lrg.schcntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      # Expect Negative Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5" status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>

      #Send RGR/TFU SSAP Configuration to LTEMAC */
      <tapa.send>
         <tapa.lrg.cfg.schins numSaps="1" instId="5" rgr_suId="0" rgr_spId="0"
            tfu_suId="0" tfu_spId="1" rgm_suId="0" rgm_spId="0" bndTimerValue="5" />
      </tapa.send>
# Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.schcfgcfm instId="5"/>
      </tapa.expect>

      #Send Unbind Without Binding
      <tapa.send>
         <tapa.rgr.ubndreq/>
      </tapa.send>

      # Enable USTA
      <tapa.send>
         <tapa.lrg.schcntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>

      # Expect Negative Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm />
      </tapa.expect>


      #Send Control Request to Enable TFU SAP at Scheduler
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1" />
      </tapa.expect>

 #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      # Expect Status Indication for SAP Not available
      <tapa.expect>
         <tapa.lrg.sch.staind instId="5" category="2" event="11" cause="256" />
      </tapa.expect>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#       Test:    16.8
#
#       Desc:    To test Lower sap bind retries.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="11.143">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test lower sap bind retries at Scheduler"
      </tapa.desc>

      <tapa.longdesc>
         "Unbind Disable TFU SAP at Scheduler. Again send a BndReq, this time do not send
         the reply. Expect MAX retries(2) from LRG. LRG status indication is
         expected after 2 retries."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
 # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         <tapa.lrg.schcntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm/>
      </tapa.expect>
      <tapa.send>
         <tapa.lrg.schcntrlreq suId="0" spId="0" action="AUBND" elmntType="STTFUSAP" />
      </tapa.send>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.ubndreq instId="5" spId="1"/>
      </tapa.expect>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5" />
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
 # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>


      # Ecpect Dummy TFU Bind Request
      <tapa.expect guardTmr="2000000">
         <tapa.tfu.sch.bndreq spId="1" />
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.lrg.sch.staind category="2" event="8" cause="10"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#       Test:    16.3
#
#       Desc:    To test cfg/sta/sts/cntrl without genCfg.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="11.144">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test cfg/sta/sts/cntrl without genCfg"
      </tapa.desc>

      <tapa.longdesc>
         "To test cfg/sta/sts/cntrl without genCfg"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

   </tapa.cfg>
 # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.lrg.cfg.crgsap/>
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.cfgcfm status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stareq elmntType="STGEN" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stacfm status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.stsreq elmntType="STGEN" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.stscfm status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.cntrlreq elmntType="STGEN" />
      </tapa.send>

      # Ecpect Sta Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_NOK" reason="LCM_REASON_GENCFG_NOT_DONE"/>
      </tapa.expect>

   </tapa.test>
 # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.145
#
#       Desc:    To test Lower sap bind retries.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc1.xml
#
<tapa.testcase id="11.145">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test lower sap bind retries"
      </tapa.desc>

      <tapa.longdesc>
         "Unbind Disable TFU SAP. Again send a BndReq, this time do not send
         the reply. Expect MAX retries(2) from LRG. LRG status indication is
         expected after 2 retries."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
 # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         <tapa.lrg.cntrlreq elmntType="STGEN" action="AENA" subAction="SAUSTA" />
      </tapa.send>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="AUBND" elmntType="STTFUSAP" />
      </tapa.send>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.ubndreq/>
      </tapa.expect>

      # Ecpect Cntrl Confirm
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
 # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect guardTmr="2000000">
         <tapa.tfu.bndreq/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.lrg.staind category="2" event="8" cause="10" instId="5"/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#       Test:    2.14
#
#       Desc:    To test validation CRG UE Reconfiguration
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc2.xml
#
<tapa.testcase id="11.146">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test validation CRG UE Reconfiguration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, RACH and UE configurations and then call Ue
         Reconfiguration for validating different parameters"
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="1" dlTotalBw="50"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

 # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
#Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
 # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
 # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>

   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

# Send UE ReConfiguration for the Invalid CellId at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.ue  cellId="4" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
          <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      # Send UE ReConfiguration for the Invalid CellId at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  instId="5" cellId="4" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect negative Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE ReConfiguration for the Invalid UeId at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.ue  cellId="3" oldUeId="1"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      #But UE reestablishing at CRG interface is dummy
      <tapa.expect>
          <tapa.crg.cfgcfm status="0"/>
       </tapa.expect>
# Send UE ReConfiguration for the Invalid UeId at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  cellId="3" oldUeId="1" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect negative Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm status="15" instId="5" />
       </tapa.expect>
 # Send UE ReConfiguration to existing UE for TXmode Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  cellId="3" oldUeId="0" UeReCfgType="1"
             txModeEnum="RGAC_RGR_UE_TM_ERR" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm instId="5" status="15"/>
       </tapa.expect>

       # Send UE ReConfiguration to existing UE for UL HARQ Recfg at CRG
      <tapa.send>
          <tapa.crg.cfgreq.recfg.ue  cellId="3" oldUeId="0" UeReCfgType="8"
             maxUlHqTx="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
          <tapa.crg.cfgcfm status="15"/>
       </tapa.expect>

       # Send UE ReConfiguration to existing UE for UL HARQ Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  cellId="3" oldUeId="0" UeReCfgType="8"
             maxUlHqTx="0" instId="5" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm instId="5" status="15"/>
       </tapa.expect>

      # Send UE ReConfiguration existing oldrnti as newrnti at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  cellId="3" oldUeId="0" newUeId="0"
             UeReCfgType="2" instId="5" pucchTpcRntiPres="FALSE"
             puschTpcRntiPres="FALSE"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>

      # Send UE config request with inavlid ackNackRepFactor at RGR
      <tapa.send>
      /* Validating ACK/NACK is Enabled */
        <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" UeReCfgType="256" isAckNackEnabled="TRUE" ackNackRepFactor="RGAC_ACKNACK_REPFACT_N2_ERR"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request with inavlid gapOffst at RGR
      <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" UeReCfgType="256" 
           isMesGapEnabled="TRUE"  gapPrd="40" gapOffst="40"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request with inavlid gapOffst at RGR
      <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" UeReCfgType="256" isMesGapEnabled="TRUE"  gapPrd="80" gapOffst="80"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

   </tapa.test>
 # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.147
#
#       Desc:    "Verify that RB allocation for UE is constrained by power
#                 headroom."
#
#       Notes:   None
#
#       Module:  "Power"
#
#       File:    rgac_tc10.xml
#
#
<tapa.testcase id="11.147">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that RB allocation for UE is constrained by power
          headroom."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that RB allocation for UE is constrained by power
          headroom."
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="1" dlTotalBw="50"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

 # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
#Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
 # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
 # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"
          isAccumulated="TRUE" isDeltaMCSEnabled="TRUE" trgCqi="14" />

   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
# Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
 # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" lcId="3"
               addShortBsr="TRUE" lcgId="1" bsr="20"
               addPhr="TRUE" phr="12"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="3"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
 # No allocation is made due to inadequate headroom and low current
      # CQI

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # we now give minimum RB's for this case.
      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
 #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" lcId="3"
               addShortBsr="TRUE" lcgId="1" bsr="20"
               addPhr="TRUE" phr="12"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
   </tapa.test>
# Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    7.1
#
#       Desc:    To test DL Scheduler for GBR SVCs Priorities
#
#       Notes:   None
#
#       Module:  None
#
#       File:    rgac_tc7.xml
#
#
<tapa.testcase id="11.148">>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test DL Scheduler for GBR SVCs Priorities"
      </tapa.desc>

      <tapa.longdesc>
         "To Test if DLS gives higher priority to a SVC with greater BO
          among the configured SVCs of the UE which have same priority
          and same GBR configuration."
      </tapa.longdesc>
   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="0" ulSchdType="0" ulDlCfgIdx="2" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TEST1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

 #Till now RACH and basic UE context is setup
 # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="1000" dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="1000"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="1000" dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
 # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="1" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="1000"  dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="15"/>
      </tapa.send>
      # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="10"/>
      </tapa.send>


      # Send a Tti to get the transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
 # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Send DDatReq for UE1 with size equal to the allocated size on RGU.
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU.
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send>
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY for UE2. UeId to check rnti sent by MAC.
   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
   # Expect Msg4 from MAC to PHY.
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1"/>
     </tapa.tfu.dat.req>
   </tapa.expset>
 # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>
 # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#       Test:    7.9
#
#       Desc:    To test if DLS considers GBR/MBR SVCs first and then AMBR.
#
#       Notes:   None
#
#       Module:  None
#
#       File:    rgac_tc7.xml
#
#
<tapa.testcase id="11.149">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test if DLS considers GBR/MBR SVCs first and then AMBR."
      </tapa.desc>

      <tapa.longdesc>

         "Configure 1 Cell and 1 UE with 1 gbr svc and 1 UE with 1
         non gbr svc each. Send starsp in some tti for UE2 and then for UE1.
         Verify that in the next TTI, staInd for UE1 is received first by RLC.
         Scheduler schedules UE1 prior to UE2."
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="0" ulSchdType="0" ulDlCfgIdx="2" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" ambrPres="TRUE" dlAmbr="1024"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" ambrPres="TRUE" dlAmbr="1024"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" TTI="TEST1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="10" lcType="4" dir="1"
                                    dlQci="2" dlGbr="512" dlMbr="1024"/>
      </tapa.send>

      # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1" dlQci="9" />
      </tapa.send>

      # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="8" lcType="4" dir="1"  dlQci="7" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="10" lcType="4" dir="1"
                        dlQci="2" dlGbr="512" dlMbr="1024" instId="5"/>
      </tapa.send>

      # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1" dlQci="9"  instId="5"/>
      </tapa.send>

      # Configure a dedicated logical channel for the created UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="8" lcType="4" dir="1"  dlQci="7"  instId="5"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="10" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="8" lcType="4" bo="30"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="10" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="8" saveTo="2"/>
      </tapa.expect>

      # Send DDatReq for UE1 with size equal to the allocated size on RGU.
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="10" ueId="0" lcId="10" lcType="4"/>
      </tapa.send>
 # Send DDatReq for UE2 with size equal to the allocated size on RGU.
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="8" ueId="1" lcId="8" lcType="4"/>
      </tapa.send>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send>
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
           <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8" TTI="TEST"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
 # Send TFU_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#       Test:    8.1
#
#       Desc:    To test DL Scheduler for UE refreshing
#
#       Notes:   None
#
#       Module:  None
#
#       File:    rgac_tc8.xml
#
#
<tapa.testcase id="11.150">>>

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test DL Scheduler for UE refreshing"
      </tapa.desc>

      <tapa.longdesc>
        "Configure 1 UE and 1 Svc. Make BO = 2*GBR, MBR/AMBR=0.
        Verify that this BO is satisfied over 2 UE refresh cycles.
        In the first cycle after this UE is scheduled once, it has
        left with no data and hence would be removed from consideration
        by scheduler through out the remaining period of 1st cycle.
        There is a provision to specify no of TTIs to be sent via xml command."
      </tapa.longdesc>
   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="3" ulSchdType="3" ulDlCfgIdx="2" />

   </tapa.cfg>
 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send lc="TRUE">
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send lc="TRUE">
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
# Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1" />
   </tapa.send>
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Send DlCqi for the created UE
    <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi cqiIdx="15"/>
         </tapa.tfu.dlcqi.ind>
   </tapa.send>

      # Configure a dedicated logical channel for the created UE  at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="8" lcType="4" dir="1"/>
      </tapa.send>
 # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="8" lcType="4" dir="1"
                                   dlQci="3" dlGbr="256"  dlMbr="256"/>
      </tapa.send>

      # Send a Tti to get the configuration applied at Scheduler.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

 # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # Send BO for the created logical channel on RGU.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="8" lcType="4" bo="64"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="8" />
      </tapa.expect>

      # Send data with size equal to the allocated size on RGU.
     <tapa.send>
         <tapa.rgu.ddatreq  ueId="0" lchTb1Data="8"  lcType="4"/>
      </tapa.send>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send>
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1" >
            <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
         </tapa.tfu.cntrl.req>
 </tapa.expset>

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req />
         </tapa.tfu.recp.req>
 </tapa.expect>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>
 </tapa.send>

 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#       Test:    12.16
#
#       Desc:   "To test Msg4 Re-tx handling in a frequency selective cell"
#
#       Notes:   None
#
#       Module:  "DLFS Module"
#
#       File:    rgac_tc12.xml
#
#
<tapa.testcase id="11.151">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of NACK for Msg4"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, Msg4 and then NACK for Msg4"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  isDlFreqSel="1" dlTotalBw="25"
         dlCcchCqi="3" maxMsg4HqTx="2"/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
  # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                                 tpcs="1" cqiPres="TRUE" cqis="4" ueId="0"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

 # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
 # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
 # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send NACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
	<tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
 # At start of this step, we are at (2,1)
      # Send 2 TTIs(SCHEDULING_RETX(=1) + RG_DL_DELTA(=3) - TFU_DELTA(=2)) before expecting
      # Pdcch request and data request for Msg4 re-transmission.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # At start of this step, we are at (2,3)
      # Expecting a pdcch request and data request for MSG4 re-transmission.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

      # At start of this step, we are at (2,3)
      # Send 4 TTIs before expecting a HARQ reception request for MSG4
      # re-transmission.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (2,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>
   </tapa.expect>
 # At start of this step, we are at (2,7)
      # Send 3 TTIs before expecting a HARQ feedback for MSG4
      # re-transmission.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # At start of this step, we are at (3,0)
      # Send final NACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

      # At start of this step, we are at (3,0)
      # Send 1 TTI for NACK processing
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # RG_MAX_RA_PRC_FRM from 6 to 10
      # At start of this step, we are at (3,1)
      # Send 69 TTIs to delete raCb after
      # raPrcFrm number of TTIs (raPrcFrm = RG_MAX_RA_PRC_FRM = 150)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1500" />
      </tapa.send>

      # At start of this step, we are at (10,0)
      # Send UE config request from RRC when MSG4 is finally NACKED
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (10,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 # Send UE config request from RRC when MSG4 is finally NACKED
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (10,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (10,1)
      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.152
#
#       Desc:    To Validate RAR for ccpu00108928

#
#       Notes:   None
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc13.xml
#
#
###############################################################################
<tapa.testcase id="11.152">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "1.To validate RAR in case actual rach during special subframe (1),
            reaches mac at subframe 4 ulDlCfgIdx="2"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  ulTotalBw="30" ulSchdType="3" maxUlUeNewTxPerTti="4" preambleFormat="4" raWinSize="4"/>

   </tapa.cfg>

# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>


# Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


#Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>


 # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>


 # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>



 # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>


 # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>


<tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

 # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>


 # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>


 # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>


 # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>
        # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>


# Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


 # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expset>
 # Send UL CQI such that ue2 has a lower CQI
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="9" />
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" />
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

 </tapa.test>
# Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    11.153
#
#       Desc:    To validate BSR Timer Expiry
#
#       Notes:   None
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc13.xml
#
#
###############################################################################
<tapa.testcase id="11.153">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "1.To validate that for Uplink scheduling MAX CI chooses a UE with
            lcg0 data even if it has a lower wideband CQI.
         2 .To Validate the BSR Timer Expiry."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  ulTotalBw="30" ulSchdType="3" maxUlUeNewTxPerTti="4"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>



 # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>



#Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>


 # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>



 # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>


 # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>


 # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
	<tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
	<tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

 # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ueCatEnum="CM_LTE_UE_CAT_4" ueBr="6000"/>
   </tapa.send>


# Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>


 # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>


 # Configure bi-directional DTCH for default UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>
        # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>


# Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>



 # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expset>
 # Send UL CQI such that ue2 has a lower CQI
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="9" />
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" />
         </tapa.tfu.ulcqi.ind>
      </tapa.send>


# Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>



# Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


 #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant Send LCG0 for
      # ue2
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE" lcgId="0" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>



 # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# Expect data reception request
<!--
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     #Periodic BSR timer expires. So DCI-0 grant is given.
         <tapa.expect>
           <tapa.tfu.cntrl.req expCntrlReq="1"/>
              <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
                        vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
   </tapa.test>
# Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#To test the Ticket ccpu00130018
#
#       Test:    11.154
#
#       Desc:  Successful handling of TA for a UE.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="11.154">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
       Successful handling of TA for a UE.
      </tapa.desc>

      <tapa.longdesc>
      "Testing that all previously received TAs will be discarded
      if ACK is received for the sent TA and a new TA will be sent
      to UE only after the successful application of TA at UE"
      </tapa.longdesc>

   </tapa.doc>

 # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgInitAll/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>
 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
 # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
# Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
# Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

 # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
 <tapa.send>
         # Send TA to UE
          <tapa.tfu.timingadv.ind>
             <tapa.tfu.timingadv ueId="0" timingAdv="3"  />
          </tapa.tfu.timingadv.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti - TA(=3) gets scheduled here
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.send>
         # Send TA to UE
          <tapa.tfu.timingadv.ind>
             <tapa.tfu.timingadv ueId="0" timingAdv="4"  />
          </tapa.tfu.timingadv.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti - TA(=3) gets transmitted here
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         # Expect datReq with TA
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" chkTA="TRUE" taVal="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
        <tapa.send>
         # Send TA to UE
          <tapa.tfu.timingadv.ind>
             <tapa.tfu.timingadv ueId="0" timingAdv="5"  />
          </tapa.tfu.timingadv.ind>
      </tapa.send>

      <tapa.send>
         # Send 4 TTIs to receive HARQ repection request for the
         # TA that has been sent out
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         # Send TFU_DELTA (=2) TFU_UL_DELTA(=1) Ttis - fdbk for TA (=3)
         # shall be sent here.
         <tapa.tfu.tti.ind numTti="1" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>
 # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
     # Modified for MIMO from 2 to 3 for
     # [ccpu00113186] Corrected  TA handling
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect datReq with TA
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" chkTA="TRUE" taVal="5"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#       Test:    11.155
#
#       Desc:    To test Warning SI Scheduling when winSize = 15
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="11.155">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3" siId="6" bcchIdx="5" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.warningsicfgreq instId="5" bcchIdx="7" cellId="3" siId="7" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.warningsicfgcfm status="15" />
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="29"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
       
      <tapa.expset>
       #  <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      #   <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>      

#
#       Test:    11.156
#
#       Desc:    To test Warning SI Scheduling when winSize = 15
#                When TDD is enabled.
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="11.156">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <!--
      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.warningsicfgreq instId="5" bcchIdx="7" cellId="3" siId="7" buffSz="32" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.warningsicfgcfm status="15" />
      </tapa.expect>
      -->
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="29"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
       
      <tapa.expset>
      #   <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <!--
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        # <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="115"/>
      </tapa.send>
      -->
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>            

 
#       Test:    11.157
#
#       Desc:    To test SI Scheduling Stop Req
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="11.157">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling Stop Req at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>


      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="29"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.warningsistopreq instId="5" siId="4" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
     #    <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>       

         
#
#       Test:    11.158
#
#       Desc:    To test TDD UL Congiguration Scheduling when winSize = 1
#                for TDD 
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="11.158">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="13"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="29"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="15" />
         <!--    
         <tapa.tfu.cntrl.req>
            <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req>
            <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
         </tapa.tfu.dat.req>
         -->
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>            

    
#
#       Test:    11.159
#
#       Desc:    To test SI Scheduling when winSize = 15
#                for TDD (MIB, SIB1, SI, Wrning SI)
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="11.159">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling using SI enhancement at RGR interface"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>
      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="6" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5"  bcchIdx="3"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="7" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>   

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7"  vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
     

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expset>
      #  <tapa.tfu.dat.req>
      #  </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                
      
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      <tapa.expset>
      #  <tapa.tfu.dat.req>
      #  </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      <tapa.expset>
      #   <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      <tapa.expset>
      #   <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
      
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="7" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>                                             

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>          

                                       
#
#       Test:    11.160
#
#       Desc:    To test Warning SI Scheduling if reTxCnt is 2
#                for TDD
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc1.xml
#
#
<tapa.testcase id="11.160">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Warning SI Scheduling if reTxCnt is 2"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="4"  bcchIdx="1"  buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.warningsicfgreq instId="5" cellId="3"  siId="5" bcchIdx="3" buffSz="32" numSeg="2"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="29"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="66"/>
      </tapa.send>

      <tapa.expset>
      #   <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.warningsicfgcfm status="1" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>          

# 
#
#       Test:     11.161
#
#       Desc:     Successful Retransmission of the TB, when Release of DL Harq 
#                 Process is due to the DTX (HARQ Ack/Nack) 
#              
#       Notes:    None
#
#       Module:   "TDD"
#
#       File:    rgac_tc11.xml
#
#

<tapa.testcase id="11.161">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Retransmission scenario in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and generates DTX for it. MAC retransmits it and gets an ACK for
          it."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  
         dlSchdType="2" ulSchdType="2" maxDlRetxBw="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Downlink data now 
       # Send BO for the created logical channel for DAT1
      <tapa.send>
          <tapa.rgu.dstarsp lcId="3" lcType="5" bo="300" ueId="0"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
 
      # Expect staInd from MAC to RLC for DAT1
         <tapa.expect>
            <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         </tapa.expect>
 
      # Send data with size equal to the allocated size for DAT1
      <tapa.send>
         <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
 
      # Expect PDSCH and PDCCH for the dat req for DAT1
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" >
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>
 
      # Send BO for the created logical channel for DAT1
       <tapa.send>
          <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
       </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
 
      # Expect staInd from MAC to RLC for DAT2
         <tapa.expect>
            <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
         </tapa.expect>
 
      # Send data with size equal to the allocated size for DAT2
      <tapa.send>
         <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      # Expect PDSCH and PDCCH for the dat req for DAT2
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" >
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtDai="TRUE" dai="1" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
 
      # Do Not Send feedback for DAT 1
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>
 
 
      #expect HARQ Recption Request for DAT 1
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>
 
      # Do Not Send feedback for DAT 2
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
 
      #expect HARQ Recption Request for DAT 2
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>
      </tapa.expect>
 
       <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
 
 
      # Expect Retransmission for DAT1
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" >
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
 
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
 
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      
      #send HARQ Recption Request for DAT 1 RTX
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>
     </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
 
       # Expect Retransmission for DAT2
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" >
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>
     
      # Send feedback for DAT 1
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>
 
      #send HARQ Recption Request for DAT 1 RTX
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # Send feedback for DAT 2
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="17" />
      </tapa.send>
      
   </tapa.test>
 
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>
 
   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

# 
#
#       Test:    11.162
#
#       Desc:  Successful Updation of DAI when two succssive SF is scheduled for
#              the UE for the same DAI region.
#
#       Notes:   None
#
#       Module:  "TDD"
#
#       File:    rgac_tc11.xml
#
#

<tapa.testcase id="11.162">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2 Transmission scenario in bundling mode"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed
          by RB setup procedure for an UE. It then sends DL data 
          and sends the Proper DAI in PDCCH Control Request for the Second
          Transmission on same DAI region."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  
         dlSchdType="2" ulSchdType="2" maxDlRetxBw="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Downlink data now 
       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="1300" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" vldtDai="TRUE" dai="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>


   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>


   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" vldtDai="TRUE" dai="2" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.163">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1 Data Transfer for a UE in bundling mode -
          Verification of Harq Size in PUSCH HarqInfo"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         "by RB setup procedure for 2 UEs. It then sends DL data."
         "Verifies the DAI sent in UL DCI"
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         maxUlBwPerUe="20" raWinSize="10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request for UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
    # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"
               UeReCfgType="1" />
         </tapa.send>
         
      # Send a TTI to process the UE-Recfg Request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

 
    #Expect positive Configuration Confirm from LTEMAC
    <tapa.expect>
       <tapa.rgr.cfgCfm ueId="0"/>
    </tapa.expect>


   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" 
                  ueId="0"/>
      </tapa.send>
      
      # Configure UL LCG on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for  UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                   ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      <!--     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      -->
      # Send SR Indication for UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      # Send Data Indication using TB size recieved in the grant for UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Expect data indication for UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant for UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>
     
#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="16" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
     
   # Send data with size equal to the allocated size for DAT1 for UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect PDSCH and PDCCH for the dat req for DAT1 for 
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1" spId="0">
        <tapa.tfu.pdsch.dat.req transMode="TFU_UE_TM_3" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>
 # Expect staInd from MAC to RLC for DAT2 for UE
   # HARQ Recption Request for DAT 1,2 for UE
   <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
 <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

<!--
 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
-->
  
    # Send BO for the created logical channel for DAT2 for UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="17" ueId="0"/>
    </tapa.send>

 <tapa.send>
      <tapa.tfu.tti.ind numTti="5" />
   </tapa.send>
 # Expect staInd from MAC to RLC for DAT1 for UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
 
 # Send data with size equal to the allocated size for DAT2 for UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" />
   </tapa.send>
 
   # Expect PDSCH and PDCCH for the dat req for DAT2 for UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req transMode="TFU_UE_TM_3" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   
  <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req transMode="TFU_UE_TM_3" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

<tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

 # HARQ Recption Request for DAT 2 for UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

<tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 1 for UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
  <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   # HARQ Recption Request for DAT 2 for UE 
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 2 for UE 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
 
    # Send SR Indication for UE 
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req transMode="TFU_UE_TM_3" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
# Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 for UE
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for UE 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req  ueId="0" valHqSz="TRUE" hqSz="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req transMode="TFU_UE_TM_3" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
<tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   #Send CRC for Msg for UE 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
   # Send BSR for UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

 # HARQ Recption Request for DAT 2 for UE
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send feedback for DAT 2 for UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
 <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req transMode="TFU_UE_TM_3" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
 <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect UL grant for UE
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


<tapa.testcase id="11.164">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD RGR Cell Configuration - Failure Case"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD RGR Cell configuration , "
         "by RB setup procedure for 2 UEs. It then sends DL data."
         "Verifies the DAI sent in UL DCI"
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

   </tapa.cfg>
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>


      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

 
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

 
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
      
      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell dlTotalBw="100" ulTotalBw="50"/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" maxUlUeNewTxPerTti="3" maxUePerUlSf="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.165
#
#       Desc:    To test UE Configuration at CRG/RGR
#                with DRX parameters(Includes both unsuccessful
#                and successful cases)
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.165">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful UE config at CRG/RG with DRX params"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELl, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Send Invalid values of DRX params and
         expect negative confirm. Finally, send valid values and expect 
         positive confirm.
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="LTEMAC_R9" />
         <tapa.flag id="RGR_V2" />
         <tapa.flag id="TFU_TDD" />
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"  
         dlSchdType="2" ulSchdType="2" maxDlRetxBw="10"/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR  with invalid value of onDurTmr
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="32"   
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
     
     # Send UE config request at RGR with an invalid drx-inactivity tmr val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid drx-retx tmr val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid long-Drx val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="21"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with an invalid short-cycle val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with an invalid short-cycle val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="17"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with longdrx Cycle
    # as not a multiple of short-drx cycle
    
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="17"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with drx-offset 
    # invalid 
    
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
           drxStartOffst="12"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with an valid drx params 
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="3"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="10"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect positive cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
    <tapa.rg.macDeInit/>
   </tapa.clean>

    #Request to ShutDown LTEMAC
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

# SK Start 
#
#
#       Test:    11.166
#
#       Desc:    For configuration 2, To Test that MAC moves to 
#                long DRX cycle after expiry of Short Cycle timer.
#                
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.166">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test UE switching to Long DRX cycle after short cycle. 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="5"
           drxRetxTmr="16"
           longDrxCycle="40"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="10"
           drxShortCycleTmr="4" 
           drxStartOffst="10"
           />
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- bring it to (4,5) --> 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # (4,8)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    
      # Send ACK as feedback for the received PDU.
       <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>
           
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.167
#
#       Desc:    For configuration 2, To test that MAC schedules 
#                only in its active time after reconfiguration.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.167">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test that MAC schedules only in its active time after reconfiguration."
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="10"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # UE ReConfiguration(5,8).
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="0"
            UeReCfgType="131072"
            />
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>


      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.168
#
#       Desc:    For configuration 2, To test functionality of HARQ RTT timer.
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.168">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test that MAC schedules only in its active time after reconfiguration."
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="10"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      # HARQ Reception(5,5)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # HARQ Feedback(5,7). Extra 1 TTI for delta
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send NACK as feedback.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # HARQ Reception(6,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    11.169
#
#       Desc:    For configuration 2, To test functionality of Inactivity 
#                time of 1 PDCCH subframe..
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.169">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test Inactivity time of 1 PDCCH subframe."
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="2"
           drxInactvTmr="1"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="10"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      # HARQ Reception(5,5)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # HARQ Feedback(5,7). Extra 1 TTI for delta
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send NACK as feedback.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>


   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    11.170
#
#       Desc:    For configuration 2, that UE continues on running 
#                onduration cycle even after reconfiguration. 
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.170">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test that UE continues on running onduration 
          cycle even after reconfiguration."
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="10"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="10"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      # UE ReConfiguration(7,0).
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="4"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="0"
            UeReCfgType="131072"
            />
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
<!--      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
-->

      # RLC--->MAC_SH (StaRsp)(7,1)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      

       # Send 2 Tti to get reach(8,0).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.171
#
#       Desc:    For configuration 1, that UE's Retx gets scheduled 
#                while retx running. 
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.171">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test that For configuration 1, that UE's Retx gets scheduled 
          while retx running"
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the drx-retx timer starts at DL SF 9. 
          2) Verify that HARQ retx is scheduled in DL SF 9
          3) Verify that the drx-retx timer expires after DL SF 0, 
             ie, at SPL SF 1 the timer is not active"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="2"
           drxRetxTmr="2"
           longDrxCycle="20"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="9"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" saveTo="5" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Sending BO here and this should not be scheduled as no DRX timer is running
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" lcId="1" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   
      #As the onDur Timer gets started then the pending BO will be scheduled 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    11.172
#
#       Desc:    For configuration 2, the functioning of drx-Retransmission 
#                timer when single HARQ is active. 
#                
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.172">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test the functioning of drx-Retransmission timer when single 
          HARQ is active."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the drx-retx timer starts at SPL SF 1 of next SFN. 
          2) The HARQ retx should not be scheduled in SPL SF 1 because the 
             deltas will lead to reduction in retx Timer. 
          3) Verify that HARQ retx is scheduled in DL SF 3
          4) Verify that the drx-retx timer expires after DL SF 5, ie, at 
             DL SF 6 the timer is not active."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5"
           ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="2"
           drxRetxTmr="4"
           longDrxCycle="40"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="9"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" saveTo="5" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Sending BO here and this should not be scheduled as no DRX timer is running
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" lcId="1" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
   
      #As the onDur Timer gets started then the pending BO will be scheduled 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.173
#
#       Desc:    For configuration 2, the functioning of drx-Retransmission 
#                timer when single HARQ is active and retx timer starst at
#                special subframe. 
#                
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.173">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test the functioning of drx-Retransmission timer when single 
          HARQ is active and the data transmission on special subframe."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the drx-retx timer starts at SPL SF 6 of next SFN. 
          2) The HARQ retx should not be scheduled in SPL SF 6 (assuming the i
             total delay due to the HARQ processing and DL scheduling is 1 + 3 = 4 TTI)
          3) Verify that HARQ retx is scheduled in DL SF 8
          4) Verify that the drx-retx timer expires after DL SF 0, ie, at i
             DL SF 1 the timer is not active ."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5"
           ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="2"
           drxRetxTmr="4"
           longDrxCycle="40"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="8"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" saveTo="5" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Sending BO here and this should not be scheduled as no DRX timer is running

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" lcId="1" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # Send BO and it can not be scheduled immediately as the UE ACTIVE time gone 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="22"/>
      </tapa.send>
   
      #As the onDur Timer gets started then the pending BO will be scheduled 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.174
#
#       Desc:    For configuration 2, the functioning of drx-Retransmission 
#                timer when multiple HARQ is active and retx timer starts at 
#                special subframe. 
#                
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.174">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test the functioning of drx-Retransmission timer when single 
          HARQ is active and the data transmission on special subframe."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the drx-retx timer starts at SPL SF 1 of next SFN 
             (for the first Harq) 
          2) The HARQ retx should not be scheduled in SPL SF 6 (assuming the 
             total delay due to the HARQ processing and DL scheduling is 1+3 = 
             4TTI)
          3) Verify that HARQ retx is scheduled in DL SF 3
          4) Verify that the drx-retx timer 
          5) Similarly verify the retx timer start and expiry timings for i
             Second Harq. The start and expiry should happen independently of 
             the first Harq"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5"
           ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="2"
           drxRetxTmr="4"
           longDrxCycle="40"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="3"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="400"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" saveTo="5" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" saveTo="3" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" lcId="1" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="2" lcId="1" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #As the retx timers expired for both HARQ Processes, Hence this BO 
      #should be schduled after onDuration timer starts
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="17"/>
      </tapa.send>
      #As the onDur Timer gets started then the pending BO will be scheduled 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.175
#
#       Desc:    For configuration 1, that UE's Retx scheduling gets delayed
#                when retx timer configured to 1ms. 
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.175">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test the functioning of drx-Retransmission timer when retx 
          timer is equal to 1."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the drx-retx timer starts at SPL SF 1 of next SF. 
          2) Verify that HARQ retx is not scheduled in SPL SF 1 
          3) Verify that the drx-retx timer expires after SPL SF 1, ie, 
             at DL SF 4 the timer is not active  
          4) Verify that the Harq is scheduled only in next on duration"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="2"
           drxRetxTmr="1"
           longDrxCycle="20"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="10"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" saveTo="5" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" lcId="1" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.176
#
#       Desc:    For configuration 1, that UE's Retx scheduling gets delayed
#                when retx timer configured to 1ms. 
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.176">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test the functioning of drx-Retransmission timer when retx 
          timer is equal to 1."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the drx-retx timer starts at SPL SF 1 of next SF. 
          2) Verify that HARQ retx is not scheduled in SPL SF 1 
          3) Verify that the drx-retx timer expires after SPL SF 1, ie, 
             at DL SF 4 the timer is not active  
          4) Verify that the Harq is scheduled only in next on duration"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE"
           drxOnDurTmr="5"
           drxInactvTmr="2"
           drxRetxTmr="2"
           longDrxCycle="20"
           isShortDrxPrsnt="FALSE"
           shortDrxCycle="5"
           drxStartOffst="10"
           />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" saveTo="5" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" lcId="1" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.177">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test that the UE only gets scheduled during its active time for 
          tdd configuration 1"
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the UE is scheduled for DL transmission for DL subframe 0
          2) Verify the expiry of the On-duration timer. It should expire at DL 
             SF 6"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="4"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="40"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="0"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- The inactivity timer for 5pfs for UE 0 would have started.
      This means we can still send more downlink data -->

      # RLC--->MAC_SH (StaRsp). This is (4,8)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="30"/>
      </tapa.send>

      #Give 2 TTI's to bring it to (5,1) as we look at 
      #3 tti's ahead. (5,4) is a DL subframe.
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>(5,2)
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- bring it to (5,5) --> 
      <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #HARQ reception for 1st data
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  #HARQ reception for 2nd data
  <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>
  
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  # Send ACK as feedback for the received PDU.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>


</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.178">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "For configuration 1, test that the once the UE gets scheduled in its 
          active time, drxInactivity timer is started."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that the BO is scheduled immediately during the inactivity 
             timer period
          2) Verify the drxinactivity timer starting. It should start in the 
             subframe for which DL scheduling is done 
          3) Verify the expiry of the drx inactivity timer"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="4"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="40"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="0"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel at end of onDuration Timer
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="400"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         # Give enough TTIs so that we reach (4,7)..3 ahead
         # than (5,0) when the UE's onDuration starts
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         # Send  Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>(5,2)
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- bring it to (5,5) --> 
      <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #HARQ reception for 1st data
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  #HARQ reception for 2nd data
  <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
  </tapa.expect>
  
  <tapa.send>
     <tapa.tfu.tti.ind numTti="1"/>
  </tapa.send>

  # Send ACK as feedback for the received PDU.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>


</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.179">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "For configuration 1, test that once the UE gets scheduled in its 
          active time, after drx-inactiviy timer expires, the UE switches 
          to short cycle."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify the starting of the DRX Short cycle
          2) Verify the expiry of the DRX Short cycle"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="4"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="40"
        isShortDrxPrsnt="TRUE"
        shortDrxCycle="10"
        drxShortCycleTmr="5"
        drxStartOffst="0"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Send TTI indications to switch from short to Long DRX cycles
      <tapa.send>
         <tapa.tfu.tti.ind numTti="81"/>
      </tapa.send>

       # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel at end of onDuration Timer
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="100"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      #HARQ reception for 1st data
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for the received PDU.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      #Inactv Time expired by now, Hence UE should move short DRX cycles.
      #Onduration timer will be started for short cycle
      <tapa.send>
         # Send BO for the created logical channel at end of onDuration Timer
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.180">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "For configuration 1, test that the UE only gets scheduled during its 
          active time for UL."
      </tapa.desc>

      <tapa.longdesc>
         " Verify that the UE is scheduled in its active time for UL"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="4"
        drxInactvTmr="5"
        drxRetxTmr="16"
        longDrxCycle="40"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="0"
        prdBsrTmr="65535"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="1" lcType="5" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expset>
         <tapa.rgr.cfgCfm status="0"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="0" saveTo="3" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="5" ueId="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Send TTIs to start onduration timer which allows UL scheduling for 
      # received BSR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="25"/>
      </tapa.send>
      
      # Expect DCI format 0
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      <!-- bring it to (5,5) --> 
      <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.181">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "For configuration 1, test the starting and expiry of all the DRX timers."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify on-duration timer starting and expiry
          2) Verify inactivity timer starting and expiry"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="3"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        prdBsrTmr="65535"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expset>
         <tapa.rgr.cfgCfm status="0"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send StaRsp now, which should  not be scheduled immediately
      # as the inactivity timer is not running for UL
      # drx inactivity timer is not started for SR grant
      <tapa.send>
         # Send BO for the created logical channel at end of onDuration Timer
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #BO scheduled after onDuration timer start
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="0" saveTo="3" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="5" ueId="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      #HARQ reception for 1st data
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK as feedback for the received PDU.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # UL Data is scheduled once on-Duration  timer starts
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.182">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "For configuration 2, test the starting and expiry of all the DRX timers."
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify on-duration timer starting and expiry
          2) Verify inactivity timer starting and expiry"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send BO for Msg4 on RGU.
       <tapa.send>
          <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           # Added Np Validation - ccpu00109160
           <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>


   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        drxInactvTmr="6"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="5"
        prdBsrTmr="65535"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <!--- on RGR interface -->
      # Configure bi-directional DCCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expset>
         <tapa.rgr.cfgCfm status="0"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      # Bring it to (3,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send StaRsp now, which should be scheduled immediately
      # as the onDuration timer is running
      <tapa.send>
         # Send BO for the created logical channel at end of onDuration Timer
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="0" saveTo="3" ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK as feedback for the received PDU.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat lcgId="0" addShortBsr="TRUE" bsr="5" ueId="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      #Send TTIs to allow UL scheduling for received BSR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      
      # Expect DCI format 0
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                        ueId="0" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      <!-- bring it to (5,5) --> 
      <!-- bring it to (5,6). Inactivity timer DL expires in this SF -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.183">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "Verify CQI reception when DRX is enabled"
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that CQI reception request is sent correctly when CQI
             reporting occassion in ACTIVE time"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10" numTxAntPorts="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="5"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        drxStartOffst="16"
        prdCqiCfg.type="TRUE"
        cqiPCfgIdx="19"
        riEna="TRUE"
        txModeEnum="RGR_UE_TM_3"
        riCfgIdx="166"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="28"/>
      </tapa.send>

      #Expect CQI recp req
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.dlcqi.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      #Expect RI recp req
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.dlcqi.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect CQI recp req
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.dlcqi.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.184">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "Verify CQI reception when DRX is enabled"
      </tapa.desc>

      <tapa.longdesc>
         "1) Verify that CQI reception request is not sent when CQI
             reporting occassion in INACTIVE time"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10" raWinSize="10" numTxAntPorts="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
        isDrxEnabled="TRUE"
        drxOnDurTmr="4"
        longDrxCycle="20"
        isShortDrxPrsnt="FALSE"
        drxStartOffst="16"
        prdCqiCfg.type="TRUE"
        cqiPCfgIdx="19"
        riEna="TRUE"
        txModeEnum="RGR_UE_TM_3"
        riCfgIdx="166"
        />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      #CQI recp req will not be coming as CQI reporting time is in 
      #INACTIVE time
      <tapa.send>
         <tapa.tfu.tti.ind numTti="28"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      #Expect RI recp req as it is in ACTIVE TIME
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.dlcqi.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    11.185
#
#
#       Desc:    Validate that DwPTS scheduling is not allowed for Special SF 
#                configuration index 0 or 5 for Normal CP case. TDD CFG 1      
#                 
#       Notes:   None
#              
#       Module:  DwPTS Scheduling 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.185">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DwPts"/>

      <tapa.desc>
            Validate that DwPTS scheduling is not allowed for Special SF 
            configuration index 0 or 5 for Normal CP case. TDD CFG 1 
            Bundling Mode. 
      </tapa.desc>

      <tapa.longdesc>
        1) Validate that the data is not scheduled in special subframes
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgInitErr/>
      #<tapa.rg.dbgInitParm/>
      #<tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" spclSfCfgIdx="5"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"
         ulStartSfIdxLst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # [0, 3] 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # [0, 7] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # [1, 5]
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # [1,9]
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [2, 0] 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # [2, 2] 
      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # [2, 6] 
      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #[2, 7] 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #[3, 1]
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # [3 ,4]
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" />
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      ############################################
      #Till now RACH and basic UE context is setup
      
      # [3 ,5]
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # [3 ,6]
      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      
      #RLC----->MAC (DatReq)
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [3 ,7]
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Send bo again. This should not be scheduled in special sf 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # [4, 1] 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5" />
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [4, 2]
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # [4, 4] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # [4, 6] 
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # [4, 9] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
      
      # Send extra TTI to be sure that there is no unexpected
      # scheduling
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    11.186
#
#
#       Desc:    Validate the retransmission in special subframe 
#                 
#       Notes:   None
#              
#       Module:  DwPTS Scheduling 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.186">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DwPts"/>

      <tapa.desc>
            Validate that HARQ retransmission can happen in special subframe
            if initial scheduling is in special subframe. 
            Special subframe configuration is 7, Normal CP case. TDD CFG 1 
            Bundling Mode. 
      </tapa.desc>

      <tapa.longdesc>
        1) Validate that the retransmissions happen in special subframes 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgInitErr/>
      #<tapa.rg.dbgInitParm/>
      #<tapa.rg.dbgInitInfo/>

   #Initialize CELL
   <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"
         ulStartSfIdxLst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # [0, 3] 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # [0, 7] 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # [1, 5]
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # [1,9]
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [2, 0] 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # [2, 2] 
      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # [2, 3] 
      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # [2, 4] 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      #[3, 0]
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # [3 ,3]
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" />
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      ############################################
      #Till now RACH and basic UE context is setup
      
      # [3 ,7]
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # [3 ,8]
      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      
      #RLC----->MAC (DatReq)
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [3 ,9]
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
     
      # [4, 5] 
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 
    
      # [4, 8] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
 
      # [5, 2]
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"
             isRetx="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # [5, 6] 
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # [5, 9] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send 2 Dummy TTI to skip scheduling of the retx in
      # DL SF 4 and 5
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" isDummyTti="TRUE"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" isDummyTti="TRUE"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # [6, 4]
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"
             isRetx="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
     
      # [7, 0] 
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # [7, 3] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
 
      # Send extra TTI to be sure that there is no unexpected
      # scheduling
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>
   
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    11.187
#
#
#       Desc:    Validate the retransmission in special subframe for
#                TDD Configuration 2 
#                 
#       Notes:   None
#              
#       Module:  DwPTS Scheduling 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.187">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DwPts"/>

      <tapa.desc>
            Validate that HARQ retransmission can happen in special subframe
            if initial scheduling is in special subframe. 
            Special subframe configuration is 7, Normal CP case. TDD CFG 2 
            Bundling Mode. 
      </tapa.desc>

      <tapa.longdesc>
        1) Validate that the retransmissions happen in special subframes 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgInitErr/>
      #<tapa.rg.dbgInitParm/>
      #<tapa.rg.dbgInitInfo/>

   #Initialize CELL
   <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"
         ulStartSfIdxLst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # [0, 3] 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      # [0, 6] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # [1, 5]
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # [1,9]
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # [2, 2] 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [2, 3]
      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # [2, 4] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      #[3, 0]
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # [3 ,3]
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" />
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      ############################################
      #Till now RACH and basic UE context is setup
      
      # [3 ,7]
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="50"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # [3 ,8]
      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [3 ,9]
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
     
      # [4, 5] 
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 
    
      # [4, 8] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 
      # [5, 1]
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"
             isRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # [5, 5] 
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # [5, 8] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send 2 Dummy TTI to skip scheduling of the retx in
      # DL SF 4 and 5
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" isDummyTti="TRUE"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" isDummyTti="TRUE"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" isDummyTti="TRUE"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # [6, 4]
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"
            isRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
     
      # [7, 0] 
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # [7, 3] 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
 
      # Send extra TTI to be sure that there is no unexpected
      # scheduling
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>
   
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.188
#
#
#       Desc:    Validate that RAR is scheduled in special subframe 
#                 
#       Notes:   None
#              
#       Module:  DwPTS Scheduling 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.188">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DwPts"/>

      <tapa.desc>
            Validate that RAR is scheduled in Special SF, TDD CFG 1 
      </tapa.desc>

      <tapa.longdesc>
        1) Validate that the RAR is scheduled in special subframes
        2) Validate that the RB's allocated are more ro compensate 
           for less REs in DwPTS region
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgInitErr/>
      #<tapa.rg.dbgInitParm/>
      #<tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0" 
         ulStartSfIdxLst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # [0, 2] 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # [0, 4] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      # Send extra TTI to be sure that there is no unexpected
      # scheduling
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.189">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1,Validate reception of CRNTI MAC CE"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by CRNTI MAC CE for a connected UE."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1"  
            raWinSize="10" />

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect PDCCH for DCI format 0.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
            vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.190">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1,Validate UE reset procedure"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH followed"
         " by UE Re-estblishment "
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
            
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
                        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" maxUlHqTx="4"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
         
      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   
   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req vldtNp="FALSE" ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" isAck="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

      # Send re-configuration disabling SPS in downlink
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0"
           oldcrnti="61" newUeId="1" newcrnti="62"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      # Send UE ReConfiguration for the same UE created above for change in RNTI
       <tapa.send>
            <tapa.crg.cfgreq.recfg.ue cellId="3" oldUeId="0" newUeId="1"
              UeReCfgType="64"/>
       </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
       <tapa.expect>
            <tapa.crg.cfgcfm/>
       </tapa.expect>

     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.191">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 1,Validate procedure to trigger PDCCH order"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 1, the procedure initiates RACH preceded"
         " by generation of PDCCH order"
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" numRaPreamble="30" 
          sizeRaPreambleGrpA="25" preambleSetPres="1" preambleStart="30" 
          preambleSize="20" sfnEnum="RGAC_RGR_SFN_ANY" raWinSize="10"
          raOccSubFrameNum="1:6" raOccSize = "2" />

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" taTmrPres="TRUE" taTmr="40" 
         maxUlHqTx="4" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      # Send BO for the created logical channel on RGU to trigger a PO. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      # RA Req on PO Rap ID
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq numRapId="1" rapIds="30" tpcs="1" cqiPres="TRUE" cqis="4" raRnti="52"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="61"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.192
#
#       Desc:    Successful data path on BCCH-DLSCH and PCCH channels
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.192">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful data path on BCCH-DLSCH and PCCH channels" 
      </tapa.desc>

      <tapa.longdesc>
         make cell->nCce = 8. Set the pdcchCodeRate such that cmnChannel uses aggrLvl=8. Send StaRsp for
         BCCH with BO != Any valid TB size. In the same tti send a staRsp for PCCH with BO == Any valid
         TB size. Allocation for BCCH should fail, hence the only available CCE set of this subframe
         should be reused for PCCH allocation. 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" dlTotalBw="50" pdcchCodeRate="50"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for BCCH-DLSCH logical channel on RGU.
         # Chk the bo here! 
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="400" sfOffset="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for PCCH logical channel on RGU.
         # Chk the bo here! 
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="9"/>
      </tapa.send>

      <tapa.send>
         # Send 4 Ttis to get the transmission scheduled.
         # Send them individually so that if staInd comes in between, it will
         # fail. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.cstaind lcId="3" boSatisfied="TRUE" maxRb="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send PCCH data to MAC on RGU. 
         <tapa.rgu.cdatreq bcchIdx="1" lcId="3" lcType="2" use="2"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req expCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   # Expect Msg4 from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" lcId="3" bcchIdx="1" vldtPcch="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.193
#
#       Desc:   "To test the Prb Usage config on RGM" 
#
#       Notes:   None
#              
#       Module:  "RGM Module"
#
#       File:    rgac_tc16.xml
#
#
<tapa.testcase id="11.193" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of Prb Usage"
      </tapa.desc>

      <tapa.longdesc>

     </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgm.cfgprdrprt periodicity="10" cfgType="TRUE"/>
      </tapa.send>

              
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind />
      </tapa.expect>


      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind />
      </tapa.expect>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>        
                  
   
#
#
#       Test:    11.194
#
#       Desc:   "To test the Prb Usage stopi on RGM" 
#
#       Notes:   None
#              
#       Module:  "RGM Module"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.194" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario to stop Prb Usage"
      </tapa.desc>

      <tapa.longdesc>

     </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="TRUE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgm.cfgprdrprtind/>
      </tapa.expect>

      <tapa.send>
        <tapa.rgm.cfgprdrprt  periodicity="10" cfgType="FALSE" />
      </tapa.send>

      <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="100"/>
      </tapa.send>


      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>   

#
#
#       Test:    11.195
#
#       Desc:    Validation of successful RETX of only TB1 and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.195">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Validation of successful RETX of only TB1 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful RETX of only TB1 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="CEILLING_FIX"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxDlRetxBw="25" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5" prdBsrTmr="65535" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 
      # Send BO for the created logical channel for DAT1
      # ccpu00120365-MOD-modified the buffer so that second
      # TB is also utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"
            saveTo="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   # TB1 NACKED and TB2 ACKED
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE" 
        isTb2="TRUE" isAckLstTb2="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #ccpu00119023 MOD changed retx parameters for validation
   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="5" chkSdu="TRUE" lcId="3"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="FALSE" chkSduTb2="FALSE" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="FALSE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="1" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE" />
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    11.196
#
#       Desc:    Validation of successful RETX of only TB2 and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.196">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Validation of successful RETX of only TB2 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful RETX of only TB2 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="CEILLING_FIX"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


      # Send BO for the created logical channel for DAT1
      # ccpu00120365-MOD-modified buffer so that second TB
      # is also utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   # TB1 NACKED and TB2 ACKED
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE" 
        isTb2="TRUE" isAckLstTb2="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect Retransmission for TB2 of DAT1.
   # Verify that lcId=31 corresponding to padding is present in TB2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  retxUse="1" lcIdTb2="3" chkSduTb2="TRUE"
            transMode="TFU_UE_TM_3" isTb1="FALSE"  isTb2="TRUE" numTb2Lyrs="2" isTb2Retx="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="FALSE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="1" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isTb1="FALSE" isTb2="TRUE" 
             isAckLstTb2="TRUE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.197">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2, Validate scheduling MSG4 and CCCH SDU seperatly"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by MSG4 alone scheduling on expiry of CR-Gaurd timer and CCCH SDU tx-retx."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgInitAll/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send TTIs such that only MAC CR CE is scheduled
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send BO for CCCH SDU on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect CStatInd For CCCH SDU
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
   
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
       </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

<tapa.testcase id="11.198">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2, Validate MSG3 Failure case"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         "MSG3 Failure Handling."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgInitAll/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send TTIs such that only MAC CR CE is scheduled
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send TTIs such that no more Recp req is expected because max Msg3Tx reached
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.199
#
#       Desc:    To test UE Configuration at CRG/RGR
#                with DRX parameters(Includes both unsuccessful
#                and successful cases) for Config 2
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.199">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful UE config at CRG/RG with DRX params"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELl, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Send Invalid values of DRX params and
         expect negative confirm. Finally, send valid values and expect 
         positive confirm."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="LTEMAC_R9" />
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         />

   </tapa.cfg>

# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 0th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="5" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

    # Send UE config request at RGR with invalid drx params 
    # configure onduration tier in such a way that sometimes
    # crosses Long DRX cycle, based on TDD config mode
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" 
                 isDrxEnabled="TRUE"
           drxOnDurTmr="60"
           drxInactvTmr="3"
           drxRetxTmr="16"
           longDrxCycle="64"
           drxStartOffst="10"
          />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expset>

    # Send UE config request at RGR with invalid drx params 
    # configure onduration tier in such a way that sometimes
    # crosses short DRX cycle, based on TDD config mode
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="6"
           drxInactvTmr="3"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="5"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
          />
     </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect positive cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.200
#
#
#       Desc:    Validate that RAR is scheduled in special subframe 
#                 
#       Notes:   None
#              
#       Module:  DwPTS Scheduling 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.200">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DwPts"/>

      <tapa.desc>
            Validate that RAR is scheduled in Special SF, TDD CFG 2 
      </tapa.desc>

      <tapa.longdesc>
        1) Validate that the RAR is scheduled in special subframes
        2) Validate that the RB's allocated are more ro compensate 
           for less REs in DwPTS region
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgInitErr/>
      #<tapa.rg.dbgInitParm/>
      #<tapa.rg.dbgInitInfo/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0" 
         ulStartSfIdxLst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # [0, 2] 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # [0, 4] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      # Send extra TTI to be sure that there is no unexpected
      # scheduling
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.201
#
#       Desc:    To test SI Scheduling when numRetx=2
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.201">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling in Special Subframe for TDD CFG-1
          and numRetx = 2"
      </tapa.desc>

      <tapa.longdesc>
         1) Validate that SI scheduling happens in special subframe
         2) Validate that the Number of RB are more than normal SF         
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" spclSfCfgIdx="7" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="6" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         
     
      # SI-1 periodicity=8, send 80 TTIs so that the SI-1 is scheduled in dwPTS
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="80"/>
      </tapa.send>
      
      #[7, 9]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>          

#
#       Test:    11.202
#
#       Desc:    To test SI Scheduling when numRetx=2
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.202">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Scheduling in Special Subframe for TDD CFG-2
          and numRetx = 2"
      </tapa.desc>

      <tapa.longdesc>
         1) Validate that SI scheduling happens in special subframe
         2) Validate that the Number of RB are more than normal SF         
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="7" siWinSize="5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="6" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>         
     
      # SI-1 periodicity=8, send 80 TTIs so that the SI-1 is scheduled in dwPTS
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      #[0, 4]
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req  bcchIdx="6" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>    

#
#
#       Test:    11.203
#
#       Desc:    To validate Padding headers are correctly decoded and also
#       short and long sub headers are decoded propoerly.
#
#       Notes:   None
#              
#       Module:  DEMUX 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.203">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DEMUX"/>

      <tapa.desc>
         To validate Padding headers are correctly decoded and also
         short and long sub headers are decoded propoerly."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
   
      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" numRaPreamble="30" 
          sizeRaPreambleGrpA="25" preambleSetPres="1" preambleStart="30" 
          preambleSize="20" sfnEnum="RGAC_RGR_SFN_ANY" raWinSize="10"
          raOccSubFrameNum="1:6" raOccSize = "2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" maxUlHqTx="4" prdBsrTmr="65535" 
         ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueBr="4000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
          ulQci="8"/>
      </tapa.send>

      # Configure uplink DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="2" lcType="4" ulQci="8"/>
      </tapa.send>

      # Configure uplink DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="2" lcType="4" ulQci="8"/>
      </tapa.send>

      # Configure uplink DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="2" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure DL DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcType="4" instId="5"/>
      </tapa.send>

      # Configure all LCGs for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication for config application
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
       <tapa.send lc="TRUE">
          <tapa.tfu.sr.ind>
             <tapa.tfu.sr/>
          </tapa.tfu.sr.ind>
       </tapa.send>

      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3" addLongBsr="TRUE" bsr0="55"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1"/>
      </tapa.expect>

       # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
       # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 TTIs (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      # But because of long bsr, we will get pdcchReqs every TTI till the
      # bsr is satisfied
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        # Expect data reception request
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        # Expect data reception request
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        # Expect data reception request
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send data indication using TB size recieved in the grant
    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat lcIds="3:4" use="3" sduSzs="1024:200"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

      <tapa.expect>
         # Expect datInd to go to RLC
         <tapa.rgu.ddatind numLch="2" lchTb1Data="3,1:4,1"/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.204
#
#       Desc:    TDD Configuration 2, Validate UE Config on RGR/CRG interfaces
#
#       Notes:   None
#              
#       Module:  CONFIG 
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.204">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2, Validate UE Config on RGR/CRG interfaces"
      </tapa.desc>

      <tapa.longdesc>
         "For TDD configuration 2, the procedure initiates RACH followed"
         " by UE Config validation across different parameters on RGR/CRG "
         " interfaces."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgInitAll/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" 
         numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
         ulStartSfIdxLst="10:10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" maxUlHqTx="0"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" pushNCqiVal="17"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
 
<tapa.testcase id="11.205">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configuration 1 handover scenario with fault dedicated preamble reception." 
      </tapa.desc>

      <tapa.longdesc>
         "Send RACH request with a genuine dedicated preamble and one false dedicated preamble
          and expect RA Response for the genuine praemble "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched.tddraocc ulDlCfgIdx="1" 
            numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            numRsc="2" freqIdxLst="0:0" sfnLst="2:2" halfFrmLst="0:1"
            ulStartSfIdxLst="0:0" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

        # Send UE config request
         <tapa.send>
            <tapa.crg.cfgreq.cfg.ue cellId="3" isHoUe="TRUE"/>
         </tapa.send>

        # Expect success in cfg cfm
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Send UE config request with dedicated preamble
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" 
                           dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Configure bi-directional DTCH for default UE
         <tapa.send>
            <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
         </tapa.send>

         # Expect configuration confirm after the TTI
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>
   
         # Configure DL LC on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5"/>
         </tapa.send>

         # Configure UL LCG on RGR
         <tapa.send>
            <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
         </tapa.send>

         # Expect configuration confirm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         # Expect configuration confirm
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5"/>
         </tapa.expect>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="3"/>
         </tapa.send>

         # Send raReq with the preconfigured rapId
         <tapa.send>
            <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
               <tapa.tfu.rareq  numRapId="2" rapIds="50:51" raRnti="3"
                     tpcs="1" cqiPres="TRUE" cqis="4"/>
            </tapa.tfu.rareq.ind>
         </tapa.send>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="5"/>
         </tapa.send>

         # Expect RaResp for the rapId sent in RaReq
         <tapa.expset>
            <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
               <tapa.tfu.pdcch.cntrl.req/>
            </tapa.tfu.cntrl.req>
            <tapa.tfu.dat.req datReqs="1">
               <tapa.tfu.rarsp.req poHoUeId="0" expectAll="FALSE"/>
            </tapa.tfu.dat.req>
         </tapa.expset>

         <tapa.send>
            <tapa.tfu.tti.ind numTti="8"/>
         </tapa.send>

         # Expect a reception request for this UE.
         <tapa.expect>
            <tapa.tfu.recp.req expRecpReq="1">
               <tapa.tfu.pusch.recp.req ueId="0" use="0" saveTo="2"/>
            </tapa.tfu.recp.req>   
         </tapa.expect>
        
         # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
         <tapa.send>
            <tapa.tfu.tti.ind numTti="4"/>
         </tapa.send>
      
         #Send CRC for Msg
         <tapa.send>
            <tapa.tfu.crc.ind>
               <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            </tapa.tfu.crc.ind>
         </tapa.send>
     
         <tapa.send>
            <tapa.tfu.tti.ind numTti="1"/>
         </tapa.send>
         
         # Expect HARQ ACK in PHICH
         <tapa.expect>
            <tapa.tfu.cntrl.req expCntrlReq="1">
               <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            </tapa.tfu.cntrl.req>
         </tapa.expect>

         # Send Data Indication using TB size recieved in the grant
         <tapa.send>
            <tapa.tfu.dat.ind datInds="1">
                <tapa.tfu.dat use="2" lcId="1"/>
            </tapa.tfu.dat.ind>
         </tapa.send>

         # Expect Data Indication at RLC
         <tapa.expect>
            <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
         </tapa.expect>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.206
#
#       Desc:    Validation of successful 2 TX TB spatial multiplexing and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.206">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Validation of successful 2 TX TB spatial multiplexing and 
          subsequent Harq Feedback processing in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful 2 TX TB spatial multiplexing and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="CEILLING_FIX"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2"
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" 
        ueCatEnum="CM_LTE_UE_CAT_5" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
   # ccpu00120365-ADD-add second LC data for second TB
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" numLchTb2="1" lchTb2Data="3"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
   # ccpu00120365-MOD-modified buffer so that second TB is 
   # utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:FALSE" 
        isTb2="TRUE" isAckLstTb2="TRUE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
 
   # Verify No Retransmissions 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.207
#
#       Desc:    Validation of successful 2 RETX TB spatial multiplexing and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.207">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2, two TB Retransmission scenario in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful 2 RETX TB spatial multiplexing and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="CEILLING_FIX"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" 
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" 
        ueCatEnum="CM_LTE_UE_CAT_5" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


      # Send BO for the created logical channel for DAT1
      # ccpu00120365:-ADD-modified buffer so that second TB
      # is utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
   # ccpu00120365-MOD-modified buffer so that second TB
   # is utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="97" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE" 
        isTb2="TRUE" isAckLstTb2="FALSE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"
        isTb2="TRUE" isAckLstTb2="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.208
#
#       Desc:    To check configuration for CQI Reporting of DL Power
#                   management.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.208">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To check configuration for PUSH N CQI Reporting of DL Power management"
      </tapa.desc>

      <tapa.longdesc>
      " 1. Configure UE with CQI reporting enabled with N = 5
        2. Configure PCQI with some periodicity
        3. Expect Recpetion request at TFU interface and every occasion of CQI
        4. Expect StaInd at RGR interface after 5 CQIs"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
        <tapa.flag id="TFU_UPGRADE"/>
        <tapa.flag id="RGR_CQI_REPT"/>
        <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="2"/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq (0,7)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp (1,6)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3 (2,0)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req. (2,1)
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3 (2,2)
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4 (2,3)
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY. (2,4)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. (3,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4. (3,4)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" pushNCqiVal="5" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.209
#
#       Desc:    To check configuration for CQI Reporting of DL Power
#                   management.
#
#       Notes:   None
#
#       Module:  Configuration
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.209">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To check configuration for PUSH N CQI Reporting of DL Power management"
      </tapa.desc>

      <tapa.longdesc>
      " 1. Configure UE with CQI reporting enabled with N = 5
        2. Configure PCQI with some periodicity
        3. Expect Recpetion request at TFU interface and every occasion of CQI
        4. Expect StaInd at RGR interface after 5 CQIs"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="RGR_CQI_REPT"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="1" raWinSize="10"/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
      <tapa.rg.rachtdd1/>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" pushNCqiVal="5" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.210
#
#       Desc:    To check re-configuration for CQI Reporting of DL Power
#                   management.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.210">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To check re-configuration for PUSH N CQI Reporting of DL Power management"
      </tapa.desc>

      <tapa.longdesc>
      " 1. Configure UE with CQI reporting enabled with N = 5
        2. Configure PCQI with some periodicity
        3. Expect Recpetion request at TFU interface and every occasion of CQI
        4. After 4 CQI indication have been send, reconfigure N = 3
        5. Expect StaInd at RGR interface for 3 CQIs
        6. After next Send 2 CQI indications, expect StaInd at RGR for 3 CQIs
        7. Send 2 CQI indications
        8. Re-configure for N = 5
        9. Expect StaInd after send 3 CQI indications
        10. Send 3 CQI indications
        11. Reconfigure with N=0 (Disable)
        12. Send 4 CQI Ind, no StaInd shold be recieved
        13. Send  re-configuration with N=2
        14. Send 2 CQI indications
        15. Receive StaInd at RGR for 2 CQI indications "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="RGR_CQI_REPT"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="1" raWinSize="10"/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
      <tapa.rg.rachtdd1/>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" pushNCqiVal="5" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind TTI-Identity="1" numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="3" numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="6" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="1" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="8" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="11" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="13" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="16" numTti="3"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="3" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="18" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="21" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="3"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="22" numTti="1"/>
      </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expset>
         <tapa.rgr.staind ueId="0" numRept="3"/>
       <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expset>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="23" numTti="1"/>
      </tapa.send>
    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="26" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="5" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="28" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="31" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="33" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="36" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="7" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="3"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="38" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="41" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="43" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="46" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="5"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="47" numTti="1"/>
      </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="48" numTti="1"/>
      </tapa.send>
    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="51" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="53" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="56" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="58" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="61" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

###### Now send 5 CQI indicatiosn and check StaInd is received #####

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="63" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="66" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="68" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="71" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="14" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="73" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="76" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="15" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="78" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="81" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="1" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="83" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="86" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

############ Internal data is cleared by SCH, now send few more CQI indications
###########  before disabling the feature 
      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="88" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="91" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="3" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="93" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="96" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="98" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="101" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="5" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="0"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="102" numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="103" numTti="1"/>
      </tapa.send>

### Now send 5 + 1 cqi indications and check StaInd is not sent ###########

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="106" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="108" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="111" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="7" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="113" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="116" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="118" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="121" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="123" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="126" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="128" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="131" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="2"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="132" numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="133" numTti="1"/>
      </tapa.send>


    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="136" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="138" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="141" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="2"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.211
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 1-2 
#                   (Multiple PMI) when Tx Antennas =2
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.211">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 1-2 (Multiple PMI)
         when Tx Antennas =2"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" numTxAntPorts ="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_4" codeBookResPrsnt="TRUE" 
             aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" aprdModeEnumPres="TRUE"
             prdBsrTmr="65535" />
      </tapa.send>
     
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD12"
           aprdModeEnumPres="TRUE"  UeReCfgType="2" codeBookResPrsnt="TRUE"
           pmiBitMap0="65535" pmiBitMap1="65535"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # DATA --->1 
      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # DATA --->1 at (3,7) for DL SF (3,9)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" 
               isFormat1a="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="9" chkSdu="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # DATA --->1: expect Recp Req at (4,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="TRUE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.212
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 3-1 
#                   when Tx Antennas = 2
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.212">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 3-1 
         when Tx Antennas =2"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" 
         aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="TRUE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255"  />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.213
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 2-2 
#                   when Tx Antennas = 2
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.213">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 2-2 
         when Tx Antennas =2"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="1" raWinSize="10" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_4"  
             aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" aprdModeEnumPres="TRUE"
             prdBsrTmr="65535" />
      </tapa.send>
     
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD22"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="TRUE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255" byte2="255" byte3="255"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#       Test:    11.214
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 1-1 for 2 Antenna Ports. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.214">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 1-1(2 Tx Antenna Ports)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Set a Raw CQI and verify whether the Decoding is proper."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="2"/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue />
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4"
          prdModeEnum="RGAC_RGR_PRD_CQI_MOD11" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
          cqiRepType="1"  riEna = "TRUE"  riCfgIdx = "161" ueCatEnum ="CM_LTE_UE_CAT_2" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="50"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler, this would be a RI RR
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="100" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.215
#
#       Desc:    To test PCQI periodicity with PCQI configured 
#                   with a certain Periodicity for SubBand CQI. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="11.215">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI subband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="1" raWinSize="10"/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Do RACH init
      <tapa.rg.rachtdd1/>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  UeReCfgType="4096" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 5 (26/5) 
     #We will receive a WB CQI since, periodNum%H is 0 (5%5).
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 10 (51/5) 
    #We will receive a WB CQI since, periodNum%H is equal to 0 (10%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.216
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 2-1 
#             for 2 Tx Antenna Ports
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.216">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 2-1(WideBand and SubBand Occasions)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI SubBand mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Check Raw CQI Decoding  for one WideBand and Other SubBand 
         occasions when there are 2 Tx Antenna Ports."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="2"/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4" codeBookResPrsnt="TRUE"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  UeReCfgType="4096" riEna = "TRUE"  riCfgIdx = "161" ueCatEnum ="CM_LTE_UE_CAT_2"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 5 (26/5) 
     #We will receive a WB CQI since, periodNum%H is 0 (5%5).
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 10 (51/5) 
    #We are intended to receive a WB CQI since, periodNum%H is equal to 0 (10%5)
    #since RI RR collides with Wide CQI, RI RR will be sent
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Now that Rank has changed to 2, the Bitwidth changes for CQI Params

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,4) and Reception Request Info time is (5,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 11 (56/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (11%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,9) and Reception Request Info time is (6,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 12 (61/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (12%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,4) and Reception Request Info time is (6,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 13 (66/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (13%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,9) and Reception Request Info time is (7,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 14 (71/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (14%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (7,4) and Reception Request Info time is (7,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 15 (76/5) 
     #We will receive a WB CQI since, periodNum%H is equal to 0 (15%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.217
#
#       Desc:    Handling of SR and RI reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.217">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SR and RI Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. The Configuration should be such that there should
         be a collision of SR, PCQI RR and RI RR" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="1" raWinSize="10"/>

      # UE configuration
   #   <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Do RACH init
      <tapa.rg.rachtdd1/>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3" 
       srCfgPres ="TRUE" srCfgIdx ="7"  />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a PCQI and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" 
          sANCQI="TRUE" riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        #Expect a Config Confirm for Confguration 
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Increment the Num of TTIs so as to set a collision
         # between two different Uplink entities 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # SR and RI, PCQI configured earlier will expect a RR.
     # Expecting a SR and RI RR only since PCQI will be dropped. 
      <tapa.expset>
         <tapa.tfu.recp.req >
            <tapa.tfu.sr.recp.req/>
            <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.218
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 2-1 
#             for 4 Tx Antenna Ports
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.218">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 2-1(WideBand and SubBand Occasions)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI SubBand mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Check Raw CQI Decoding  for one WideBand and Other SubBand 
         occasions when there are 4 Tx Antenna Ports."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="4" ulDlCfgIdx="2"/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  UeReCfgType="4096" riEna = "TRUE"  riCfgIdx = "161" ueCatEnum ="CM_LTE_UE_CAT_2"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 5 (26/5) 
     #We will receive a WB CQI since, periodNum%H is 0 (5%5).
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 10 (51/5) 
    #We are intended to receive a WB CQI since, periodNum%H is equal to 0 (10%5)
    #since RI RR collides with Wide CQI, RI RR will be sent
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Now that Rank has changed to 2, the Bitwidth changes for CQI Params

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,4) and Reception Request Info time is (5,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 11 (56/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (11%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,9) and Reception Request Info time is (6,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 12 (61/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (12%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,4) and Reception Request Info time is (6,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 13 (66/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (13%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,9) and Reception Request Info time is (7,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 14 (71/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (14%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (7,4) and Reception Request Info time is (7,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 15 (76/5) 
     #We will receive a WB CQI since, periodNum%H is equal to 0 (15%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1 ="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.219
#
#       Desc:    Handling of HARQ, SRS and SR Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.219">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, SRS and SR Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and SR RR on the same TTI. 
         HARQ, SRS and SR RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

    <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="1" raWinSize="10" srsSubFrameCfg="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Do RACH init
      <tapa.rg.rachtdd1/>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="8"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SRS Cfg
      # at RGR. At this point we are in (2,7) and a SRS Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="18" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
     # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="9" 
          sANCQI="TRUE" riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
              chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.srs.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>  
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      # ccpu00116923 - ADD - New Reception Request types for CQI and SRS with SR 
      #Send SRS Indication 
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#
#       Test:    11.220
#
#       Desc:    To test SRS periodicity with SRS configured 
#                   with a certain Periodicity. 
#
#       Notes:   None
#              
#       Module:  Reception Request for SRS 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.220">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Reception Request for for SRS only"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a SRS with a certain 
         Periodicity and expect a SRS reception request followed by a SRS Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="2"/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,3)
     <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="17" 
          sANSrs="TRUE"  />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

     # At start of this step, we are at (3,1) and Reception Request Info time is (3,3)
     # Expect SRS reception request from Scheduler
      <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

     # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

    # At start of this step, we are at (4,1) and Reception Request Info time is (4,3)
     # Expect DL CQI reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.221
#
#       Desc:    Handling of SR and SRS reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.221">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SR and SRS Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. The Configuration should be such that there should
         be a collision of SR, PCQI RR and RI RR" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="1" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Do RACH init
      <tapa.rg.rachtdd1/>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a SRS and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SRS Cfg
      # at RGR. At this point we are in (2,7) and a SRS Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="22" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        #Expect a Config Confirm for Confguration 
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Increment the Num of TTIs so as to set a collision
         # between two different Uplink entities 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # SR and SRS configured earlier will expect a RR. 
     # Expecting a SR and SRS RR. 
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.srs.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.222
#
#       Desc:   Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.222">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH." 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI and RI, CQI and SRS with a certain 
         Periodicity.Send DLSCH and do not send a Feedback so as to trigger a Aperiodic CQI
         Request through DCI-0. Configure a DLSCH and a ULSCH such that the Periodicity of 
         RI, CQI, SRS should collide with with ULSCH for a UE and collide with the Aperiodic CQI
         and check for Data Reception Request  for Data and HARQ, ACQI and SRS. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" ulDlCfgIdx="2" maxDlHqTx="5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,3)
     <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3" 
             aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<!--
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # DATA --->1  
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="4" lcType="4" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # DATA --->1 
      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq lchTb1Data="4" lcType="5"/>
      </tapa.send>

      # DATA --->2  
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="4" lcType="4" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # DATA --->2 
      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq lchTb1Data="2" lcType="5"/>
      </tapa.send>  

      # DATA --->1 at (3,7) for DL SF (3,9)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # DATA --->2 at (3,8) for DL SF (4,0)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # DATA --->1: expect Recp Req at (4,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      #1 DATA --->1: Send Hq Ind at (4,4) for UL Subframe (4,3)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      # DATA --->2: expect Recp Req at (4,5)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # DATA --->1 Retx at (4,7) for DL SF (4,9)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"  validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>   

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      #2 DATA --->2: Send Hq Ind at (4,8) for UL Subframe (4,7)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # DATA --->1(Retx): expect Recp Req at (5,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # DATA --->2 Retx at (5,2) for DL SF (5,4)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"  validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      #3 DATA --->1(Retx): Send Hq Ind at (5,4) for UL Subframe (5,3)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      # DATA --->2(Retx): expect Recp Req at (5,6)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # DATA --->1 Retx at (5,7) for DL SF (5,9)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"  validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>    

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      #4 DATA --->2(Retx): Send Hq Ind at (5,9) for UL Subframe (5,8)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      # DATA --->1(Retx): expect Recp Req at (6,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # DATA --->2 Retx at (6,2) for DL SF (6,4)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      #5 DATA --->1(Retx): Send Hq Ind at (6,4) for UL Subframe (6,3)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      # DATA --->2(Retx): expect Recp Req at (6,6)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # DATA --->1 Retx at (6,7) for DL SF (6,9)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"  validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      #6 DATA --->2(Retx): Send Hq Ind at (6,9) for UL Subframe (6,8)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      # DATA --->1(Retx): expect Recp Req at (7,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # DATA --->2 Retx at (7,2) for DL SF (7,4)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"  validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      #7 DATA --->1(Retx): Send Hq Ind at (7,4) for UL Subframe (7,3)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      # DATA --->1(Retx): expect Recp Req at (7,6)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # DATA --->2 Retx at (7,7) for DL SF (7,9)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"  validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #8 DATA --->1(Retx): Send Hq Ind at (7,9) for UL Subframe (7,8)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>   

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>

      # DATA --->2(Retx): expect Recp Req at (8,1)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # DATA --->2 Retx at (8,2) for DL SF (8,4)
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"  validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="9" lcId="4" chkSdu="TRUE" 
               isRetx="TRUE" retxUse="5" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #9 DATA --->1(Retx): Send Hq Ind at (8,4) for UL Subframe (8,3)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="TRUE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>    

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>  

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq  isAckLst="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>    

      # Send UE config request at RGR 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="18" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      # Hence, the SRS will arrive on Reception Request Info time (3,1)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="8192"
            srsCfgPres ="TRUE" srsCfgIdx ="27" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                vldtGrant="TRUE" vldtTx="TRUE" cqiReq="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>   

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request, HARQ for DL Data and ACQI
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE"  nSrs="1" saveTo="2"/>
            <tapa.tfu.dlcqi.recp.req />
            <tapa.tfu.srs.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs/>
         </tapa.tfu.srs.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.223
#
#       Desc:   "Verify that GBR DTCHs are capped off at
#                respective configured MBR values."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.223">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that GBR DTCHs are capped off at
          respective configured MBR values."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that GBR DTCHs are capped off at
          respective configured MBR values."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched dlTotalBw="35" ulDlCfgIdx="1" maxDlBwPerUe="35" dlSchdType="1" maxUlBwPerUe="20" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
 
      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            dlGbr="400" dlMbr="800" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send BO higher than AMBR
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="3000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect staInd from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Allocation for more data
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # No more allocation as MBR limit is reached
      </tapa.expset>

      <tapa.send>
         # Send TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Now send a large number of TTIs to (just) exhaust the refresh cycle
      <tapa.send>
         <tapa.tfu.tti.ind numTti="273"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.224
#
#       Desc:    "Verify that UE is scheduled upto its configured bit rate,
#                 which is refreshed after refresh time.
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.224">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that UE is scheduled upto its configured bit rate,
          which is refreshed after refresh time.
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE is scheduled upto its configured bit rate,
          which is refreshed after refresh time.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulSchdType="1" ulDlCfgIdx="1" raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
 
      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
               ueBr="620" ueCatEnum="CM_LTE_UE_CAT_4"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="1" bsr="30" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Separated TTI processing for DL and UL.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="262"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # End TC here

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.225
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. And in
#       the case where Feedback isnt received at action is taken on the final
#       feedback in the case of a NACK retransmission is scheduled.
#       This is for sched type=1
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.225">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs (assume NACK in case
       of tie)."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" dlSchdType="1" ulSchdType="1" 
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
 
      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request for UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"
               ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"
               isAckNackEnabled="TRUE" pucchAckNackRep="1001"
               ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="1" saveTo="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      # ccpu00119087 MOD changes in retransmsission when there is a DTX
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 
      
      <tapa.expset>
          # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate="TRUE" use="1" saveTo="3"
               vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate="TRUE" use="3" isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.226
#
#       Desc:   "Verify that for the case of two UEs with
#                DTCHs of comparable properties, the DTCH for
#                higher CQI UE starts getting satisfied first.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.226">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that for the case of two UEs with
          DTCHs of comparable properties, the DTCH for
          higher CQI UE starts getting satisfied first."
      </tapa.desc>

      <tapa.longdesc>
         "For the two GBR DTCHs of two UEs, configure them such that LC of UE
         1 is of priority slightly higher (priority value one lower) than LC
         of UE 2. Other properties shall remain same.
         Assign CQI = 7 for UE 1 and CQI = 14 for UE 2. Assign large BOs to
         both channels.
         Verify that LC of UE 2 is allocated first (despite it having a lower
         service priority)."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="25" maxDlBwPerUe="25" dlSchdType="1" 
          ulDlCfgIdx="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            lcType="4" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="2"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Just let some TTIs pass by
      <tapa.send>
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="800"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="800"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="15"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC. Second UE (with higher CQI) shall
      # be satisfied first, and then the other one (though
      # this is not known (checked for) here yet.
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # The first UE with lower CQI was not completely satisfied
       # initially, which means that the remainder of it would
       # have been scheduled now.
       # Also not the absence of UE 2 being scheduled, indicating
       # that it indeed must have been totally satisfied the
       # first time around.
      #<tapa.expset>
         #<tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      #</tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.227
#
#       Desc:   "To verify that contention resolution is accorded higher
#                priority over signaling."
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.227">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify that contention resolution is accorded higher
         priority over signaling."
         "Successful scenario of C-RNTI based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "To verify that contention resolution is accorded higher
         priority over signaling."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulSchdType="1" ulDlCfgIdx="2"/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="3"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      # Configure a DTCH for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3"
            lcType="4" ulQci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
        <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            # This tmp crnti would get updated in ueId="2", since ueId="1" is
            # the last one being used.
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect confirmation for Logical channel configuration
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.

      # However, meanwhile let us start SR + allocation cycle for the
      # other UE.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.msg3.recp.req ueId="2" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat sduSize="20" crnti="0" ueId="2" addCrnti="TRUE"/>
            <tapa.tfu.dat use="3" ueId="1" addShortBsr="TRUE"
               lcgId="0" bsr="35" lcId="1"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expset>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1"/>
      </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Remaining allocation for second UE
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>      

      # Need not finished the flow. End TC here.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.228
#
#       Desc:    To test successful CRG and RGR Logical Channel Re Configuration
#                            for SchedType=1
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc11.xml
#
<tapa.testcase id="11.228">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG Logical Channel Re Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Send CELL/UE configuration request to LTEMAC/Scheduler from Dummy RRC and
         from RRM respectively and expect a positive configuration confirmation 
         from LTE MAC and Scheduler respectively and then send a configuration 
         for  Dedicated Logical Channels from Dummy RRC and RRM to LTEMAC and
         Scheduler respectively and expect a configuration confirm"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      
      #Disable All Debugs
      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="1" ulSchdType="1" ulDlCfgIdx="1"
         raWinSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>
     
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Configure a dedicated logical channel for the created UE at CRG
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Configure a dedicated logical channel for the created UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="0" lcId="9" lcType="5" dir="2" dlQci="1"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send LC ReConfiguration for the same LC created above at CRG 
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcId="9" dir="1"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
     
      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcId="9"
             dir="2"/>
      </tapa.send>
      # Send LCG ReConfiguration for the same LCG created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lcg instId="5" lcgId="0"/>
       </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure uplink DTCH for default UE at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Configure uplink DTCH for default UE at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="2" lcType="4" />
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for default UE at RGR 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="3" lcgId="0" dir="3" 
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="4" lcgId="1" dir="2" 
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="5" lcgId="2" dir="2" 
            lcType="4"/>
      </tapa.send>
      # Configure uplink DTCH for default UE at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" lcId="6" lcgId="3" dir="2" 
            lcType="4"/>
      </tapa.send>
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect configuration confirm after the TTI from Scheduler
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send LC ReConfiguration for the same LC created above at CRG 
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="2" lcId="3"
             dir="3"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="2"
            lcId="3" dir="3"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send LC ReConfiguration for the same LC created above at CRG 
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcgId="1" lcId="4"
             dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcgId="1"
            lcId="4" dir="2"/>
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.229
#
#       Desc:    To test Contention Free RA procedure is not impacted
#                by DRX
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.229">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Contention Free RA with DRX." 
      </tapa.desc>

      <tapa.longdesc>
         "To test Contention Free RA is not impacted by the state of 
          UE as dicated by its DRX period.
          Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" numRaPreamble="30" 
          sizeRaPreambleGrpA="25" preambleSetPres="1" preambleStart="30" 
          preambleSize="20" sfnEnum="RGAC_RGR_SFN_ANY" raWinSize="10"
          raOccSubFrameNum="1:6" raOccSize = "2" />

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" taTmrPres="TRUE" taTmr="40" 
         maxUlHqTx="4" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"
         isDrxEnabled="TRUE"
         drxOnDurTmr="5"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="10"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="2"
      />

   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      # Send BO for the created logical channel on RGU to trigger a PO. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      # RA Req on PO Rap ID
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq numRapId="1" rapIds="30" tpcs="1" cqiPres="TRUE" cqis="4" raRnti="52"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="61"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="0" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req  use="1" ueId="0" numSdu="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.230
#
#       Desc:    Validation of UE category change reconfig
#
#       Notes:   None
#              
#       Module:  Configuration
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.230">
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
        "Validation of UE category change reconfig"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"
          raOccSubFrameNum="1:6" raOccSize = "2" numTxAntPorts="4"/>

   </tapa.cfg>

 # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   # Do RACH init
   <tapa.rg.rachtdd1/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"
        ueCatEnum="CM_LTE_UE_CAT_1"
      />

   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.dlcqi.ind>
         <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
      </tapa.tfu.dlcqi.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue  cellId="3" UeReCfgType="1"  tm="CRG_UE_TM_4"
            isTMRecfgPres="TRUE"/>
      </tapa.send>

      #Expect ue recfg cfm  from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at RGR
      # UeReCfgType = (UeTxModeRecfg + UeCatRecfg)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  cellId="3" UeReCfgType="2049"
            txModeEnum="RGR_UE_TM_4" ueCatRecfgPres="TRUE" ueCatEnum="CM_LTE_UE_CAT_5" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.231
#
#       Desc:    Test case to test in the MIMO case-2UE attached,retransmiited 
#                UE is scheduled and the remaining RB is lesser than RBGSize,
#                second UE should not get allocate in that TTI.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.231">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "In case of MIMO if available RB is lesser than RBGSize,UE should not 
          get scheduled in that TTI."
      </tapa.desc>

      <tapa.longdesc>
         " This is  the test case that in case of MIMO 2UE attached if the 
           retransmitted UE is get scheduled in that TTI and the remaining 
           available bandwith is lesser than RBGSize than the second UE should 
           get scheduled in the next TTI"
      </tapa.longdesc>

   </tapa.doc>

# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTEMAC_RGU_PAD"/>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="50" maxDlBwPerUe="50" 
         numTxAntPorts="4"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" 
        ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" 
        txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5" />
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 
      <tapa.send>
         # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcgId="0"
            dir="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a DTCH at MAC (not scheduler) for UE 1
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" dir="1" lcType="5"
           dlQci="5" instId="5"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Get all the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="300" ueId="0"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" 
               riIdx="4" cqiIdx="15" ueId="1"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" TTI="TEST1"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      <tapa.expset>
          # Expect retransmission from MAC to PHY for ueID=0.
        <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9" ueId="0"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE" ueId="0"/>
        </tapa.tfu.cntrl.req>
        <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" ueId="1"/>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      <tapa.expset>
          # Expect transmission from MAC to PHY for ueID=1.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.232
#
#       Desc:    To test SI Parameters Configuration
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.232">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test SI Parameters Configuration in SI Cfg Req and Cell Cfg Req. 
          Negative Scenearios test case."
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Verify SI Configuration request for invalid CFG Type 
      <tapa.send>
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_INV" />
      </tapa.send>

      # Expect SI Cfg Cfm from MAC 
      <tapa.expect>
         <tapa.rgr.sicfgcfm status="0" instId="5"/>
      </tapa.expect>

      # Verify Cell Configuration request for invalid ReTxCnt 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" siWinSize="4"
          siRetxCnt="5" />
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      # Verify SI Configuration request for invalid SI Id
      <tapa.send>
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="5" buffSz="47"/>
      </tapa.send>

      <tapa.expect>
      # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm status="15" instId="5"/>
      </tapa.expect>

      # Verify Cell Configuration request for invalid SI1 peridocity
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" siWinSize="4"
          siRetxCnt="3" si1Prd="50"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Verify SI-Reconfiguration scenario with a change in numSi value
      #Configure a valid SIs
      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (0,0),giving TTI upto (0,4)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" numSi="3"
           recfgType="2048" />
      </tapa.send>

       <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
     <tapa.rgr.cfgCfm instId="5" />
   </tapa.expect>

      #Re-Configure a valid SIs,with numSi set to 3
      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.233
#
#       Desc:    To test Activation Time in RGR Cell ReConfiguration
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.233">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Activation Time in RGR Cell ReConfiguration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CRG CELL, UE configurations successfuly and then send
         reconfiguration request to same CELL with valid Activation time and 
         expect configuration confirm"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"/>

      <tapa.rg.UeInitTdd1/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send CRG Cell Re Configuration with valid Activation Time
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5"  cellId="3" actvTimePres="TRUE"
            actvTimesfn="4" actvTimesf="9" dlTotalBw="50" ulTotalBw="50"/>
      </tapa.send>
      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="30"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.234
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority  are satisfied first considering 
#                their PDB time in the stack. If both have same 
#                OPAT delay time then higher PfsPrio should be 
#                scheduled first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.234">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
          higher priority are satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
          higher priority are satisfied first"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="100" maxDlBwPerUe="100"
           maxDlUeNewTxPerTti="1" dlSchdType="1"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
             lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
 # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="350"
            oldestSduDelay="10" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="350"
            oldestSduDelay="10" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST0"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expect>

      # Expect staInds from MAC
      # Send data corresponding to staInds
      <tapa.send>
           <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

 	    <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expect>

	    <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.235
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority  are satisfied first considering 
#                their PDB time in the stack. If Svc#1 has higher priority
#                but lower OPAT delay then Svc#2 with lower priority but 
#                higher OPAT delay time thus higher PfsPrio should be 
#                scheduled first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.235">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
          higher priority are satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
          higher priority are satisfied first"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="100" maxDlBwPerUe="100"
           maxDlUeNewTxPerTti="1" dlSchdType="1"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="7"
             lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
 # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="350"
            oldestSduDelay="1" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="350"
           oldestSduDelay="251" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST0"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expect>

      # Expect staInds from MAC
      # Send data corresponding to staInds
      <tapa.send>
           <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

 	    <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expect>

	    <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    11.236
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority (lower priority value) are
#                satisfied first and if the BO is not satisfied in
#                one go then the PDB pivot for the same LC is moved
#                to the next level thus treating the higher priority
#                LC with the corresponding PDB weight's effective priority"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.236">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  dlTotalBw="100" maxDlBwPerUe="100" dlSchdType="1"/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
 # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
 # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="10000"
            oldestSduDelay="25" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="10000"
            oldestSduDelay="69" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST0"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
      # Send data corresponding to staInds
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>
     
      # Expect staInds from MAC
      # Send data corresponding to staInds
      <tapa.send>
           <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

 	    <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

	    <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel which did not have BO satisifed
         # completely last time.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
	
 	    <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

	    <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel which did not have BO satisifed
         # completely last time.
         #<tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         #<tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>




#
#
#       Test:    11.237

#       Desc:    To Validation of UE Re Configuration for Hybrid CSG

#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="11.237" >

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To Validation of UE Re Configuration for Hybrid CSG mode"
      </tapa.desc>

      <tapa.longdesc>
         "Configure Cell in Hybrid mode, and send CSG membership status to UE
         in Ue Reconfiguration message. Expect positive UE Reconfiguration confirm 
         from scheduler"
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" 
         raWinSize="10" numTxAntPorts ="2" csgAccMode="3"/>
   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
      
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
      # Send UE ReConfiguration for the same UE-0 created above for CSG membership status 
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="4194304" csgMmbrSta="1"/>
      </tapa.send>

    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expset>

  #Request to ShutDown LTEMAC

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.238
#
#       Desc:    Verify that in a multiple UE Scenario(only CSG UEs), 
#                the UEs shall be  scheduled in RR
#                 
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.238">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure Cell mode as HYBRID, then attach only 4 CSG UEs.
         Here all the 2 CSG UEs get scheduled in all  UL subframe(In
         each subframe 2 UEs). Configure number of UE per ul TTI as 4"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2"
         csgAccMode="3" maxUlUeNewTxPerTti="4" maxDlUeNewTxPerTti="4"
         maxUePerDlSf="4"/>
      #<tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2"
      #   csgAccMode="3"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
         #<tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="4" rapIds="5:6:7:8:10" 
               cqiPres="TRUE:TRUE:TRUE:TRUE" cqis="4:4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="4" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
            <tapa.tfu.msg3.recp.req ueId="2" />
            <tapa.tfu.msg3.recp.req ueId="3" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>
   
   #Send CRC for Msg3 for 3rd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 4th UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
 
      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Send Message3 after receiving Message3 reception req for 3rd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="2"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 4th UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="3"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
         <tapa.rgu.cdatind ueId="3" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>
    
    # Send BO for Msg4 on RGU for 3rd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="2"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 4th UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="3"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>
   
   # Send Msg4 on RGU for 3rd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 4th UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="3" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="3" ueId="2" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="4" ueId="3" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="3"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="4" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
        <tapa.tfu.hq.recp.req ueId="3"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for all UEs.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="2" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="3" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2"/>
   </tapa.send>

   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="3"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   # Expect success in cfg cfm for 3rd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 4th UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
  
   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="2" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="3" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   # Send UE ReConfiguration for the UE-1 created above for CSG membership status 
   # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newUeId="0" UeReCfgType="4194304" csgMmbrSta="1"/>
     </tapa.send>

   # Send UE ReConfiguration for the UE-2 created above for CSG membership status 
   # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" newUeId="1" UeReCfgType="4194304" csgMmbrSta="1"/>
     </tapa.send>

   # Send UE ReConfiguration for the UE-3 created above for CSG membership status 
   # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue  oldUeId="2" newUeId="2" UeReCfgType="4194304" csgMmbrSta="1"/>
     </tapa.send>

   # Send UE ReConfiguration for the UE-4 created above for CSG membership status 
   # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue  oldUeId="3" newUeId="3" UeReCfgType="4194304" csgMmbrSta="1"/>
    </tapa.send>

    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="2"/>
         <tapa.rgr.cfgCfm ueId="3"/>
      </tapa.expset>

 #Till now RACH and basic UE context is setup
 #UE1 and UE2 Configuration
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 #UE3 and UE4 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    #(4,7)
  
     # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
    
      #(5,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

    #(5,1)
     <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
    #(5,2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      #(5,4)
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

    #(5,5)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
 # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" addLongBsr="TRUE"
            bsr0="4" bsr1="0" bsr2="0" bsr3="0"/>
          <tapa.tfu.dat ueId="1" use="4" addLongBsr="TRUE"
            bsr0="9" bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE" saveTo="7"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="7" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="8" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
 # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    11.239
#
#       Desc:    Verify that in a multiple UE Scenario(only NonCSG UEs), 
#                the UEs shall be  scheduled in PFS
#                 
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.239">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure Cell mode as HYBRID, then attach only 4 CSG UEs.
         Here all the 2 Non CSG UEs get scheduled in all  UL subframe(In
         each subframe 2 UEs). Configure number of UE per ul TTI as 2"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="1" ulSchdType="1" ulDlCfgIdx="2"
         csgAccMode="3" maxUlUeNewTxPerTti="4" maxDlUeNewTxPerTti="4"
         maxUePerDlSf="4" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="4" rapIds="5:6:7:8:10" 
               cqiPres="TRUE:TRUE:TRUE:TRUE" cqis="4:4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="4" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
            <tapa.tfu.msg3.recp.req ueId="2" />
            <tapa.tfu.msg3.recp.req ueId="3" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>
   
   #Send CRC for Msg3 for 3rd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 4th UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
 
      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Send Message3 after receiving Message3 reception req for 3rd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="2"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 4th UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="3"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
         <tapa.rgu.cdatind ueId="3" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>
    
    # Send BO for Msg4 on RGU for 3rd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="2"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 4th UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="3"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>
   
   # Send Msg4 on RGU for 3rd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 4th UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="3" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="3" ueId="2" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="4" ueId="3" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="3"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="4" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
        <tapa.tfu.hq.recp.req ueId="3"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for all UEs.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="2" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="3" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2"/>
   </tapa.send>

   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="3"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   # Expect success in cfg cfm for 3rd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 4th UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
  
   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="2" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="3" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

 #Till now RACH and basic UE context is setup
 #UE1 and UE2 Configuration
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 #UE3 and UE4 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    #(4,7)
  
     # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
    
      #(5,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

    #(5,1)
     <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
    #(5,2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      #(5,4)
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

    #(5,5)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
 # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" addLongBsr="TRUE"
            bsr0="4" bsr1="0" bsr2="0" bsr3="0"/>
          <tapa.tfu.dat ueId="1" use="4" addLongBsr="TRUE"
            bsr0="9" bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE" saveTo="7"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="7" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="8" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
 # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.240
#
#       Desc:    Verify that in a multiple UE Scenario(only NonCSG UEs), 
#                the UEs shall be  scheduled in RR
#                 
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc15.xml
#
#
<tapa.testcase id="11.240">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure Cell mode as HYBRID, then attach only 4 CSG UEs.
         Here all the 2 Non CSG UEs get scheduled in all  UL subframe(In
         each subframe 2 UEs). Configure number of UE per ul TTI as 2"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2"
         csgAccMode="3" maxUlUeNewTxPerTti="4" maxDlUeNewTxPerTti="4"
         maxUePerDlSf="4" />

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="4" rapIds="5:6:7:8:10" 
               cqiPres="TRUE:TRUE:TRUE:TRUE" cqis="4:4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="4" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
            <tapa.tfu.msg3.recp.req ueId="2" />
            <tapa.tfu.msg3.recp.req ueId="3" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>
   
   #Send CRC for Msg3 for 3rd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 4th UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
 
      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Send Message3 after receiving Message3 reception req for 3rd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="2"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 4th UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="3"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
         <tapa.rgu.cdatind ueId="3" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>
    
    # Send BO for Msg4 on RGU for 3rd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="2"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 4th UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="3"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>
   
   # Send Msg4 on RGU for 3rd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 4th UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="3" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="3" ueId="2" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="4" ueId="3" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="3"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="4" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
        <tapa.tfu.hq.recp.req ueId="3"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for all UEs.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="2" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="3" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2"/>
   </tapa.send>

   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="3"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   # Expect success in cfg cfm for 3rd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 4th UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
  
   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="2" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="3" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

 #Till now RACH and basic UE context is setup
 #UE1 and UE2 Configuration
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 #UE3 and UE4 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    #(4,7)
  
     # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
    
      #(5,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

    #(5,1)
     <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
    #(5,2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      #(5,4)
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

    #(5,5)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
 # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="3" addLongBsr="TRUE"
            bsr0="4" bsr1="0" bsr2="0" bsr3="0"/>
          <tapa.tfu.dat ueId="1" use="4" addLongBsr="TRUE"
            bsr0="9" bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE" saveTo="7"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="7" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="8" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
 # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    11.241
#
#       Desc:    Verify that in a multiple UE Scenario(CSG and Non CSG UEs), 
#                the UEs shall be  scheduled in RR, and more priority
#                is given to CSG UEs, here number of CSG UEs 3 and non CSG UE 1
#                number of UEs per UL TTI is 4
#                 
#
#       Notes:   None
#
#       Module:  RR SCH
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="11.241">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure Cell mode as HYBRID, then attach only 3 CSG UEs.
        and 1 Non CSG UE. Here CSG UEs will get scheduled before non CSG UEs"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
	 <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" ulDlCfgIdx="2" csgAccMode="3"
         maxUlUeNewTxPerTti="4" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"/><!--
      <tapa.rg.UeInitTdd2 ueId="0"/>
      <tapa.rg.UeInitTdd2 ueId="1"/>
      <tapa.rg.UeInitTdd2 ueId="2"/>
      <tapa.rg.UeInitTdd2 ueId="3"/>-->

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="4" rapIds="5:6:7:8" 
               cqiPres="TRUE:TRUE:TRUE:TRUE" cqis="4:4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="4" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
            <tapa.tfu.msg3.recp.req ueId="2" />
            <tapa.tfu.msg3.recp.req ueId="3" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>
   
   #Send CRC for Msg3 for 3rd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>
   
   #Send CRC for Msg3 for 4th UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
 
      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Send Message3 after receiving Message3 reception req for 3rd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="2"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Send Message3 after receiving Message3 reception req for 4th UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="3"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
         <tapa.rgu.cdatind ueId="3" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>
    
    # Send BO for Msg4 on RGU for 3rd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="2"/>
    </tapa.send>
    
    # Send BO for Msg4 on RGU for 3rd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="3"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>
   
   # Send Msg4 on RGU for 3rd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>
   
   # Send Msg4 on RGU for 4th UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="3" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req use="1" ueId="0" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="2" ueId="1" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="3" ueId="2" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req use="4" ueId="3" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="4" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="3"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
  
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="4" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
        <tapa.tfu.hq.recp.req ueId="3"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for all UEs.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="2" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="3" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2"/>
   </tapa.send>
   
   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="3"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   # Expect success in cfg cfm for 3rd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   # Expect success in cfg cfm for 4th UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535" ueCatEnum="1" />
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>
   
   # Send UE config request for 3rd UE
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="2" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>
   
   # Send UE config request for 4th UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="3" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Send UE ReConfiguration for the UE-1 created above for CSG membership status 
   # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newUeId="0" UeReCfgType="4194304" csgMmbrSta="1"/>
     </tapa.send>

   # Send UE ReConfiguration for the UE-2 created above for CSG membership status 
   # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" newUeId="1" UeReCfgType="4194304" csgMmbrSta="1"/>
     </tapa.send>

   # Send UE ReConfiguration for the UE-3 created above for CSG membership status 
   # at RGR
    <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue  oldUeId="2" newUeId="2" UeReCfgType="4194304" csgMmbrSta="1"/>
     </tapa.send>

    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="2"/>
      </tapa.expset>
 
 #Till now RACH and basic UE context is setup
 #UE1 and UE2 Configuration
 # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 #UE3 and UE4 Configuration
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      
      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
      #(4,6)
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    #(4,7)
  
     # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
    
      #(5,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="4">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"/>
        <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>
   </tapa.expset>

    #(5,1)
     <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
    #(5,2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      #(5,4)
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
    #(5,7)
     
 # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="5" addLongBsr="TRUE"
            bsr0="4" bsr1="0" bsr2="0" bsr3="0"/>
          <tapa.tfu.dat ueId="1" use="6" addLongBsr="TRUE"
            bsr0="9" bsr1="0" bsr2="0" bsr3="0"/>
          <tapa.tfu.dat ueId="2" use="7" addLongBsr="TRUE"
            bsr0="4" bsr1="0" bsr2="0" bsr3="0"/>
          <tapa.tfu.dat ueId="3" use="8" addLongBsr="TRUE"
            bsr0="9" bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
    #(6,2)

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="10" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="11" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="12" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    #(6,5)

 # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="9" vldtDatRecp="TRUE" saveTo="13"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="10" vldtDatRecp="TRUE" saveTo="14"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="11" vldtDatRecp="TRUE" saveTo="15"/>
        <tapa.tfu.pusch.recp.req ueId="3" use="12" vldtDatRecp="TRUE" saveTo="16"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    #(6,9)

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    #(7,2)

      # Expect HARQ ACK in PHICH for BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send Data Indication using TB size recieved in the BSR grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="13" lcId="1"/>
          <tapa.tfu.dat ueId="1" use="14" lcId="1"/>
          <tapa.tfu.dat ueId="2" use="15" lcId="1"/>
          <tapa.tfu.dat ueId="3" use="16" lcId="1"/>
       </tapa.tfu.dat.ind>
    </tapa.send>
 # Expect Data Indication at RLC
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="1,1" vldtBuf="TRUE"/>
         <tapa.rgu.ddatind ueId="3" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expset>
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend
#/********************************************************************30**
#
#         End of file:     rgac_tc11.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#/main/1      ---     sm   1. Initial Release.
#$SID$         ---     sm   1. Initial Release.
#             rg004.201 rnt  1. Modified for SI Enhancement
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg001.301   nudupi   1.Changes for the CR ccpu00118643. 
#$SID$        rg002.301  asehgal 1.Changes for ccpu00109543,ccpu00119953
#$SID$                           2.Changes for the CR ccpu001120264 and ccpu00119494.
#$SID$                           3.ccpu00120969: added dependancy for RGR_V2
#$SID$        rg003.301  ap      1.Added TDD configuration 1 test cases.
#$SID$        ---     rt  	 1.LTE MAC 4.1 Release
#*********************************************************************91*/
