#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases For PFS Scheduler
#
#     File:    rgac_tc14.xml
#
#     Sid:      rgac_tc14.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#     Prg:     ns 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:hn:rgac_tc14.xml



#
#
#       Test:    14.1
#
#       Desc:    Configure PFS DL cell incorrectly to so that
#                so that the configuration fails
#       
#       Notes:   None
#              
#       Module:  MAC
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.1">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "Incorrect configuration of PFS DL cell"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that cell config fails when there is no non-zero priority
         value for any type (type being cqi/svcprio/frac) "
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>

      <!--
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STRGRSAP" />
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>
      -->

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

 
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

 
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell dlTotalBw="100" ulTotalBw="50"/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #need to add case for cell configuration failure
      <!--
      #Sending RGR CELL Configuration
      <tapa.send>
         # Set svc priorities to zero
         <tapa.rgr.cfgreq.cfg.cell instId="1" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
            dlSchdType="1"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"
            cqiPrios="1000:2000:3000" fracPrios="1:2" svcPrioPrios="0"/>
      </tapa.send>

      # Expect failure in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      <tapa.send>
         # Set frac priorities to zero
         <tapa.rgr.cfgreq.cfg.cell instId="5" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
            dlSchdType="1"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"
            svcPrioPrios="1000:2000:3000" cqiPrios="1:2" fracPrios="0"/>
      </tapa.send>

     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>
     -->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    14.2
#
#       Desc:    Configure PFS DL cell incorrectly so that
#                so that the configuration fails
#       
#       Notes:   None
#              
#       Module:  MAC
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.2">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "Incorrect configuration of PFS DL cell"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that cell config fails when priority values are too
         large."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>

      <!--
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STRGRSAP" />
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>
      -->

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

 
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

 
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell dlTotalBw="100" ulTotalBw="50"/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #need to add case for cell configuration failure
      <!--
      #Sending RGR CELL Configuration
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="1" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
            dlSchdType="1"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"
            cqiPrios="100000:100000:10000"
            fracPrios="100000:100000" svcPrioPrios="32:32"/>
      </tapa.send>

     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="1" status="15"/>
     </tapa.expect>
     -->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>


</tapa.testcase>


#
#
#       Test:    14.3
#
#       Desc:   "Verify that signaling channel is given higher priority over
#                data with priority 0."
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that signaling channel is given higher priority over data
         with priority 0."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that signaling channel is given higher priority over data
         with priority 0."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0"
            dir="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a DTCH at MAC (not scheduler) for UE 1
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5"
            instId="5"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the DTCH on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="3000"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the DCCH on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for both DCCH and DTCH
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for DTCH
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.4
#
#       Desc:   "Verify that TA receives higher priority than
#                signaling (DCCH)"
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that TA receives higher priority than signaling (DCCH)"

      </tapa.desc>

      <tapa.longdesc>
         "Verify that TA receives higher priority than signaling (DCCH)"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0"
            dir="3" lcType="5"/>
      </tapa.send>

      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TA for UE and BO for the DTCH on RGU. 
      <tapa.send>
         <tapa.tfu.timingadv.ind>
            <tapa.tfu.timingadv ueId="0" timingAdv="3"/>
         </tapa.tfu.timingadv.ind>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="5000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for both DCCH
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" chkTA="TRUE" taVal="3"
               validate="TRUE" chkSdu="TRUE" lcId="1"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for DTCH
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.5
#
#       Desc:   "Verify that GBR channels are satisfied
#                before AMBR ones."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that GBR channels are satisfied
         before AMBR ones."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that GBR channels are satisfied
         before AMBR ones."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="50" maxDlBwPerUe="50" dlSchdType="1" minDlResNonCsg="100" minUlResNonCsg="100"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a GBR DTCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         # Configure an AMBR DTCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure GBR DTCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="1" instId="5" dlGbr="4000" dlMbr="5000"/>
      </tapa.send>

      # Configure AMBR DTCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="7" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="5000"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for both DTCHs,
         # GBR one being completely satisfied first.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.expset>
         # Expect staInd from MAC to RLC for both DTCHs,
         # GBR one being completely satisfied first.
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
     
       <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         #<tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         # Scheduler meanwhile would have scheduled for the AMBR DTCH
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.6
#
#       Desc:   "Verify that priority 0 DTCH channels are satisfied
#                before GBR channels"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that priority 0 DTCH channels are satisfied
         before GBR ones."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that priority 0 DTCH channels are satisfied
         before GBR ones."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Configure a GBR DTCH with (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="2" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="5000"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for both DTCHs,
         # priority 0 one being completely satisfied first.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the AMBR DTCH
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.7
#
#       Desc:   "Verify that, among GBR channels, channels with pending
#                GBR are satisfied before channels with pending MBR (but
#                for which GBR has been exhausted)"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among GBR channels, channels with pending
         GBR are satisfied before channels with pending MBR (but
         for which GBR has been exhausted)"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among GBR channels, channels with pending
         GBR are satisfied before channels with pending MBR (but
         for which GBR has been exhausted)"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 1 (QCI 1) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            dlGbr="200" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 2 (QCI 2) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="2"
            dlGbr="5000" dlMbr="10000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO so that no more GBR remains when UE 0
      # is completely scheduled
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="300"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="5000"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="300"/>
      </tapa.send>

      # Send a Tti to send the data, as well as get transmissions
      # scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data down to MAC
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="4"/>
      </tapa.send>


      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the higher
         # priority GBR service due to pending BO
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#       Test:    14.8
#
#       Desc:   "Verify that, among GBR channels, channels with
#                higher priority (lower priority value) are
#                satisfied first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among GBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among GBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 1 (QCI 1) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            dlGbr="1000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 2 (QCI 2) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="5"
            dlGbr="1000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="350"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="350"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      # Send data corresponding to staInds
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel which did not have BO satisifed
         # completely last time.
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.9
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority (lower priority value) are
#                satisfied first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            dlGbr="1000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
            dlGbr="1000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="250"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="250"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      # Send data corresponding to staInds
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>

         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>    
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.10
#
#       Desc:   "Verify that remaining rate is considered
#                for GBR channels"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that remaining rate is cnosidered for
          GBR channels."
      </tapa.desc>

      <tapa.longdesc>
         "Configure two GBR services of equal priority (for different UEs) -
         LC 3 and LC 4. Update non-zero BO for LC 3. Once complete allocation
         has bee made for this (make sure configured GBR is larger than
         allocation), update BO for both LC 3 and LC 4 in the same subframe,
         LC 3's BO being larger.
         Verify that LC 4 is completely satisfied first."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="25" maxDlBwPerUe="25" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 2 (QCI 3/4) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="3"
            dlGbr="500" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 3 (QCI 5/6) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="4"
            dlGbr="500" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send some BO to satisfy the higher priority LC,
      # So that its remaining rate goes down.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="400"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInds.
      # Also, now send more BO updates, so that the lower
      # priority LC also has some BO.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="200"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="5000"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel, and also for the higher priority
         # one. However, the lower priority is expected to have
         # been completely scheduled for here.
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the original
         # higher priority channel, thus indicating that during the
         # last scheduling time, it had given preference to the
         # lower priority channel due to higher remaining fraction.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>

      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="1" ueId="1" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.11
#
#       Desc:   "Verify that remaining rate is considered
#                for AMBR channels"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that remaining rate is cnosidered for
          AMBR channels."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that remaining rate is cnosidered for
          AMBR channels."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit ambrPres="TRUE" dlAmbr="2000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send some BO to satisfy the higher priority LC,
      # So that its remaining rate goes down.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="400"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      # Also, now send more BO updates, so that the lower
      # priority LC also has some BO.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="400"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="5000"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for both
         # channels now, completely for the lower service
         # priority one, and the rest for the other.
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Not sending data for DTCH anymore, ending TC here
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.12
#
#       Desc:   "Verify that AMBR DTCHs are capped off at
#                UE's configured AMBR, which is then refreshed
#                after refresh time."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that AMBR DTCHs are capped off at
          UE's configured AMBR, which is then refreshed
          after refresh time."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that AMBR DTCHs are capped off at
          UE's configured AMBR, which is then refreshed
          after refresh time."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit ambrPres="TRUE" dlAmbr="400"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) (QCI 7/8) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send BO higher than AMBR
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="800"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Absence of StaInd here implies that no more is to
         # be scheduled for the channel. Whether this is due
         # to BO getting exhausted or AMBR limit is not clear
         # yet.
         # This will become clear when we wait for a refresh
         # cycle and see that the channel is again scheduled
         # for. The fact that AMBR is in action could have
         # been clear now if we checked for allocation. But no
         # easy way to do that now, so relying on after
         # refresh cycle expectation of further scheduling.
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Now send a large number of TTIs to (just) exhaust the refresh cycle
      <tapa.send>
         <tapa.tfu.tti.ind numTti="288"/>
      </tapa.send>

      # Now the AMBR would've been refreshed, and remaining BO
      # of LC would be satisfied.
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.13
#
#       Desc:   "Verify that AMBR DTCHs are capped off at UE's
#                configured AMBR, which is then refreshed after
#                refresh time."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that AMBR DTCHs are capped off at UE's
          configured AMBR, which is then refreshed after
          refresh time."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that AMBR DTCHs are capped off at UE's
          configured AMBR, which is then refreshed after
          refresh time."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="25" maxDlBwPerUe="25" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit ambrPres="FALSE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) (QCI 7/8) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send BO higher than AMBR
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="800"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # As opposed to the previous TC, there is going to be
         # an allocation for the channel here since there is
         # no cap due to AMBR.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.14
#
#       Desc:   "Verify that GBR DTCHs are capped off at
#                respective configured MBR values."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that GBR DTCHs are capped off at
          respective configured MBR values."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that GBR DTCHs are capped off at
          respective configured MBR values."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit ambrPres="FALSE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            dlGbr="400" dlMbr="800" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send BO higher than AMBR
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="3000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Allocation for more data
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # No more allocation as MBR limit is reached
      </tapa.expset>

      <tapa.send>
         # Send TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Now send a large number of TTIs to (just) exhaust the refresh cycle
      <tapa.send>
         <tapa.tfu.tti.ind numTti="287"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.15
#
#       Desc:   "Verify that AMBR limit does not hold
#                for DCCHs."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.15">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that AMBR limit does not hold
          for DCCHs."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that AMBR limit does not hold
          for DCCHs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit ambrPres="TRUE" dlAmbr="400"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DCCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1"
            dir="3" lcType="5"/>
      </tapa.send>

      # Configure DCCH
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1"
            lcType="5" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send BO higher than AMBR
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Allocation for more data, breaching AMBR limit
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 3 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 1 TTI to get next subframe's harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # 2 more TTIs for HARQ indication corresponding to first data
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # 1 more TTI for next HARQ indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Now send a large number of TTIs to (comfortably)
      # exhaust the refresh cycle
      <tapa.send>
         <tapa.tfu.tti.ind numTti="988"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.16
#
#       Desc:   "Verify that AMBR limit does not hold
#                for priority 0 DTCHs."
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.16">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that AMBR limit does not hold
          for priority 0 DTCHs."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that AMBR limit does not hold
          for priority 0 DTCHs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit ambrPres="TRUE" dlAmbr="400"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure (priority 0) DTCH (QCI 0)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send BO higher than AMBR
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="800"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Allocation for more data, breaching AMBR limit
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 3 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 1 TTI to get next subframe's harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # 2 more TTIs for HARQ indication corresponding to first data
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # 1 more TTI for next HARQ indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Now send a large number of TTIs to (comfortably)
      # exhaust the refresh cycle
      <tapa.send>
         <tapa.tfu.tti.ind numTti="988"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.17
#
#       Desc:   "Verify that for the case of two UEs with
#                DTCHs of comparable properties, the DTCH for
#                higher CQI UE starts getting satisfied first.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that for the case of two UEs with
          DTCHs of comparable properties, the DTCH for
          higher CQI UE starts getting satisfied first."
      </tapa.desc>

      <tapa.longdesc>
         "For the two GBR DTCHs of two UEs, configure them such that LC of UE
         1 is of priority slightly higher (priority value one lower) than LC
         of UE 2. Other properties shall remain same.
         Assign CQI = 7 for UE 1 and CQI = 14 for UE 2. Assign large BOs to
         both channels.
         Verify that LC of UE 2 is allocated first (despite it having a lower
         service priority)."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="25" maxDlBwPerUe="25" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            lcType="4" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="2"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Just let some TTIs pass by
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="800"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="800"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="15"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="9"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC. Second UE (with higher CQI) shall
      # be satisfied first, and then the other one (though
      # this is not known (checked for) here yet.
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # The second UE with lower CQI was not completely satisfied
         # initially, which means that the remainder of it would
         # have been scheduled now.
         # Also not the absence of UE 2 being scheduled, indicating
         # that it indeed must have been totally satisfied the
         # first time around.
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      # Send data corresponding to staInd - not doing this,
      # ending TC here.
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.18
#
#       Desc:   "Verify that for the case of two UEs with
#                DTCHs of comparable properties, the DTCH for
#                higher CQI UE starts getting satisfied first.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.18">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that for the case of two UEs with
          DTCHs of comparable properties, the DTCH for
          higher CQI UE starts getting satisfied first.
      </tapa.desc>

      <tapa.longdesc>
         "Verify that for the case of two UEs with
          DTCHs of comparable properties, the DTCH for
          higher CQI UE starts getting satisfied first.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <!--
      <tapa.rg.cellInit dlTotalBw="25" maxDlBwPerUe="25" dlSchdType="1"/>
      -->

## CELL CFG START
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>
      
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>
<!--
      #Send Bind Request for RGM SAP 
      <tapa.send>
         <tapa.rgm.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgm.bndcfm/>
      </tapa.expect>
 -->
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      
      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>


      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq instId="0"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0" instId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

	  #Sending RGR ENB Configuration
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.enb instId="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         dlSchdType="1"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" cqiPrios="16:15:14:13:12:11:10:9:8:7:6:5:4:3:2" />
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


## CELL CFG END

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCHs at MAC (not scheduler)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Just let some TTIs pass by
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="800"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="800"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="7"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="14"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC. Second UE (with higher CQI) shall
      # be satisfied first, and then the other one (though
      # this is not known (checked for) here yet.
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # The first UE with lower CQI was not completely satisfied
         # initially, which means that the remainder of it would
         # have been scheduled now.
         # Also not the absence of UE 2 being scheduled, indicating
         # that it indeed must have been totally satisfied the
         # first time around.
         #<tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      # Send data corresponding to staInd.
      #<tapa.send>
      #   <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      #</tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.19
#
#       Desc:   "Verify that HARQ proc with signaling/TA receives higher
#                priority than proc carrying DTCH of priority 0.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.19">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0.
      </tapa.desc>

      <tapa.longdesc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" maxDlRetxBw="25"
         dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0"
            dir="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a DTCH at MAC (not scheduler) for UE 1
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" 
            dlQci="5" instId="5"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Get all the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="14"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="14"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Send BOs. Note that BOs should be sent such
      # that they are completely satisfied without
      # leaving a lot of buffer in the bandwidth.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="700"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the DCCH on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="700"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for both DCCH and DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="1" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>
      
      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="7"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="7"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtRetx="TRUE"
               use="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

    <!-- 
      # TODO: As the non-adaptive HARQ retransmssion used for DL  
      # CQI degradation will not effect the retransmission.
      # Hence both UEs will be scheduled in single TTI as in new trasmission.
      # The below part can be used once the adaptive scheduling is taken-in 

      # A TTI for rescheduling the other left out proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
    -->
      # Ending TC here, what needed to be verified is achieved.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.20
#
#       Desc:   "Verify that HARQ proc with signaling/TA receives higher
#                priority than proc carrying DTCH of priority 0.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.20">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that HARQ proc with signaling/TA receives higher
          priority than proc carrying DTCH of priority 0."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="28" maxDlBwPerUe="28" maxDlRetxBw="28"
         dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a DCCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0"
            dir="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a DTCH at MAC (not scheduler) for UE 1
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DCCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5"
           dlQci="5" instId="5"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Get all the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TA for UE and BO for the DTCH on RGU. 
      <tapa.send>
         <tapa.tfu.timingadv.ind>
            <tapa.tfu.timingadv ueId="0" timingAdv="3"/>
         </tapa.tfu.timingadv.ind>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="800"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="1" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3"
               chkTA="TRUE" taVal="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4"
               validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtRetx="TRUE"
               use="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <!--
      # TODO: As the non-adaptive HARQ retransmssion used for DL  
      # CQI degradation will not effect the retransmission.
      # Hence both UEs will be scheduled in single TTI as in new trasmission.
      # The below part can be used once the adaptive scheduling is taken-in 

      # A TTI for rescheduling the other left out proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      -->

      # Ending TC here, what needed to be verified is achieved.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.21
#
#       Desc:   "Verify that HARQ proc with priority 0 DTCH receives higher
#                priority than proc carrying GBR DTCH.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with priority 0 DTCH receives higher
          priority than proc carrying GBR DTCH."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that HARQ proc with priority 0 DTCH receives higher
          priority than proc carrying GBR DTCH."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" maxDlRetxBw="25"
         dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH with priority 0 (QCI 5) (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="5" instId="5"/>
      </tapa.send>

      # Configure a GBR DTCH with (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send BOs. Note that BOs should be sent such
      # that they are completely satisfied without
      # leaving a lot of buffer in the bandwidth.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="700"
            oldestSduDelay="12" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="700"
            oldestSduDelay="12" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for both DCCH and DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="9"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtRetx="TRUE"
               use="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # A TTI for rescheduling the other left out proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Ending TC here, what needed to be verified is achieved.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.22
#
#       Desc:   "Verify that HARQ proc with GBR DTCH receives higher
#                priority than proc carrying AMBR DTCH.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with priority 0 DTCH receives higher
          priority than proc carrying GBR DTCH."
      </tapa.desc>

      <tapa.longdesc>
         "Ensure that proc 1 (of UE 1) carries AMBR DTCH and proc 2 (of UE 2)
         carries GBR DTCH in same subframe. Update CQI for each so that now
         both procs together canonot be retransmitted in the same subframe.
         Generate a NACK for each. In the next downlink subframe, data for
         proc 2 should appear. Data for proc 1 should appear in a subsequent
         downlink subframe."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" maxDlRetxBw="25"
         dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a GBR DTCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         # Configure an AMBR DTCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure GBR DTCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="1" instId="5"/>
      </tapa.send>

      # Configure AMBR DTCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="7" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send BOs. Note that BOs should be sent such
      # that they are completely satisfied without
      # leaving a lot of buffer in the bandwidth.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="700"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="700"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for both DCCH and DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="9"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtRetx="TRUE"
               use="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # A TTI for rescheduling the other left out proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" vldtRetx="TRUE"
               use="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Ending TC here, what needed to be verified is achieved.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.23
#
#       Desc:   "Verify that HARQ proc with GBR DTCH receives higher
#                priority than proc carrying AMBR DTCH.
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.23">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that HARQ proc with priority 0 DTCH receives higher
          priority than proc carrying GBR DTCH."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that HARQ proc with priority 0 DTCH receives higher
          priority than proc carrying GBR DTCH."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35" maxDlRetxBw="255"
         dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 1 (QCI 1) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="1"
            dlGbr="3000" dlMbr="5000" lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (GBR) with priority 2 (QCI 2) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="2"
            dlGbr="5000" dlMbr="10000" lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO so that no more GBR remains when UE 0
      # is completely scheduled. Do the completely cycle
      # (upto HARQ feedback).
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="200"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>
      <tapa.send>
         # TODO: chk if numTti=2 is correct. Probably needs to be 3.
         # In fact, on checking further, many of the retx cases actually
         # work since unable to retrieve correct hq proc on receiving
         # feedback is tantamount to NACK.
         # Somehow though, some earlier TCs with complete path (refresh
         # (cycle ones) seem to be working with numTti="3".
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      # The cycle is now complete for the initial data transmission
      # meant to extinguish GBR for the UE 0 channel


      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send BOs. Note that BOs should be sent such
      # that they are completely satisfied without
      # leaving a lot of buffer in the bandwidth.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="700"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="700"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for both DTCHs
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Lower CQI so that both procs do not fit in the same subframe
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="9"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # A TTI (in fact, 2 of them) for rescheduling a suitable proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="5" vldtRetx="TRUE"
               use="2"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" vldtRetx="TRUE"
               use="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="1" use="5" validate="TRUE"
               isRetx="TRUE" retxUse="4"/>
            <tapa.tfu.pdsch.dat.req ueId="0" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <!--
      # TODO: As the non-adaptive HARQ retransmssion used for DL  
      # CQI degradation will not effect the retransmission.
      # Hence both UEs will be scheduled in single TTI as in new trasmission.
      # The below part can be used once the adaptive scheduling is taken-in 
      # A TTI for rescheduling the other left out proc
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" vldtRetx="TRUE"
               use="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="6" validate="TRUE"
               isRetx="TRUE" retxUse="3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      -->
      # Ending TC here, what needed to be verified is achieved.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#### UPLINK TCs #####


#
#
#       Test:    14.24
#
#       Desc:    Configure PFS DL cell incorrectly to so that
#                so that it configuration fails
#       
#       Notes:   None
#              
#       Module:  MAC
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.24">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "Incorrect configuration of PFS DL cell"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that cell config fails when there is no non-zero priority
         value for any type (type being cqi/svcprio/frac) "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>

      <!--
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STRGRSAP" />
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>
      -->

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

 
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

 
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell dlTotalBw="100" ulTotalBw="50"/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #need to add case for cell configuration failure
      <!--
      #Sending RGR CELL Configuration
      <tapa.send>
         # Set svc priorities to zero
         <tapa.rgr.cfgreq.cfg.cell instId="1" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
            ulSchdType="1"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"
            cqiPrios="1000:2000:3000" fracPrios="1:2" lcgPrios="0"/>
      </tapa.send>

      # Expect failure in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      <tapa.send>
         # Set cqi priorities to zero
         <tapa.rgr.cfgreq.cfg.cell instId="5" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
            ulSchdType="1"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"
            cqiPrios="0" lcgPrios="1000:2000:3000" fracPrios="1:2"/>
      </tapa.send>

      # Expect failure in cfg cfm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      <tapa.send>
         # Set frac priorities to zero
         <tapa.rgr.cfgreq.cfg.cell instId="5" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
            ulSchdType="1"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"
            lcgPrios="1000:2000:3000" cqiPrios="1:2" fracPrios="0"/>
      </tapa.send>

     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>
     -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    14.25
#
#       Desc:    Configure PFS DL cell incorrectly so that
#                so that the configuration fails
#
#       Notes:   None
#
#       Module:  MAC
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.25">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "Incorrect configuration of PFS DL cell"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that cell config fails when priority values are too
         large."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>

      <!--
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STRGRSAP" />
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>
      -->

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

 
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

 
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>
      
      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell dlTotalBw="100" ulTotalBw="50"/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #need to add case for cell configuration failure
      <!--
      #Sending RGR CELL Configuration
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="1" dlTotalBw="100" ulTotalBw="50"  numCmnLc="5"
            ulSchdType="1"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0"
            cqiPrios="100000:100000:10000"
            fracPrios="100000:100000" lcgPrios="32:32"/>
      </tapa.send>

     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>
     -->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>


</tapa.testcase>


#
#
#       Test:    14.26
#
#       Desc:    "Verify that UE with signaling buffers receives higher priority
#                over others with non-signaling buffers."
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that UE with signaling buffers receives higher priority
         over others with non-signaling buffers."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE with signaling buffers receives higher priority
         over others with non-signaling buffers."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 0 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="0" lcId="1"
            lcType="5" dir="3"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 0 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="0" bsr="18" lcId="1"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="1" bsr="25" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="3"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="10"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="4" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.27
#
#       Desc:    "Verify that LCG priorities are respected across
#                 UEs LCGs 1, 2 and 3."
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.27">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that LCG priorities are respected across
          UEs LCGs 1, 2 and 3."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that LCG priorities are respected across
          UEs LCGs 1, 2 and 3."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="30" ulSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 and 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="5"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 2 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="2" lcId="4"
            lcType="4" dir="3"/>
      </tapa.send>

      # Configure LCG 1 and 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="3" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" gbr="2000" instId="5" qci="3"/>
      </tapa.send>
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5" qci="9"/>
      </tapa.send>

      # Configure LCG 2 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="2" dir="3"
               lcType="4" ulQci="6" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="2" instId="5" qci="6"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addLongBsr="TRUE"
               lcgId="1" bsr1="28" bsr3="15" lcIds="3:5"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="2" bsr="25" lcId="4"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="9"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="15"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="2" lchTb1Data="3:5"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.28
#
#       Desc:    "Verify that CQI is considered to determine UE
#                 priority while scheduling"
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.28">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that CQI is considered to determine UE
           priority while scheduling"
      </tapa.desc>

      <tapa.longdesc>
         "Set up two similar UEs, UE 1 having CQI = 10 and UE 2 having CQI = 7.
         Both UE are configured with same LC and LCG(default bearer).
         Using TP factor = 10 and Fairness Factor = 0, Both UE should be
         scheduled and UE with higher CQI should be present in upper data queue
         and so it should be scheduled first.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulSchdType="1" maxUlUeNewTxPerTti="2"
      ulThroughputFactor="10" ulFairnessFactor="0"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="100000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="100000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 3 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="3" lcId="3"
            lcType="4" dir="3"/>
      </tapa.send>

      # Configure LCG 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5" qci="9"/>
      </tapa.send>

      # Configure LCG 3 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="3" instId="5" qci="9"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="3" bsr="60" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="3" bsr="60" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.delay delay="5"/>

      <tapa.send lc="TRUE">
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="7"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="10"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      <tapa.delay delay="5"/>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
      </tapa.expset>

      <tapa.delay delay="5"/>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE" rbStart="2" numRb="30"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE" rbStart="32" numRb="60"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.29
#
#       Desc:    "Verify that bitrate of UE is considered to
#                 determine UE priority while scheduling"
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.29">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that bitrate of UE is considered to
          determine UE priority while scheduling"
      </tapa.desc>

      <tapa.longdesc>
         "Set up two similar UEs, UE 1 having CQI = 10 and UE 2 having CQI = 9.
         Report BSR for LCG 1 for UE 1, and satisfy it. (This would cause
         remaining bitrate of UE 1 to reduce.)
         Report BSR for LCG 1 for both UE 1 and UE 2, such that both UEs
         together cannot be completely satisfied in the same subframe. Ensure
         that priorities are configured such the resulting bitrate difference
         more than compensates for difference in CQI priorities.
         Verify that UE 2 is satisifed first completely before UE 1 (despite
         UE 2 having lower CQI)."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="75"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="75"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="3" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Report good CQI for the UE to get the job of pumping
      # out data quickly
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="10"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      # Report high BSR, satisfying which would cause UE's
      # remaining BR to perceivably diminish.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" ueId="0" addShortBsr="TRUE"
               lcgId="3" bsr="23" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" ueId="0" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expect>


      # Send a bunch of TTIs so that no outstanding allocations
      # count when SR is received by MAC.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="700"/>
      </tapa.send>

      # Now start the complete cycle of allocations for both UEs,
      # intending to verify that UE 2 now gets higher preference
      # due to earlier allocation to UE 1.

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="800"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Report large BOs, lest a small BO shadows the effect of UE
      # bit rate in remaining bit rate calculation, and so that
      # only one UE being allocation in a subframe is visible.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="3" bsr="62" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="3" bsr="62" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="10"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="9"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" TTI="500"/>
      </tapa.send>

      # Now grant is expected only for second UE.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Remaining allocations for second UE made here.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.30
#
#       Desc:   "To verify that contention resolution is accorded higher
#                priority over signaling."
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.30">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify that contention resolution is accorded higher
         priority over signaling."
         "Successful scenario of C-RNTI based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "To verify that contention resolution is accorded higher
         priority over signaling."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulSchdType="1"/>

      # UE Configuration
      <tapa.rg.2UeInit/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3"
            lcType="4" ulQci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3"
               lcType="4" ulQci="5" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            # This tmp crnti would get updated in ueId="2", since ueId="1" is
            # the last one being used.
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect confirmation for Logical channel configuration
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.

      # However, meanwhile let us start SR + allocation cycle for the
      # other UE.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="2" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat sduSize="20" crnti="0" ueId="2" addCrnti="TRUE"/>
            <tapa.tfu.dat use="3" ueId="1" addShortBsr="TRUE"
               lcgId="0" bsr="35" lcId="1"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expset>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="1"/>
      </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>


      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Remaining allocation for second UE
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>      

      # Need not finished the flow. End TC here.

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.31
#
#       Desc:    "Verify that UE is scheduled upto its configured bit rate,
#                 which is refreshed after refresh time.
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that UE is scheduled upto its configured bit rate,
          which is refreshed after refresh time.
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE is scheduled upto its configured bit rate,
          which is refreshed after refresh time.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1"/>

      # UEs Creation
      <tapa.rg.UeInit ueBr="620" ueCatEnum="CM_LTE_UE_CAT_4" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="3" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="1" lcId="3" qci="3" gbr="2000" mbr="2100"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="1" bsr="30" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <!--  
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
     <!-- 
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     -->
      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
   
     <!-- 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="4" ueId="0" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
     -->
      # Separated TTI processing for DL and UL.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="280"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # End TC here

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.32
#
#       Desc:   PFS behaviour with two UEs in uplink
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.32">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure two UEs with same PFS priorities and ueBR. Send the BSR for 
          both UEs (with high BSR index value such as 20-25) in SF N so that all 
          the grant to one UE cannot be accommodated in one TTI. 
          Verify if only UE1 is scheduled the complete bandwidth in SF N+1. 
          Then in SF N+2 UE2 is being getting scheduled, followed by UE1 getting 
          scheduled at N+3 and UE2 at N+4. And so on."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 and 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 and 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="1" bsr="30" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="1" bsr="30" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="3"/>
      </tapa.expset>

     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

 
#
#
#       Test:    14.33
#
#       Desc:   PFS behaviour with three UEs in uplink
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.33">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure three UEs with same PFS priorities and ueBR. Send the BSR for 
          all the UEs (with high BSR index value such as 20-25) in SF N so that all 
          the grant to one UE cannot be accommodated in one TTI. 
          Verify if only UE1 is scheduled the complete bandwidth in SF N+1. 
          Then in SF N+2 UE2 is being getting scheduled, followed by UE3 getting 
          scheduled at N+3 and UE1 at N+4. And so on."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1" maxUePerDlSf="4" 
         numSubbands="3" maxUlUeNewTxPerTti="5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="3" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="3" numRaReq="3" rapIds="1:2:3" timingAdvs="3:3:3" 
            tpcs="1:1:1" cqiPres="TRUE:TRUE:TRUE" cqis="4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" rapIds="1:2:3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="3">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
            <tapa.tfu.msg3.recp.req ueId="2"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="3" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="2"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
      </tapa.expset>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"  ueId="0"/>
      </tapa.send>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"  ueId="1"/>
      </tapa.send>
      
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"  ueId="2"/>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>
   
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>
   
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>
   
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>
   
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="3">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
     </tapa.tfu.cntrl.req>
   # Expect Msg4 from MAC to PHY.
     <tapa.tfu.dat.req datReqs="3">
        <tapa.tfu.pdsch.dat.req saveTo="4" use="1" ueId="0" chkCcchSh="TRUE"/>
        <tapa.tfu.pdsch.dat.req saveTo="5" use="2" ueId="1" chkCcchSh="TRUE"/>
        <tapa.tfu.pdsch.dat.req saveTo="6" use="3" ueId="2" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" op="RG_ACC_PLUS" numTfuDelta="1"/>
   </tapa.send>
   
   <tapa.expset>
     <tapa.tfu.recp.req numRntis="4">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
     </tapa.tfu.recp.req>   
  </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="3">
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="2"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueBr="6000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" prdBsrTmr="65535"/>
   </tapa.send>

   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" ueBr="6000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" prdBsrTmr="65535"/>
   </tapa.send>
   
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" ueBr="5000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" prdBsrTmr="65535"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5" ueId="0"/>
      <tapa.rgr.cfgCfm instId="5" ueId="1"/>
      <tapa.rgr.cfgCfm instId="5" ueId="2"/>
   </tapa.expset>
  
      # Configure LCG 1 and 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>
      
      # Configure LCG 1 at MAC (not scheduler) for UE 2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 and 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="6" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="6" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
      
      # Configure LCG 1 for UE 2 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="6" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
            <tapa.tfu.sr ueId="2"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="4"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="5"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE"
               saveTo="6"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="3">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="3">
            <tapa.tfu.dat use="4" ueId="0" addShortBsr="TRUE"
               lcgId="1" bsr="25" lcId="3"/>
            <tapa.tfu.dat use="5" ueId="1" addShortBsr="TRUE"
               lcgId="1" bsr="25" lcId="3"/>
            <tapa.tfu.dat use="6" ueId="2" addShortBsr="TRUE"
               lcgId="1" bsr="35" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="2" numLch="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      # Expect dci format 0 and do basic validations of the grant for UE2
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="4" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="5" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expset>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE2
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="6" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
    </tapa.expset>
    
    <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0
      <tapa.expset>
      <!--
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     -->
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
    </tapa.expset>
    
    <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0
      <tapa.expset>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req ueId="2" use="4" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
    </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.34
#
#       Desc:   PFS behaviour with two UEs in uplink
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.34">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure two UEs with same PFS priorities and ueBR. Send the BSR for both 
          UEs (with a value of BSR index value such as grant can be satisfied in one SF for both UEs) 
          in SF N so that all the grant for both UEs can be accommodated in one TTI. 
          Verify that both UE1 and UE2 are scheduled in SF N+1. 
          Then in SF N+2 verify that again both UEs are getting scheduled. And so on for 3-4 TTIs"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="25" ulSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit ueBr="4000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 and 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 and 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="1" bsr="20" lcId="3"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="1" bsr="20" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0 and UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0 and UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="4" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

 
#
#
#       Test:    14.35
#
#       Desc:   PFS behaviour with three UEs in uplink
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Configure three UEs with same PFS priorities and ueBR, Send the BSR for two 
         UEs such that the grant for them can be satisfied in one SF and BSR for 3rd UE 
         such that it can't be satisfied in one SF. Verify that in SF N+1 UE1 and UE2 
         are being given the UL grant, and then in SF N+1 UE3 is being given the grant (completely). 
         Following by UE1 and UE2 again being given the grant in SF N+2 and then UE3 in N+3"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="16" ulSchdType="1" maxUePerDlSf="4" 
          numSubbands="3" maxUlUeNewTxPerTti="5" size="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="3" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="3" numRaReq="3" rapIds="1:2:3" timingAdvs="3:3:3" 
            tpcs="1:1:1" cqiPres="TRUE:TRUE:TRUE" cqis="4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" rapIds="1:2:3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="3">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
            <tapa.tfu.msg3.recp.req ueId="2"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="3" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="2"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
      </tapa.expset>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"  ueId="0"/>
      </tapa.send>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"  ueId="1"/>
      </tapa.send>
      
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"  ueId="2"/>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>
   
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>
   
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>
   
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>
   
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="3">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
     </tapa.tfu.cntrl.req>
   # Expect Msg4 from MAC to PHY.
     <tapa.tfu.dat.req datReqs="3">
        <tapa.tfu.pdsch.dat.req saveTo="4" use="1" ueId="0" chkCcchSh="TRUE"/>
        <tapa.tfu.pdsch.dat.req saveTo="5" use="2" ueId="1" chkCcchSh="TRUE"/>
        <tapa.tfu.pdsch.dat.req saveTo="6" use="3" ueId="2" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" op="RG_ACC_PLUS" numTfuDelta="1"/>
   </tapa.send>
   
   <tapa.expset>
     <tapa.tfu.recp.req numRntis="4">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
     </tapa.tfu.recp.req>   
  </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="3">
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="2"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>
   
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2" />
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" ueBr="3000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" prdBsrTmr="65535"/>
   </tapa.send>

   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" ueBr="3000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" prdBsrTmr="65535"/>
   </tapa.send>
   
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" ueBr="3000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="25" prdBsrTmr="65535"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5" ueId="0"/>
      <tapa.rgr.cfgCfm instId="5" ueId="1"/>
      <tapa.rgr.cfgCfm instId="5" ueId="2"/>
   </tapa.expset>
  
      # Configure LCG 1 and 3 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>
      
      # Configure LCG 1 at MAC (not scheduler) for UE 2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 and 3 for UE 0 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Configure LCG 1 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
      
      # Configure LCG 1 for UE 2 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
            <tapa.tfu.sr ueId="2"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="4"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="5"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE"
               saveTo="6"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="3">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="3">
            <tapa.tfu.dat use="4" ueId="0" addShortBsr="TRUE"
               lcgId="1" bsr="23" lcId="3"/>
            <tapa.tfu.dat use="5" ueId="1" addShortBsr="TRUE"
               lcgId="1" bsr="22" lcId="3"/>
            <tapa.tfu.dat use="6" ueId="2" addShortBsr="TRUE"
               lcgId="1" bsr="21" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="2" numLch="1" lchTb1Data="3"/>
      </tapa.expset>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="4" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   <!--   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect dci format 0 and do basic validations of the grant for UE0 and UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect dci format 0 and do basic validations of the grant for UE0 and UE1
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="8" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="9" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="10" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE2
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="7" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="5" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant for UE2
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="7" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="5" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
     <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Expect dci format 0 and do basic validations of the grant for UE2
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="2" vldtDatRecp="TRUE"
               saveTo="11"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE"
               saveTo="12"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="4" vldtDatRecp="TRUE"
               saveTo="13"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE"
               saveTo="11"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"
               saveTo="12"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="7" vldtDatRecp="TRUE"
               saveTo="13"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="8" vldtDatRecp="TRUE"
               saveTo="11"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="9" vldtDatRecp="TRUE"
               saveTo="12"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="10" vldtDatRecp="TRUE"
               saveTo="13"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

     <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
     # Expect dci format 0 and do basic validations of the grant for UE2
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="7" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="5" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.36
#
#       Desc:   "PFS behaviour as RR when priority is same"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "PFS behaviour as RR when priority is same"
      </tapa.desc>

      <tapa.longdesc>
         "Configure two UEs. Send the BO for both UEs (with a value of BO such that value
          can be satisfied in one SF for both UEs) in SF N so that all the 
          BO for both UEs can be accommodated in one TTI. Verify that both UE1 and UE2 
          are scheduled in SF N+1. Then in SF N+2 verify that again both UEs are getting 
          scheduled. And so on for 3-4 TTIs"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="100" maxDlBwPerUe="100" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (GBR) UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="4"
            lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (GBR) UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" dlQci="4"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="40"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="40"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>
     
      # Send data corresponding to staInds.
      # Also, now send more BO updates, so that the lower
      # priority LC also has some BO.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="1" lcId="3"/>
      </tapa.send>
     
      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="40"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="40"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"/>
      </tapa.expset>
     
      # Send data corresponding to staInds.
      # Also, now send more BO updates, so that the lower
      # priority LC also has some BO.
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="1" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="4"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0" use="3" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="1" use="4" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.37
#
#       Desc:   "To verify if the retransmission allocation if failing for
#                  particular HARQ process continously the release the HARQ 
#                  process and removed the node from the retransmission list"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To verify if the retransmission allocation if failing for
      particular HARQ process continously the release the HARQ 
      process and removed the node from the retransmission list"
      </tapa.desc>

      <tapa.longdesc>
      "To verify if the retransmission allocation if failing for
      particular HARQ process continously the release the HARQ 
      process and removed the node from the retransmission list"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="15" maxDlBwPerUe="10" maxDlRetxBw="10"
         dlSchdType="1" raWinSize="5"/>

      # UEs Creation
      <tapa.rg.UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a GBR DTCH at MAC (not scheduler) for UE 0
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0"
            dir="3" lcType="4"/>
      </tapa.send>

            # Configure GBR DTCH (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="1" instId="5"/>
      </tapa.send>

            # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Set good CQIs intially (later we worsen it so that
      # the two retx procs cannot go toghether)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send BOs. Note that BOs should be sent such
      # that they are completely satisfied without
      # leaving a lot of buffer in the bandwidth.
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for both DCCH and DTCH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="1" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="2" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="1" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="2" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="4" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="5" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="6" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
       <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="7" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req/>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="6" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
        <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req/>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="7" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
           
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req/>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" rapIds="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req/>
        <tapa.tfu.cntrl.req/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg002.301 ccpu00109543 MOD
#
#
#       Test:    14.38
#
#       Desc:    To verify successful UE reset for UEs pending with
#       transmissions or re-transmissions through 2 UE scenario.
#
#       Notes:   None
#              
#       Module:  "PFS Module"
#
#       File:    rgac_tc13.xml
#
#
<tapa.testcase id="14.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful UE reset for UEs pending with transmissions or
         re-transmissions through 2 UE scenario.
      </tapa.desc>

      <tapa.longdesc>
         To verify successful UE reset for UEs pending with transmissions or
         re-transmissions through 2 UE scenario.
      </tapa.longdesc>

   </tapa.doc>
   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="50" dlSchdType="1" maxDlBwPerUe="25" 
         maxDlRetxBw="25" ulSchdType="1"/>

      # UE Creation with periodic mode 1-0
      <tapa.rg.UeInit ueId="0" ueCatEnum="1" 
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"
         dlAmbr="15000"/>
      <tapa.rg.UeInit ueId="1" ueCatEnum="1"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated logical channel (DTCH) for the UE1  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure an non-ambr dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>
      
      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>
      
      # Configure a Non-GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 7 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="7" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      <tapa.send>
         # Send BO for the DCCH on RGU for UE1 
         <tapa.rgu.dstarsp ueId="0" lcId="1" lcType="5" bo="800"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="580"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="4" bo="540"/>
      </tapa.send>
      
      # Send CQI indication for periodic mode 1-0 for UE1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI indication for periodic mode 1-0 for UE2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="TRUE" cqiMode="0" cqiIdx="8"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send UE Reset Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Reset Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5"  cellId="3" ueId="0"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # Send TTI to Scheduler
      # Expect staInd for UE2
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      

      <tapa.expect>
        # Now DTCH of UE2 shall get scheduled
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="3" />
      </tapa.expect>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="3,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send a TTI to get the PDCCH for UE2
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1" use="1" saveTo="2" validate="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 3 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
      # Send UE Reset Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Reset Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5"  cellId="3" ueId="1"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # Send TTIs to Scheduler
      # No other pending data is expected
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    14.39
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority  are satisfied first considering 
#                their PDB time in the stack. If both have same 
#                OPAT delay time then higher PfsPrio should be 
#                scheduled first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.39">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
         higher priority  are satisfied first considering
         their PDB"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
         higher priority  are satisfied first considering
         their PDB"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35"
           maxDlUeNewTxPerTti="1" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
             lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
             lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>


      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="250"
            oldestSduDelay="10"  />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="250"
            oldestSduDelay="10" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC only for Higher Prio LC
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expect>

      # Send data corresponding to staInd
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>    
      # Expect staInd from MAC now for Lower Prio LC
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>    
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.40
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority  are satisfied first considering 
#                their PDB time in the stack. If Svc#1 has higher priority
#                but lower OPAT delay then Svc#2 with lower priority but 
#                higher OPAT delay time thus higher PfsPrio should be 
#                scheduled first"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.40">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
         higher PDB  are satisfied first "
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
         higher PDB  are satisfied first "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="35" maxDlBwPerUe="35"
           maxDlUeNewTxPerTti="1" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
             lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="7"
             lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="250"
            oldestSduDelay="260" opatStatus ="1" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="250"
            oldestSduDelay="10" opatStatus ="1" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC only for LC whose PDB is higher
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expect>

      # Send data corresponding to staInd
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>    
      # Expect staInd from MAC now for LC whose PDB is lower than other
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>

      <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>    
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.41
#
#       Desc:   "Verify that, among AMBR channels, channels with
#                higher priority (lower priority value) are
#                satisfied first and if the BO is not satisfied in
#                one go then the PDB pivot for the same LC is moved
#                to the next level thus treating the higher priority
#                LC with the corresponding PDB weight's effective priority"
#
#       Notes:   None
#
#       Module:  "PFS"
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="14.41">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that, among AMBR channels, channels with
          higher priority (lower priority value) are
          satisfied first"
      </tapa.longdesc>

   </tapa.doc>
# Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
	      <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit  dlTotalBw="100" maxDlBwPerUe="100" dlSchdType="1"/>

      # UEs Creation
      <tapa.rg.2UeInit/>

   </tapa.cfg>
# Test Steps subsection
   <tapa.test>

 # Configure a DTCH at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure a DTCH at MAC (not scheduler) for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1"
            dir="3" lcType="4"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 4 (QCI 7) for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" dlQci="7"
            lcType="4" instId="5"/>
      </tapa.send>

      # Configure DTCH (AMBR) with priority 5 (QCI 8) for UE 1 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" dlQci="8"
            lcType="4" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
 # Expect the successful confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send enough BO for lower priority channel first,
      # and then for the higher priority one
      # (Actually, any order is ok. But this order
      # tends to be better for testing.)
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="10000"
            oldestSduDelay="25" opatStatus ="1" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="10000"
            oldestSduDelay="69" opatStatus ="1" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1" TTI="TEST0"/>
      </tapa.send>

      # Expect staInds from MAC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
      </tapa.expset>
      # Send data corresponding to staInds
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="4" ueId="1" lcId="4"/>
      </tapa.send>
     
      # Expect staInds from MAC
      # Send data corresponding to staInds
      <tapa.send>
           <tapa.rgu.ddatreq lchTb1Data="3" ueId="0" lcId="3"/>
      </tapa.send>

 	    <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

	    <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel which did not have BO satisifed
         # completely last time.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
	
 	    <tapa.send>
         # Send DL_DELTA(3) - TFU_DELTA(2) Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

	    <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
         # Scheduler meanwhile would have scheduled for the lower
         # priority channel which did not have BO satisifed
         # completely last time.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    14.42
#
#       Desc:    "Verify that data rate is limited to MBR and
#                  then AMBR is served"
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.42">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that data rate is limited to MBR and then 
         UE with AMBR is given priority"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that data rate is limited to MBR and 
          then UE with AMBR is given priority"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="100" ulSchdType="1" maxUlUeNewTxPerTti="2"
      ulThroughputFactor="0" ulFairnessFactor="0"/>

      # UEs Creation
      <tapa.rg.2UeInit ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      #configer lch lcId 5 with lcg 3 (Ambr) for UE 0 at mac
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="5"
            lcType="4" dir="2"/>
      </tapa.send>

      #configer lch lcId 4 with lcg 2 (gbr) for UE 1 at mac
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcgId="2" lcId="4"
            lcType="4" dir="3"/>
      </tapa.send>

      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5" qci="9"/>
      </tapa.send>

      # Configure LCG 2 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="2" dir="3"
               lcType="4" ulQci="6" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="2" instId="5" qci="4" 
         gbr="1132" mbr="2127"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" addShortBsr="TRUE"
               lcgId="3" bsr="30" lcId="5"/>
            <tapa.tfu.dat use="4" ueId="1" addShortBsr="TRUE"
               lcgId="2" bsr="23" lcId="4"/>
         </tapa.tfu.dat.ind>
      </tapa.send>


      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="5"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.pusch.recp.req ueId="0" vldtDatRecp="TRUE"
               saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" vldtDatRecp="TRUE"
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send a 3 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH 
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat use="3" ueId="0" lcId="5" lcgId="3" addShortBsr="TRUE" bsr="40"/>
            <tapa.tfu.dat use="4" ueId="1" lcId="4" lcgId="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="1" lchTb1Data="5"/>
         <tapa.rgu.ddatind ueId="1" numLch="1" lchTb1Data="4"/>
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
    -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    14.43
#
#       Desc:    "Verify that data rate is limited to MBR and
#                  then AMBR is served among LCGs within a UE"
#
#       Notes:   None
#              
#       Module:  "PFS"
#
#       File:    rgac_tc14.xml
#
#
<tapa.testcase id="14.43">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that data rate is limited to MBR and
                  then AMBR is served among LCGs within a UE"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that data rate is limited to MBR and
                  then AMBR is served among LCGs within a UE"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="100" ulSchdType="1" maxUlUeNewTxPerTti="2"
      ulThroughputFactor="0" ulFairnessFactor="0"/>

      # UEs Creation
      <tapa.rg.2UeInit ueBr="20000" ueCatEnum="CM_LTE_UE_CAT_5"
         maxUlBwPerUe="100"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      #configer lch lcId 5 with lcg 3 (Ambr) for UE 0 at mac
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="3" lcId="5"
            lcType="4" dir="2"/>
      </tapa.send>

      #configer lch lcId 4 with lcg 2 (gbr) for UE 1 at mac
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="2" lcId="4"
            lcType="4" dir="3"/>
      </tapa.send>

      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="3" dir="3"
               lcType="4" ulQci="9" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instId="5" qci="9"/>
      </tapa.send>

      # Configure LCG 2 for UE 1 (RGR)
      <tapa.send>
      <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="2" dir="3"
               lcType="4" ulQci="6" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="2" instId="5" qci="4" 
         gbr="1132" mbr="2127"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" lcgId="2" addLongBsr="TRUE" bsr2="28" bsr3="15"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" addLongBsr="TRUE"
               lcgId="2" bsr3="15" lcIds="4:5"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="2" lchTb1Data="4:5" />
      </tapa.expset>

     <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     -->
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"
               saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs: (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>




      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>





      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="3" ueId="0" addLongBsr="TRUE"
               lcgId="3" bsr3="15" lcIds="4:5"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" numLch="2" lchTb1Data="5:4"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect dci format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#/********************************************************************30**
#
#         End of file:     rgac_tc14.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#/main/1      ---     sm   1. Initial Release.
#$SID$         ---     sm   1. Initial Release.
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg002.301 asehgal 1.ccpu00109543 changes
#$SID$        ---     2.ccpu00120621:made changes to priorites of qci. 
#$SID$      ---        rt  1. LTE MAC 4.1 Release
#*********************************************************************91*/
