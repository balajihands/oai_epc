#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases For Layer Manager
#
#     File:    rgac_tc17.xml
#
#     Sid:      rgac_tc17.xml@@/main/2 - Fri Dec 25 00:18:39 2009
#
#     Prg:     ns 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:hn:rgac_tc1.xml

#
#
#       Test:    17.1
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.1">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send DStaRsp with non-zero BO from RGU to MAC.
          3. Verify Transmit Diversity is the TX Scheme selected
             by MAC for scheduling this BO.
          4. Send CQI report from PHY with RI=2. 
          5. Send non-zero BO.
          6. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing with precInfo=0."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="150"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 To ensure TD as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="250"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3  and precInfo=2 To ensure SpaMux as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.2
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE with subsequent retx of both TB1 and TB2.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.2">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE with subsequent retx of TB1 and TB2." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Expect RETX for both the TBs with precInfo = 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTEMAC_RGU_PAD"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="60"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.3
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE with subsequent retx of both TB1 and TB2.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.3">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE with subsequent retx of TB1 and TB2." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Expect RETX for both the TBs with precInfo = 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"  lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                          vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                       vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Format2A, mode=3 and precInfo=1 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9"  chkSdu="FALSE" 
            transMode="TFU_UE_TM_3" isTb1="FALSE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                          isTb1Pres="FALSE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
                           isChkPmi ="TRUE" chkPmi="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.4
#
#       Desc:    Validation of UE Transmission mode with the 
#                Cell Number of Antenna Ports.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.4">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation of UE Transmission mode with the 
          Cell Number of Antenna Ports" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Configure a Cell with 1 Tranmit Antenna Port 
          3. Validate UE Transmission mode with Cell Transmit Antenna
             Ports.
          4. Transmission mode 1 is allowed iff number of antenna ports is 1
             and modes 2,3,4,5,6 are not allowed if no. of antenna ports is
             equal to 1
          5. Mode 7 can support single Antenna port or multiple antenna ports."
 
       </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="1"/>

      #Finish RACH 
      <tapa.rg.rach.grp16/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

         # Send UE config request
         <tapa.send>
            <tapa.crg.cfgreq.cfg.ue  tm="CRG_UE_TM_3"/>
         </tapa.send>

         # Expect success in cfg cfm
         <tapa.expect>
            <tapa.crg.cfgcfm/>
         </tapa.expect>

         # Send UE config request
         <tapa.send>
           <tapa.rgr.cfgreq.cfg.ue instId="5" txModeEnum="RGR_UE_TM_3"/>
         </tapa.send>


         # Send TTI to apply the config
         <tapa.send>
            <tapa.tfu.tti.ind/>
         </tapa.send>

         # Expect success in cfg cfm
         # Expect status = 15 because UE TM 3 doesn't support
         # if Cell Tx Antenna ports = 1 
         <tapa.expect>
            <tapa.rgr.cfgCfm instId="5" status="15"/>
         </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.5
#
#       Desc:    To test the MAC whether it supports TM2 or not.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.5">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC whether it supports TM2 or not." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM2.
          2. Configure a Cell with 4 Tx Antenna
          3. Send CQI Report from the UE.
          4. Schedule the UE.
          6. Expect DCI Format 1A in PDCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_2" tm="CRG_UE_TM_2"/> 

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with CQI = 9
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="9"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=2 Transmit diversity as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_2" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                                     isTb1Pres="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format1A, mode=2 TD as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_2" isTb1="TRUE"/> 
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                                     isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1  
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.6
#
#       Desc:    To test the MAC whether it supports TM3 or not.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC whether it supports TM3 or not." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Configure a Cell with 4 Tx Antenna
          3. Send RI Report = 4 from the UE using PUCCH mode(2-0).
          4. Schedule the UE.
          5. Expect Two TB's in PDSCH
          6. Expect DCI Format 2A in PDCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="2" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 OLSM as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" 
              isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.7
#
#       Desc:    To verify the MAC Shall support Transmit Diversity Scheme
#                using format 1A, apart from the Transmision mode specific 
#                DCI Format.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To verify the MAC Shall support Transmit Diversity Scheme using
           format 1A, apart from the Transmision mode specific DCI Format." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Configure a Cell with 2 Tx Antenna
          3. Send RI Report = 1 from the UE using PUCCH mode(2-0).
          4. Schedule the UE.
          5. Expect One TB in PDSCH
          6. Expect DCI Format 1A in PDCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=1
      # Send CQI indication for periodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="2" riIdx="1"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 OLSM using Transmit Diversity as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3"  />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                             isTb1Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    17.8
#
#       Desc:    To verify that - for no rank or rank = 1 is reported from
#                the UE, It should transmit using Transmit diversity
#                Also verify that ReTx of TB2 is alwyas using DCI Format 2A
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "  To verify that - for no rank or rank = 1 is reported from
            the UE, It should transmit using Transmit diversity
            Also verify that ReTx of TB2 is alwyas using DCI Format 2A"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Configure a Cell with 4 Tx Antenna
          3. Send RI Report and CQI from the UE using PUSCH mode(2-0).
          4. Schedule the UE.
          5. Expect TB1 and TB2 in PDSCH and DCI 2A in PDCCH
          6. Report Feedback for TB1 and TB2 and RI from the UE
          7. Expect TB2 in PDSCH using DCI Format 2A in PDCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"
                             ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4 and CQI = 10
      # Send CQI indication for Aperiodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE"
               ri="4" cqiMode="1" wbCqi="11" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst = "3:3:3:3:2" 
             cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"
            lchTb2Data="9" numLchTb2="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 OLSM as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                             isTb1Pres="TRUE" isTb2Pres="TRUE"
                             vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      # Send CQI report with RI=1
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="1"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=0 SpaMux using Transmit Diversity 
      # as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" chkSdu="FALSE"
            transMode="TFU_UE_TM_3" isTb1="FALSE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                              isTb1Pres="FALSE" isTb2Pres="TRUE"
                              isChkPmi ="TRUE" chkPmi="0" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>     
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.9
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-4 UE with retx of both TB1 and TB2.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.9">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-4 UE with retx of TB1 and TB2." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Expect RETX for both the TBs with precInfo according to latest
             Aperiodic report"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2, mode=4 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.10
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-4 UE with ReTx of TB1 and New Tx of TB2.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.10">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-4 UE with Retx of TB1 and new Tx of TB2." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for TB1 and ACK for TB2
          6. Expect RETX of TB2 along with New Tx TB1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb2Data="9" saveTo="3" numLchTb2="1" numLchTb1="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb2="1" lchTb2Data="9" lcType="5" numLchTb1="0"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect Format2, mode=4 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"  
                              vldCWSwapFlag="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.11
#
#       Desc:    Validation of PMI.
#                Incase of Precoding Information Signalling to a UE is implicit
#                then MAC Scheduler Shall explicitely inform the PHY layer as to 
#                what are the sub band and PMI mappings.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation of PMI.
          Incase of Precoding Information Signalling to a UE is implicit
          then MAC Scheduler Shall explicitely inform the PHY layer (In PDSCH) 
          as to what are the sub band and PMI mappings" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Feedback report using Aperiodic mode 3 - 1 
             and RI=4 from the TFU Interface. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4, pmi = 50 and PUSCHMODE = MODE31 in pusch  
      # SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"
              vldPuschPmiInfo="TRUE" puschMode="TFU_PUSCH_CQI_MODE_31"
              vldPuschRptUsd="TRUE" puschRptUsd="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.12
#
#       Desc:    Validate that Rank of Transmission is less than
#                the reported rank.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.12">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Rank of transmission is less than the
          Reported rank." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Aperiodeic Feedback. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for 1TB and ACK for another TB.
             and Report Periodic Feedback RI =4.
          6. Expect RETX of 1TB using 2 Layer"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="1" riIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2, mode=4 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcIdTb2="9" chkSduTb2="TRUE"
            transMode="TFU_UE_TM_4" isTb1="FALSE" isTb2="TRUE" chkSdu="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="FALSE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1  
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.13
#
#       Desc:    Validate that New transmission of the single codeword 
#                mapped to twolayers shall not be permitted incase of 
#                TM3 and TM4.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that New transmission of the single codeword mapped to
         twolayers shall not be permitted incase of TM3 and TM4."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Aperiodeic Feedback. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for 1TB and ACK for another TB.
             and Report Periodic F/B RI = 2.
          6. Expect Prcoding Info range 18 to 34. 
             This range is used for ReTx of 1TB on 2 Layers  "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="1" riIdx="2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2, mode=4 and PMI = 28 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" chkSdu="FALSE"
            transMode="TFU_UE_TM_4" isTb1="FALSE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="FALSE" isTb2Pres="TRUE" vldtRetx="TRUE"
              isChkPmi="TRUE" chkPmi="28"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1  
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.14
#
#       Desc:    Validate that The Transmission PMI choosen shall be based on  
#                the Reported PMI(aperiodic) such that the single column of choosen 
#                precoder appears in the reported precoder when rank of 
#                Tx = 1 and reported rank = 2 in case of TM4
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that The Transmission PMI choosen shall be based on  
          the Reported PMI(aperiodic) such that the single column of choosen 
          precoder appears in the reported precoder when rank of 
          Tx = 1 and reported rank = 2 in case of TM4"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Aperiodeic Feedback. 
          3. Send non-zero BO.
          4. Verify that both TBs are scheduled and that lcId=9 is
             accomodated in TB1 itself as BO was very low.
          5. HqFdbk as NACK for TB1 and ACK for TB2.
          6. Verify TB1 RETX scheduling using TX scheme as Spatial 
             Multiplexing.
          7. Verify that for single layer retransmission of TB1, the precoding
             info shall be according to the single column of reported PMI
             corresponding to a better CW (good Cqi in this case). Hence verify
             that precInfo to be 5.
          8. Re-execute the same steps by swapping the CW cqis.
             verify that Precoding Info recieved is 6.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTEMAC_RGU_PAD"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   #ccpu00120365-ADD-disabling this test case as design 
   #has changed and therefore this test case is no longer
   #valid.
      <!--
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
      # Send CQI report with RI=2
      # Send CQI indication for Aperiodic mode 2-2
      #ccpu00118150 changed pmi =1 from 2 since we have to pass valid pmi value
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="15" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmi ="1"
               cqiTb0="10"  cqiTb1="10" wbPmi="1"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="2" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"  isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Format2A, mode=3 and precInfo=1 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="FALSE" isChkPmi="TRUE" chkPmi="5" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # reexecute the same steps by swapping the CW cqis.
      # verify that Precoding Info recieved is 6.
      # Send CQI report with RI=2
      # Send CQI indication for Aperiodic mode 2-2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="12" wbCqiTb1="15" numRbLst = "3:3:3:3:2" pmi ="2"
               cqiTb0="10"  cqiTb1="10" wbPmi="2"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="2" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"  isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Format2A, mode=3 and precInfo=1 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="FALSE" isChkPmi="TRUE" chkPmi="6" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.15
#
#       Desc:    Validate that The Transmission PMI(periodic report) shall choose the 
#                column of the Precoding matrix corresponding to the better
#                CQI Codeword, when having to determine which column to use 
#                from reported two layer precoder when using single layer 
#                transmission incase of TM4.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.15">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " Validate that The Transmission PMI(periodic report) shall choose the 
           column of the Precoding matrix corresponding to the better
           CQI Codeword, when having to determine which column to use 
           from reported two layer precoder when using single layer 
           transmission incase of TM4."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Aperiodeic Feedback. 
          3. Send non-zero BO.
          4. Verify that both TBs are scheduled and that lcId=9 is
             accomodated in TB1 itself as BO was very low.
          5. HqFdbk as NACK for TB1 and ACK for TB2.
          6. Verify TB1 RETX scheduling using TX scheme as Spatial 
             Multiplexing.
          7. Verify that for single layer retransmission of TB1, the precoding
             info shall be according to the single column of reported PMI
             corresponding to a better CW (good Cqi in this case). Hence verify
             that precInfo to be 4.
          8. Re-execute the same steps by swapping the CW cqis.
             verify that Precoding Info recieved is 3.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTEMAC_RGU_PAD"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   <!--
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
      # Send CQI report with RI=2
      # Send CQI indication for Aperiodic mode 2-2
      #ccpu00118150 changed pmi =1 from 2 since we have to pass valid pmi value
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="15" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmi ="1"
               cqiTb0="10"  cqiTb1="10" wbPmi="1"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      # Send CQI indication for periodic mode 1-1
      # verify that upon reception of this periodic report
      # Scheduler shall not indicate "Use the previously reported PMIs.."
      # in pdcch's precoding information.
      # As per this report CW2(cqi=12) is better than CW1(cqi=10)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="10" wideDiffCqiPres="1" wideDiffCqiVal="6"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="1" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"  isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Format2A, mode=3 and precInfo=1 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="FALSE" isChkPmi="TRUE" chkPmi="4" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # reexecute the same steps by swapping the CW cqis.
      # verify that Precoding Info recieved is 4.
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="12" wideDiffCqiPres="1" wideDiffCqiVal="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="1" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"  isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Format2A, mode=3 and precInfo=1 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="FALSE" isChkPmi="TRUE" chkPmi="3" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
   -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.16
#
#       Desc:    Validate that the TB size determination according 
#                to section 7.1.7.2.2 of 36.213.
#                Also validate that whether it supports Transmission Mode 4(CLSP)
#                with maximum TB Size or not 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.16">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that the TB size determination according 
          to section 7.1.7.2.2 of 36.213
          Also validate that whether it supports Transmission Mode 4(CLSP)
          with maximum TB Size or not "
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Aperiodeic Feedback. 
          3. Send BO with Max Size .
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
             And also TB Sizes are according to 7.1.7.2.2 of 36.213.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" dlTotalBw="110" maxDlBwPerUe="110"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 2-2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="15" wbCqiTb1="15" numRbLst = "3:3:3:3:2" pmi ="10"
               cqiTb0="10"  cqiTb1="10" wbPmi="10"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      # Maximum Number DL-SCH transport block bits received with in a TTI = 299552
      # (299552-120)/8 = 37429 bytes [120 bits for RLC header]
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="2529"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" vldtDciFmt="TRUE" 
              expDciFmt="5" numTb1Lyrs="2" numTb2Lyrs="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="5" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="50" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#       Test:    17.17
#
#       Desc:    Validate that MAC Shall consider CQI/PMI/RI report
#                as valid starting from the point of reception of this 
#                report till the reception of a subsequent periodic/
#                aperiodic report
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "MAC shall consider Ues aperiodic CQI/PMI/RI report as valid
         starting from the point of reception of this report till the
         reception of a subsequent periodic/aperiodic report."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send APeriodic Feedback. 
          3. Send non-zero BO.
          4. Verify 2TB scheduling using TX scheme as Spatial 
             Multiplexing and Scheduling according to reported 
             Aperiodic F/B.
          5. Send HARQ Feedback for both Code words and 
             Channel Feedback using periodic mode.
          6. Send non-zero BO
          7. Verify 2TB scheduling using TX scheme as Spatial 
             Multiplexing and Scheduling according to reported 
             periodic F/B.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 2-2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="15" numRbLst = "3:3:3:3:2" pmi ="10"
               cqiTb0="10"  cqiTb1="10" wbPmi="10"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,PMI = 50  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="50" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="10" wideDiffCqiPres="0" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="140"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"
                              numLchTb2="1" lchTb2Data="9"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"
                              numLchTb2="1" lchTb2Data="9" />
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.18
#
#       Desc:    Validation of Control information which is informed to PHY 
#                implicitely. Incase of Precoding Information Signalling to a UE
#                is implicit then MAC Scheduler Shall explicitely inform the 
#                PHY layer as to what are the sub band and PMI mappings.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.18">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation of Control information which is informed to PHY implicitely.
          Incase of Precoding Information Signalling to a UE is implicit
          then MAC Scheduler Shall explicitely inform the PHY layer (In PDSCH) 
          as to what are the sub band and PMI mappings" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Feedback report using Aperiodic mode 3 - 1 
             and RI=4 from the TFU Interface. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HarqFeedback for both the codewords
          6. Send non zero Bo
          7. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          8. Verify Control Info is informed to UE implicitely by using PDCCH
             and Control Info to PHY explicitely by using PDSCH

       </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4, pmi = 44 and PUSCHMODE = MODE31 in pusch  
      # SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"
              vldPuschPmiInfo="TRUE" puschMode="TFU_PUSCH_CQI_MODE_31"
              vldPuschRptUsd="TRUE" puschRptUsd="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     #No Control feedback Info from the UE

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4, pmi = 44 and PUSCHMODE = MODE31 in pusch  
      # SpaMux as TX Scheme 
      # DARSHAN
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"
              vldPuschPmiInfo="TRUE" puschMode="TFU_PUSCH_CQI_MODE_31"
              vldPuschRptUsd="TRUE" puschRptUsd="FALSE" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.19
#
#       Desc:    Validate that MAC Shall do reestimation of RB's
#                if there is a change in rank
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.19">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that MAC Shall do reestimation of RBs
          if there is a change in rank" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Feedback report using Aperiodic mode 3 - 1 
             and RI=4 from the TFU Interface. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HarqFeedback for both the codewords and also
             send control feedback
          6. Send non zero Bo
          7. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          8. Verify that there should be change in number of RBs
             incase of  Tx and ReTx as there change in Rank


       </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4, pmi = 44 and PUSCHMODE = MODE31 in pusch  
      # SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="3"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>     

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2, mode=4, pmi = 0 and PUSCHMODE = MODE31 in pusch  
      # SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.20
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE with subsequent retx of both TB1 and TB2
#                in adjacent TTIs.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.20">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE with subsequent retx of TB1 and TB2 in 
          adjacent TTIs." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Change the rank to 1.
          7. Expect RETX of TB1 using TD.
          8. Next TTI expect RETX of TB2 using TD"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
    
      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="1"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
   
      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format1A, TB1 RETX 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK for TB1
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE" isTb1="TRUE" isAckTb1="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #verify no more retransmissions
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.21
#
#       Desc:    Validate Imcs and RV Idx of each TB 
#                when TB is enabled and when TB is disabled
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate Imcs and RV Idx of each TB 
          when TB is enabled and when TB is disabled" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send Feedback report using Aperiodic mode 3 - 1 
             and RI=4 from the TFU Interface. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HarqFeedback for both the codewords and also
             send control feedback
          6. Verify that Imcs and Rv Idx of Retransmitting TB
             and disabled TB"
             
       </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4, pmi = 44 and PUSCHMODE = MODE31 in pusch  
      # SpaMux as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>     

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2, mode=4, pmi = 28 and PUSCHMODE = MODE31 in pusch  
      # SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" chkSdu="FALSE"
              transMode="TFU_UE_TM_4" isTb1="FALSE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
              isTb1Pres="FALSE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
              isChkPmi="TRUE" chkPmi="28" imcsTb0="0" rvTb0="1" 
              rvTb1="2" imcsTb1="19"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    17.22
#
#       Desc:    Validate the successful scheduling of 2 TX TB for rank=4
#                and then upon a rank change to 1 and BO reported,
#                verify TB1 RETX, then TB2 RETX and then a new TX using 
#                another HqProc for reported BO.
#                
#                
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate the successful scheduling of 2 TX TB for rank=4
          and then upon a rank change to 1 and BO reported,
          verify TB1 RETX, then TB2 RETX and then a new TX using 
          another HqProc for reported BO."
      </tapa.desc>

      <tapa.longdesc>
      
       </tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO for 2 LCs.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Change the rank to 1 report BO for both LCs.
          7. Expect RETX of TB1 using TD.
          8. Next TTI expect RETX of TB2 using TD
          9. Next TTI expect New TX of TB1 for newly repoted BO using TD"
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="8" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         # For the test case to work across
         # all schedulers, giv lciId 9 a lower qci than 8. This is essential
         # as sc1 scheduler adds lciId's to head of its list when it 
         # recevies DStaRsp but other schedulers add to tail. This 
         # causes validations to fail later on.
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5" dlQci="2"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="8" lcType="5" dir="1" instId="5" dlQci="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="8" lcType="5" bo="260"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="150"/>
      </tapa.send>
      
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC. Verify that lcId=8 is scheduled on Tb1
      and lcId=9 is scheduled on TB2.
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="8" saveTo="2" numLchTb1="1" numLchTb2="2"
                           lchTb2Data="8:9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="8" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="8" chkSdu="TRUE"
             lcIdTb2="9" chkSduTb2="TRUE" transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"
                isTb1="TRUE" isAckTb1="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="1"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      #Again send BO reports. Verify that this is not scheduled until the
      two retx TBs are.
      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="8" lcType="4" bo="100"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="100"/>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format1A, TB1 RETX 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="8" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"
            lcIdTb2="9"  chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE" 
                  isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         # By this time the two RETX TBs would have been already scheduled.
         <tapa.rgu.dstaind ueId="0" numLchTb1="2" lchTb1Data="8:9" />
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq  ueId="0" numLchTb1="2" lchTb1Data="8,0,1:9,0,1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="9" lcId="9" chkSdu="TRUE" transMode="TFU_UE_TM_3" ueId="0" numSdu="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #for TB1 RETX
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #for new TX
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for TB1
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
 
      #verify no more retransmissions
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.23
#
#       Desc:    To test the MAC whether it supports TM6 or not.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.23">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC whether it supports TM6 or not." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6.
          2. Configure a Cell with 4 Tx Antenna
          3. Send PMI Feedback.
          4. Schedule the UE.
          5. Expect TB in PDSCH
          6. Expect DCI Format 1B in PDCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B, mode=3 and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.24
#
#       Desc:    Validate that Latest aperiodic PUSCH report from the
#                UE is honoured till new reception
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.24">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Latest aperiodic PUSCH report from the
                UE is honoured till new reception" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6.
          2. Configure a Cell with 4 Tx Antenna
          3. Send PMI Feedback using periodic Mode.
          4. Schedule the UE.
          5. Expect a TB in PDSCH and DCI Format 1B in PDCCH
          6. Send Harq F/B and PMI F/B using Aperiodic Mode
          7. Schedule the UE
          8. Expect a TB in PDSCH and DCI Format 1B in PDCCH
          9. Send Harq Feedback and No Control F/B
          10.Schedule the UE
          11.Expect the DCI Format 1B using previous Control F/B
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5" 
            dlQci="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" 
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="1" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="0:0:0:0:0" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B and precInfo=10 CLSM - Single Layer as TX Scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="10" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
     
      #No Control F/B from the UE
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B and precInfo=10 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="10" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.25
#
#       Desc:    Valiadte that MAC shall use Transmit diversity 
#                when no PMI has been reported by UE.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " Valiadte that MAC shall use Transmit diversity
           when no PMI has been reported by UE" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6.
          2. Configure a Cell with 4 Tx Antenna
          3. Dont Send any Feedback
          4. Schedule the UE.
          5. Expect TB in PDSCH
          6. Expect DCI Format 1A in PDCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A Transmit Diversity Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" 
              isFormat1a="TRUE" isTb1Pres="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    17.26
#
#       Desc:    Validation On maximum number of layers based on 
#                UE Category
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation On maximum number of layers based on 
           UE Category."
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Configure UE with Category 2
          3. Send APeriodic Feedback RI =2. 
          4. Send non-zero BO.
          5. Verify 2TB scheduling using TX scheme as Spatial 
             Multiplexing and Scheduling according to reported 
             Aperiodic F/B.
          6. Send HARQ Feedback for both Code words and 
             Channel Feedback using periodic mode RI =4.
          7. Send non-zero BO
          8. Expect that Rank of Transmission is 2
             because of UE Category2."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_2"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 2-2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="15" numRbLst = "3:3:3:3:2" pmi ="10"
               cqiTb0="10"  cqiTb1="10" wbPmi="10"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,PMI = 50  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="16" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"
                              numLchTb2="1" lchTb2Data="9"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"
                              numLchTb2="1" lchTb2Data="9" />
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="16"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.27
#
#       Desc:    Validation On maximum number of layers based on 
#                UE Category
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.27">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation On maximum number of layers based on UE Category" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6
          2. Configure UE with Category 1
          3. Send Periodic Feedback. 
          4. Send Status Rsp with BO = 2000bytes.
          5. Expect Status Indication of BO  = 1287 bytes
             Because UE Category1 Supports max of 1287 bytes
          6. Expect a TB in PDSCH and DCI1B in PDCCH
          7. Send StaInd for the remaining byte."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" dlTotalBw="110" maxDlBwPerUe="110"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="2000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         # Expect a Staind of 1287 bytes. This is MAX Supported by UE Category1
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      # Expect Format1B, mode=3 and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>
    # Test Case end here. No further steps are required  
      
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.28
#
#       Desc:    Validate that MAC Shall request for Aperiodic reporting
#                After maximum number of Retransmissions
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.28">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that MAC Shall request for Aperiodic reporting
                After maximum number of Retransmissions" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6 and Configure MAX ReTx = 3
          2. Configure a Cell with 4 Tx Antenna
          3. Send PMI Feedback using periodic Mode.
          4. Schedule the UE.
          5. Expect a TB in PDSCH and DCI Format 1B in PDCCH
          6. Send Harq F/B as NACK 
          7. ReTx UE (ReTx1)
          8. Expect a TB in PDSCH and DCI Format 1B in PDCCH
          9. Send Harq Feedback as NACK
          10.ReTx UE (ReTx2)
          11.Expect a TB in PDSCH and DCI Format 1B in PDCCH
          12.Send Harq F/B as NACK
          13.ReTx UE (ReTx3)
          14.Expect a TB in PDSCH and DCI Format 1B in PDCCH
          15.Send SR for grant (Max ReTx are done)
          16.Expect DCI Format 0 for grant and also expect 
             CQI bit as SET in DCI 0 for requesting aperiodic feedback
          17.Send Aperiodic feedback
          18.Expect a TB in PDSCH and DCI Format 1B in PDCCH
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>  
         <tapa.flag id="DLFS_INV"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
          ueCatEnum="CM_LTE_UE_CAT_1" maxDlHqTx="3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10"
            aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="9" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
    
      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # ReTransmission 1
      # Expect Format1B and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
    
      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # ReTransmission 2
      # Expect Format1B and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
    
      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Retransmission 3
      # Expect Format1B and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
    
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      # Expect CQI Request = TRUE in DCI 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="9" vldtDatRecp="TRUE" saveTo="3"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" 
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="1" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="0:0:0:0:0" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B and precInfo=10 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="10" pmiCfm="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    17.29
#
#       Desc:   "To verify that UE with best CQI and RI value gets priority over 
#                other UEs in 4 UE scenario"
#
#       Notes:   None
#              
#       Module:  "MAX C/I Module"
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.29">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify that UE with best CQI and RI value gets priority over
         other UEs in 4 UE scenario
         Configure all UE's with Transmission Mode 4
      </tapa.desc>

      <tapa.longdesc>
         1. Configure Cell with 4Tx Antennas
         2. Configure 4 UE's with Transmission mode 3
         3. Send Aperiodic feedback (RI,CQI and PMI) for
            four UE's
         4. Send Non Zero BO for all the UE's
         5. Expect Status Indications in the order of UE's
            which having good CQI and RI value
            Here order is UE2,UE3,UE4 and UE1
         6. Expect PDCCH and PDSCH for all UE's
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="CEILLING_FIX"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="80" dlSchdType="3" maxDlBwPerUe="40"
                                       numTxAntPorts="4"/>
      # UE Creation with Aperiodic mode 2-0
      <tapa.rg.UeInit ueId="0" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit ueId="1" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit ueId="2" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit ueId="3" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE3
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="5" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE3
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="6" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>
      
      # Configure a GBR dedicated logical channel (DTCH) for the 
      # created UE with QCI = 2 for UE2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="2" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="5" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE4
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="6" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send CQI report with RI=2 and Wide band CQI = 4 for UE 0
      # Send CQI indication for Aperiodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE"
               ri="2" cqiMode="1" wbCqi="4" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst = "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=4 and wide band CQI = 12 for UE 1
      # Send CQI indication for Aperiodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="FALSE" isRiPres="TRUE"
               ri="4" cqiMode="1" wbCqi="12" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst = "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=3 and wide band CQI = 10 for UE 2
      # Send CQI indication for Aperiodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="2" isPucchInfo="FALSE" isRiPres="TRUE"
               ri="3" cqiMode="1" wbCqi="10" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst = "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=2 and wide band CQI = 8 for UE 3
      # Send CQI indication for Aperiodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="3" isPucchInfo="FALSE" isRiPres="TRUE"
               ri="2" cqiMode="1" wbCqi="8" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst = "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="4" bo="200"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE3. 
         <tapa.rgu.dstarsp ueId="2" lcId="5" lcType="4" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE3. 
         <tapa.rgu.dstarsp ueId="3" lcId="6" lcType="4" bo="200"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         # Expect Status Indications in the order of UEId 1,2,3 and 0.
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4"  numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="5" numLchTb2="1" lchTb2Data="5" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="6" numLchTb2="1" lchTb2Data="6" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3" numLchTb2="0" lchTb2Data="3" />
      </tapa.expect>

      <tapa.send>
         # Send data for UE1
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4" numLchTb2="1" lchTb2Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="5" numLchTb2="1" lchTb2Data="5"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE3
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="6" numLchTb2="1" lchTb2Data="6"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE0
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="3" numLchTb2="0" lchTb2Data="3"/>
      </tapa.send>
      
      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
   <tapa.expset>
     # Expect 4 Control requests
     <tapa.tfu.cntrl.req numCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="4" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="FALSE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
     </tapa.tfu.cntrl.req>
     # Expect 4 Dat requests
     <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="4" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="2"  use="9" lcId="5" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="1"/>
        <tapa.tfu.pdsch.dat.req ueId="3"  use="9" lcId="6" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="1" numTb2Lyrs="1"/>
        <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="3" chkSdu="TRUE"
           transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="FALSE" numTb1Lyrs="1" numTb2Lyrs="1"/>
     </tapa.tfu.dat.req>
   </tapa.expset>
   # Ending TC here: further processing not needed
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.30
#
#       Desc:   "To verify that UE with best CQI and RI value gets priority over 
#                other UEs in 4 UE scenario"
#
#       Notes:   None
#              
#       Module:  "MAX C/I Module"
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.30">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify that UE with best CQI and RI value gets priority over 
         other UEs in 4 UE scenario"
         Configure all UE's with Transmission Mode 3
      </tapa.desc>

      <tapa.longdesc>
         1. Configure Cell with 4Tx Antennas
         2. Configure 4 UE's with Transmission mode 4
         3. Send Aperiodic feedback (RI,CQI and PMI) for
            four UE's
         4. Send Non Zero BO for all the UE's
         5. Expect Status Indications in the order of UE's
            which having good CQI and RI value
            Here order is UE1,UE2,UE3 and UE4
         6. Expect PDCCH and PDSCH for all UE's
            Order of UE's = 1,2,3 and 4
         7. Send Harq F/B and Control F/B from the UE's
         8. Send Non Zero Bo for the required UE's
         9. Expect Status Indications for new Tx UE's in the 
            order of UE's which having good CQI and RI value
            Here order is UE4,UE3,UE1 and UE2
         10.Expect PDCCH and PDSCH for all the UE's
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="80" dlSchdType="3" maxDlBwPerUe="20"
                                       numTxAntPorts="4"/>
      # UE Creation with Aperiodic mode 3-1
      <tapa.rg.UeInit ueId="0" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"/>
      <tapa.rg.UeInit ueId="1" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"/>
      <tapa.rg.UeInit ueId="2" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"/>
      <tapa.rg.UeInit ueId="3" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE3
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="5" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE3
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="6" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>
      
      # Configure a GBR dedicated logical channel (DTCH) for the 
      # created UE with QCI = 2 for UE2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="2" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="5" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE4
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="6" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send CQI report with RI=4 and CQI = 10 for CW0 and CQI = 12 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=4 and CQI = 8 for CW0 and CQI = 10 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=3 and CQI = 6 for CW0 and CQI = 8 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="2" isPucchInfo="FALSE" isRiPres="TRUE" ri="3"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="6" wbCqiTb1="8" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=2 and CQI = 8 for CW0 and CQI = 8 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="3" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="8" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="4" bo="400"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE3. 
         <tapa.rgu.dstarsp ueId="2" lcId="5" lcType="4" bo="220"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE3. 
         <tapa.rgu.dstarsp ueId="3" lcId="6" lcType="4" bo="200"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="6" numLchTb2="1" lchTb2Data="6" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3"  numLchTb2="1" lchTb2Data="3"/>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4" numLchTb2="1" lchTb2Data="4" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="5" numLchTb2="1" lchTb2Data="5" />
      </tapa.expset>

      <tapa.send>
         # Send data for UE1
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="3" numLchTb2="1" lchTb2Data="3"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4" numLchTb2="1" lchTb2Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE3
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="5" numLchTb2="1" lchTb2Data="5"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE0
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="6" numLchTb2="1" lchTb2Data="6"/>
      </tapa.send>
      
      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE" ueId="0"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="44"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE" ueId="1"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="44"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE" ueId="2"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="27"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="4" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE" ueId="3"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="10"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="4" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="2"  use="3" lcId="5" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="1" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"  use="4" lcId="6" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="1" numTb2Lyrs="1"/>
     </tapa.tfu.dat.req>
  </tapa.expset>

   <tapa.send>
       # Send a 4 TTIs to get the harqrecpRequest from MAC
       <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req numRntis="4" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
        <tapa.tfu.hq.recp.req ueId="3"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
      # Send Harq F/B for 4 UE's   
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        <tapa.tfu.hq ueId="1" isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        <tapa.tfu.hq ueId="2" isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        <tapa.tfu.hq ueId="3" isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send CQI report with RI=3 and CQI = 8 for CW0 and CQI = 10 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="3"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=2 and CQI = 6 for CW0 and CQI = 8 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="6" wbCqiTb1="8" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=4 and CQI = 10 for CW0 and CQI = 10 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="2" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=4 and CQI = 14 for CW0 and CQI = 12 for CW1
      # Send CQI indication using Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="3" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="14" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="250"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="4" bo="400"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1. 
         <tapa.rgu.dstarsp ueId="2" lcId="5" lcType="4" bo="330"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2. 
         <tapa.rgu.dstarsp ueId="3" lcId="6" lcType="4" bo="350"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="6"  numLchTb2="1" lchTb2Data="6"/>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="5" numLchTb2="1" lchTb2Data="5" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3"  numLchTb2="1" lchTb2Data="3"/>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4" numLchTb2="1" lchTb2Data="4" />
      </tapa.expset>

      <tapa.send>
         # Send data for UE4
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="6" numLchTb2="1" lchTb2Data="6"/>
      </tapa.send>
      <tapa.send>
         # Send data for UE3
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="5" numLchTb2="1" lchTb2Data="5"/>
      </tapa.send>
      <tapa.send>
         # Send data for UE1
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="3" numLchTb2="1" lchTb2Data="3"/>
      </tapa.send>
      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4" numLchTb2="1" lchTb2Data="4"/>
      </tapa.send>
   
      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

    # Expect PDCCH and PDSCH  
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="44"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="44"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="27"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="10"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="3"  use="9" lcId="6" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="2"  use="9" lcId="5" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="1" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="4" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="1" numTb2Lyrs="1"/>
     </tapa.tfu.dat.req>
  </tapa.expset>


   # Ending TC here: further processing not needed
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.31
#
#       Desc:   "To verify that UE with best CQI and RI value gets priority over 
#                other UEs in 3 UE scenario"
#
#       Notes:   None
#              
#       Module:  "MAX C/I Module"
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify that UE with best CQI and RI value gets priority over
         other UEs in 3 UE scenario
         Configure UE's in different transmission modes
      </tapa.desc>

      <tapa.longdesc>
         1. Configure Cell with 4Tx Antennas
         2. Configure UE1 with TM 3
         3. Configure UE2 with TM 4
         4. Configure UE3 with TM 6
         5. Send Aperiodic feedback for all UE's
         6. Send Non Zero BO for all the UE's
         7. Expect Status Indications in the order of UE's
            which having good CQI and RI value
            Here order is UE2,UE3,UE1
         6. Expect PDCCH and PDSCH for all UE's
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="80" dlSchdType="3" maxDlBwPerUe="80"
                                       numTxAntPorts="4"/>
      # UE1 Creation with Aperiodic mode 2-0
      # UE2 Creation with Aperiodic mode 3-1
      # UE3 Creation with Aperiodic mode 3-1
      <tapa.rg.UeInit ueId="0" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit ueId="1" ueCatEnum="CM_LTE_UE_CAT_5"
         txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"/>
      <tapa.rg.UeInit ueId="2" ueCatEnum="CM_LTE_UE_CAT_1"
         txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
         aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE2
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE3
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="5" dir="1" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>
      
      # Configure a GBR dedicated logical channel (DTCH) for the 
      # created UE with QCI = 2 for UE2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4"
            dlQci="2" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 3 for UE3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="5" dir="1" lcType="4"
            dlQci="3" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send CQI report with RI=4 and Wide band CQI = 4 for UE 0
      # Send CQI indication for Aperiodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE"
               ri="4" cqiMode="1" wbCqi="4" cqiIdx="10"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst = "3:3:3:3:2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=4 and wbCQI0 = 12 for CW0 and wbCQI1 = 10 for
      # CW1 for the UE 1
      # Send CQI indication for Aperiodic mode 3-1 (TM -4)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="12" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with CQI=15 for the UE 2
      # Send CQI indication for Aperiodic mode 3-1 (TM -6)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="2" isPucchInfo="FALSE" 
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="15" wbCqiTb1="1" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="0:0:0:0:0" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE1. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="4" bo="360"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE2. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="4" bo="500"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the GBR DTCH on RGU for UE3. 
         <tapa.rgu.dstarsp ueId="2" lcId="5" lcType="4" bo="400"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4"  numLchTb2="1" lchTb2Data="4"/>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="5"/>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3" numLchTb2="1" lchTb2Data="3" />
      </tapa.expset>

      <tapa.send>
         # Send data for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4" numLchTb2="1" lchTb2Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE3
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="5"/>
      </tapa.send>

      <tapa.send>
         # Send data for UE1
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="3" numLchTb2="1" lchTb2Data="3"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
   <tapa.expset>
     # Expect 3 Control requests
     <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="44"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" vldDciFrmt="TRUE" isFormat1b="TRUE"
                                     isTb1Pres="TRUE"  vldCWSwapFlag="FALSE" 
                                     isChkPmi ="TRUE" chkPmi ="10" pmiCfm="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
     </tapa.tfu.cntrl.req>
     # Expect 3 Dat requests
     <tapa.tfu.dat.req datReqs="3">
        <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="4" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
        <tapa.tfu.pdsch.dat.req ueId="2"  use="9" lcId="5" chkSdu="TRUE"
           transMode="TFU_UE_TM_6" isTb1="TRUE" isTb2="FALSE" numTb1Lyrs="1"/>
        <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="1" numTb2Lyrs="1"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   # Ending TC here: further processing not needed
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.32
#
#       Desc:    Validation of transmission scheme incase of invalid PMI
#                Report for the first time (TM4)
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.32">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validation of transmission scheme incase of invalid PMI
          Report for the first time (TM4)" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Configure Cell with 2 TX Antenna Ports.
          3. Send Feedback report using Aperiodic mode 3-1 
             and RI,CQI and invalid PMI
          4. Send non-zero BO.
          5. Expect a TB in PDSCH and DCI Format1A in PDCCH
             Because of invalid PMI report (Incase of first time),
             It should choose transmission scheme as transmit diversity.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      #ccpu00118150 changed pmiIdx =2 from 1 since validation is for invalid PMI
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="2"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A in PDCCH
      # Expect transmission scheme as transmit diversity
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="FALSE"
              vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.33
#
#       Desc:    Validate that Retransmission TB should map to 2 layers 
#                incase of TX+ReTx when reported ri = 3
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.33">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Retransmission TB should map to 2 layers 
          incase of TX+ReTx when reported ri = 3" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for TB1 and ACK for TB2
          6. Send Control Feedback(PMI,CQI and RI =3) from the TFU interface
          7. Validate that ReTx TB should map to cw1 (2 layers) and
             New Tx TB should map to CW0 (single layer).
             Validate the CW Swap flag. It should set TRUE 
          8. Expect RETX of TB2 along with New Tx TB1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="90"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="3"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb2Data="9" saveTo="3" numLchTb2="1" numLchTb1="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb2="1" lchTb2Data="9" lcType="5" numLchTb1="0"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect Format2, mode=4 SpaMux as TX Scheme
      # Expect cwSwapFlag as TRUE
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"  
                              vldCWSwapFlag="TRUE" cwSwapFlag="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.34
#
#       Desc:    To test the MAC that Our Current Implementation doesn't support
#                MU-MIMO mode of transmission
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.34">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC that Our Current Implementation doesn't support
           MU-MIMO mode of transmission" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM6.
          2. Configure a Cell with 4 Tx Antenna
          3. Send PMI Feedback.
          4. Schedule the UE.
          5. Expect TB in PDSCH
          6. Expect DCI Format 1B in PDCCH
          7. Reconfigure UE into TM5 (MU-MIMO)
          8. Expect that Configuration should fail"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B, mode=3 and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue  cellId="3" UeReCfgType="1"  tm="CRG_UE_TM_5"
            isTMRecfgPres="TRUE"/>
      </tapa.send>
      #Expect ue recfg cfm  from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  cellId="3" UeReCfgType="1"
            txModeEnum="RGR_UE_TM_5" />
      </tapa.send>
      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.35
#
#       Desc:    To test the MAC - whether it supports TM7 or not.
#                Also validate that support of TM7 with Resource
#                Allocation Type
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test the MAC whether it supports TM7 or not.
           Also validate that support of TM7 with Resource Allocation Type" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM7.
          2. Configure a Cell with 4 Tx Antenna and with DLFS.
          3. Send CQI Feedback.
          4. Schedule the UE.
          5. Expect TB in PDSCH
          6. Expect DCI Format 1 in PDCCH
             (Expect DCI Fmt 1 if RAType=0 or DCI Fmt 1A if RAType =2)"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" isDlFreqSel="1"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_7" tm="CRG_UE_TM_7"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="800"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1 in PDCCH as RAType = 0 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_7" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1="TRUE"
              isTb1Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format1A, mode=2 TD as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_7" isTb1="TRUE"/> 
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1="TRUE"
                                     isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1  
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.36
#
#       Desc:    Incase of TM7 Ues, MAC shall be able to indiacte the PHY
#                reported DOA(Direction of Arrival) Indicator back to PHY
#                as part of subsequent PDSCH datarequest
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
           "Incase of TM7 Ues, MAC shall be able to indiacte the PHY
            reported DOA(Direction of Arrival) Indicator back to PHY
            as part of subsequent PDSCH datarequest"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM7.
          2. Configure a Cell with 4 Tx Antenna 
          3. Send CQI Feedback.
          4. Send DOA report from the TFU Interface
          5. Schedule the UE.
          6. Expect TB in PDSCH
          7. Expect DCI Format 1A in PDCCH (RAType =2)
          8. Expect previously reported DOA Value in this
             PDSCH DatRequest"
       </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_7" tm="CRG_UE_TM_7"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send DOA(Direction of Arrival) for the received PDU
      <tapa.send>
        <tapa.tfu.doa.ind>
           <tapa.tfu.doa doa="10"/>
        </tapa.tfu.doa.ind>   
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="1000"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A in PDCCH as RAType = 2
      # Expect DOA value(Reported Previously) in this PDSCH DatRequest
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_7" isTb1="TRUE" vldDoa="TRUE" doaVal="10"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.37
#
#       Desc:   MAC shall use Transmit diversity scheme for scheduling
#               for the Transmission Mode transition from RGR's UE reconfiguration
#               transition START and COMPLETE
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " MAC shall use Transmit diversity scheme for scheduling
         for the Transmission Mode transition from RGR's UE reconfiguration
         transition START and COMPLETE" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Configure a Cell with 4 Tx Antenna
          3. Schedule the UE.
          4. Expect TB1 and TB2 in PDSCH
             and DCI Fmt2 in PDCCH
          5. Send Transition start request from RGR interface
             to configure the UE into TM6
          6. Send Harq F/B and Control info from the UE
          7. Expect DCI Format 1A in PDCCH and Data in PDSCH
          8. Send Transition complete from the RGR Interface.
          9. Schedule the UE
          10.Expect DCI Fmt 1B in PDCCH and data in PDSCH
             (UE TM is 6)
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>
      # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="400"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      # Send UE ReConfiguration to existing UE for TXmode Recfg at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue  cellId="3" UeReCfgType="1"  tm="CRG_UE_TM_6"
            isTMRecfgPres="TRUE"/>
      </tapa.send>

      #Expect ue recfg cfm  from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE TM transition state as start from RGR Interface
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  cellId="3" UeReCfgType="1"
            tmTrnstnState="RGR_TXMODE_RECFG_START" txModeEnum="RGR_UE_TM_6"/>
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

      # Send NACK for TB1 and ACK for TB2 for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=2
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI = 2 to retransmit the UE 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2" />
      </tapa.send>
      
      # Expect Transmission mode as TXD as UE is in transition mode
      <tapa.expset>
        # Expect Format1A, mode=4  SpaMux as TX Scheme 
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="FALSE" isReTx="TRUE"/>
        </tapa.tfu.dat.req>
        # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="FALSE" isReTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send CQI report with PMI=8
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send UE ReConfiguration transition state complete from RGR Interface
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  cellId="3" UeReCfgType="1"
            tmTrnstnState="RGR_TXMODE_RECFG_CMPLT" txModeEnum="RGR_UE_TM_6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send 4 Tti such that nothing is get scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B, mode=3 and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

  </tapa.test>
  
  # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.38
#
#       Desc:    Validation of RB Calculation 
#                RB estimation based on the CQI and number of Tx Layers of
#                each codeword
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " Validation of RB Calculation
         RB estimation based on the CQI and number of Tx Layers of
         each codeword" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM1 and UE Cat 1.
          2. Configure a Cell with 4 Tx Antenna
          3. Send CQI = 10 from the UE.
          4. Schedule the UE with BO = 1000.
          5. Expect a TB in PDSCH Occupying 'X' no. of RB's
          6. Expect DCI Format 1A in PDCCH
          7. Reconfigure UE into TM4 (Spatial Multiplexing) and UE Cat 5
          8. Send RI = 4 and CQI=10 for both the Code words from the UE
          9. Schedule the UE with BO = 1000
          10.Expect a TB in PDSCH
          11.Validate that Number of Occupied RB's = X/4
             (nothing but (x)/(L1*E1 + L2*E2) )"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="DLFS_INV"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with CQI = 9
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="600"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A  - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_1" isTb1="TRUE" isVldRb="TRUE" numTb1Rb="16"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue  cellId="3" UeReCfgType="1"  tm="CRG_UE_TM_4"
            isTMRecfgPres="TRUE"/>
      </tapa.send>
      #Expect ue recfg cfm  from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at RGR
      # UeReCfgType = (UeTxModeRecfg + UeCatRecfg)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  cellId="3" UeReCfgType="2049"
            txModeEnum="RGR_UE_TM_4" ueCatRecfgPres="TRUE" ueCatEnum="CM_LTE_UE_CAT_5" />
      </tapa.send>
      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

     <tapa.repeat.start repeatCount="22"/>
      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="10" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      <tapa.repeat.end/>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="500"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"
              numTb1Lyrs="2" numTb2Lyrs="2" isVldRb="TRUE" numTb2Rb="12"
                numTb1Rb="12"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.39
#
#       Desc:    In the event of CQI Report on 2 Codewords,
#                and if only TB2 needs to be Retransmitted then
#                MAC Shall consider Codeword0's CQI for RB estimation
#                
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.39">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "In the event of CQI Report on 2 Codewords and if only TB2 needs
         to be Retransmitted then MAC Shall consider Codeword0's CQI for RB
         estimation" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk TB1 as ACK TB2 as NACK.
          6. Change the rank to 2 and no CQI Reporting.
          7. Expect RETX of TB2
          8. Validate that RB calculation for TB2 is based on CW0 CQI"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5" dlQci="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="15" wbCqiTb1="5" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="3800"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4 and precInfo=50 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="9" chkSdu="TRUE"
              transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs ="2"
                numTb2Lyrs="2" isVldRb="TRUE" numTb1Rb="40" numTb2Rb="40"
                saveTo="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="44"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="1" riIdx="2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2, TB2 RETX 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" lcIdTb2="9" chkSdu="FALSE"
              chkSduTb2="TRUE" transMode="TFU_UE_TM_4" isTb1="FALSE" isTb2="TRUE"
              numTb2Lyrs="2" isTb2Retx="TRUE" isRetx="TRUE" retxUse="3" use="4"
                isVldRb="TRUE" numTb2Rb="40"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" vldDciFrmt="TRUE" isFormat2="TRUE"
                                     isTb1Pres="FALSE" isTb2Pres="TRUE"
                                     vldtRetx="TRUE" isChkPmi ="TRUE" chkPmi="28"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb1="FALSE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.40
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE with DLFS enabled.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.40">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send DStaRsp with non-zero BO from RGU to MAC.
          3. Verify Transmit Diversity is the TX Scheme selected
             by MAC for scheduling this BO.
          4. Send CQI report from PHY with RI=4. 
          5. Send non-zero BO.
          6. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing with precInfo=2."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" isDlFreqSel="1"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5" prdModeEnumPres="TRUE" 
         prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 To ensure TD as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
            isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3  and precInfo=2 To ensure SpaMux as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.41
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE with subsequent retx of both TB1 and TB2
#                with DLFS enabled.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.41">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE with subsequent retx of TB1 and TB2." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Expect RETX for both the TBs with precInfo = 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTEMAC_RGU_PAD"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" isDlFreqSel="1"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5" prdModeEnumPres="TRUE" 
         prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="120"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#       Test:    17.42
#
#       Desc:    Sanity test for Spatial multiplexing of 2 TBs
#                in case of TM-3 UE with subsequent retx of both TB1 and TB2
#                with DLFS enabled.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.42">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE with subsequent retx of TB1 and TB2." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for both the TBs.
          6. Expect RETX for both the TBs with precInfo = 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" isDlFreqSel="1"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5" prdModeEnumPres="TRUE" 
         prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"  lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                          vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format2A, mode=3 and precInfo=2 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                       vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect Format2A, mode=3 and precInfo=1 SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9"  chkSdu="FALSE" 
            transMode="TFU_UE_TM_3" isTb1="FALSE" isTb2="TRUE" lcIdTb2="9" chkSduTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                          isTb1Pres="FALSE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE"
                           isChkPmi ="TRUE" chkPmi="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.43
#
#       Desc:    Validate that Retransmission TB should map to 2 layers 
#                incase of TX+ReTx when reported ri = 3 with DLFS enabled.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.43">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Retransmission TB should map to 2 layers 
          incase of TX+ReTx when reported ri = 3" 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for TB1 and ACK for TB2
          6. Send Control Feedback(PMI,CQI and RI =3) from the TFU interface
          7. Validate that ReTx TB should map to cw1 (2 layers) and
             New Tx TB should map to CW0 (single layer).
             Validate the CW Swap flag. It should set TRUE 
          8. Expect RETX of TB2 along with New Tx TB1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" isDlFreqSel="1"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5" prdModeEnumPres="TRUE" 
         prdModeEnum="RGAC_RGR_PRD_CQI_MOD21"  aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD12"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="2" wbPmi="10" pmi="10" cqiTb0="8" cqiTb1="10" 
               numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         # ccpu00120365:-ADD-increase buffer to enable bo to
         # go on both TBs
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="80"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         # ccpu00120365-MOD-enabled Tb2 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="3"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb2Data="9" saveTo="3" numLchTb2="1" numLchTb1="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb2="1" lchTb2Data="9" lcType="5" numLchTb1="0"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect Format2, mode=4 SpaMux as TX Scheme
      # Expect cwSwapFlag as TRUE
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"  
                              vldCWSwapFlag="TRUE" cwSwapFlag="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

########################## Performing the same steps with periodic mode SB CQI report ##

      # Send Subband CQI indication for Aperiodic mode 2-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" 
               cqiMode="3" type="TFU_RPT_CQI" isWideband="FALSE" 
               cqiIdx="10" diffCqiPres="1" diffCqiVal="2"
               />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Wideband CQI indication for Aperiodic mode 2-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" 
               cqiMode="3" type="TFU_RPT_CQI" isWideband="TRUE" 
               cqiIdx="10" pmiIdx="10" diffCqiPres="1" diffCqiVal="2"
               />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send CQI report with RI=4 using PUCCH mode 2-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="TRUE" 
                cqiMode="3" type="TFU_RPT_RI" riIdx="4"
                cqiTb0="8" cqiTb1="10" wbCqiTb0="8" wbCqiTb1="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="80"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4 and CQI = 10
      # Send CQI indication for Aperiodic mode 2-0 (TM -3)
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE"
               ri="3" cqiMode="1" wbCqi="10" cqiIdx="10" wbCqiTb0="8" wbCqiTb1="12"
            numOfSubbands = "5" rbStartLst = "0:6:12:21:27" numRbLst = "3:3:3:3:2" 
             cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" cqiTb0="8" cqiTb1="12"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb2Data="9" saveTo="3" numLchTb2="1" numLchTb1="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb2="1" lchTb2Data="9" lcType="5" numLchTb1="0"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect Format2, mode=4 SpaMux as TX Scheme
      # Expect cwSwapFlag as TRUE
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"  
                              vldCWSwapFlag="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      -->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.44
#
#       Desc:    To test DL scheduling for TM6 UE for both TX and
#                then a subsequent RETX with DLFS enabled.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.44">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test DL scheduling for TM6 UE for both TX and
           then a subsequent RETX with DLFS enabled." 
      </tapa.desc>

      <tapa.longdesc>
         " To test DL scheduling for TM6 UE for both TX and
           then a subsequent RETX with DLFS enabled.
           1. Donot report PMI, expect TD as TX scheme with format 1A.
           2. Negative feedback to this TX and then a PMI report,
              expect single layer precoding as RETX scheme." 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" isDlFreqSel="1"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_6" tm="CRG_UE_TM_6"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
            <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1B, mode=3 and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with PMI=2
      # Send CQI indication for periodic mode 1-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="1" cqiIdx="10"
               pmiIdx="8" wideDiffCqiPres="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect Format1B, mode=3 and precInfo=8 CLSM - Single Layer as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_6" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1b="TRUE"
              isTb1Pres="TRUE" isChkPmi ="TRUE" chkPmi="8" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.45
#
#       Desc:    Validate that Retransmission TB should map to 2 layers 
#                incase of TX+ReTx when reported ri = 3 with DLFS enabled.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.45">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Validate that Retransmission TB should map to 2 layers 
          incase of TX+ReTx when reported ri = 3. Scenario is same
          as 17.43, only that DL CQI reporting modes are changed." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM4.
          2. Send CQI report from PHY with RI=4. 
          3. Send non-zero BO.
          4. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing.
          5. Send HqFdbk as NACK for TB1 and ACK for TB2
          6. Send Control Feedback(PMI,CQI and RI =3) from the TFU interface
          7. Validate that ReTx TB should map to cw1 (2 layers) and
             New Tx TB should map to CW0 (single layer).
             Validate the CW Swap flag. It should set TRUE 
          8. Expect RETX of TB2 along with New Tx TB1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" isDlFreqSel="1"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" tm="CRG_UE_TM_4" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="4"
               cqiMode="4" wbPmi="10" pmi="10" cqiTb0="8" cqiTb1="10" 
               numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="8" wbCqiTb1="10" numRbLst = "3:3:3:3:2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="400"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" vldCWSwapFlag="FALSE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for Aperiodic mode 3-1
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="3"
               cqiMode="4" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="10" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmiIdx ="10"
               cqiIdxLstTb0="9:7:6:8:5" cqiIdxLstTb1="8:7:9:5:6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="100"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb2Data="9" saveTo="3" numLchTb2="1" numLchTb1="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb2="1" lchTb2Data="9" lcType="5" numLchTb1="0"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect Format2, mode=4 SpaMux as TX Scheme
      # Expect cwSwapFlag as TRUE
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2="TRUE"
                              isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"  
                              vldCWSwapFlag="TRUE" cwSwapFlag="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



######################################## MIMO TDD TEST CASES ###############################
#
#
#       Test:    17.46
#
#       Desc:    Validation of successful 2 TX TB spatial multiplexing and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.46">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Validation of successful 2 TX TB spatial multiplexing and 
          subsequent Harq Feedback processing in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful 2 TX TB spatial multiplexing and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


       # Send BO for the created logical channel for DAT1
    <tapa.send>
       #ccpu00120365-MOD-modified the buffer so that second tb
       #is utilized
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="90" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
   # ccpu00120365-ADD-add second LC data for second TB
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" numLchTb2="1" lchTb2Data="3"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
   # ccpu00120365-MOD-modified buffer so that second TB is 
   # utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="90" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE" 
        isTb2="TRUE" isAckLstTb2="FALSE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
 -->
   # Verify No Retransmissions 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.47
#
#       Desc:    Validation of successful 2 RETX TB spatial multiplexing and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.47">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2, two TB Retransmission scenario in multiplexing mode"
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful 2 RETX TB spatial multiplexing and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


      # Send BO for the created logical channel for DAT1
      # ccpu00120365:-ADD-modified buffer so that second TB
      # is utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="90" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
   # ccpu00120365-MOD-modified buffer so that second TB
   # is utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="97" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE" 
        isTb2="TRUE" isAckLstTb2="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"
        isTb2="TRUE" isAckLstTb2="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.48
#
#       Desc:    Validation of successful RETX of only TB1 and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.48">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Validation of successful RETX of only TB1 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful RETX of only TB1 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxDlRetxBw="25" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


      # Send BO for the created logical channel for DAT1
      # ccpu00120365-MOD-modified the buffer so that second
      # TB is also utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="100" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"
            saveTo="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
   # ccpu00120365-MOD-modified buffer so that secondTB
   # is utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="100" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"
            saveTo="4"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   # TB1 NACKED and TB2 ACKED
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE" 
        isTb2="TRUE" isAckLstTb2="FALSE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #ccpu00119023 MOD changed retx parameters for validation
   # Expect Retransmission for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" numTb1Lyrs="2"
             retxUse="2" isRetx="TRUE" validate="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="1" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.49
#
#       Desc:    Validation of successful RETX of only TB2 and 
#                subsequent Harq Feedback processing in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.49">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Validation of successful RETX of only TB2 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful RETX of only TB2 and 
          subsequent Harq Feedback processing in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


      # Send BO for the created logical channel for DAT1
      # ccpu00120365-MOD-modified buffer so that second TB
      # is also utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="100" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
   # ccpu00120365-MOD-modifed buffer so that the second TB
   # is also utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="100" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   # TB1 NACKED and TB2 ACKED
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE" 
        isTb2="TRUE" isAckLstTb2="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect Retransmission for TB2 of DAT1.
   # Verify that lcId=31 corresponding to padding is present in TB2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  retxUse="1" lcIdTb2="31" chkSduTb2="TRUE"
            transMode="TFU_UE_TM_3" isTb1="FALSE"  isTb2="TRUE" numTb2Lyrs="2" isTb2Retx="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="FALSE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="1" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isTb1="FALSE" isTb2="TRUE" isAckLstTb2="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    17.50
#
#       Desc:    Validation of successful RETX of TB1 followed by RETX of TB2 
#                in successive DL occassions for CFG 2 and also verify 
#                subsequent Harq Feedback processing for both RETXs in TDD. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.50">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "Validation of successful RETX of TB1 followed by RETX of TB2 
         in successive DL occassions for CFG 2 and also verify 
         subsequent Harq Feedback processing for both RETXs in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Validation of successful RETX of TB1 followed by RETX of TB2 
         in successive DL occassions for CFG 2 and also verify 
         subsequent Harq Feedback processing for both RETXs in TDD."
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


      # Send BO for the created logical channel for DAT1
      # ccpu00120365-MOD-modified buffer so that second TB
      # is utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="100" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # Send BO for the created logical channel for DAT2
   # ccpu00120365-MOD-modified bo so that second TB is also 
   # utilized
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="100" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0" lchTb2Data="3" numLchTb2="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="1"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   # Send feedback for DAT 1,2
   # TB1 NACKED and TB2 ACKED
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE" 
        isTb2="TRUE" isAckLstTb2="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect Retransmission for TB1 of DAT1.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  retxUse="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" numTb1Lyrs="1" isTb1Retx="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                                     isTb1Pres="TRUE" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect Retransmission for TB2 of DAT1.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  retxUse="1" lcIdTb2="31" chkSduTb2="TRUE"
            transMode="TFU_UE_TM_3" isTb1="FALSE" isTb2="TRUE" numTb2Lyrs="1" isTb2Retx="TRUE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="FALSE" isTb2Pres="TRUE"
                        vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0" vldtRetx="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #send HARQ Recption Request for TB1 DAT 1
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isTb1="TRUE" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isTb1="FALSE" isTb2="TRUE" isAckLstTb2="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.51
#
#       Desc: Retransmission in TB1 when TB2 is inactive
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.51">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Retransmission in TB1 when TB2 is inactive"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
      # Send CQI report with RI=2
      # Send CQI indication for Aperiodic mode 2-2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="15" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmi ="1"
               cqiTb0="10"  cqiTb1="10" wbPmi="1"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="FALSE"/>

        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="FALSE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
     
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="FALSE" isChkPmi="TRUE" chkPmi="0" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.52
#
#       Desc: Retransmission in TB1 when TB2 is also active
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.52">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Retransmission in TB1 when TB2 is active"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
      # Send CQI report with RI=2
      # Send CQI indication for Aperiodic mode 2-2
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" isPucchInfo="FALSE" isRiPres="TRUE" ri="2"
               cqiMode="2" numOfSubbands = "5" rbStartLst = "0:6:12:21:27"
               wbCqiTb0="15" wbCqiTb1="12" numRbLst = "3:3:3:3:2" pmi ="1"
               cqiTb0="10"  cqiTb1="10" wbPmi="1"  />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1"/>
      </tapa.expect>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2, mode=4,  SpaMux as TX Scheme 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="FALSE"/>

        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="FALSE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
     
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

         # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="100"/>
      </tapa.send>
      
        # Send a Tti to get the transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb2Data="9" saveTo="2" numLchTb1="0" numLchTb2="1"/>
      </tapa.expect>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="0" lchTb2Data="9" lcType="5" numLchTb2="1"/>
      </tapa.send>

      # Send TTI to receive data in PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                    isTb1Pres="TRUE" isTb2Pres="TRUE" isChkPmi="TRUE" chkPmi="0" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and TB2
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTI to see nothing else is received
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    17.53
#
#       Desc:   To validate that The HqSize would be Max(1,2) 
#                
#
#       Notes:  Verification has to be done through GDB. in function rgSCHTomUtlFillSfHqFdbkForOneUe in the hqRecp
#              
#       Module:   HARQ
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.53">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "TDD Configuration 2, HARQ size validation in HARQ Reception request for 2 TBs in."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxDlRetxBw="10" numTxAntPorts="4"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for the UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for the UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for the UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for the UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7" TTI="1000"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for the UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0" tm="CRG_UE_TM_3"/>
   </tapa.send>

   # Expect success in cfg cfm for the UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for the UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for the UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for the UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg for the UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for the UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send CQI report with RI=4 for UEID=0
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" ueId="0"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Downlink data now 


       # Send BO for the created logical channel for DAT1
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="160" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="3" ueId="0"/>
      </tapa.expect>
   
   # Send data with size equal to the allocated size for DAT1
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="FALSE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>
  
    # Send BO for the created logical channel for DAT2
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="170" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" numTb1Lyrs="2" numTb2Lyrs="2"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   #send HARQ Recption Request for DAT 1,2
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 1,2
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE" 
        isTb2="TRUE" isAckLstTb2="FALSE:FALSE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>
  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    17.54
#
#       Desc:    Release of Harq Process for 2 TBs if RLC does not 
#                provide the data.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.54">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Release of Harq Process for 2 TBs if RLC does not  
          provide the data." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send DStaRsp with non-zero BO from RGU to MAC.
          3. Send CQI report from PHY with RI=2. 
          4. Do not send data from RLC.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="LTEMAC_RGU_PAD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="150"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 To ensure TD as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="250"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A
      # The DCI format is sent irrespective of the Data received from RLC
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   # Layer Manager ShutDown
   </tapa.shutdown>

</tapa.testcase>

# ccpu00122022 
#
#
#       Test:   17.55 
#
#       Desc:   Test case to test in the MIMO case-2UE attached,retransmiited UE is scheduled and the remaining RB is lesser than RBGSize,second UE should not get allocate in that TTI.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.55">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       In case of MIMO if available RB is lesser than RBGSize,UE should not get scheduled in that TTI.
      </tapa.desc>

      <tapa.longdesc>
      " This is  the test case that in case of MIMO 2UE attached if the retransmitted UE is get scheduled in that TTI 
        and the remaining available bandwith is lesser than RBGSize than the second UE should get scheduled in the next TTI"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTEMAC_RGU_PAD"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4" dlTotalBw="50" maxDlBwPerUe="50"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"/>
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_5" ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0" ueId="0"/>
         <tapa.crg.cfgcfm status="0" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="415" ueId="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiMode="1" cqiIdx="4"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1" tti_id="500"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" tti_id="4000"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>
      </tapa.send>
      
      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="4" cqiIdx="15" ueId="1"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="5" bo="20"/>
      </tapa.send>

      # Send 2 Ttis 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2" tti_id="5000"/>
      </tapa.send>
     
      <tapa.expset>
          # Expect retransmission from MAC to PHY for ueID=0.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9" ueId="0"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE" ueId="0"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" ueId="1"/>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" numLchTb2="1" lchTb1Data="9" 
                           lchTb2Data="9"  lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" tti_id="6000"/>
      </tapa.send> 
      
      <tapa.expset>
          # Expect transmission from MAC to PHY for ueID=1.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                               vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="2"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
      </tapa.tfu.hq.ind>
      </tapa.send>

 </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    17.56
#
#       Desc:    Validation of UE category change reconfig
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc17.xml
#
#
<tapa.testcase id="17.56">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "Validation of UE category change reconfig"
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM1 and UE Cat 1.
          2. Configure a Cell with 4 Tx Antenna
          3. Send CQI = 10 from the UE.
          4. Schedule the UE with BO = 1000.
          5. Expect a TB in PDSCH Occupying 'X' no. of RB's
          6. Expect DCI Format 1A in PDCCH
          7. Reconfigure UE into TM4 (Spatial Multiplexing) and UE Cat 5
          8. Send RI = 4 and CQI=10 for both the Code words from the UE
          9. Schedule the UE with BO = 1000
          10.Expect a TB in PDSCH
          11.Validate that Number of Occupied RB's = X/4
             (nothing but (x)/(L1*E1 + L2*E2) )"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="4"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"
                      ueCatEnum="CM_LTE_UE_CAT_1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      # Send CQI report with CQI = 9
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_CQI" isPucchInfo="TRUE" cqiMode="0" cqiIdx="10"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at CRG
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue  cellId="3" UeReCfgType="1"  tm="CRG_UE_TM_4"
            isTMRecfgPres="TRUE"/>
      </tapa.send>
      #Expect ue recfg cfm  from MAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
      
      # Send UE ReConfiguration to existing UE for TXmode Recfg at RGR
      # UeReCfgType = (UeTxModeRecfg + UeCatRecfg)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  cellId="3" UeReCfgType="2049"
            txModeEnum="RGR_UE_TM_4" ueCatRecfgPres="TRUE" ueCatEnum="CM_LTE_UE_CAT_5" />
      </tapa.send>
      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#/********************************************************************30**
#
#         End of file:     rgac_tc17.xml@@/main/2 - Fri Dec 25 00:18:39 2009
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#/main/1      ---     sm   1. Initial Release.
#/main/2      ---     sm   1. Initial Release.
#             rg004.201 rnt  1. Modified for SI Enhancement
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg002.301 asehgal  1.added ccpu00109543 and ccpu00120621 changes.
#$SID$        rg003.301 ap   1.added 17.51 and 17.52 for ccpu00120365 changes.
                        draju 2.Added testcase for the CR ccpu00122022
#$SID$      ---        rt  1. LTE MAC 4.1 Release
#*********************************************************************91*/

