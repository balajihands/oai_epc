#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases
#
#     File:    rgac_tc19.xml
#
#     Sid:      cm_xta_gen_tc_num.py@@/main/5 - Wed Jun 27 16:21:06 2007
#
#     Prg:     hn 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=5:hn:rgac_tc19.xml


#
#
#       Test:    19.1
#
#       Desc:    TC_MAC_FDD_UL_SPS_1
#                To verify successful UE configuration for SPS.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.1">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful UE configuration for SPS."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
       <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   # rg004.201 Fixed the CCCH sdu size 
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq />
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag = "TRUE" SPSRnti="65"
     ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
     txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535" LcSRMask =
     "TRUE"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   
   #<tapa.rg.dbgDeInitAll/>
    

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.2
#
#       Desc:    TC_MAC_FDD_UL_SPS_2
#                To verify successful UE re-configuration for enabling SPS in
#                the uplink. 
#
#       Notes:    
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.2">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful UE re-configuration for enabling SPS in the uplink"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />

      #Initialize UE 1
      <tapa.rg.UeInit /> 
   
  </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
 # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
 
   # Try a reconfiguration on the UE. Make it SPS enabled and change its packet size to 40
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue UeReCfgType="64" instId="5" 
      ULSPSEnFlag="TRUE" SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.3
#
#       Desc:    TC_MAC_FDD_UL_SPS_3
#                To verify successful UE re-configuration for disabling SPS in
#                the uplink. 
#
#       Notes:    
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.3">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful UE re-configuration for disabling SPS in the uplink"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" SPSRnti="65"
      ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
  # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
 
   # Try a reconfiguration on the UE.
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue SPSRnti="65" UeReCfgType="65536" instId="5"
      ULSPSEnFlag="FALSE"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect negative Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.4
#
#       Desc:    TC_MAC_FDD_UL_SPS_4
#                To verify unsuccessful UE configuration for SPS in the uplink:
#                Invalid number f UL SPS LCs.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.4">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify unsuccessful UE configuration for SPS in the uplink: Invalid
          number f UL SPS LCs"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
       <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   # rg004.201 Fixed the CCCH sdu size 
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq />
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with an invalid UL LC count
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag = "TRUE" SPSRnti="65"
     ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
     txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535" LcSRMask =
     "TRUE" ULSPSLcId="3:4"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>
   
   #<tapa.rg.dbgDeInitAll/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    19.5
#
#       Desc:    TC_MAC_FDD_UL_SPS_5
#                To verify unsuccessful UE configuration for SPS in the uplink:
#                Invalid Periodicity
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.5">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify unsuccessful UE configuration for SPS in the uplink:
         Invalid Periodicity"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
       <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   # rg004.201 Fixed the CCCH sdu size 
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq />
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with an invalid interval.
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag = "TRUE" SPSRnti="65"
     ULSPSSchIntrv="RGR_SPS_PRD_INVALID" numSPSproc="1"
     txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535" LcSRMask =
     "TRUE" ULSPSLcId = "3"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>
   
   #<tapa.rg.dbgDeInitAll/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.6
#
#       Desc:    TC_MAC_FDD_UL_SPS_6
#                To verify unsuccessful UE configuration for SPS in the uplink:
#                UE Ack/Nack repeatition
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.6">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify unsuccessful UE configuration for SPS in the uplink:
         UE Ack/Nack repeatition"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
       <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   # rg004.201 Fixed the CCCH sdu size 
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq />
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with an invalid interval
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag = "TRUE" SPSRnti="65"
     ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
     txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535" LcSRMask =
     "TRUE" ULSPSLcCnt = "1" isAckNackEnabled="TRUE"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>
   
   #<tapa.rg.dbgDeInitAll/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.7
#
#       Desc:    TC_MAC_FDD_UL_SPS_7
#                To verify unsuccessful UE re-configuration for SPS in the
#                uplink: Rcfg Types other than Measurement Gap. 
#
#       Notes:    
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.7">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify unsuccessful UE re-configuration for SPS in the uplink: Rcfg
          Types other than Measurement Gap"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" SPSRnti="65"
      ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
  # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
 
   # Try a reconfiguration on the UE for measurement gap - 256. It passes.
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue  SPSRnti="65" UeReCfgType="256" instId="5"
      ULSPSEnFlag="TRUE" />
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect positive Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Try a reconfiguration on the UE for measurement gap n SPS both. 65536 || 256. It passes.
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue SPSRnti="65" UeReCfgType="65792" instId="5"
      ULSPSEnFlag="TRUE" />
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect positive Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Try a reconfiguration on the UE for a value other than measurement gap. It
   # fails.
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue UeReCfgType="65536" instId="5"
      ULSPSEnFlag="TRUE" isAckNackEnabled="TRUE"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect negative Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    19.8
#
#       Desc:    TC_MAC_FDD_UL_SPS_8
#                To verify unsuccessful UE re-configuration for SPS in the
#                uplink: UE Ack/Nack repeatition. 
#
#       Notes:    
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.8">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify unsuccessful UE re-configuration for SPS in the uplink: UE
          Ack/Nack repeatition."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" SPSRnti="65"
      ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
  # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
 
   # Try a reconfiguration on the UE for Ack Nack rep. Recfg 65536 || 128
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue UeReCfgType="65664" instId="5"
      ULSPSEnFlag="TRUE" isAckNackEnabled="TRUE"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect positive Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

      </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.9
#
#       Desc:    TC_MAC_FDD_UL_SPS_9
#                To verify successful SPS activation in a UE on both downlink
#                and uplink simultaneously.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.9">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful SPS activation in a UE on both downlink and
          uplink simultaneously."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50" />
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
   # Do not send BO for the created SPS service on RGU at 2nd SPS ocassion
   <tapa.send>
      <tapa.tfu.tti.ind numTti="12"/>
   </tapa.send>
   
   # Do not send BO for the created SPS service on RGU at 3rd SPS ocassion
   <tapa.send>
      <tapa.tfu.tti.ind numTti="20"/>
   </tapa.send>

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect a release PDCCH over here
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
              chkFrmt1aRelPdcch="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    19.10
#
#       Desc:    TC_MAC_FDD_UL_SPS_10
#                To verify successful SPS activation in a UE in uplink on
#                receiving BSR on SPS logical channel.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.10">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful SPS activation in a UE in uplink on receiving BSR
          on SPS logical channel."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70" DLSPSMaxBw="40"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" lcId="4" 
             isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.11
#
#       Desc:    TC_MAC_FDD_UL_SPS_11
#                To verify successful SPS activation in a UE in uplink on
#                receiving data for SPS logical channel.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.11">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful SPS activation in a UE in uplink on receiving
          data for SPS logical channel."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.12
#
#       Desc:    TC_MAC_FDD_UL_SPS_12
#                To verify resending SPS activation PDCCH on CRC failure till
#                maxUlTxCnt.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.12">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify resending SPS activation PDCCH on CRC failure till
          maxUlTxCnt."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit  DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"
      maxUlHqTx="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
 
# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
<!--      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>


      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.13
#
#       Desc:    TC_MAC_FDD_UL_SPS_13
#                To verify SPS is not activated in a UE in uplink as long as BSR
#                for SPS LCG remains less than SID Packet Size.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.13">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify SPS is not activated in a UE in uplink as long as BSR for
         SPS LCG remains less than SID Packet Size."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit  DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

# Since SID packet size is 10, we send a BSR of 0 index (index 1 gives 10 bytes)
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
       addShortBsr="TRUE" lcgId="1" bsr="0" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>
# No PDCCH is received for SPS activation, 20 TTIs.

#Now send a BSR for index 1 (10 bytes). SPS is activated only when BSR is
      greater than 10 bytes. Here, grant is received, not the activation PDCCH.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
       addShortBsr="TRUE" lcgId="1" bsr="1" />
       </tapa.tfu.dat.ind>
      </tapa.send>

       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

        </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    19.14
#
#       Desc:    TC_MAC_FDD_UL_SPS_14
#                To verify successful deactivation (Implicit Release) of UL SPS
#                alone in a UE (and continue with DL SPS): ImplicitRel Counter
#                hits max configured value.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.14">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful deactivation (Implicit Release) of UL SPS alone
          in a UE (and continue with DL SPS): ImplicitRel Counter hits max
          configured value."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

  # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
   
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

  # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
     <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
  
#No more reception request is received on the next SPS occasion since SPS is
      implicitely released

<!--      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.15
#
#       Desc:    TC_MAC_FDD_UL_SPS_15
#                To verify successful deactivation
#                (Explicit Release) of UL SPS alone in a UE (and continue with
#                DL SPS): Non SPS data on SPS occasions.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.15">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful SPS activation in a UE in uplink on receiving
          data for SPS logical channel."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

# Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>


      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

  # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
     
     # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
  
    # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

  # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
     
    # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
    # Expect Release PDCCH from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0"
           isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.16
#
#       Desc:    TC_MAC_FDD_UL_SPS_16
#                To verify successful deactivation (Explicit Release) of UL SPS
#                in a UE : LCG deletion.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.16">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful deactivation (Explicit Release) of UL SPS
          in a UE : LCG deletion"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>
      # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Release PDCCH from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.17
#
#       Desc:    TC_MAC_FDD_UL_SPS_17
#                To verify successful deactivation (Explicit Release) of UL SPS
#                alone in a UE (and continue with DL SPS): Release PDCCH does
#                not reach UE and is resent (DTX).
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.17">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify successful deactivation (Explicit Release) of UL SPS alone
           in a UE (and continue with DL SPS): Release PDCCH does not reach UE and
           is resent (DTX)."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

     # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>
 
     # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>


      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   # Sebd LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>
      # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# Expect Release PDCCH from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
<!--
# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
            
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.18
#
#       Desc:    TC_MAC_FDD_UL_SPS_18
#                To verify dynamic scheduling of data on a SPS configured
#                logical channel when SPS is not activated.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.18">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful SPS activation in a UE in uplink on receiving
          data for SPS logical channel."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
# Passing sduSz as 3 bytes (less than SID packet size)
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" sduSzs="3" lcIds="4"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# No activation PDCCH is received in this TTI. UL data is scheduled dynamically.
# Try sending 12 bytes in SduSzs (greater than SID packet size), activation
# PDCCH will be received and data will be scheduled semi persistently.
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.19
#
#       Desc:    TC_MAC_FDD_UL_SPS_19
#                To verify the maximum MCS index as 15.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.19">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the maximum MCS index as 15."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
#Anshika - Add CQI validation
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
# Passing sduSz as 3 bytes (less than SID packet size)
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" sduSzs="12" lcIds="4"  addShortBsr="TRUE" lcgId="1" bsr="20"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

# Send a CQI indication of 15. It would be scaled to 10 and max MCS wouldn't
# exceed 15 in the PDCCH cntrl req received.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="15"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
# Since ULSPSInit is TRUE, MCS is verified to be less than 15.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.20
#
#       Desc:    TC_MAC_FDD_UL_SPS_20
#                To verify that CRC bits are scrambled using UE's SPS-CRNTI in
#                dynamic scheduling of SPS data for retransmissions.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.20">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify that CRC bits are scrambled using UE's SPS-CRNTI in dynamic
         scheduling of SPS data for retransmissions."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4"  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
# isRetx validates the SPS crnti for SPS retx data.
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE" isRetx="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
         </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.21
#
#       Desc:    TC_MAC_FDD_UL_SPS_21
#                To verify explicit release does not happen even if SPS data is
#                received in non SPS occasions.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.21">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify explicit release does not happen even if SPS data is received
       in non SPS occasions."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send non SPS  Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="0" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect a grant for the BSR sent(for non SPS data). Use this grant to send SPS data on non SPS
# occasion.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
  # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="4"
   isSpsRnti="FALSE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send SPS Data Indication on non SPS occ using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="4" dedBufIdx="0" 
      lcId="4" isSpsRnti="FALSE" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

#Sending non-sps data for explicit release- 2      

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send non SPS Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="FALSE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
    

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

#Sending non-sps data for explicit release- 3      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
 
   # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send non SPS Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>
#Sending non-sps data for explicit release- 4      

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Even after sending non SPS data on SPS occasion 3 times (explicit release
       count), data reception request for SPS is received as SPS data was
      sent in between in a non SPS occasion. Hence SPS is not explicitely
      released.
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.22
#
#       Desc:    TC_MAC_FDD_UL_SPS_22
#                To verify the reactivation (SPS is already activated) of SPS in
#                the uplink on receiving BSR (greater than the current BSR for
#                which SPS is activated) for the SPS logical channel.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.22">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify the reactivation (SPS is already activated) of SPS in the
       uplink on receiving BSR (greater than the current BSR for which SPS is
       activated) for the SPS logical channel."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="3" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send Data Indication using TB size recieved in the grant
           
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Received BSR is scheduled dynamically instead of waiting for SPS occasion
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #SPS reactivation PDCCH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.23
#
#       Desc:    TC_MAC_FDD_UL_SPS_23
#                To verify release of harq proc after max-retransmission.
#                maxUlTxCnt.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.23">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify release of harq proc after max-retransmission."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
 
# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
<!--      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
<!--
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.24
#
#       Desc:    TC_MAC_FDD_UL_SPS_24
#                To verify SPS is not activated in a UE in uplink as long as BSR
#                for SPS LCG remains less than SID Packet Size.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.24">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify SPS is not activated in a UE in uplink as long as BSR for
         SPS LCG remains less than SID Packet Size."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

# Since SID packet size is 10, we send a BSR of 0 index (index 1 gives 10 bytes)
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
       addShortBsr="TRUE" lcgId="1" bsr="0" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>
# No PDCCH is received for SPS activation, 20 TTIs.

#Now send a BSR for index 1 (10 bytes). SPS is activated only when BSR is
      greater than 10 bytes. Here, grant is received, not the activation PDCCH.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
       addShortBsr="TRUE" lcgId="1" bsr="1" />
       </tapa.tfu.dat.ind>
      </tapa.send>

       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

        </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.25
#
#       Desc:    TC_MAC_FDD_UL_SPS_25
#                To verify the resource allocation for UL SPS.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.25">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the resource allocation for UL SPS."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
      # Expect data reception request. This verifies the startRb and numRb
# received in pusch rec req with the previous stored values in pdcch.
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.26
#
#       Desc:    To Verify the SPS release by receiving CRC failure 
#                RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) times 
#                
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.26">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To Verify the SPS release by receiving CRC failure 
           RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) times "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="20"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  hopOffst="0"/>
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535" 
      maxUlHqTx="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
         ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
       <tapa.tfu.dat  ueId="0"
       addShortBsr="TRUE" lcgId="1" bsr="20" /> 
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      # Expect First SPS occasion 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #First CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect second SPS occasion 
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Fourth CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect HARQ NACK in PHICH
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect second SPS occasion 
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Fourth CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>






      # Expect HARQ NACK in PHICH
      # and UL SPS Rel after RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL CRC failures
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0"
               isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect retx of second occasion 
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.27
#
#       Desc:    TC_MAC_FDD_UL_SPS_27
#                To verify resending SPS activation PDCCH on CRC failure till
#                maxUlTxCnt.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.27">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify resending SPS activation PDCCH on CRC failure till
          maxUlTxCnt."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ NACK on PHICH resource
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.28
#
#       Desc:    TC_MAC_FDD_UL_SPS_28
#                To verify the non-adaptive retransmission of SPS data in
#                uplink.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.28">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the non-adaptive retransmission of SPS data in uplink."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4"  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request for non adaptive retx
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE" isRetx="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
         </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.29
#
#       Desc:    TC_MAC_FDD_UL_SPS_29
#                To verify that PDCCH is sent with DCI format 0 for adaptive
#                retransmission of SPS data on not receiving CRC success on a
#                configured SPS resource.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.29">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify that PDCCH is sent with DCI format 0 for adaptive
       retransmission of SPS data on not receiving CRC success on a configured
       SPS resource."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  hopOffst="4"/>
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1" prdBsrTmr="65535"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
            # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#Activation PDCCH
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

     # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

    # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="5" numRapId="1" rapIds="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5" rapIds="1" vldtRar="TRUE" saveTo="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     
      # Adaptive retx
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtGrant="TRUE" vldtRetx="TRUE"
            isUlGrant="TRUE" />
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2">
       <tapa.tfu.msg3.recp.req ueId="1"/>
       <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>
   
    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.30
#
#       Desc:    TC_MAC_FDD_UL_SPS_30
#                To verify the deactivation of UL and DL SPS locally on
#                reception of MAC CRNTI CE.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.30">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the deactivation of UL and DL SPS locally on reception of
          MAC CRNTI CE."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>
   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  DLSPSMaxBw = "40" dlTotalBw="50" />
      # UE Configuration
      <tapa.rg.UeInit prdBsrTmr="65535" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="5" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
#####RACH for CRNTI CE
      # Send RaReqInd for one rapId 
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
       <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
          tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send >
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   <tapa.send >
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect PDCCH for DCI format 0.
      <tapa.expset>
         <tapa.rgr.uestaind />
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for UL data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For UL data 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="27"/>
      </tapa.send>

     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
        
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.31
#
#       Desc:    TC_MAC_FDD_UL_SPS_31
#                To verify that reconfiguration of SPS Params for an already SPS
#                enabled UE is ignored and Scheduler continues to schedule the
#                UE at it's SPS occasions. 
#
#       Notes:    
#
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.31">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify that reconfiguration of SPS Params for an already SPS
         enabled UE is ignored and Scheduler continues to schedule the UE at
         it's SPS occasions."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>
    # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      # Expect data reception request. This verifies the startRb and numRb
# received in pusch rec req with the previous stored values in pdcch.
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

# Try a reconfiguration on the UE, make the periodicity as 32.
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue SPSRnti="65" UeReCfgType="65536" instId="5" 
      ULSPSEnFlag="TRUE" ULSPSSchIntrv="RGR_SPS_PRD_32SF"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
   
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

     # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect> 
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
#Expect a reception request at the old SPS occasion only, i.e. after 20 TTIs.
#The new periodicity sent in Recfg is ignored.
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.32
#
#       Desc:    TC_MAC_FDD_UL_SPS_32
#                To verify the SPS scheduling of a UL SPS activated UE is not
#                disturbed with the admission of other SPS UE with the
#                periodicity resulting in change of LCM.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.32">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the SPS scheduling of a UL SPS activated UE is not disturbed
          with the admission of other SPS UE with the periodicity resulting in
          change of LCM."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

      #Initialize another UE
      <tapa.rg.UeInit ueId="1" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for another UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

       # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

     <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue oldUeId="1" newUeId="1" UeReCfgType="65536" instId="5" 
      ULSPSEnFlag="TRUE"  ULSPSSchIntrv="RGR_SPS_PRD_32SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Expect Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   <tapa.send>
       <tapa.tfu.tti.ind numTti="2"/>
    </tapa.send>
      
   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req  isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  # Send SR Indication for another UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="3" ueId="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" use="4" dedBufIdx="0"
                lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #UeId 1 doesnt have SPS activated in the previous TTI since max UE per sf are 1
      here. Due to the collision, its SPS is activated in the next TTI.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="4"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for 1st UE on SPS occasion
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect data reception request for 2nd UE on SPS occasion
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="4" vldtDatRecp="TRUE" saveTo="5"
        isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
    
    # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" use="5" dedBufIdx="0"
                lcId="4" />
       </tapa.tfu.dat.ind>
      </tapa.send>


    # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE"/>
      </tapa.tfu.recp.req>   
      </tapa.expect>
    
     # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" />
       </tapa.tfu.dat.ind>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # After 32 TTIs (2nd UE's SPS periodicity), recp req is received.
      # The first UE still receives its SPS recp req after 20 TTIs (1st UE's SPS
      # periodicity).
      <tapa.expect>
      <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="4" vldtDatRecp="TRUE" saveTo="5"
        isSpsRnti="TRUE"/>
      </tapa.tfu.recp.req>   
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" use="5" dedBufIdx="0"
                lcId="4" />
       </tapa.tfu.dat.ind>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.33
#
#       Desc:    TC_MAC_FDD_UL_SPS_33
#                To verify the allocation of unused SPS resources for dynamic
#                scheduling in case of dynamic scheduling of a UE on SPS
#                occasion.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.33">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify the allocation of unused SPS resources for dynamic scheduling
       in case of dynamic scheduling of a UE on SPS occasion."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send Data Indication for non SPS LC using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.34
#
#       Desc:    TC_MAC_FDD_UL_SPS_34
#                To verify that when SPS is activated, it is deactivated on MAC
#                reset and releases the SPS resources.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.34">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify that when SPS is activated, it is deactivated on MAC reset
         and releases the SPS resources."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20"   />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send UE Reset request for the  Ue  1 at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset   ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Ue Id  1 at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
      #No data reception request on SPS occasions for ueId 0 as allocations are cleared by
      #Reset command.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="30"/>
      </tapa.send>

     </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.35
#
#       Desc:    TC_MAC_FDD_UL_SPS_35
#                To verify re-activation of UL SPS due to collision with
#                measurement gap which comes in UE-Recfg.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To verify re-activation of UL SPS due to collision with
       measurement gap which comes in UE-Recfg."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />

      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"
      isMesGapEnabled="TRUE" gapPrd="40" gapOffst="20" prdBsrTmr="65535" ueBr="2000"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
         ulQci="1" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#SPS occassion collides with meas GAP, so expect normal grant
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" />
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
#Activation PDCCH when we dont collide with meas gap
<!--      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send UE-Reconfig with periodicity = 80 ms, with offset that collides
      with SPS occassions.
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2"
      oldUeId="0" UeReCfgType="256" isMesGapEnabled="TRUE" gapPrd="80" 
      gapOffst="66" instId="5" />
      </tapa.send>

   # Send a Tti to get the configuration applied. 
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   #Expect positive Configuration Confirm from Scheduler
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>
   
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
      #Command To ShutDown LTEMAC Layer
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#
#       Test:    19.36
#
#       Desc:    TC_MAC_FDD_UL_SPS_36
#                To verify MAC uses scaled CQI for UL SPS.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.36">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify MAC uses scaled CQI for UL SPS."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

      <tapa.rg.UeInit ueId="1" />


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
 
     # Send SR Indication for another UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>


      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
#Anshika - Add CQI validation
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
# Passing sduSz as 12 bytes (greater than SID packet size)
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" sduSzs="12" lcIds="4" addShortBsr="TRUE" lcgId="1" bsr="20"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" use="4" sduSzs="12" lcIds="4"/>
       </tapa.tfu.dat.ind>
      </tapa.send>


# Send a CQI indication of 15. It would be scaled to 10 and max MCS wouldn't
# exceed 15 in the PDCCH cntrl req received.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="15"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="15"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
# Since ULSPSInit is TRUE, scaled MCS is verified to be less than 15.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
 
    # Send SR Indication again for another UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>


      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
# This vldtTx shows the MCS to be greater than 15 (not scaled) since the CQI was greater than 15
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.37
#
#       Desc:    TC_MAC_FDD_UL_SPS_19
#                To verify reactivation of UL SPS due to re-allocation of SPS
#                resources due to change in scaled UL CQI.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.37">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify reactivation of UL SPS due to re-allocation of SPS resources
          due to change in scaled UL CQI."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="40"  numTxAntPorts="2" startRnti="70"
      rntiSize="11" />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
#Anshika - Add CQI validation
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" sduSzs="112" lcIds="4" addShortBsr="TRUE" lcgId="1" bsr="20"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      # Since ULSPSInit is TRUE, MCS is verified to be less than 15.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="4"
           isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="1"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
     
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send a CQI indication of 9.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="6"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #UL SPS re-activated due to scaled CQI leading to change in num of subbands
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.38
#
#       Desc:    TC_MAC_FDD_UL_SPS_38
#                To verify deletion of a UL SPS active UE. 
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.38">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify deletion of a UL SPS active UE."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" SPSRnti="65"
       ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
       ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4"  addShortBsr="TRUE" lcgId="1" bsr="20"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

# Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Send a UE delete request
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="2" ueId="0"/>
      </tapa.send>
     
       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
# No more reception request is received for SPS on SPS occasion (16 TTIs from
# here)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.39
#
#       Desc:    TC_MAC_FDD_UL_SPS_39
#                To verify UL SPS activation doesn't collide with measurement
#                gap. 
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.39">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "To verify UL SPS activation doesn't collide with measurement gap." 
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2"
      isMesGapEnabled="TRUE" gapPrd="40" gapOffst="37" prdBsrTmr="65535"/>
<!--
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" />
-->
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      <!--
# Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>
      -->
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Should not recieve any UL Allocations
      <tapa.timeout/>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
      #Command To ShutDown LTEMAC Layer
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#
#       Test:    19.40
#
#       Desc:    TC_MAC_FDD_UL_SPS_40
#                To verify the path when UEs in UL SPS retransmission queue get
#                priority over new transmission of non SPS data.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.40">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the path when UEs in UL SPS retransmission queue get
          priority over new transmission of non SPS data."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4"  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

      #Initialize another UE
      <tapa.rg.UeInit ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>


      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20"   />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      # Send SR Indication for second UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request for non adaptive retx of SPS UE. Data recp
      # req for UE2 is not received.
      <tapa.expect> 
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE" isRetx="TRUE"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
         </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.41
#
#       Desc:    TC_MAC_FDD_UL_SPS_41
#                To verify the path when UE delete is sent: UE is in
#                ToBeActvtdList. 
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.41">>

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify the path when UE delete is sent: UE is in ToBeActvtdList."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send Data Indication using TB size recieved in the grant
           
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

   # Send a UE delete request
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="2" ueId="0"/>
      </tapa.send>
     
       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
# No more reception request/reactivation is received for SPS on SPS occasion (16 TTIs from
# here)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.42
#
#       Desc:    TC_MAC_FDD_UL_SPS_42
#                To verify the path when UE delete is sent: UE is in
#                ToBeRelList.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.42">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the path when UE delete is sent: UE is in ToBeRelList."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

# Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>


      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send non SPS Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

  # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send non SPS Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
     
     # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
  
    # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

  # Send non SPS Data Indication 3rd time using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
     
    # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>
 
   # Send a UE delete request. UE is already in SPS toBeRelList.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="2" ueId="0"/>
      </tapa.send>
     
       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
# No more reception request/reactivation is received for SPS on SPS occasion (16 TTIs from
# here)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

# Explicit release PDCCH will not be sent. On next SPS occasion, PDCCH should be
# received.

<!--     # Expect Release PDCCH from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0"
           isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.43
#
#       Desc:    TC_MAC_FDD_UL_SPS_43
#                To verify  SPS is not activated in a UE in uplink on
#                receiving a long BSR on SPS logical channel together
#                with other LCG.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.43">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify  SPS is not activated in a UE in uplink on
          receiving a long BSR on SPS logical channel together
          with other LCG."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="20"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  hopOffst="0"/>
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
         ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
       <tapa.tfu.dat  ueId="0"
       addLongBsr="TRUE" lcgId="1" bsr0="20" bsr1="10" /> 
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Expect DCI0 with Dynamic SCH.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="FALSE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.44
#
#       Desc:    TC_MAC_FDD_UL_SPS_44
#                To verify the path when feedback (ACK) of UL SPS data collides
#                with measurement gap (UE assumes ACK).
#                other UEs. 
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.44">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To verify the path when feedback (ACK) of UL SPS data collides with
      measurement gap (UE assumes ACK)."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />

      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"
      isMesGapEnabled="TRUE" gapPrd="40" gapOffst="21" maxUlHqTx="4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#Activation PDCCH as we dont collide with meas gap
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Send a Tti to get the configuration applied. 
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
   # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Feedback collides with measurement gap so dont expect PHICH 
<!-- 
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
   # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Should not recieve any UL Allocations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
      #Command To ShutDown LTEMAC Layer
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    19.45
#
#       Desc:    TC_MAC_FDD_UL_SPS_45
#                To verify the path when explicit release PDCCH collides with
#                measurement gap. 
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.45">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify the path when explicit release PDCCH collides with measurement
       gap.
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" SPSRnti="65" 
      ULSPSSchIntrv="RGR_SPS_PRD_40SF" numSPSproc="1" prdBsrTmr="65535"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
    ulQci="1" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" />
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="36"/>
      </tapa.send>

     # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="30"/>
      </tapa.send>
      

      # Send UE-Reconfig with periodicity = 80 ms, with offset that collides
      with SPS occassions.
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_40SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2"
      oldUeId="0" UeReCfgType="256" isMesGapEnabled="TRUE" gapPrd="40" 
      gapOffst="9" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

###### Third time sending non SPS LC Data
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="30"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>



###### Third time sending non SPS LC Data END



      # Send 11 TTIs to process toBe released list after the meas gap is over
      <tapa.send>
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>



# Expect Release PDCCH from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0"
      isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
      #Command To ShutDown LTEMAC Layer
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.46
#
#       Desc:    TC_MAC_FDD_UL_SPS_46
#                To verify the path when feedback (NACK) of UL SPS data collides
#                with measurement gap (UE assumes ACK).
#                other UEs. 
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.46">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To verify the path when feedback (NACK) of UL SPS data collides with
       measurement gap (UE assumes ACK)."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />

      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"
      isMesGapEnabled="TRUE" gapPrd="40" gapOffst="21" maxUlHqTx="4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#Activation PDCCH as we dont collide with meas gap
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Send a Tti to get the configuration applied. 
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
   # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

    <!-- 
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect> 
   #Feedback collides with measurement gap so dont expect PHICH 
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Ul Re tx will not be scheduled as it lost the Synd HARQ retx.
   # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
      # Should not recieve any UL Allocations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
      #Command To ShutDown LTEMAC Layer
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    19.47
#
#       Desc:    TC_MAC_FDD_UL_SPS_47
#                To verify non-adaptive retransmission of UL SPS data for 2
#                UEs. 
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.47">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify non-adaptive retransmission of UL SPS data for 2 UEs."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
         rntiSize="11"  hopOffst="4"/>

      #Initialize UE with Default UeID 0
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1" prdBsrTmr="65535"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" maxUlHqTx="4"/>

      #Initialize UE with Ue Id as 1
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1" prdBsrTmr="65535"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" maxUlHqTx="4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      
      # Configure bi-directional DTCH for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcType="5" instId="5"
            DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      
      # Configure bi-directional DTCH for UeId 1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcType="5" instId="5"
            DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>

      # Configure UL LCG on RGR for Default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR for UeId 1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>

      # Expect configuration for LCH 
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE (UE Id 0)
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
     
     # Send SR Indication for second UE (UE Id 1)
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1" />
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE" ueId="1"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request for Both UE's
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg for UeId 0 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Send CRC for Msg for UeId 1
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI for Processing CRC Indications for both UE's
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="10" />
            <tapa.tfu.dat  ueId="1"
               addShortBsr="TRUE" lcgId="1" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      
      #Send 1 TTI so that above BSR's Scheduled
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Activation PDCCH for Both First Default UE's and Normal Allocation for
      # ueId 1 in Same TTI
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
            #Second Ue Gets Normal Allocation not SPS
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/> 
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 1 TTI to get PDCCH SPS Activation for second UE 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Now get Activation PDCCH for SecodnUE with UeId 1
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Now send 3 More TTI's to receive recp Request for bot UE's one for SPS
      #and other for normal
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="4"
               isSpsRnti="TRUE"/>
            <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="5"
               ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 1 TTI to get Recp request for UeId 1 for SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect data reception request for UeId 1 for SPS occasion
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="6"
               isSpsRnti="TRUE" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send 2 TTIs for CRC Ind for ueId 0 for SPS and UeId 1 non SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send CRC for Msg for SPS ueId 0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Send CRC for Msg for SPS ue Id 1 for NON sps data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send One more TTI to send CRC for UeId 1 for SPS Data and also to receive
      #PHICH for Ueid 0 for SPS and UeID 1 for Non sps
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send CRC for Msg for SPS ueId 1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
     <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Expect data reception request For First Occasion of Ue Id 0
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="4"
               isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 1 TTI to reach First SPS Occasion for UeId 1 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect data reception request for UeId 1 for SPS occasion
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="6"
               isRetx="TRUE" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
    </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.48
#
#       Desc:    TC_MAC_FDD_UL_SPS_48
#                To verify that MAC shall activate Second SPS UE in next TTI
#                when it doesn't have sufficient bandwidth for Second UE.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
<tapa.testcase id="19.48">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify that MAC shall activate Second SPS UE in next TTI when it
         doesn't have sufficient bandwidth for Second UE."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
         rntiSize="11"  />

      #Initialize UE with Default UeID 0
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1" prdBsrTmr="65535"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" maxUlHqTx="4"/>

      #Initialize UE with Ue Id as 1
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1" prdBsrTmr="65535"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" maxUlHqTx="4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      
      # Configure bi-directional DTCH for UE 1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm 
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcType="5" instId="5"
            DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      
      # Configure bi-directional DTCH for UeId 1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcType="5" instId="5"
            DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>

      # Configure UL LCG on RGR for Default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR for UeId 1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>

      # Expect configuration for LCH 
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE (UE Id 0)
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
     
     # Send SR Indication for second UE (UE Id 1)
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1" />
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE" ueId="1"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
               vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request for Both UE's
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg for UeId 0 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Send CRC for Msg for UeId 1
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI for Processing CRC Indications for both UE's
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="10" />
            <tapa.tfu.dat  ueId="1"
               addShortBsr="TRUE" lcgId="1" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      
      #Send 1 TTI so that above BSR's Scheduled
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Activation PDCCH for Both First Default UE's and Normal Allocation for
      # ueId 1 in Same TTI
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
            #Second Ue Gets Normal Allocation not SPS
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/> 
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 1 TTI to get PDCCH SPS Activation for second UE 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Now get Activation PDCCH for SecodnUE with UeId 1
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Now send 3 More TTI's to receive recp Request for bot UE's one for SPS
      #and other for normal
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="4"
               isSpsRnti="TRUE"/>
            <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="5"
               ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 1 TTI to get Recp request for UeId 1 for SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect data reception request for UeId 1 for SPS occasion
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="6"
               isSpsRnti="TRUE" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send 2 TTIs for CRC Ind for ueId 0 for SPS and UeId 1 non SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send CRC for Msg for SPS ueId 0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Send CRC for Msg for SPS ue Id 1 for NON sps data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send One more TTI to send CRC for UeId 1 for SPS Data and also to receive
      #PHICH for Ueid 0 for SPS and UeID 1 for Non sps
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send CRC for Msg for SPS ueId 1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for both UeId 0
      #for SPS data and Ueid 1 for Non SPS data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat  ueId="0" use="4" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
            #for UeId 1 for Non SPS Data
            <tapa.tfu.dat  ueId="1" use="5" dedBufIdx="0" 
               lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      #Next TTI we should get phich for UeId 1 for SPS data and Dat indications
      #at RLC for UeId 0 for SPS data and UeID 1 for Non SPS Data
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Send CRC for Msg for Non SPS ueId 1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for UeId 1 for
      # SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="1" use="6" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC for SPS Data for Ue Id 1
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # Send 1 More TTI to reach First SPS Occasion for Ue Id 0 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      # Expect data reception request For First Occasion of Ue Id 0
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="4"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 1 TTI to reach First SPS Occasion for UeId 1 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect data reception request for UeId 1 for SPS occasion
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="6"
               isSpsRnti="TRUE" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 2 TTIs for CRC Ind for ueId 0 for SPS 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      #Send CRC for Msg for SPS ueId 0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      #Send One more TTI to send CRC for UeId 1 for SPS Data and PHICH for UeId
      #0 for SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Send CRC for Msg for SPS ueId 1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant for UeId 0 for
      # SPS data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="4" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>
      
      #Next TTI we should get phich for UeId 1 for SPS data and Dat indications
      #at RLC for UeId 0 for SPS data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect Data Indication at RLC for UeId 0 for SPS
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
     
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="2"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
     
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="2"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH for UeId 1 for SPS
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Send CRC for Msg for SPS ueId 1
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      # Send Data Indication using TB size recieved in the grant for UeId 1 for
      # SPS data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="1" use="6" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Send one more TTI to receive Dat Indication at RLC for UeId 1 for SPS
      # Data
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC for UeId 0 for SPS
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      #Activation PDCCH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.49
#
#       Desc:    TC_MAC_FDD_UL_SPS_49
#                To verify multiple occasion of 2 UEs with different
#                periodicity. One UE will be deleted and the other is reset.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#       
<tapa.testcase id="19.49">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
      "To verify multiple occasion of 2 UEs with different periodicity. One UE
       will be deleted and the other is reset."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70" maxUlUeNewTxPerTti="10"
      rntiSize="11"  hopOffst="4"/>
   #Initialize UE 0
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_64SF" numSPSproc="1" ULSPSPcktSize="80" ULSPSimpRls="1"
         maxUlHqTx="5"  prdBsrTmr="65535"/>
   #Initialize UE 1
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
         ULSPSSchIntrv="RGR_SPS_PRD_80SF" numSPSproc="1" ULSPSPcktSize="80" ULSPSimpRls="1"
         maxUlHqTx="5"  prdBsrTmr="65535"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Configure bi-directional DTCH for UE0 on CRG 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>
      
      # Configure bi-directional DTCH for UE2 on CRG 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>
 
      # Configure bi-directional DTCH for UE0 on RGR 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5"
            ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>
      
   # Configure bi-directional DTCH for  UE1 on RGR 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5"
            ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG UE0 on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG UE1 on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # On CRG Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>
      
      # On CRG Configure bi-directional DTCH for UE2 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
   # On RGR Configure bi-directional DTCH for UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="5"
            ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      
      #On RGR Configure bi-directional DTCH for UE1 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="5" lcgId="0" dir="3" lcType="5"
            ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      
      # Configure UL LCG on RGR for UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
   
   # Send SR Indication UE0 or the default UE 
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0" />
        </tapa.tfu.sr.ind>
     </tapa.send>
   
      # ***************** TTI 1 ***********************
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Minimum Grant Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      # Send 4 TTI 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      #***************************** TTI 5 *************************** 
      # Expect data reception request for the Min Grant that the UE got in the step above
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
     
       # Send 3 TTIs ((2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #***************************** TTI 8 *************************** 
      #Send CRC for Msg for the default UE or the UE with ueId->0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 9 ************************
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
   
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      # **************************** TTI 10 ************************* 
      #Activation PDCCH for UE0 PRDCTY 64SF
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
           
      # Send 4 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # **************************** TTI 14 ************************* 
      # Expect data reception request for Activation PDCCH that we got 4 TT before for UE0 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>
      
      # Send 2 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # **************************** TTI 16 ************************* 
      # Fine lets send Our SR Indication for Ue 1 that is ueId=1 here.
      # Send SR Indication UE1  
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1" />
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # **************************** TTI 17 ************************* 
      # Minimum Grant Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Send CRC for Msg for the default UE or the UE with ueId->0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # ************************** TTI 18 ************************
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="0" use="3" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
    
      # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # **************************** TTI 21 ************************* 
      Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>

      # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      # ************************** TTI 24 ************************
      #Send CRC for Msg for UE1 or ueId->1
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # ************************** TTI 25 ************************
      # Expect HARQ ACK in PHICH for UE1
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
    
     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="1" addShortBsr="TRUE" lcgId="1" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # ************************** TTI 26 ************************
      #Activation PDCCH for UE1 PRDCTY 80SF
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send 4 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
     #Activation PDCCH for UE1 PRDCTY 80SF
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   

      # ************************** TTI 30 ***************************
      # Expect data reception request for UE1. 1st Occasion for UE1 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"
        isSpsRnti="FALSE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>

      # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"
        isSpsRnti="FALSE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>

     # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
  


      # **************************** TTI 33 ************************* 
      #Send CRC for Msg for  UE1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 34 ************************
      # Expect HARQ ACK in PHICH for UE1
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="1" use="4" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


# DONE with 1 st Ocassion for both UES
 
  <!--  # Send 50 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="44"/>
      </tapa.send>

      # ************************** TTI 78 ************************
      # Expect data reception request for 2nd Occasion of UE0 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>
   
      # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    
     # **************************** TTI 81 ************************* 
      #Send CRC for Msg for UE0 or the UE with ueId->0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 82 ************************
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="0" use="3" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
  
     # Send 22 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="28"/>
      </tapa.send>

      # ************************** TTI 110 ************************
      # Expect data reception request for UE1 2nd Occasion 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>

      # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 
      # **************************** TTI 113 ************************* 
      #Send CRC for Msg for  UE1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 114 ************************
      # Expect HARQ ACK in PHICH for UE1
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="1" use="4" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

     # Send 34 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="28"/>
      </tapa.send>
     
  # ************************** TTI 142 ************************
      # Expect data reception request for 3rd Occasion of UE0 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>
   
      # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    
     # **************************** TTI 145 ************************* 
      #Send CRC for UE0 or the UE with ueId->0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 146 ************************
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="0" use="3" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
  
     # Send 38 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="44"/>
      </tapa.send>

      # ************************** TTI 190 ************************
      # Expect data reception request for UE1. 3rd Occasion for UE1 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>

      # Send 3 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 
      # **************************** TTI 193 ************************* 
      #Send CRC for Msg for  UE1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 194 ************************
      # Expect HARQ ACK in PHICH for UE1
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="1" use="4" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 12 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
      
      # ************************** TTI 206 ************************
      # Expect data reception request for 4th Occasion of UE0 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>
   
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    
     # **************************** TTI 209 ************************* 
      #Send CRC for Msg for the default UE or the UE with ueId->0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 210 ************************
      # Expect HARQ ACK in PHICH
      <tapa.expect>
       <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="0" use="3" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
  
     # Send 60 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="60"/>
      </tapa.send>

      # ************************** TTI 270 ************************
      # Expect data reception request for 5th Occasion of UE0 
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3" isSpsRnti="TRUE"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
     </tapa.expset>
   

      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
    
     # **************************** TTI 273 ************************* 
      #Send CRC for Msg for the default UE or the UE with ueId->0
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
    
      #Send CRC for Msg for  UE1 
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      # Send 1 TTI  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # ************************** TTI 274 ************************
      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="0" use="3" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
  
      #Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  ueId="1" use="4" dedBufIdx="0" lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # So lets now delete the UE0. The Delete Type is 2.Put Cell ID in here as well. 
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="2" ueId="0"/>
      </tapa.send>
     
       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
  
     # So lets now Reset the UE1. UeId=1. 
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5" ueId="1"/>
      </tapa.send>
     
       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send 64 TTI. To check The UE that was Deleted. We dont get anything Here 
      # For UE0  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="64"/>
      </tapa.send>

      # Send 16 TTI. Next for the UE that was reset UE1 we dont get anything as well.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
-->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.50
#
#       Desc:    TC_MAC_FDD_UL_SPS_50
#                To verify UL SPS scheduling when PHR is present: de-activate
#                SPS.
#                
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.50">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify UL SPS scheduling when PHR is present: de-activate SPS."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="50"  numTxAntPorts="2" startRnti="70"
         rntiSize="11"   pMax="30"/>
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_10SF" ULSPSPcktSize="40" 
         ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
    ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="15"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
      isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" bufIdx="1" 
      lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="0" bsr="50"
      addPhr="TRUE" phr="1" />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<!--
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0"
           isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.51
#
#       Desc:    TC_MAC_FDD_UL_SPS_51
#                To verify UL SPS shouldn't be activated when PHR MAC CE comes
#                along, even when BSR > SID Packet Size.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.51">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify UL SPS shouldn't be activated when PHR MAC CE comes along,
          even when BSR > SID Packet Size."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Give a low value of CQI such that maxRbs would be less to activate SPS
# with a low PHR.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="8"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

#Since CQI is low, even with PHR of 20, SPS is not activated.
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="20" addPhr="TRUE" phr="20"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
     # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Another grant as the bsr is 20. 
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="FALSE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.52
#
#       Desc:    TC_MAC_FDD_UL_SPS_52
#                To verify SPS is not activated during DRX time.                  
#                Send BSR > SID Packet Size is received on SPS LC when UE is in
#                DRX time. (UE can send UL data in DRX).
#
#                PDCCH for SPS activation will be received in next possible
#                on/active time.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.52">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify SPS is not activated during DRX time.                  
          Send BSR > SID Packet Size is received on SPS LC when UE is in DRX time.
          (UE can send UL data in DRX).

          PDCCH for SPS activation will be received in next possible on/active
          time."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="LTEMAC_DRX"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" isDrxEnabled="TRUE"
      drxOnDurTmr="2" drxInactvTmr="2" drxRetxTmr="16" longDrxCycle="10" isShortDrxPrsnt="TRUE"
      shortDrxCycle="5" drxStartOffst="0" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="2"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
                         ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

#Activation PDCCH is received after 4 TTIs as UE was in DRX. Otherwise it comes
      in the next TTI.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
             isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      

     # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.53
#
#       Desc:    TC_MAC_FDD_UL_SPS_53
#                To verify SPS release PDCCH is not sent during DRX time.                                      
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.53">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify SPS release PDCCH is not sent during DRX time."
      </tapa.desc>
     <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="LTEMAC_DRX"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"
      isDrxEnabled="TRUE" drxOnDurTmr="1" drxInactvTmr="2" drxRetxTmr="16" longDrxCycle="10" 
      isShortDrxPrsnt="TRUE" shortDrxCycle="5" drxStartOffst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
                         ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="0" dir="3" lcType="5"
                        ulQci="1" instId="5" DLSPSLchEnabFlag="FALSE"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
            isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
           isSpsRnti="TRUE"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="5" isSpsRnti="TRUE" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
           isSpsRnti="TRUE"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
            lcId="5" isSpsRnti="TRUE" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

      #Sending non-sps data for explicit release- 1      

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
          isSpsRnti="TRUE"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
          lcId="5" isSpsRnti="TRUE" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="5,1" vldtBuf="TRUE"/>
      </tapa.expect>

      #Sending non-sps data for explicit release- 2      

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0"
           isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.54
#
#       Desc:    TC_MAC_FDD_UL_SPS_54
#                To verify adaptive retransmission of SPS data can be sent
#                during DRX time.
#
#                PDCCH for SPS activation will be received in next possible
#                on/active time.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.54">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify adaptive retransmission of SPS data can be sent during DRX
          time."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="LTEMAC_DRX"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" isDrxEnabled="TRUE"
      drxOnDurTmr="2" drxInactvTmr="2" drxRetxTmr="16" longDrxCycle="10" isShortDrxPrsnt="TRUE"
      shortDrxCycle="5" drxStartOffst="0" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="2"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
                         ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
             isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.55
#
#       Desc:    TC_MAC_FDD_UL_SPS_55
#                To verify non-adaptive retransmission of SPS data can be sent
#                during DRX time.
#
#                PDCCH for SPS activation will be received in next possible
#                on/active time.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.55">>

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the non-adaptive retransmission of SPS data in uplink."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="LTEMAC_DRX"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4"  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" isDrxEnabled="TRUE" drxOnDurTmr="2" 
      drxInactvTmr="2" drxRetxTmr="16" longDrxCycle="10" isShortDrxPrsnt="TRUE"
      shortDrxCycle="5" drxStartOffst="0" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0"
                lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request for non adaptive retx
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
        isSpsRnti="TRUE" isRetx="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
         </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.56
#
#       Desc:    TC_MAC_FDD_UL_SPS_56
#                To verify SPS scheduling in DRX time on SPS occasion.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.56">>

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify SPS scheduling in DRX time on SPS occasion."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="LTEMAC_DRX"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2" isDrxEnabled="TRUE"
      drxOnDurTmr="2" drxInactvTmr="2" drxRetxTmr="16" longDrxCycle="10"
      isShortDrxPrsnt="TRUE" shortDrxCycle="5" drxStartOffst="0" prdBsrTmr="65535"/>

      <tapa.rg.UeInit ueId="1" />


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
#         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1"  gbr="9000" lcgId="1" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
 
     # Send SR Indication for another UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>


      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
#Anshika - Add CQI validation
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
           vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="2">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
# Passing sduSz as 12 bytes (greater than SID packet size)
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" use="4" sduSzs="1" lcIds="4"
          />
       </tapa.tfu.dat.ind>
      </tapa.send>


# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
     <!-- 
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"
        isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<!--
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"
        isSpsRnti="FALSE"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>


       <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
   -->   
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" lcId="4"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
# Data indication not sent to RLC for ueId 1
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     <!-- 
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     --> 
           <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="4" dedBufIdx="0" lcId="4"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

# Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

<!--

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
 
      <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3"
      isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

# SPS reception request is received even when UE is in DRX      
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"
        isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>
 -->

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    19.57
#
#       Desc:    TC_MAC_FDD_UL_SPS_57
#                To verify SPS reactivation is not sent in DRX time.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="19.57">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify SPS reactivation is not sent in DRX time."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="LTEMAC_DRX"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1" prdBsrTmr="65535"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" isDrxEnabled="TRUE"
      drxOnDurTmr="2" drxInactvTmr="2" drxRetxTmr="16" longDrxCycle="10" isShortDrxPrsnt="TRUE"
      shortDrxCycle="5" drxStartOffst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="5"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
          ulQci="1" instId="5" DLSPSLchEnabFlag="TRUE"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
          <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
            isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
           isSpsRnti="TRUE"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
          lcId="4" isSpsRnti="TRUE"  />
        </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="1"/>
         </tapa.tfu.ulcqi.ind>
     </tapa.send>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
#SPS reactivation is sent when UE comes out of DRX      
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
              isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"
              ULSPSInit="FALSE" ULSPSReInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      # Expect data reception request
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
       <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    19.58
#
#       Desc:    TC_MAC_FDD_UL_SPS_58
#                To verify if higher layers have configured the
#                logicalChannelSR-Mask to be set, not configure PHY to read SR
#                from the UE as long as SPS is activated for the logical channel
#                associated with SPS.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="19.58">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify if higher layers have configured the logicalChannelSR-Mask
         to be set, not configure PHY to read SR from the UE as long as SPS is
         activated for the logical channel associated with SPS."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11"  />
      #Initialize UE
      <tapa.rg.UeInit  ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSimpRls="RGR_SPS_E2"  prdBsrTmr="65535" 
      LcSRMask = "TRUE" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" gbr="9000" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0"
     addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" 
            vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
            isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

# Send UE ReConfiguration for the same UE-0 created above for SR Cfg
# at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
      
# SR reception request is not received after 15 TTIs also
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
<!--
# Try a reconfiguration on the UE.
   <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue SPSRnti="65" UeReCfgType="65536" instId="5"
      ULSPSEnFlag="FALSE"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
   isSpsRnti="TRUE"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


   #Expect Configuration Confirm from LTEMAC
   <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
      
# SR reception request is not received after 15 TTIs also
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="40"/>
      </tapa.send>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


