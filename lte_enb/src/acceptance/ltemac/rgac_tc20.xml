#
#/********************************************************************20**
#
#     Name:    LTEMAC
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Group 
#
#     File:    rgac_tc20.xml
#
#     Sid:     $SID$ 
#
#     Prg:     dvasisht
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:hn:rga_tc20.xml

#
#
#       Test:    20.1
#
#       Desc:    To test successful UE Configuration at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR enabled.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.1">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and expect a positive configuration confirmation 
         from LTE MAC"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" />

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       txModeEnum="RGR_UE_TM_3"   aprdModeEnumPres="TRUE" 
        prdCqiCfg.type="TRUE" riEna="TRUE" srsCfgPres="TRUE" 
       srCfgPres="TRUE"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send UE config request for same Ue again to confirm above UE config
     # If not given default ueId is 0
     <tapa.send>
       <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect failure in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm status="15"/>
     </tapa.expect>

     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5"/>
    </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>
     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.2
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#           Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="20.2">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>
      
      #Finish RACH and then do UE Configuratrion
      <tapa.rg.UeInit ueId="0" txModeEnum="RGR_UE_TM_3"/>
      <tapa.rg.UeInit ueId="1"  txModeEnum="RGR_UE_TM_3" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="FALSE" srsCfgPres="TRUE" srCfgPres="TRUE"/>
      <tapa.rg.UeInit ueId="2" txModeEnum="RGR_UE_TM_3"/>
   </tapa.cfg>
   # Test Steps subsection
     <tapa.test>

    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>

    # Send UE ReConfiguration for the same UE-0 created above for SRS Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
      srsCfgPres="TRUE" UeReCfgType="8192" />
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
   srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="415" cqiRepType="0" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "2" UeReCfgType="4096" />
      </tapa.send>

   # Send UE ReConfiguration for the same UE-1 created above for SRS
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  srsBw="1"  srsCfgIdx="27" 
          sANSrs="FALSE" fDomPosi ="2" srResIdx="46" UeReCfgType="8192" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
       # Send UE ReConfiguration for the same UE-2 created above for ACQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
      # Send UE ReConfiguration for the same UE-2 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>

    # Send UE ReConfiguration for the same UE-2 created above for SRS Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" 
      srsCfgPres="TRUE" UeReCfgType="8192" />
      </tapa.send>

      # Send UE ReConfiguration for the same UE-2 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2"
   srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="2"/>
         <tapa.rgr.cfgCfm ueId="2"/>
         <tapa.rgr.cfgCfm ueId="2"/>
         <tapa.rgr.cfgCfm ueId="2"/>
      </tapa.expset>


     # Send UE ReConfiguration for the same UE-2 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2"  txModeEnum="RGR_UE_TM_3"
       cqiPResIdx="501" cqiPCfgIdx="415" cqiRepType="0" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "2" UeReCfgType="4096" />
      </tapa.send>

     # Send UE ReConfiguration for the same UE-2 created above for SRS
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2"  srsBw="1"  srsCfgIdx="27" 
          sANSrs="FALSE" fDomPosi ="2"  UeReCfgType="8192" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-2 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" srResIdx="46" 
          srCfgIdx="46" dTMax="16"  UeReCfgType="16384" />
      </tapa.send>


     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>
      
   # Expect success in cfg cfm from Scheduler
     <tapa.expset>
       <tapa.rgr.cfgCfm ueId="2"/>
       <tapa.rgr.cfgCfm ueId="2"/>
       <tapa.rgr.cfgCfm ueId="2"/>
    </tapa.expset>


    # Send UE ReConfiguration for the same UE-2 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-2 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

       # Send UE SRS ReConfiguration for the same UE-2 created above 
      # for SRS release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" srsCfgPres="FALSE" 
        UeReCfgType="8192" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-2 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="2"/>
         <tapa.rgr.cfgCfm ueId="2"/>
         <tapa.rgr.cfgCfm ueId="2"/>
         <tapa.rgr.cfgCfm ueId="2"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-2 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-2 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="405"  riCfgIdx = "501"
        UeReCfgType="4096" />
      </tapa.send>

       # Send UE SRS ReConfiguration for the same UE-2 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" 
       srsCfgPres="TRUE" srsCfgIdx="400"  
        UeReCfgType="8192" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-2 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="2" 
         srCfgPres="TRUE" srCfgIdx="315"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="2" />
          <tapa.rgr.cfgCfm ueId="2" />
          <tapa.rgr.cfgCfm ueId="2" />
          <tapa.rgr.cfgCfm ueId="2" />
      </tapa.expset>

  #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.3
#
#       Desc:    To test Failure Handling of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled, configured with Out-of-Range values
#                    and released and later configure them with proper Configuration parameters.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="20.3">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test failure handling for UE PCQI, RI, SR, SRS and ACQI Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Later reconfigure them Out-Of-Range PCQI,RI,
         ACQI,SRS and SR for UEID 0 and later reconfigure them with allowed range "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
        <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>  

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>
      
      #Finish RACH and then do UE Configuratrion
      <tapa.rg.UeInit ueId="0" txModeEnum="RGR_UE_TM_3" sANCQI ="TRUE" sANSrs="TRUE" />
      <tapa.rg.UeInit ueId="1" txModeEnum="RGR_UE_TM_3" sANCQI ="TRUE" sANSrs="TRUE"/>
   </tapa.cfg>
   
   # Test Steps subsection
     <tapa.test>
      # Send UE PCQI/RI ReConfiguration for the same UE-0 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>

       # Send UE SRS ReConfiguration for the same UE-0 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       srsCfgPres="TRUE" srsCfgIdx="1000"  
        UeReCfgType="8192" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-0 created above for  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
         srCfgPres="TRUE" srCfgIdx="254"
        UeReCfgType="16384" />
      </tapa.send>
    
        # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>

       # Send UE SRS ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
       srsCfgPres="TRUE" srsCfgIdx="1000"  
        UeReCfgType="8192" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
         srCfgPres="TRUE" srCfgIdx="254"
        UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_4" UeReCfgType="1" />
      </tapa.send>
      
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_4"
                aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3" UeReCfgType="1" />
      </tapa.send>
      
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="1"  txModeEnum="RGR_UE_TM_3" prdCqiCfg.type="TRUE" cqiRepType="0" cqiPCfgIdx="201" k="5"
         UeReCfgType="4096" />
      </tapa.send>
      
      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" status="15" />
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="0"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="0"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>

      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

       # Send UE SRS ReConfiguration for the same UE-1 created above 
      # for SRS release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srsCfgPres="FALSE" 
        UeReCfgType="8192" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>


      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
       aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="405"  riCfgIdx = "501"
        UeReCfgType="4096" />
      </tapa.send>

       # Send UE SRS ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       srsCfgPres="TRUE" srsCfgIdx="400"  
        UeReCfgType="8192" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="315"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>
             
  #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.4
#
#       Desc:    To test successful UE Configuration at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR enabled.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.4">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and expect a positive configuration confirmation 
         from LTE MAC"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxUlBwPerUe="20" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request at RGR 
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
        aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE" srCfgPres="TRUE"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

      # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect> 

     # Send UE config request for same Ue again to confirm above UE config
     # If not given default ueId is 0
     <tapa.send>
       <tapa.crg.cfgreq.cfg.ue ueId="0"/>
     </tapa.send>
     # Expect failure in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm ueId="0" status="15"/>
     </tapa.expect>

     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
    </tapa.send>
     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>
     # Expect failure in cfg cfm from Scheduler
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" ueId="0" status="15"/>
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.5
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#           Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="20.5">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

  # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" spclSfCfgIdx="8"
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
     aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      aprdModeEnumPres="TRUE" prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>       
      
    # Send UE ReConfiguration for the same UE-0 created above for Aperiodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
       UeReCfgType="2" />
      </tapa.send>
      
    # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" riEna="TRUE" UeReCfgType="4096" />
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
   srCfgPres="TRUE"  UeReCfgType="16384" />
      </tapa.send>

       # Send UE ReConfiguration for the same UE-1 created above for PRD DLCQI
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       cqiPResIdx="501" cqiPCfgIdx="315" cqiRepType="2" k="2" riCfgIdx = "501"
       sANCQI ="FALSE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD20" UeReCfgType="4096" />
      </tapa.send>


       # Send UE ReConfiguration for the same UE-1 created above for SR
      # Recfg at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgIdx="46" dTMax="16" 
        UeReCfgType="16384" />
      </tapa.send>
      
      
    # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="0"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>


    # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>
    
      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>
    
     # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

     #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="314"  riCfgIdx = "555"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="312"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

  #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.6
#
#       Desc:    To test Failure Handling of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled, configured with Out-of-Range values
#                    and released and later configure them with proper Configuration parameters.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="20.6">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test failure handling for UE PCQI, RI, SR, SRS and ACQI Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Later reconfigure them Out-Of-Range PCQI,RI,
         ACQI,SRS and SR for UEID 0 and later reconfigure them with allowed range "
      </tapa.longdesc>
   </tapa.doc>

     # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="0" spclSfCfgIdx="8"
         raWinSize="10" numTxAntPorts ="2"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="4" numRapId="2" rapIds="5:6" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="4"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" />
    </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="0"/>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   <tapa.delay delay="1"/>
   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" />
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0" />
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   <tapa.delay delay="1"/>
   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
      aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE"/>
   </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" txModeEnum="RGR_UE_TM_3"
      aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
      prdCqiCfg.type="TRUE" riEna="TRUE"  srCfgPres="TRUE" />
   </tapa.send>

      # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>  

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_1" UeReCfgType="1" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3" UeReCfgType="1" />
      </tapa.send>

         # Send UE PCQI/RI ReConfiguration for the same UE-0 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>


      # Send UE SR ReConfiguration for the same UE-0 created above for  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
         srCfgPres="TRUE" srCfgIdx="253"
        UeReCfgType="16384" />
      </tapa.send>
    
        # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="FALSE" cqiPCfgIdx="2000" 
        UeReCfgType="4096" />
      </tapa.send>


      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with out-of-range values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="253"
        UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  txModeEnum="RGR_UE_TM_3" UeReCfgType="1" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="1" />
         <tapa.rgr.cfgCfm ueId="1" />
         <tapa.rgr.cfgCfm ueId="0" status="15" />
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" status="15"/>
         <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>

      # Send UE ReConfiguration for the same UE-1 created above for ACQI Release
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
       aprdModeEnumPres="FALSE"  UeReCfgType="2" />
      </tapa.send>

      # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # for PRD DLCQI release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1"  prdCqiCfg.type="FALSE" 
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above 
      # for SR Release
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" srCfgPres="FALSE" 
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>


      # Send UE ReConfiguration for the same UE-1 created above for ACQI setup
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
          txModeEnum="RGR_UE_TM_3"
       aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>
      
       # Send UE PCQI/RI ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" txModeEnum="RGR_UE_TM_3"
          prdCqiCfg.type="TRUE" riEna="TRUE" cqiPCfgIdx="311"  riCfgIdx = "501"
        UeReCfgType="4096" />
      </tapa.send>

      # Send UE SR ReConfiguration for the same UE-1 created above  
      # with allowed range
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="1" 
         srCfgPres="TRUE" srCfgIdx="315"
        UeReCfgType="16384" />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind/>
      </tapa.send>

    #Expect positive Configuration Confirm from LTEMAC
      <tapa.expset>
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
          <tapa.rgr.cfgCfm ueId="1" />
      </tapa.expset>
             
  #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.7
#
#       Desc:    To test PCQI periodicity with PCQI configured 
#                   with a certain Periodicity for WideBand CQI. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.7">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3"  />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.8
#
#       Desc:    To test PCQI periodicity with PCQI configured 
#                   with a certain Periodicity for SubBand CQI. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.8">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI subband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  UeReCfgType="4096" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 5 (26/5) 
     #We will receive a WB CQI since, periodNum%H is 0 (5%5).
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 10 (51/5) 
    #We will receive a WB CQI since, periodNum%H is equal to 0 (10%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.9
#
#       Desc:    To test PCQI periodicity with RI configured 
#                   with a certain Periodicity. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.9">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a  RI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20"
       prdCqiCfg.type="TRUE" cqiRepType="2" cqiPCfgIdx = "3" riEna = "TRUE"  riCfgIdx = "5" UeReCfgType="4096" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.10
#
#       Desc:    To test PCQI periodicity with RI configured 
#                   with a certain Periodicity for SubBand CQI. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.10">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR UE Configuration"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI subband mode with a certain 
         Periodicity and expect a  RI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # But RI collides with PCQI in terms of Periodicity, hence RI will be received at (2,6) 
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  riEna = "TRUE"  riCfgIdx = "0" UeReCfgType="4096" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # Expect RI instead of PCQI since RI overrides during collision. 
     # RI occurs at tti 26 and later at tti 51 since rioffset will yield to -5. 
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
     # Expect DL CQI reception request from Scheduler
     # Expect RI instead of PCQI since RI overrides during collision. 
     # RI occurs at tti 26 and later at tti 51 since rioffset will yield to -5. 
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.11
#
#       Desc:    Handling of PCQI RR and HARQ RR with Simulataneous AckNack
#           set as False
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.11">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, PCQI Periodicity for a Reception Request 
           and for Simultaneous ACK/NACK is false and CQI case" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a PCQI Wideband mode with 
         a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq which should
         sync with a HQ RR and PCQI RR on the same TTI. With sANCQI set as false, only
         a HARQ RR should be received " 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" sANCQI="FALSE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
            transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (2,9) and Reception Request time is (3,1)
     # PDCCH and PDSCH sent at (2,5) will expect a HARQ Feedback at (2,9)
     # No CQI RR since sANCQI is false. Hence expecting only HQ RR 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.12
#
#       Desc:    Handling of PCQI RR and HARQ RR with Simulataneous AckNack
#           set as True
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.12">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, PCQI Periodicity for a Reception Request 
           and for Simultaneous ACK/NACK is TRUE and CQI case" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a PCQI Wideband mode with 
         a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq which should
         sync with a HQ RR and PCQI RR on the same TTI. With sANCQI set as false, only
         a HARQ RR should be received " 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
          cqiPResIdx="501" prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" sANCQI="TRUE" 
          UeReCfgType="4096" />
      </tapa.send>

     #TTI #23. The above configuration will be applied after TTI is incremented from 22 to 23. 
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
           transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (2,9) and Reception Request time is (3,1)
     # PDCCH and PDSCH sent at (2,5) will expect a HARQ Feedback at (2,9)
     # Also a CQI RR since sANCQI is TRUE. Hence expecting HQ RR + CQI RR
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="1" numRntis="1">
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.dlcqi.recp.req  />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.13
#
#       Desc:    Handling of RI RR and HARQ RR with Simulataneous AckNack
#           set as False
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.13">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, RI Periodicity for a Reception Request 
           and for Simultaneous ACK/NACK is False and CQI case" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a PCQI Wideband mode with 
         a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq which should
         sync with a HQ RR and RI RR on the same TTI. With sANCQI set as false, only
         a HARQ RR should be received.
         Note: PCQI and RI are configured in a manner that they too collide with the
          same periodicity in which case PCQI will be dropped. Since sANCQI set as false
          only HARQ RR will be sent."

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_4" cqiRepType ="2"
        prdModeEnum="RGAC_RGR_PRD_CQI_MOD21"  prdCqiCfg.type="TRUE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" cqiRepType ="2"
       prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" sANCQI="FALSE" 
        riEna = "TRUE"  riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
           transMode = "TFU_UE_TM_4" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (2,9) and Reception Request time is (3,1)
     # PDCCH and PDSCH sent at (2,5) will expect a HARQ Feedback at (2,9)
     # Neither CQI nor RI RR since sANCQI is false. Hence expecting only HQ RR 
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.14
#
#       Desc:    Handling of RI RR and HARQ RR with Simulataneous AckNack
#           set as True
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.14">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, RI Periodicity for a Reception Request 
           and for Simultaneous ACK/NACK is True and RI case" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish Cell, Common Logical Channel configurations at CRG and RGR
          and also finish RACH and then send UE Configuration request to
          LTE-MAC from Dummy RRC and reconfigure a PCQI Wideband Mode with 
          a certain periodicity. Send a PDSCH DatReq and PDCCH CntrlReq which 
          should sync with a HQ RR and RI RR on the same TTI. With sANCQI set
          as true, both RI RR and HARQ RR should be received.
          Note: PCQI and RI are configured in a manner that they too collide with the
          same periodicity in which case PCQI will be dropped."

       </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" sANCQI="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" 
        riEna = "TRUE"  riCfgIdx = "0" UeReCfgType="4096" cqiRepType="2"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
           transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (2,9) and Reception Request time is (3,1)
     # PDCCH and PDSCH sent at (2,5) will expect a HARQ Feedback at (2,9)
     # Also a RI RR since sANCQI is TRUE. Hence expecting HQ RR + CQI(RI) RR
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.15
#
#       Desc:    Handling of HARQ RR  and SR RR 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.15">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ and SR Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request with 
         a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq which should
         sync with a HQ RR and SR RR on the same TTI. HARQ and SR RR should
         be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
   
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_1" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
             chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
     # Expecting a HARQ and a SR RR.  
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.sr.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.16
#
#       Desc:    Handling of HARQ, PCQI and SR Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.16">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, PCQI and SR Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, PCQI RR and SR RR on the same TTI. 
         HARQ, PCQI and SR RR should  be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_1" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
             chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
     # Expecting a HARQ and a SR RR.  
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.17
#
#       Desc:    Handling of HARQ, RI and SR Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.17">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, RI and SR Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, RI RR and SR RR on the same TTI. 
         HARQ, RI and SR RR should  be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

    <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
             transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
     # Expecting a HARQ and a SR RR.  
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.18
#
#       Desc:    Handling of HARQ, SRS and SR Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.18">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, SRS and SR Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and SR RR on the same TTI. 
         HARQ, SRS and SR RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

    <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SRS Cfg
      # at RGR. At this point we are in (2,7) and a SRS Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
              chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
     # Expecting a HARQ and a SR and DLCQI RR. SRS will collide with PCQI
     # SRS RR will still not be dropped. 
     # This is non-deterministic in nature hence eNB sends RR type as
     # TFU_PUCCH_HARQ_SR_CQI_SRS  
     # ccpu00116923 - ADD - New Reception Request types for CQI and SRS with SR 
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.srs.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      # ccpu00116923 - ADD - New Reception Request types for CQI and SRS with SR 
      #Send SRS Indication 
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.19
#
#       Desc:    Handling of HARQ and SRS Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.19">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ and SRS Periodicity for a Reception Request with Simultaneous
         ACK/NACK and SRS set as false" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR and SRS RR on the same TTI. 
         Only HARQ should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

    <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0" txModeEnum="RGR_UE_TM_6" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SRS Cfg
      # at RGR. At this point we are in (2,7) and a SRS Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="FALSE" UeReCfgType="8192" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

        <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
            transMode = "TFU_UE_TM_6" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
      # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
      # Expecting a HARQ RR only since sANSRS is set as false.  
      <tapa.expset>
         <tapa.tfu.recp.req >
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

     
      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.20
#
#       Desc:    Handling of HARQ and SRS Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.20">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ and SRS Periodicity for a Reception Request with Simultaneous
         ACK/NACK and SRS set as true" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR and SRS RR on the same TTI. 
         HARQ and SRS RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0" txModeEnum="RGR_UE_TM_6" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
            transMode = "TFU_UE_TM_6" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
      # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
      # Expecting a HARQ and a SRS RR.  
      <tapa.expset>
         <tapa.tfu.recp.req >
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.srs.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      #Send SRS Indication 
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>
      
      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.21
#
#       Desc:    Handling of HARQ, SRS and CQI Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.21">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, SRS and CQI Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and CQI RR on the same TTI. 
         HARQ and CQI RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
              chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
     # Expecting a HARQ and a CQI RR.  
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.22
#
#       Desc:    Handling of HARQ, SRS and RI Reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.22">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, SRS and RI Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and RI RR on the same TTI. 
         HARQ and RI RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0" txModeEnum="RGR_UE_TM_3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a HARQ and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
    
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" txModeEnum="RGR_UE_TM_3" riEna = "TRUE"  riCfgIdx = "0"
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
              chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # PDCCH and PDSCH sent at (2,9) will expect a HARQ Feedback at (3,3)
     # Expecting a HARQ and a CQI RR.  
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.hq.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.23
#
#       Desc:    Handling of SR and PCQI reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.23">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PCQI and SR Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. The Configuration should be such that there should
         be a collision of SR and PCQI RR" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a PCQI and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        #Expect a Config Confirm for Confguration 
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Increment the Num of TTIs so as to set a collision
         # between two different Uplink entities 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # SR and RI, PCQI configured earlier will expect a RR.
     # Expecting a SR and DLCQI RR. 
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.24
#
#       Desc:    Handling of SR and RI reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.24">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SR and RI Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. The Configuration should be such that there should
         be a collision of SR, PCQI RR and RI RR" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a PCQI and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        #Expect a Config Confirm for Confguration 
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Increment the Num of TTIs so as to set a collision
         # between two different Uplink entities 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # SR and RI, PCQI configured earlier will expect a RR.
     # Expecting a SR and RI RR only since PCQI will be dropped. 
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.25
#
#       Desc:    Handling of SR and SRS reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.25">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SR and SRS Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. The Configuration should be such that there should
         be a collision of SR, PCQI RR and RI RR" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a SRS and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      # Send UE ReConfiguration for the same UE-0 created above for SRS Cfg
      # at RGR. At this point we are in (2,7) and a SRS Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        #Expect a Config Confirm for Confguration 
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Increment the Num of TTIs so as to set a collision
         # between two different Uplink entities 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #At this point crntTime is (3,3) and Reception Request time is (3,5)
     # SR and SRS configured earlier will expect a RR. 
     # Expecting a SR and SRS RR. 
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.srs.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>
      
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.26
#
#       Desc:    To test SRS periodicity with SRS configured 
#                   with a certain Periodicity. 
#
#       Notes:   None
#              
#       Module:  Reception Request for SRS 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.26">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Reception Request for for SRS only"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a SRS with a certain 
         Periodicity and expect a SRS reception request followed by a SRS Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,3)
     <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="10" 
          sANSrs="TRUE"  />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

     # At start of this step, we are at (3,1) and Reception Request Info time is (3,3)
     # Expect SRS reception request from Scheduler
      <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

     # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

    # At start of this step, we are at (4,1) and Reception Request Info time is (4,3)
     # Expect DL CQI reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.27
#
#       Desc:    To validate Data Reception Request and RI Reception Request collision
#
#       Notes:   None
#              
#       Module:  Reception Request on PUSCH
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.27">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI with a certain 
         Periodicity.Configure a ULSCH such that the Periodicity of RI should
         collide with with ULSCH for a UE and check for Data Reception Request
          for Data and RI together. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
         
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="7" 
          riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

           # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

       # At start of this step, we are at (2,8) and Reception Request Info time is (3,0)
      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.28
#
#       Desc:    To validate Data Reception Request and HARQ, RI Reception Request collision
#
#       Notes:   None
#              
#       Module:  Reception Request on PUSCH
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.28">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI with a certain 
         Periodicity.Configure a DLSCH and a ULSCH such that the Periodicity of RI should
         collide with with ULSCH for a UE and check for Data Reception Request
          for Data and HARQ, RI together. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>
        
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" 
          riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

     <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

       <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
       <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9"
            transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        </tapa.expset>  

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point of time we are at (2,9) and Reception Request Info time is (3,1)
      # Expect data reception request, HARQ for DL Data and RI
      # Initial Num RBs support for UCI on PUSCH
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" />
                 vldtInitNumRbs="1" initNumRbsPres="1"/>
            <tapa.tfu.dlcqi.recp.req />
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Send ACK for the received PDU
       <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.29
#
#       Desc:    To validate Data Reception Request and CQI Reception Request collision
#
#       Notes:   None
#              
#       Module:  Reception Request on PUSCH
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.29">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI with a certain 
         Periodicity.Configure a ULSCH such that the Periodicity of CQI should
         collide with with ULSCH for a UE and check for Data Reception Request
          for Data and PCQI together. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
         
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="7" 
           txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

           # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (2,8) and Reception Request Info time is (3,0)
      # Expect data reception request
      #Initial Num RBs support for UCI on PUSCH
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               vldtInitNumRbs="1" initNumRbsPres="1" />
            <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.30
#
#       Desc:    To validate Data Reception Request, SRS, RI and CQI Reception Request collision
#
#       Notes:   None
#              
#       Module:  Reception Request on PUSCH
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.30">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI with a certain 
         Periodicity.Configure a ULSCH such that the Periodicity of RI, CQI and SRS should
         collide with with ULSCH for a UE and check for Data Reception Request
          for Data, SRS and RI together. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="4"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_4" cqiRepType ="2"
        codeBookResPrsnt="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" prdCqiCfg.type="TRUE"/>

   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
         
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="7" 
           riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_4"  cqiRepType ="2"
          prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" UeReCfgType="4096" />
      </tapa.send>

      # Send UE config request at RGR 
     # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,0)
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="8192"
           srsCfgPres ="TRUE" srsCfgIdx ="7" />
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

     # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (2,8) and Reception Request Info time is (3,0)
      # Expect data reception request, RI RR and SRS RR. PCQI will collide with RI
      # hence it will be dropped. 
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
      #ccpu00117050 - ADD - nSrs setting 
      #Initial Num RBs support for UCI on PUSCH
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" nSrs="1"
               saveTo="2" vldtInitNumRbs="1" initNumRbsPres="1" />
            <tapa.tfu.dlcqi.recp.req />
            <tapa.tfu.srs.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.31
#
#       Desc:    To validate Data Reception Request and HARQ, RI, SRS Reception Request collision
#
#       Notes:   None
#              
#       Module:  Reception Request on PUSCH
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.31">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI, CQI and SRS with a certain 
         Periodicity.Configure a DLSCH and a ULSCH such that the Periodicity of RI, CQI, SRS 
         should collide with with ULSCH for a UE and check for Data Reception Request
          for Data and HARQ, SRS, RI together. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" codeBookResPrsnt="TRUE"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>
        
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" 
          riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      # Send UE config request at RGR 
     # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,1)
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="8192"
           srsCfgPres ="TRUE" srsCfgIdx ="8" />
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

     <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

       <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
       <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9"
            transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        </tapa.expset>  

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point of time we are at (2,9) and Reception Request Info time is (3,1)
      # Expect data reception request, HARQ for DL Data and RI
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
      #ccpu00117050 - ADD - nSrs setting 
      #Initial Num RBs support for UCI on PUSCH
      <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" nSrs="1" saveTo="2"
         vldtInitNumRbs="1" initNumRbsPres="1" />
            <tapa.tfu.dlcqi.recp.req />
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.srs.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send ACK for the received PDU
       <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.32
#
#       Desc:    To validate Data Reception Request and HARQ, SRS Reception Request collision
#
#       Notes:   None
#              
#       Module:  Reception Request on PUSCH
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.32">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure SRS with a certain 
         Periodicity.Configure a DLSCH and a ULSCH such that the Periodicity of RI, CQI, SRS 
         should collide with with ULSCH for a UE and check for Data Reception Request
          for Data and HARQ, SRS together. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3"
        prdCqiCfg.type="TRUE"/>

   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>
        
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send UE config request at RGR 
     # At start of this step, we are at (2,3) and Reception Request Info time is (2,5)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,1)
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="8192"
           srsCfgPres ="TRUE" srsCfgIdx ="8" />
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

     <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

       <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
       <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9"
            transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
        </tapa.expset>  

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point of time we are at (2,9) and Reception Request Info time is (3,1)
      # Expect data reception request, HARQ for DL Data and RI
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
      #ccpu00117050 - ADD - nSrs setting 
      #Initial Num RBs support for UCI on PUSCH
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" nSrs="1"
               saveTo="2" vldtInitNumRbs="1" initNumRbsPres="1" />
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.srs.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send ACK for the received PDU
       <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.33
#
#       Desc:   Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="20.33">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH." 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI and RI, CQI and SRS with a certain 
         Periodicity.Send DLSCH and do not send a Feedback so as to trigger a Aperiodic CQI
         Request through DCI-0. Configure a DLSCH and a ULSCH such that the Periodicity of 
         RI, CQI, SRS should collide with with ULSCH for a UE and collide with the Aperiodic CQI
         and check for Data Reception Request  for Data and HARQ, ACQI and SRS. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
        <tapa.flag id="DLFS_INV"/>
        <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               lcId="9" chkSdu="TRUE" saveTo="2"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="16" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      # Hence, the SRS will arrive on Reception Request Info time (3,1)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="8192"
            srsCfgPres ="TRUE" srsCfgIdx ="16" />
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9"
               transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
               cqiReq="TRUE"  vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point of time we are at (7,7) and Reception Request Info time is (7,9)
      # Expect data reception request, HARQ for DL Data and ACQI
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
      #ccpu00117050 - ADD - nSrs setting 
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE"  nSrs="1" saveTo="2"/>
            <tapa.tfu.dlcqi.recp.req />
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.srs.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.34
#
#       Desc:    To test RI periodicity when RI perodicity is beyond 320. 
#
#       Notes:   None
#              
#       Module:  TFU Upgrade 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.34">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To RI periodicity when RI perodicity is beyond 320"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a  RI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 10. 
     # Hence, the PCQI will arrive on Reception Request Info time (3,1)
     # for 640 periodicity change cqiPCfgIdx to "18" instead of 7 ttis gap make it 17
     # run the repeatCount loop "30"
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "8" riEna = "TRUE"  riCfgIdx = "805" UeReCfgType="4096" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

     <tapa.repeat.start repeatCount="29"/>

     # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

    <tapa.repeat.end/>

    # At start of this step, we are at (31,9) and Reception Request Info time is (32,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.35
#
#       Desc:    To test SRS periodicity with SRS configured 
#                   with a Periodicity of 320. 
#
#       Notes:   None
#              
#       Module:  Reception Request for SRS 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.35">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Reception Request for for SRS only"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a SRS with a certain 
         Periodicity and expect a SRS reception request followed by a SRS Indication"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,3)
     <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="318" 
          sANSrs="TRUE"  />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="297"/>
      </tapa.send>

     # At start of this step, we are at (31,9) and Reception Request Info time is (32,1)
     # Expect SRS reception request from Scheduler
      <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

     # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="317"/>
      </tapa.send>

    # At start of this step, we are at (63,9) and Reception Request Info time is (64,1)
     # Expect DL CQI reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" />
         </tapa.tfu.srs.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.36
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 1-0. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.36">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 1-0"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Set a Raw CQI and verify whether the Decoding is proper."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3"  />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="2"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="15"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#       Test:    20.37
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 1-1 for 2 Antenna Ports. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.37">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 1-1(2 Tx Antenna Ports)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Set a Raw CQI and verify whether the Decoding is proper."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue />
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4"
          prdModeEnum="RGAC_RGR_PRD_CQI_MOD11" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
          cqiRepType="1"  riEna = "TRUE"  riCfgIdx = "161" ueCatEnum ="CM_LTE_UE_CAT_2" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="50"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler, this would be a RI RR
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#       Test:    20.38
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 1-1 for 4 Antenna Ports. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.38">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 1-1 (4 Tx Antenna Ports)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Set a Raw CQI and verify whether the Decoding is proper when there are 
         4 Tx Antenna Ports."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="4" ulTxAntSelPres="TRUE"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue />
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4" codeBookResPrsnt="TRUE"
          prdModeEnum="RGAC_RGR_PRD_CQI_MOD11" prdCqiCfg.type="TRUE" cqiPCfgIdx
          = "3" pmiBitMap1="65535"
          cqiRepType="1"  riEna = "TRUE"  riCfgIdx = "161" ueCatEnum
          ="CM_LTE_UE_CAT_2" pmiBitMap0="65535"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="50"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler, this would be a RI RR
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.39
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 2-0 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.39">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 2-0(WideBand and SubBand Occasions)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI SubBand mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Check Raw CQI Decoding  for one WideBand and Other SubBand occasions."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  UeReCfgType="4096" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 5 (26/5) 
     #We will receive a WB CQI since, periodNum%H is 0 (5%5).
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 10 (51/5) 
    #We will receive a WB CQI since, periodNum%H is equal to 0 (10%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="51"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.40
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 2-1 
#             for 2 Tx Antenna Ports
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.40">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 2-1(WideBand and SubBand Occasions)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI SubBand mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Check Raw CQI Decoding  for one WideBand and Other SubBand 
         occasions when there are 2 Tx Antenna Ports."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4" codeBookResPrsnt="TRUE"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  UeReCfgType="4096" riEna = "TRUE"  riCfgIdx = "161" ueCatEnum ="CM_LTE_UE_CAT_2"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 5 (26/5) 
     #We will receive a WB CQI since, periodNum%H is 0 (5%5).
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 10 (51/5) 
    #We are intended to receive a WB CQI since, periodNum%H is equal to 0 (10%5)
    #since RI RR collides with Wide CQI, RI RR will be sent
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Now that Rank has changed to 2, the Bitwidth changes for CQI Params

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,4) and Reception Request Info time is (5,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 11 (56/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (11%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,9) and Reception Request Info time is (6,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 12 (61/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (12%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,4) and Reception Request Info time is (6,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 13 (66/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (13%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,9) and Reception Request Info time is (7,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 14 (71/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (14%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (7,4) and Reception Request Info time is (7,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 15 (76/5) 
     #We will receive a WB CQI since, periodNum%H is equal to 0 (15%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.41
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 2-1 
#             for 4 Tx Antenna Ports
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.41">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 2-1(WideBand and SubBand Occasions)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI SubBand mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Check Raw CQI Decoding  for one WideBand and Other SubBand 
         occasions when there are 4 Tx Antenna Ports."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="4"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     # H = J*K+1 hence will be 5 in the test case
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_4"
       prdModeEnum="RGAC_RGR_PRD_CQI_MOD21" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" 
       cqiRepType="2" K="1"  UeReCfgType="4096" riEna = "TRUE"  riCfgIdx = "161" ueCatEnum ="CM_LTE_UE_CAT_2"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 5 (26/5) 
     #We will receive a WB CQI since, periodNum%H is 0 (5%5).
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 6 (31/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (6%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 7 (36/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (7%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,9) and Reception Request Info time is (4,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 8 (41/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (8%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

     # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (4,4) and Reception Request Info time is (4,6)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 9 (46/5) 
    #We will receive a SB CQI since, periodNum%H is not equal to 0 (9%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (4,9) and Reception Request Info time is (5,1)
    # Expect DL CQI reception request from Scheduler
    # periodNum is tti/periodicity which is equal to 10 (51/5) 
    #We are intended to receive a WB CQI since, periodNum%H is equal to 0 (10%5)
    #since RI RR collides with Wide CQI, RI RR will be sent
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Now that Rank has changed to 2, the Bitwidth changes for CQI Params

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,4) and Reception Request Info time is (5,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 11 (56/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (11%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (5,9) and Reception Request Info time is (6,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 12 (61/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (12%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,4) and Reception Request Info time is (6,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 13 (66/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (13%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (6,9) and Reception Request Info time is (7,1)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 14 (71/5) 
     #We will receive a SB CQI since, periodNum%H is not equal to 0 (14%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (7,4) and Reception Request Info time is (7,6)
     # Expect DL CQI reception request from Scheduler
     # periodNum is tti/periodicity which is equal to 15 (76/5) 
     #We will receive a WB CQI since, periodNum%H is equal to 0 (15%5)
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1 ="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.42
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 1-2 
#                   (Multiple PMI) when Tx Antennas =2
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.42">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 1-2 (Multiple PMI)
         when Tx Antennas =2"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" codeBookResPrsnt="TRUE" prdBsrTmr="65535"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" aprdModeEnumPres="TRUE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD12"
           aprdModeEnumPres="TRUE"  UeReCfgType="2" codeBookResPrsnt="TRUE"
           pmiBitMap0="65535" pmiBitMap1="65535"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

     <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            transMode = "TFU_UE_TM_4" lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
                isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
                isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
                isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="234" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.43
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 1-2 
#                   (Multiple PMI) when Tx Antennas =4
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.43">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 1-2 (Multiple PMI)
         when Tx Antennas =4"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="4" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10"
          aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD12"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

     <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            transMode = "TFU_UE_TM_4" lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="234" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.44
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 2-0 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.44">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 2-0"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" codeBookResPrsnt="TRUE" prdBsrTmr="65535"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_3" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_3" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_3" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_3" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="234" byte2="255" byte3="255" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.45
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 2-2 
#                   when Tx Antennas = 2
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.45">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 2-2 
         when Tx Antennas =2"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" 
            aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD22"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255" byte2="255" byte3="255"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

     <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            transMode = "TFU_UE_TM_4" lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255" byte2="255" byte3="255" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.46
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 2-2 
#                   when Tx Antennas = 4
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.46">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 2-2 
         when Tx Antennas =4
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="4" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" 
          aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD22"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255" byte2="255" byte3="255"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

     <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            transMode = "TFU_UE_TM_4" lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255" byte2="255" byte3="255" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.47
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 3-0 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.47">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 3-0"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
            aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_3" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_3" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_3" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_3" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="234"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.48
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 3-1 
#                   when Tx Antennas = 2
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.48">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 3-1 
         when Tx Antennas =2"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" 
             aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255"  />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

     <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               transMode = "TFU_UE_TM_4" lcId="9" chkSdu="TRUE" validate="FALSE" 
               saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9" validate="FALSE"
               isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9" validate="FALSE"
               isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9" validate="FALSE"
               isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255" byte2="255" byte3="255" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.49
#
#       Desc:   Verify Aperiodic CQI Raw CQI Decoding for Aperiodic Mode 3-1 
#                   when Tx Antennas = 4
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.49">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.212" section=""/>
      <tapa.module id=""/>

       <tapa.desc>
         "To test Raw CQI Decoding for Aperiodic Mode 3-1 
         when Tx Antennas =4"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI .Send DLSCH and do not
         send a Feedback so as to trigger a Aperiodic CQI Request through DCI-0. 
         Check whether a DLCQI RR is received followed by Raw CQI Indication. 
         Verify the decoding for the configured Mode for Different Ranks and when
         Num Tx Antennas are 4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
      <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="DLFS_INV"/>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="4" />

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_4" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD10" 
             aprdModeEnumPres="TRUE" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               lcId="9" transMode = "TFU_UE_TM_4" chkSdu="TRUE"
               saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_4"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD31"
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255"  />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

     <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               transMode = "TFU_UE_TM_4" lcId="9" chkSdu="TRUE" validate="FALSE" 
               saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect retransmission from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
               transMode = "TFU_UE_TM_4" lcId="9"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      #VERIFY CQIREQ IS SET TO TRUE.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" cqiReq="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="255" byte1="255" byte2="255" byte3="255" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.50
#
#       Desc:    To test Tx Antenna Selection through SRS using Closed-Loop Mode 
#
#       Notes:   None
#              
#       Module:  Reception Request for SRS 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.50">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Tx Antenna Selection through SRS using Closed-Loop Mode"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a SRS with a certain 
         Periodicity and expect a SRS reception request followed by a SRS Indication.
         With Closed-Loop Transmit Antenna Selection, Antenna Ports Chosen will depend
         on CQI values received on two Ports on successive SRS Indications. A comparison will
         be done and an Antenna with a better CQI shall be chosen. "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Initialize UE
      <tapa.rg.UeInit ueId="0" ulTxAntSelPres = "TRUE" 
          selType="RGAC_RGR_UE_TX_ANT_CLOSEDLOOP"/>
   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
     <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

    # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,2)
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="9" 
          sANSrs="TRUE"   UeReCfgType="8192"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

     # At start of this step, we are at (3,0) and Reception Request Info time is (3,2)
     # Expect SRS reception request from Scheduler
      <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

     # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send SRS Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="6"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

     # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" isTxAntSel="TRUE" txAntenna="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # At start of this step, we are at (4,0) and Reception Request Info time is (4,2)
     # Expect SRS reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="7"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" isTxAntSel="TRUE" txAntenna="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # At start of this step, we are at (5,0) and Reception Request Info time is (5,2)
     # Expect SRS reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

      
      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send SRS Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="9"/>
         </tapa.tfu.srs.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.51
#
#       Desc:    To test Tx Antenna Selection through SRS using Open-Loop Mode 
#
#       Notes:   None
#              
#       Module:  Reception Request for SRS 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.51">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Tx Antenna Selection through SRS using Open-Loop Mode"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a SRS with a certain 
         Periodicity and expect a SRS reception request followed by a SRS Indication.
         With Open Loop Transmit Antenna Selection, always Antenna port-0 is selected
         irrespective of CQI value receieved for the UL Channel."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Initialize UE
      <tapa.rg.UeInit ueId="0" ulTxAntSelPres = "TRUE" 
          selType="RGAC_RGR_UE_TX_ANT_OPENLOOP"/>
   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
     <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

    # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Periodicity yielded from below step will be 10. 
     # Hence, the SRS will arrive on Reception Request Info time (3,2)
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="9" 
          sANSrs="TRUE"   UeReCfgType="8192"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

     # At start of this step, we are at (3,0) and Reception Request Info time is (3,2)
     # Expect SRS reception request from Scheduler
      <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

     # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send SRS Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="6"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

     # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" isTxAntSel="TRUE" txAntenna="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # At start of this step, we are at (4,0) and Reception Request Info time is (4,2)
     # Expect SRS reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="TRUE" widecqi="7"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           vldtTx="TRUE" isTxAntSel="TRUE" txAntenna="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       # At start of this step, we are at (5,0) and Reception Request Info time is (5,2)
     # Expect SRS reception request from Scheduler
    <tapa.expect>
        <tapa.tfu.recp.req >
           <tapa.tfu.srs.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expect>

      
      # Send TTI to increment as many to receive SRS RR (since periodicity is set to 10)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send TTI to increment as many to receive SRS Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send SRS Indication 
      <tapa.send >
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0" widecqipres="FALSE" widecqi="9"/>
         </tapa.tfu.srs.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.52
#
#       Desc:    To test PCQI periodicity with PCQI configured with a certain 
#                 Periodicity for WideBand CQI in case of TDD config 2.
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE 
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.52">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test PCQI periodicity with PCQI configured with a certain Periodicity
         for WideBand CQI."
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
           <tapa.flag id="TFU_UPGRADE"/>
           <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
        numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
        ulStartSfIdxLst="10:10" numTxAntPorts ="4"/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index time:(0,3) 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq time:(0,7)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp time:(1,6)
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3 time:(1,9)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      <tapa.expect> time:(2,2)
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4 time(2,3)
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY. time:(2,4)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. time:(3,1)
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4. time(3,4)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request(3,4)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0"  codeBookResPrsnt="TRUE" txModeEnum="RGR_UE_TM_3" prdCqiCfg.type="TRUE" 
              cqiPCfgIdx ="3" sANCQI="TRUE" 
                riEna = "FALSE"  riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>
     
     
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect success in cfg cfm(3,5)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #For the confiuration parameters set offset=2 and perioditicity=5.
      #Thus (37-2)%5=0 So expect the CQI RR at 35 time:(3,5)
      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication (3,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #(42-2)%5=0 So expect the CQI RR at 40 time:(4,0)
      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #(47-2)%5=0 So expect the CQI RR at 45 time:(4,5)
      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
   #Send Raw CQI Indication (4,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.53
#
#       Desc:    Handling of HARQ, PCQI and RI Reception requests in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.53" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of HARQ, PCQI and RI Reception requests in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a  RI reception request followed by a RAW CQI Indication"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="4" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq (0,7)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp (1,6)
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3 (2,0)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req. (2,1)
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3 (2,2)
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4 (2,3)
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY. (2,4)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. (3,1)
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4. (3,4)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request(3,4)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_4"  codeBookResPrsnt="TRUE"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="8" sANCQI="TRUE" prdModeEnum = "RGAC_RGR_PRD_CQI_MOD21"
            riEna = "TRUE"  cqiRepType="2" riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,5)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send> 
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

     #For configuration set above offset=2 and periodicity=10 (42-2)%10=0
     #Thus expect CQI RR here at 42
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>
      </tapa.expset>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Send Raw CQI Indication (4,5)
      <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
           <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
        
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
        
        #For the data sent 4 tti's earlier expect HQ RR and (52-2)%10=0
        #Thus expect both HQ RR and CQI RR
      <tapa.expset>
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.54
#
#       Desc:    Handling of HARQ, PCQI and SR Reception requests in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.54" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HARQ, PCQI and SR Periodicity for a Reception Request in TDD" 
      </tapa.desc>

      <tapa.longdesc>
        "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, PCQI RR and SR RR on the same TTI. 
         HARQ, PCQI and SR RR should  be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"  codeBookResPrsnt="TRUE"
            srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_1" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.sr.recp.req/>
             <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    20.55
#
#       Desc:    Handling of HARQ, PCQI, SRS and SR Reception requests
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="20.55" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of HARQ, PCQI, SRS and SR Reception requests in TDD"
      </tapa.desc>

      <tapa.longdesc>
        "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and SR RR on the same TTI. 
         HARQ, SRS and SR RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"  codeBookResPrsnt="TRUE"
            srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      #Configure SRS
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="22" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>
      
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiPCfgIdx ="13" sANCQI="TRUE" 
              riEna="TRUE"  riCfgIdx="0" cqiRepType="2" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
      
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Since CQI and SRS periodicities collide, SRS RR will still not be dropped. 
      # This is non-deterministic in nature hence eNB sends RR type as
      # TFU_PUCCH_HARQ_SR_CQI_SRS  
      # ccpu00116923 - ADD - New Reception Request types for CQI and SRS with SR 
      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
              <tapa.tfu.sr.recp.req/>
              <tapa.tfu.srs.recp.req/>
             <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

      # ccpu00116923 - ADD - New Reception Request types for CQI and SRS with SR 
      #Send SRS Indication 
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
   # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.56
#
#       Desc:    Handling of HARQ, SRS and CQI Reception requests
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="20.56" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of HARQ, SRS and CQI Reception requests in TDD."
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. Send a PDSCH DatReq and PDCCH CntrlReq 
         which should sync with a HQ RR, SRS RR and RI RR on the same TTI. 
         HARQ and RI RR should be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="22" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" 
              riEna="TRUE"  riCfgIdx="0" txModeEnum="RGR_UE_TM_3" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
             <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
   # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.57
#
#       Desc:    To validate Data Reception Request and HARQ, RI, SRS Reception Request collision in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="20.57" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To validate Data Reception Request and HARQ, RI, SRS Reception 
         Request collision in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a RI, CQI and SRS with a certain 
         Periodicity.Configure a DLSCH and a ULSCH such that the Periodicity of RI, CQI, SRS 
         should collide with with ULSCH for a UE and check for Data Reception Request
          for Data and HARQ, SRS, RI together. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      #Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="5" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "1" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="22" 
          sANSrs="TRUE" UeReCfgType="8192" />
      </tapa.send>
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" 
              riEna="TRUE"  riCfgIdx="0" txModeEnum="RGR_UE_TM_3" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="10"/>
     </tapa.send>


     #Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
             <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
      #ccpu00117050 - ADD - nSrs setting 
      #Initial Num RBs support for UCI on PUSCH
      <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" nSrs="1" saveTo="2"
         vldtInitNumRbs="1" initNumRbsPres="1" />
              <tapa.tfu.hq.recp.req/>
              <tapa.tfu.srs.recp.req />
             <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="FALSE:TRUE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>

     #Send CRC for Msg
     <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
     </tapa.send>
     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs widecqipres="FALSE" ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
    </tapa.send>
    
    #Send Data Indication using TB size recieved in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="9"/>
        </tapa.tfu.dat.ind>
    </tapa.send>
    
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
      </tapa.expect>
      
 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.58
#
#       Desc:    Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml

<tapa.testcase id="20.58" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Aperiodic CQI collision with a Periodic CQI on a PUSCH in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a ACQI and RI, CQI and SRS with a certain 
         Periodicity.Send DLSCH and do not send a Feedback so as to trigger a Aperiodic CQI
         Request through DCI-0. Configure a DLSCH and a ULSCH such that the Periodicity of 
         RI, CQI, SRS should collide with with ULSCH for a UE and collide with the Aperiodic CQI
         and check for Data Reception Request  for Data and HARQ, ACQI and SRS. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"
               aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" aprdModeEnumPres="TRUE" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      #Configure bi-directional DTCH for default UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="9" lcgId="0" dir="3" lcType="5" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "1" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="4"/>
     </tapa.send>

      <tapa.send>(4,0)
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
     </tapa.send>
      
      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.cntrl.req numCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" saveTo="3" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # No feedback sent in this TC - same as NACK

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>(4,3)
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     #No harq feedback is sent- same as sending nack
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>(4,3)
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #No hq feedback sent-same as sending nack
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>
     
      <tapa.expset>(4,3)
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req ueId="0" use="4" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" 
                 isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
             <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="0" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>(4,7)
          <tapa.tfu.recp.req numRntis="1">
              <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     #No harq feedback is sent- same as sending nack

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      
      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      # Hence, the SRS will arrive on Reception Request Info time (3,1)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" UeReCfgType="8192"
            srsCfgPres ="TRUE" srsCfgIdx ="22" />
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20" 
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50"/>
      </tapa.send>

     #Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>(4,2)
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      <tapa.expset>(4,3)
         <tapa.tfu.cntrl.req numCntrlReq="1">
             <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
             <tapa.tfu.pdcch.cntrl.req saveTo="1" cqiReq="TRUE" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="2" transMode = "TFU_UE_TM_3" lcId="3" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point of time we are at (7,7) and Reception Request Info time is (7,9)
      # Expect data reception request, HARQ for DL Data and ACQI
      <tapa.expset>
          <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.srs.recp.req />
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.dlcqi.recp.req />
      #ccpu00117050 - ADD - nSrs setting 
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE"  nSrs="1" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs/>
         </tapa.tfu.srs.ind>
      </tapa.send>

       # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="FALSE:TRUE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
    </tapa.send>
    
    #Send Data Indication using TB size recieved in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat use="2" lcId="9"/>
        </tapa.tfu.dat.ind>
    </tapa.send>

    
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
             <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
      </tapa.expect>
 </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#       Test:    20.59
#
#       Desc:    To test successful Configuration/Re-Configuration of Multiple UEs at CRG and RGR
#                   with PCQI,RI, ACQI,SRS and SR being enabled and released and various other
#           Configuration parameters set.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#

<tapa.testcase id="20.59">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG and RGR Multiple UEs Configuration, 
           Reconfiguration, config params setting and Release"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC with enabling  PCQI,RI, ACQI,SRS and SR for Few
         UEs, Reconfigure them with  PCQI,RI, ACQI,SRS and SR enabled for few other
         UEs and set various other configuration parameters "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
       <tapa.ifdef>
          <tapa.flag id="DLFS_INV"/>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" dlSchdType="0"/>
      
      #Finish RACH and then do UE Configuratrion
      <tapa.rg.UeInit ueId="0" txModeEnum="RGR_UE_TM_3" prdBsrTmr="65535"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE"/>

      <tapa.rg.UeInit ueId="1" txModeEnum="RGR_UE_TM_3" prdBsrTmr="65535"
          aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" aprdModeEnumPres="TRUE"/>
   </tapa.cfg>
   
   # Test Steps subsection
     <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" ueId="0" />
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" ueId="1" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0" ueId="0"/>
         <tapa.crg.cfgcfm status="0" ueId="0"/>
         <tapa.crg.cfgcfm status="0" ueId="1"/>
         <tapa.crg.cfgcfm status="0" ueId="1"/>
     </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5" ueId="0"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="0"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
               lcId="9" chkSdu="TRUE" saveTo="2"/>
         </tapa.tfu.dat.req>
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="3" ueId="1"/>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="2" ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1" use="1" 
               lcId="9" chkSdu="TRUE" saveTo="2"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" chkTransId="3" ueId="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # No feedback sent in this TC - same as NACK
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         #Expect retransmission from MAC to PHY for both the data
         #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="0"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="1"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect HARQ reception request for 2 Data retransmitted
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="2" TTI="900"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="0"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" 
                lcId="9" ueId="1"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE" ueId="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>
     
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1" TTI="400"/>
      </tapa.send> 

      <tapa.expset>
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="4" chkSdu="TRUE" 
                lcId="9" ueId="0"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req use="4" chkSdu="TRUE" 
                lcId="9" ueId="1"
               isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" use="1" vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="4" use="1" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect retransmission from MAC to PHY.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # No feedback sent - same as NACK

      <tapa.send>
         # Verify No further retransmissions. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
    
      # Send UE config request at RGR 
      # At start of this step, we are at (9,0) and Reception Request Info time is (9,2)
      # Periodicity yielded from below step will be 10. 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newcrnti="11" prdCqiCfg.type="TRUE" cqiPCfgIdx ="15" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" newcrnti="12" prdCqiCfg.type="TRUE" cqiPCfgIdx ="15" 
            riEna = "TRUE"  riCfgIdx = "0" txModeEnum="RGR_UE_TM_3" 
            UeReCfgType="4096" />
      </tapa.send>

      # Send UE config request at RGR 
      # At start of this step, we are at (7,1) and Reception Request Info time is (7,3)
      # Periodicity yielded from below step will be 10. 
      # Hence, the SRS will arrive on Reception Request Info time (3,1)
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newcrnti="11" UeReCfgType="8192"
            srsCfgPres ="TRUE" srsCfgIdx ="15" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" UeReCfgType="8192" newcrnti="12"
            srsCfgPres ="TRUE" srsCfgIdx ="15" />
      </tapa.send>

      # Send UE ReConfiguration for UE-0 created above for ACQI setup
      # at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" newcrnti="11" txModeEnum="RGR_UE_TM_3"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="1" txModeEnum="RGR_UE_TM_3" newcrnti="12"
            aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
            aprdModeEnumPres="TRUE"  UeReCfgType="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
      </tapa.expset>
     
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50" ueId="0"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU.
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9"
               transMode = "TFU_UE_TM_3" chkSdu="TRUE" saveTo="6"/>
            <tapa.tfu.pdsch.dat.req ueId="1"  use="8" lcId="9"
               transMode = "TFU_UE_TM_3" chkSdu="TRUE" saveTo="7"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="4">
            <tapa.tfu.pdcch.cntrl.req saveTo="9" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0" isUlGrant="TRUE" 
               cqiReq="TRUE"  vldtGrant="TRUE" vldtTx="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="8" ueId="1"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" isUlGrant="TRUE" 
               cqiReq="TRUE"  vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset> 
     
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #At this point of time we are at (7,7) and Reception Request Info time is (7,9)
      # Expect data reception request, HARQ for DL Data and ACQI
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.dlcqi.recp.req ueId="0"/>
            <tapa.tfu.dlcqi.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req >
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"
               nSrs="0" ueId="0"/>
            <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="4"
               nSrs="0" ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="1" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send SRS Indication for default UE
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="1"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat ueId="0" use="3"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat ueId="1" use="4"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
  </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    20.60
#
#       Desc:   "To test ACK NACK Rep collision with PCQI reception"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc20.xml
#
################################################################################
<tapa.testcase id="20.60" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
          "To test ACK NACK Rep collision with PCQI reception"
      </tapa.desc>

      <tapa.longdesc>
          "To test ACK NACK Rep collision with PCQI reception"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" />
      # UE Configuration
      <tapa.rg.UeInit ueId="0"  isAckNackEnabled="TRUE" pucchAckNackRep="1001" 
          ackNackRepFactor="RGR_ACKNACK_REPFACT_N4" 
          txModeEnum="RGR_UE_TM_3" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="36" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx ="9" sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" 
            transMode = "TFU_UE_TM_3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #At this point crntTime is (2,9) and Reception Request time is (3,1)
     # PDCCH and PDSCH sent at (2,5) will expect a HARQ Feedback at (2,9)
     # No CQI RR since sANCQI is false. Hence expecting only HQ RR 
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" numRntis="1">
        <tapa.tfu.hq.recp.req isRepeating="TRUE"  n1PucchAnRep="1001"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" numRntis="1">
        <tapa.tfu.hq.recp.req isRepeating="TRUE"  n1PucchAnRep="1001"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" numRntis="1">
        <tapa.tfu.hq.recp.req isRepeating="TRUE"  n1PucchAnRep="1001"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" numRntis="1">
      <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.61
#
#       Desc:    Handling of PCQI and SR Reception requests in TDD
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.61" >
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify  PCQI and SR Periodicity for a Reception Request in TDD" 
      </tapa.desc>

      <tapa.longdesc>
        "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. PCQI RR and SR RR on the same TTI. 
         PCQI and SR RR should  be recieved" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
         dlTotalBw="50" rntiSize="2" numTxAntPorts="2" />
      # UE Configuration - not doing it here as it did not work, and other TDD
      # TCs are doing it manually later
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index (0,3)
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      # Send UE config request(3,6)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0" txModeEnum="RGR_UE_TM_3"  codeBookResPrsnt="TRUE"
            srCfgPres ="TRUE" srCfgIdx ="12"  UeReCfgType="16384" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm(3,7)
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

        <tapa.send>(3,8)
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      # Send UE config request(3,8)
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="13" sANCQI="TRUE" UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
      # Expect success in cfg cfm(3,9)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="7"/>
     </tapa.send>

      <tapa.expset>(4,7)
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.dlcqi.recp.req />
             <tapa.tfu.sr.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      
      #Send Raw CQI Indication
     <tapa.send >
        <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
        </tapa.tfu.rawdlcqi.ind>
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
    </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

    # Send multiple TTIs to validate that nothing else is rcvd
     <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

# ccpu00116923 - ADD - New Reception Request types for CQI and SRS with SR 
#
#
#       Test:    20.62
#
#       Desc:    Handling of SR, SRS and PCQI reception requests
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.62">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PCQI,SRS and SR Periodicity for a Reception Request " 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request and Wideband
         CQI with a certain Periodicity. The Configuration should be such that there should
         be a collision of SR, SRS and PCQI RR" 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="10"  UeReCfgType="16384" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

     # Increment 4 TTIs to 'create' a sync for a PCQI and SR RR
     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Send UE ReConfiguration for the same UE-0 created above for SRS Cfg
      # at RGR. At this point we are in (2,7) and a SRS Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" srsCfgPres ="TRUE" srsCfgIdx ="12" 
          sANSrs="TRUE" UeReCfgType="8192" />
    </tapa.send>

     # Send UE ReConfiguration for the same UE-0 created above for Periodic CQI Cfg
      # at RGR. At this point we are in (2,7) and a PCQI Index will be set for TTI#35
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="12" 
          sANCQI="TRUE" txModeEnum="RGR_UE_TM_3" 
          UeReCfgType="4096" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        #Expect a Config Confirm for Confguration 
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Increment the Num of TTIs so as to set a collision
         # between two different Uplink entities 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

     # At this point crntTime is (3,3) and Reception Request time is (3,5)
     # SR and RI, PCQI configured earlier will expect a RR.
     # Expecting a SR and DLCQI RR. 
      <tapa.expset>
     <tapa.tfu.recp.req >
        <tapa.tfu.sr.recp.req/>
        <tapa.tfu.srs.recp.req/>
        <tapa.tfu.dlcqi.recp.req />
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      #Send SRS Indication 
      <tapa.send>
         <tapa.tfu.srs.ind>
            <tapa.tfu.srs ueId="0"/>
         </tapa.tfu.srs.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


# ccpu00116923 - ADD - Test case to test notification of cell-specific SRS 
#
#
#       Test:    20.63
#
#       Desc:    To test Cell-specific SRS occurrence for a certain
#                  cell configured SRS subframe configuration. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.63">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test cell specific SRS occurrence in FDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL configuration with certain SRS subframe, Common Logical
         channel  configurations at CRG and RGR and also finish RACH and then
         send UE configuration request to LTEMAC from Dummy RRC and configure a
         UL signalling Info like PCQI so as to set up a reception request and
         expect a PCQI reception request followed by a RAW CQI Indication. Set a
         value for SRS and check if it matches with the one set in ProcUlSf"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2" srsSubFrameCfg="10"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1" vldtSrsPres="1" srsPres="0">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1" vldtSrsPres="1" srsPres="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


# ccpu00116923 - ADD - Test case to test notification of cell-specific SRS 
#
#       Test:    20.64
#
#       Desc:    To test Cell-specific SRS occurrence for a certain
#                  cell configured SRS subframe configuration. 
#
#       Notes:   None
#              
#       Module:  TFU_UPGRADE 
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.64">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test cell specific SRS occurrence in TDD"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL configuration with certain SRS subframe, Common Logical
         channel  configurations at CRG and RGR and also finish RACH and then
         send UE configuration request to LTEMAC from Dummy RRC and configure a
         UL signalling Info like PCQI so as to set up a reception request and
         expect a PCQI reception request followed by a RAW CQI Indication. Set a
         value for SRS and check if it matches with the one set in ProcUlSf"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
           <tapa.flag id="TFU_UPGRADE"/>
           <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" spclSfCfgIdx="8"
        numRsc="2" freqIdxLst="0:0" sfnLst="1:1" halfFrmLst="0:1"
        ulStartSfIdxLst="10:10" numTxAntPorts ="4" srsSubFrameCfg="10"/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index time:(0,3) 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq time:(0,7)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp time:(1,6)
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3 time:(1,9)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      <tapa.expect> time:(2,2)
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect CStatInd For MSG4 time(2,3)
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY. time:(2,4)
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. time:(3,1)
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4. time(3,4)
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request(3,4)
      <tapa.send>
          <tapa.rgr.cfgreq.cfg.ue ueId="0"  codeBookResPrsnt="TRUE" txModeEnum="RGR_UE_TM_3" prdCqiCfg.type="TRUE" 
              cqiPCfgIdx ="3" sANCQI="TRUE" 
                riEna = "FALSE"  riCfgIdx = "0" UeReCfgType="4096" />
      </tapa.send>
     
     
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect success in cfg cfm(3,5)
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #For the confiuration parameters set offset=2 and perioditicity=5.
      #Thus (37-2)%5=0 So expect the CQI RR at 35 time:(3,5)
      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" vldtSrsPres="1" srsPres="1" >
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication (3,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #(42-2)%5=0 So expect the CQI RR at 40 time:(4,0)
      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" vldtSrsPres="1" srsPres="0">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #(47-2)%5=0 So expect the CQI RR at 45 time:(4,5)
      <tapa.expset>
        <tapa.tfu.recp.req numRntis="1" vldtSrsPres="1" srsPres="1">
          <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
   #Send Raw CQI Indication (4,8)
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.65
#
#       Desc:    To check configuration for CQI Reporting of DL Power
#                   management.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.65">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To check configuration for PUSH N CQI Reporting of DL Power management"
      </tapa.desc>

      <tapa.longdesc>
      " 1. Configure UE with CQI reporting enabled with N = 5
        2. Configure PCQI with some periodicity
        3. Expect Recpetion request at TFU interface and every occasion of CQI
        4. Expect StaInd at RGR interface after 5 CQIs"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="RGR_CQI_REPT"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" pushNCqiVal="5" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.66
#
#       Desc:    To check re-configuration for CQI Reporting of DL Power
#                   management.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.66">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To check re-configuration for PUSH N CQI Reporting of DL Power management"
      </tapa.desc>

      <tapa.longdesc>
      " 1. Configure UE with CQI reporting enabled with N = 5
        2. Configure PCQI with some periodicity
        3. Expect Recpetion request at TFU interface and every occasion of CQI
        4. After 4 CQI indication have been send, reconfigure N = 3
        5. Expect StaInd at RGR interface for 3 CQIs
        6. After next Send 2 CQI indications, expect StaInd at RGR for 3 CQIs
        7. Send 2 CQI indications
        8. Re-configure for N = 5
        9. Expect StaInd after send 3 CQI indications
        10. Send 3 CQI indications
        11. Reconfigure with N=0 (Disable)
        12. Send 4 CQI Ind, no StaInd shold be recieved
        13. Send  re-configuration with N=2
        14. Send 2 CQI indications
        15. Receive StaInd at RGR for 2 CQI indications "
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
      <tapa.flag id="RGR_CQI_REPT"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="2"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3"
       prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" pushNCqiVal="5" />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind TTI-Identity="1" numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="3" numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="6" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="1" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="8" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="11" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="13" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="16" numTti="3"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="3" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="18" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="21" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="3"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="22" numTti="1"/>
      </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expset>
         <tapa.rgr.staind ueId="0" numRept="3"/>
       <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expset>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="23" numTti="1"/>
      </tapa.send>
    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="26" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="5" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="28" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="31" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="33" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="36" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="7" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="3"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="38" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="41" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="43" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="46" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="5"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="47" numTti="1"/>
      </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="48" numTti="1"/>
      </tapa.send>
    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="51" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="53" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="56" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="58" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="61" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

###### Now send 5 CQI indicatiosn and check StaInd is received #####

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="63" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="66" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="68" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="71" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="14" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="73" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="76" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="15" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="78" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="81" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="1" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="83" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="86" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="2" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="5"/>
      </tapa.expect>

############ Internal data is cleared by SCH, now send few more CQI indications
###########  before disabling the feature 
      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="88" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="91" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="3" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="93" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="96" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="98" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="101" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="5" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="0"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="102" numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="103" numTti="1"/>
      </tapa.send>

### Now send 5 + 1 cqi indications and check StaInd is not sent ###########

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="106" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="6" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="108" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="111" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="7" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="113" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="116" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="118" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="121" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="9" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="123" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="126" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="10" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="128" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="131" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="11" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     # Send Reconfigure for N = 3
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" pushNCqiVal="2"/>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="132" numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="133" numTti="1"/>
      </tapa.send>


    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="136" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="12" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="138" numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind TTI-Identity="141" numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="13" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.staind ueId="0" numRept="2"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    20.67
#
#       Desc:    Check whether a single PUSCH RR is being generated when
#                there are 2 TBs for whom a Reception Request needs to be sent.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.67">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Sanity test for Spatial multiplexing of 2 TBs
          in case of TM-3 UE." 
      </tapa.desc>

      <tapa.longdesc>
         "1. Configure a UE with TM3.
          2. Send DStaRsp with non-zero BO from RGU to MAC.
          3. Verify Transmit Diversity is the TX Scheme selected
             by MAC for scheduling this BO.
          4. Send CQI report from PHY with RI=2. 
          5. Send non-zero BO.
          6. Verify 2 TB scheduling using TX scheme as Spatial 
             Multiplexing with precInfo=0."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2"/>

      # UE configuration
      <tapa.rg.UeInit txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" 
                      ueCatEnum="CM_LTE_UE_CAT_3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH 
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
      <tapa.send>

      # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="150"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC  
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format1A, mode=3 To ensure TD as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat1a="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send CQI report with RI=4
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="250"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2" numLchTb1="1" numLchTb2="1"
                           lchTb2Data="9" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

       # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Format2A, mode=3  and precInfo=2 To ensure SpaMux as TX scheme
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" vldDciFrmt="TRUE" isFormat2a="TRUE"
                                     isTb1Pres="TRUE" isTb2Pres="TRUE"
                                     vldCWSwapFlag="FALSE" isChkPmi ="TRUE" chkPmi="0"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1">
       <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" />
           vldtInitNumRbs="1" initNumRbsPres="1"/>
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isTb2="TRUE" isAckTb2="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   20.68 
#
#       Desc:   Test case to test if the retransmitted UE is occupied with full bandwith the newly transmitted UE in the current TTI should get scheduled in next TTI 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc20.xml
#
#
<tapa.testcase id="20.68">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       The Retx Ue will have higher priority over newly Transmitted UE
      </tapa.desc>

      <tapa.longdesc>
      " This is  the test case that will test The Harq Retx for a UE that collides with the regular transmission of another UE .
        In such a scenario the UE that is doing Retransmission will have a higher priority over the UE that is doing transmission"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="6" maxDlBwPerUe="6"/>

      # UE configuration
      <tapa.rg.2UeInit />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1" tti_id="200"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="0"/>
         <tapa.rgr.cfgCfm status="0" instId="5" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="469" ueId="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiMode="1" cqiIdx="15"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1" tti_id="500"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="2"/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0" use="1" 
            lcId="9" chkSdu="TRUE" saveTo="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" chkTransId="2"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" tti_id="4000"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      # Send 2 Ttis 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2" tti_id="5000"/>
      </tapa.send>
     
      <tapa.expset>
          # Expect retransmission from MAC to PHY for ueID=0.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req use="3" chkSdu="TRUE" lcId="9" ueId="0"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" use="1" vldtRetx="TRUE" ueId="0"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind lchTb1Data="9" saveTransId="4" ueId="1"/>
      </tapa.expset>
      
      <tapa.send lc="TRUE">
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1" tti_id="6000"/>
      </tapa.send> 
      
      <tapa.expset>
          # Expect transmission from MAC to PHY for ueID=1.
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="5" chkSdu="TRUE" lcId="9" ueId="1" saveTo="6"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="5" ueId="1" chkTransId="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>
      </tapa.send>

 </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#       Test:    20.69
#
#       Desc:    To test Raw CQI processing for a Wideband  
#                CQI with a certain Periodicity for Periodic Mode 1-1 for 4 Antenna Ports. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc20.xml
#
<tapa.testcase id="20.69">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test Raw CQI Decoding for Periodic Mode 1-1 (4 Tx Antenna Ports)"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and configure a PCQI Wideband mode with a certain 
         Periodicity and expect a PCQI reception request followed by a RAW CQI
         Indication.Set a Raw CQI and verify whether the Decoding is proper when there are 
         4 Tx Antenna Ports."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
     <tapa.ifdef>
      <tapa.flag id="TFU_UPGRADE"/>
         <tapa.flag id="LTEMAC_MIMO"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
     </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit numTxAntPorts ="4" ulTxAntSelPres="TRUE"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue />

     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR 
     # At start of this step, we are at (2,1) and Reception Request Info time is (2,3)
     # Periodicity yielded from below step will be 5. 
     # Hence, the PCQI will arrive on Reception Request Info time (2,6)
     <tapa.send>
       <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" codeBookResPrsnt="TRUE"
          prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" prdCqiCfg.type="TRUE" cqiPCfgIdx = "3" pmiBitMap1="65535"
          cqiRepType="1"  riEna = "TRUE"  riCfgIdx = "161" ueCatEnum
          ="CM_LTE_UE_CAT_3" pmiBitMap0="65535"/>
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     # Expect success in cfg cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

     # Send TTI to increment as many to receive DL PCQI RR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # At start of this step, we are at (2,4) and Reception Request Info time is (2,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="50"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (2,9) and Reception Request Info time is (3,1)
     # Expect DL CQI reception request from Scheduler, this would be a RI RR
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" ri="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

    # Send TTI to increment as many to receive DL PCQI RR (since periodicity is set to 5)
       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    # At start of this step, we are at (3,4) and Reception Request Info time is (3,6)
     # Expect DL CQI reception request from Scheduler
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" byte0="234" byte1="1"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
     
     #Request to ShutDown LTEMAC
     <tapa.rg.macDeInit/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>



#/********************************************************************30**
#
#         End of file:
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#$SID$         ---     dv   1. Initial Release.
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg001.301     nudupi 1.Changes for the CR ccpu00118643. 
#                                   2.Added the changes for the Cr ccpu00119023.
#$SID$        rg002.301 asehgal   1.Changes for the CR ccpu00109543. 
#                                 2. New test case added to test the fix for
#                                    ticket ccpu0120233/332 
              rg003.301 draju     1.New testcase Added for the CR ccpu00122145                     
#$SID$      ---        rt  1. LTE MAC 4.1 Release
#*********************************************************************91*/
