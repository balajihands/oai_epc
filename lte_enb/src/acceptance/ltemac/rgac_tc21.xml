#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases
#
#     File:    rgac_tc19.xml
#
#     Sid:      cm_xta_gen_tc_num.py@@/main/5 - Wed Jun 27 16:21:06 2007
#
#     Prg:     hn 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=5:hn:rgac_tc19.xml


#
#
#       Test:    21.1
#
#       Desc:    To validate L2 Measurement request
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.1">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To validate L2 Measurement request received from SM"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS" />
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         <tapa.lrg.schL2measreq cellId="1"/>
      </tapa.send>
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_PAR_VAL"
            cellId="1"/>
      </tapa.expect>
      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#       Test:   21.2 
#
#       Desc:   "To test successful calculation of Average PRB usage in DL 
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         To test the successful calculation of average PRB usage 
         in DL in FDD mode
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="60"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1" timePrd="13"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req>
         <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="300"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indication 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HARQ ACK indication for 2nd data request
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm prbPercDl="12"/>
      </tapa.expect>

      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   21.3 
#
#       Desc:   "To test successful calculation of Average PRB usage in DL"  
#                "in TDD mode"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.3">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful calculation of Average PRB usage in DL"
         "In TDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxUlBwPerUe="20"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1" timePrd="2"/>
      </tapa.send>

#DLDATA
      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="750" ueId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   #Expect staInd from MAC to RLC for DAT1 for 1st UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   #Expect PDSCH and PDCCH for the dat req for DAT1 for 1st and 2nd UE
   #Expect staInd from MAC to RLC for DAT1 for 1st UE
   #Expect L2 Measurement confirm 
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1" spId="0">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
         <tapa.lrg.schL2meascfm prbPercDl="22"/>
     </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7" />
   </tapa.send>

   #Expect HARQ Recption Request for DAT 1st UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>
  </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>
  
   # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    21.4
#
#       Desc:    To test average prb usage in uplink FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.4">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test average prb usage in uplink in FDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS" />
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional non-GBR DTCHs for default UE 
     
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            ulQci="8" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>
     
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>
  
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="8" measType="2"/>
      </tapa.send>

       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect pdcch control request
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send second TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>        
          <tapa.lrg.schL2meascfm prbPercUl="15"/>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg002.301 ccpu00109543 MOD
#
#       Test:    21.5
#
#       Desc:    To test average prb usage in uplink TDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.5">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test average PRB usage in uplink in TDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      
      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxUlBwPerUe="50"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                 ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="33" measType="2"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      #Expect data indication for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expect>

    # Send a TTI to schedule SR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    # Send SR Indication for 1st UE and 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 for 1st UE and 2nd UE
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request for 1st UE and 2nd UE
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
        <tapa.tfu.pusch.recp.req  ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg for 1st UE and 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Send BSR for 1st UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addLongBsr="TRUE" bsr0="5"  bsr1="12" 
            bsr2="45" bsr3="60" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   # Send BSR for 2nd UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addLongBsr="TRUE" bsr0="5"  bsr1="12" 
            bsr2="45" bsr3="60" ueId="1"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect UL grant for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" />
         <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" />
         #<tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expset>
      <tapa.tfu.recp.req numRntis="2" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
         <tapa.tfu.pusch.recp.req ueId="1"/>
      </tapa.tfu.recp.req>
      <tapa.lrg.schL2meascfm prbPercUl="4"/>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    21.6
#       
#       Desc:    Test case to determine the Random Access Preamble 
                 for a given time period
#       
#       Notes:   None
#              
#       Module:  MAC
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.6">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the Random access preamble for a given time Period"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
      <tapa.flag id="RGR_V1"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>
   <tapa.cfg>
      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      #msg3 per TTI are now restricted
      #to 4. Configure a higher limit for this test case.
      <tapa.rg.cellInit maxMsg3PerUlSf="12"/>

   </tapa.cfg>
   # Test Steps subsection
    <tapa.test>
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="2" measType="16"/>
      </tapa.send>

      #Send Ra request indication for 2 UE 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="10" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="10" numRaReq="10" 
            rapIds="1:2:3:4:5:7:8:9:30:41" timingAdvs="3:3:3:3:3:3:3:3:3:3" 
            tpcs="1:1:1:1:1:1:1:1:1:1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Expect RaResp for the rapId sent in RaReq
      #Expect L2 Measurement confirm
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" rapIds="1:2:3:4:5:7:8:9:30:41"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.lrg.schL2meascfm dedPreambles="0" preLowRange="8" preHighRange="2"/>
     </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:   21.7
#
#       Desc:   "To test successful calculation of Average PRB usage per 
#                QCI in DL"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation of average PRB usage 
         per QCI in DL in FDD mode using single UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="80"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="8" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="4" timePrd="13" numQci="1" qci="8"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req>
         <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>
     
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indication 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HARQ ACK indication for 2nd data request
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.delay delay="5"/>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
          <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm numDlQci="1" prbPercQci="15"/>
      </tapa.expect>

      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#       Test:   21.8
#
#       Desc:   "To test successful calculation of Average PRB usage per 
#                QCI in DL for 2 UEs"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation of average PRB usage 
         per QCI in DL in FDD mode using two UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="80"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="2" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="4" timePrd="10" numQci="2" qci="1:2"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send BO for UE2 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req numCntrlReq="2">
         <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req datReqs="2">
         <tapa.tfu.pdsch.dat.req />
      </tapa.tfu.dat.req>
        <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="400"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.tfu.cntrl.req numCntrlReq="2">
          <tapa.tfu.pdcch.cntrl.req/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req datReqs="2">
          <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="400"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="2">
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="270"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="270"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
          <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="2">
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
          <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="2">
          <tapa.tfu.pdsch.dat.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
         <tapa.lrg.schL2meascfm numDlQci="2" prbPercQci="20:12"/>
      </tapa.expset>

      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    21.9
#
#       Desc:    To test average prb usage per qci in uplink 
#                in FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test average prb usage per qci in uplink 
          in FDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" lcId="4" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect pdcch control request
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send second TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="9" measType="8" numQci="1" qci="8"/>
      </tapa.send>
      
      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
      # Expect HARQ ACK in PHICH For MSG3
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="7"/>
          </tapa.tfu.recp.req>        
       </tapa.expset>
      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="8"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="9"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="6" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>
      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="7" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="8" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message after receiving Message reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="9" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
         <tapa.lrg.schL2meascfm numUlQci="1" avgPrbPercQciUl="3"/>
      </tapa.expset>
      # DatInd that should go in this TTI is not sent
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    21.10
#
#       Desc:    To test average prb usage per qci in uplink 
#                and downlink in FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test average prb usage per qci in uplink 
          and downlink in FDD mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="5" instId="5" 
           dlQci="8" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="400"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" />
      # Expect pdcch control request
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="400"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" />
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="9" measType="12" numQci="1" qci="8"/>
      </tapa.send>

      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      
      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
      # Expect HARQ ACK in PHICH For MSG3
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="7"/>
          <tapa.tfu.hq.recp.req ueId="0"/>
       </tapa.tfu.recp.req>        
       </tapa.expset>
     
      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="8"/>
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req> 
      </tapa.expset>
      
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="9"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      
      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # After merging from 2.1 to 2.2
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="6" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send tenth  TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="7" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>


      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      # Send 11th TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="8" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>
     
      # Send 12th TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
         <tapa.lrg.schL2meascfm numDlQci="1" numUlQci="1" avgPrbPercQciUl="3" avgPrbPercQciDl="4"/>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

     </tapa.test> 
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   21.11
#
#       Desc:   "To test successful calculation of  number of 
#                active UE per qci in DL"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation number of active
          UE per qci in DL "
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="3" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE2 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE3 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE4 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="10" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>
     
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send BO for UE2 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE3 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE4 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #made changes to recieve multiple UE Cntrl and Data. 
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>

       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      #Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
     
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
  
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>
      
      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
         
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
   
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
       
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>
      
      #Send DDatReq for UE4
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="4">
          <tapa.tfu.pdcch.cntrl.req ueId="0"/>
          <tapa.tfu.pdcch.cntrl.req ueId="1"/>
          <tapa.tfu.pdcch.cntrl.req ueId="2"/>
          <tapa.tfu.pdcch.cntrl.req ueId="3"/>
        </tapa.tfu.cntrl.req>
        
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
    
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="4" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="2"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="3"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="2"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="3"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="4" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
         <tapa.lrg.schL2meascfm numDlActQci="1" actvUeDl="4"/>
      </tapa.expset>
   
      </tapa.test>
  
   #Clean subsection
   <tapa.clean>
     
   #Command To ShutDown LTEMAC Layer
   <tapa.rg.macDeInit.grp16/>
  
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    21.12
#
#       Desc:    To test active UE per qci in uplink
#                in FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="21.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To test active UE per qci in uplink"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="1000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="2000"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueBr="3000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="13" measType="64" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           #<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        #<tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            #<tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           #<tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="42"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="41"/>
           #<tapa.tfu.dat ueId="2" use="6" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="40"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         #<tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # verify grnt is recieved for UEs in descending order of ueBr amount
      # with BW constraint restricdting grnt allocation to only 2 UEs
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
      
      <!--
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" ueId="0" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="5" ueId="1" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
          #<tapa.tfu.dat use="6" ueId="2" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
     
      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         #<tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>
      -->
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     <!--
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           #<tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     -->
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      

      # Expect DCI format 0 and do basic validations of the grant
      <!--
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     -->
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="0"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    21.13
#
#       Desc:    To calculate number of active UE
#                in uplink and downlink
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To count number of uplink and downlink active UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" dlQci="8"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="5" instId="5" 
           dlQci="8" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4" dlQci="8"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4" dlQci="8"
            instId="5"/>
      </tapa.send>


      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" lcId="3" qci="8" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" lcId="4" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5" lcId="5" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" lcId="6" qci="8"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="10" measType="96" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="400"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" />
      # Expect pdcch control request
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="400"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" />
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
      </tapa.expset>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="6" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
      # Expect HARQ ACK in PHICH For MSG3
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="7"/>
          <tapa.tfu.hq.recp.req ueId="0"/>
       </tapa.tfu.recp.req>        
       <!--
        <tapa.tfu.recp.req numRntis="1" spId="1">
        </tapa.tfu.recp.req>   -->
       </tapa.expset>

      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="7" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="8"/>
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>        <!--
         <tapa.tfu.recp.req numRntis="1" spId="1">
         </tapa.tfu.recp.req>   -->
      </tapa.expset>

      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="8" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
         # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="9"/>
         </tapa.tfu.recp.req>        
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
       <!--
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
       -->
       </tapa.expset>

      # Send Message after receiving Message reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="9" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>
      # DatInd that should go in this TTI is not sent

      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #After merging from 2.1 to 2.2
      <tapa.expset>
         <tapa.lrg.schL2meascfm numDlActvQci="1" numUlActvQci="1" actvUeUl="1" actvUeDl="0"/>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>


      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:   21.14
#
#       Desc:   "To test successful validation of qci"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test successful validation of qci"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" qci="2"/>
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" 
           dlQci="8" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
<!--
      # Send L2 Measurement request with invalid qci
      <tapa.send>
         <tapa.lrg.schL2measreq measType="12" timePrd="13" numQci="1" qci="1"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" 
            reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>

      # Send L2 Measurement request with invalid qci
      <tapa.send>
         <tapa.lrg.schL2measreq measType="8" timePrd="13" numQci="1" qci="1"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" 
            reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>

      # Send L2 Measurement request with invalid qci UL ACTIVE UE
      <tapa.send>
         <tapa.lrg.schL2measreq measType="64" timePrd="13" numQci="1" qci="1" sampPrd="2"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" 
            reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>

      # Send L2 Measurement request with invalid qci DL ACTIVE UE
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="13" numQci="1" qci="1" sampPrd="2"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" 
            reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>
-->

      # Send L2 Measurement request with invalid samp prd DL ACTIVE UE, Time
      # prd configured
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="13" numQci="1" qci="8" sampPrd="101"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" 
            reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>

      # Send L2 Measurement request with invalid samp prd ,timeprd  ==0 DL
      # ACTIVE UE
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="0" numQci="1" qci="8" sampPrd="110"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" 
            reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>


      # Send L2 Measurement request with invalid samp prd, timeprd ==0 UL
      # ACTIVE UE
      <tapa.send>
         <tapa.lrg.schL2measreq measType="64" timePrd="0" numQci="1" qci="8" sampPrd="111"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" 
            reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>


      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#
#       Test:    21.15
#
#       Desc:    Validation of transaction identifier in L2 Measurement
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.15">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test duplicate transaction are not allowed in L2 Measurement"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
         <tapa.flag id="ERRCLS_ADD_RES"/>
         <tapa.flag id="ERRCLASS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1"/>
      </tapa.send>
      <tapa.expect>
         <tapa.lrg.schL2meascfm status="LCM_PRIM_NOK" reason="LCM_REASON_INVALID_PAR_VAL"/>
      </tapa.expect>
      <tapa.rg.macDeInit/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   21.16 
#
#       Desc:   "To test successful insertion of measCb in ascending order"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.16">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         To test the successful insertion of measCb in ascending order
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1" timePrd="13"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="2" timePrd="10" transId="2"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm prbPercUl="0" transId="2"/>
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect L2 Measurement confirm 
      <tapa.expect>
         <tapa.lrg.schL2meascfm prbPercDl="0" transId="1"/>
      </tapa.expect>

      </tapa.test>
      #Clean subsection
      <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    21.17
#
#       Desc:    To test average prb usage per qci in uplink 
#                and downlink in FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test average prb usage per qci in uplink 
          and downlink in FDD mode with multiple qci"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" qci="9"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4" />
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="1" lcType="5"
            instId="5" dlQci="9"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            instId="5" dlQci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="5"
            bsr1="12" bsr2="45" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>


      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="400"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" />
      # Expect pdcch control request
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="400"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="3" />
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="400"/>
      </tapa.send>

      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
          <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" />
      </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>


      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
         <tapa.tfu.pdsch.dat.req />
       </tapa.tfu.dat.req>
    </tapa.expset>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="7" measType="12" numQci="2" qci="8:9"/>
      </tapa.send>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>

      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
      # Expect HARQ ACK in PHICH For MSG3
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="7"/>
          <tapa.tfu.hq.recp.req ueId="0"/>
       </tapa.tfu.recp.req>        
       </tapa.expset>
       
       # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="8"/>
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req> 
      </tapa.expset>
      
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="9"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      
      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="6" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>
     
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="7" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>
    
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="8" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # After merging from 2.1 to 2.2
      <tapa.expset>
      #  Do not Expect DCI format 0 as there are no more harq processes left to
      #  schedule!
      # Expect datRecpReq for pdcch stored in 6 
         <tapa.tfu.recp.req numRntis="2">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect NACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>
     
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="9" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"/>
         <tapa.lrg.schL2meascfm numDlQci="2" numUlQci="1" 
            avgPrbPercQciUl="4" avgPrbPercQciDl="5:2"/>
      </tapa.expset>
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    21.18
#
#       Desc:    To test average PRB usage in DL with multiple UE
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.18">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test average PRB usage in DL with multiple UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched2 ulSchdType="0"  dlSchdType="0"/>

      #Do RACH and UE Config
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>
      <tapa.rg.UeInit.grp16 ueId="2"/>
      <tapa.rg.UeInit.grp16 ueId="3"/>
      <tapa.rg.UeInit.grp16 ueId="4"/>
      <tapa.rg.UeInit.grp16 ueId="5"/>
      <tapa.rg.UeInit.grp16 ueId="6"/>
      <tapa.rg.UeInit.grp16 ueId="7"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
  <tapa.send>
     <tapa.tfu.dlcqi.ind>
         <tapa.tfu.dlcqi  ueId="0" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="1" wbCqi="15" isPucchInfo="FALSE" cqiMode="1"/>
         <tapa.tfu.dlcqi  ueId="2" isPucchInfo="FALSE" cqiMode="3" wbCqi="15"
            numOfSubbands="0"/>
         <tapa.tfu.dlcqi  ueId="3" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="4" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="5" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="6" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="7" cqiIdx="15"/>
     </tapa.tfu.dlcqi.ind>
  </tapa.send>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="4" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="5" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="6" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="7" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>



      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="300"  dlMbr="2000"
         instId="5"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300" instId="5"  dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="2" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="3" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="4" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="5" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="6" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="7" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="20" measType="1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="20"/>
      </tapa.send>
      

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
      
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      # Expect staInd from MAC to RLC for UE1.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expset>

     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      # Expect staInd from MAC to RLC for UE1.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expset>

     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="1" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="2" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="3" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="4" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="5" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="6" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="7" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="1" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="2" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="3" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="4" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="5" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="6" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="7" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="1" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="2" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="3" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="4" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="5" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="6" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="7" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
##########################################################     
     # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="50"/>
      </tapa.send>
      

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

###################################################################################     
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

     # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="50"/>
      </tapa.send>
      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
# Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
      </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expset>
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
# Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0"/>
         <tapa.tfu.hq  ueId="1"/>
         <tapa.tfu.hq  ueId="2"/>
         <tapa.tfu.hq  ueId="3"/>
         <tapa.tfu.hq  ueId="4"/>
         <tapa.tfu.hq  ueId="5"/>
         <tapa.tfu.hq  ueId="6"/>
         <tapa.tfu.hq  ueId="7"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
  <tapa.expect>
       <tapa.lrg.schL2meascfm prbPercDl="2"/>
  </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0"/>
         <tapa.tfu.hq  ueId="1"/>
         <tapa.tfu.hq  ueId="2"/>
         <tapa.tfu.hq  ueId="3"/>
         <tapa.tfu.hq  ueId="4"/>
         <tapa.tfu.hq  ueId="5"/>
         <tapa.tfu.hq  ueId="6"/>
         <tapa.tfu.hq  ueId="7"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    21.19
#
#       Desc:    To test random access preamble and average PRB 
#                usage per qci in downlink  in TDD mode
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.19">>>
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test random access preamble and average Prb usage per qci 
          in downlink in tdd mode"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
         
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" spclSfCfgIdx="8"
         maxUlBwPerUe="50"/>

   </tapa.cfg>


   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="4" measType="16"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.lrg.schL2meascfm dedPreambles="0" preLowRange="2" preHighRange="0"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="FALSE:TRUE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                ueId="0" dlQci="0" />
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" dir="1" lcType="5" instId="5" 
                 ueId="1" dlQci="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="0" qci="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5" ueId="1" qci="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for 1st UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send SR Indication for 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      
      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req saveTo="5" use="0" ueId="0"/>
        <tapa.tfu.pusch.recp.req saveTo="6" use="0" ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Expect data indication for 1st UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="0"/>
      </tapa.expect>
      
      #Expect data indication for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 1st UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" lcId="3" ueId="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="0"/>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant for 2nd UE
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="6" lcId="3" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC for 2nd UE
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" ueId="1" />
      </tapa.expect>

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="10" measType="4" numQci="2" qci="0:1"/>
      </tapa.send>

      # Send DL data in all the subframes of a radio frame
    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 1st UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="0"/>
    </tapa.send>

    <tapa.send>
       # Send BO for the created logical channel for DAT1 for 2nd UE
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT1 for 1st UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Expect staInd from MAC to RLC for DAT1 for 2nd UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT1 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>


   # Send data with size equal to the allocated size for DAT1 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT1 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1" spId="0">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT2 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT2 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 1st UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT2 for 2nd UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT2 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT2 for 1st and 2nd  UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT3 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT3 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT3 for 1st UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT3 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT3 for 2nd UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

   # Send data with size equal to the allocated size for DAT3 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT3 for 1st UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0" />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req ueId="0" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>

    # Send BO for the created logical channel for DAT4 for 1st UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="0"/>
    </tapa.send>

    # Send BO for the created logical channel for DAT4 for 2nd UE
    <tapa.send>
       <tapa.rgu.dstarsp lcId="3" lcType="5" bo="700" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Expect staInd from MAC to RLC for DAT4 for 1st UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="0"/>
      </tapa.expect>

   # Expect staInd from MAC to RLC for DAT4 for 2nd UE
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" ueId="1"/>
      </tapa.expect>

   #send HARQ Recption Request for DAT 1,2 for 1st and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   # Send data with size equal to the allocated size for DAT4 for 1st UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="0" lchTb1Data="3"/>
   </tapa.send>

   # Send data with size equal to the allocated size for DAT4 for 2nd UE
   <tapa.send>
      <tapa.rgu.ddatreq lcId="3" lcType="5" ueId="1" lchTb1Data="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect PDSCH and PDCCH for the dat req for DAT4 for 1st and 2nd UE
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req />
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" >
        <tapa.tfu.pdcch.cntrl.req />
     </tapa.tfu.cntrl.req>
         <tapa.lrg.schL2meascfm numDlQci="2" avgPrbPercQciDl="16:16"/>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Send feedback for DAT 1,2 for 1st UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #send HARQ Recption Request for DAT 3,4 for 1st UE and 2nd UE
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send feedback for DAT 3,4 for 1st UE and 2nd UE
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
     </tapa.tfu.hq.ind>
   </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

    # Send SR Indication for 1st UE and 2nd UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

    # Send a TTI to schedule SR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 for 1st UE and 2nd UE
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
           <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request for 1st UE and 2nd UE
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req  ueId="0"/>
        <tapa.tfu.pusch.recp.req  ueId="1"/>
     </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg for 1st UE and 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Send BSR for 1st UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="0"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

   # Send BSR for 2nd UE
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat lcgId="3" addShortBsr="TRUE" bsr="5" ueId="1"/>
      </tapa.tfu.dat.ind>
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Expect UL grant for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.pdcch.cntrl.req  isUlGrant="TRUE" vldtGrant="TRUE" />
         <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" />
         #<tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4" />
   </tapa.send>

   # Expect data reception request for 1st UE and 2nd UE
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="2" spId="1">
         <tapa.tfu.pusch.recp.req ueId="0"/>
         <tapa.tfu.pusch.recp.req ueId="1"/>
      </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   #Send CRC for Msg for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   #Send CRC for Msg for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Expect PHICH for 1st UE and 2nd UE
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    21.20
#
#       Desc:    To test active ue in uplink and downlink
#
#       Notes:   None
#              
#       Module:  None
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.20">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To calculate active ue in uplink and downlink"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS" />
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched2 ulSchdType="0"  dlSchdType="0"/>

      #Do RACH and UE Config
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>
      <tapa.rg.UeInit.grp16 ueId="2"/>
      <tapa.rg.UeInit.grp16 ueId="3"/>
      <tapa.rg.UeInit.grp16 ueId="4"/>
      <tapa.rg.UeInit.grp16 ueId="5"/>
      <tapa.rg.UeInit.grp16 ueId="6"/>
      <tapa.rg.UeInit.grp16 ueId="7"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
  <tapa.send>
     <tapa.tfu.dlcqi.ind>
         <tapa.tfu.dlcqi  ueId="0" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="1" wbCqi="15" isPucchInfo="FALSE" cqiMode="1"/>
         <tapa.tfu.dlcqi  ueId="2" isPucchInfo="FALSE" cqiMode="3" wbCqi="15"
            numOfSubbands="0"/>
         <tapa.tfu.dlcqi  ueId="3" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="4" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="5" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="6" cqiIdx="15"/>
         <tapa.tfu.dlcqi  ueId="7" cqiIdx="15"/>
     </tapa.tfu.dlcqi.ind>
  </tapa.send>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="1" dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="9" lcType="4" dir="1"  dlQci="3" dlGbr="300"  dlMbr="2000"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="4" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="5" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="6" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="7" lcId="9" lcType="4" dir="1"  dlQci="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="4" dir="3" dlQci="3" dlGbr="300"  dlMbr="2000"
         instId="5" lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="4" dir="3"  dlQci="3" dlGbr="300" 
            instId="5"  dlMbr="2000" lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="2" lcId="9" lcType="4" dir="3"  dlQci="3" 
            dlGbr="300"  dlMbr="2000" lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="3" lcId="9" lcType="4" dir="3"  dlQci="3"
            dlGbr="300"  dlMbr="2000" lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="4" lcId="9" lcType="4" dir="3"  
            dlQci="7" lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="5" lcId="9" lcType="4" dir="3"  
            dlQci="7" lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="6" lcId="9" lcType="4" dir="3"  dlQci="7"
            lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

# Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch instId="5" ueId="7" lcId="9" lcType="4" dir="3"  
            dlQci="7" lcgId="1"/>
      </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Indicate the same CQI for both
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12" /> 
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="6" /> 
            <tapa.tfu.ulcqi ueId="2" isWideBand="TRUE" wideCqi="5" /> 
            <tapa.tfu.ulcqi ueId="3" isWideBand="TRUE" wideCqi="8" /> 
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="13" measType="96" sampPrd="2" numQci="2" qci="3:7"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="20"/>
      </tapa.send>
      

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
      
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      # Expect staInd from MAC to RLC for UE1.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expset>

     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      # Expect staInd from MAC to RLC for UE1.
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expset>

     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="1" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="2" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="3" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="4" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="5" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="6" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="7" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="1" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="2" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="3" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="4" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="5" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="6" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="7" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="1" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="2" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="3" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="4" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="5" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="6" isAck="TRUE"/>
         <tapa.tfu.hq  ueId="7" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
##########################################################     
     # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="50"/>
      </tapa.send>
      

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>
      
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE2.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
     
      # Expect staInd from MAC to RLC for UE1.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
      </tapa.expect>
    
###################################################################################     
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

     # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="9" lcType="4" bo="50"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="4" lcId="9" lcType="4" bo="20"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="5" lcId="9" lcType="4" bo="30"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="6" lcId="9" lcType="4" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send lc="TRUE">
         <tapa.rgu.dstarsp ueId="7" lcId="9" lcType="4" bo="50"/>
      </tapa.send>
      # Send 1 Tti to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
# Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
      </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="1" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="2" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="3" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="4" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="5" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="6" lchTb1Data="9" saveTo="2"/>
         <tapa.rgu.dstaind ueId="7" lchTb1Data="9" saveTo="2"/>
        <tapa.lrg.schL2meascfm numDlActvQci="2" numUlActvQci="2"
        actvUeDl="4:4" actvUeUl="0:0"/>
      </tapa.expset>
     # Send DDatReq for UE1 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="1" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="2" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="3" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="4" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="5" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="6" lcId="9" lcType="4"/>
      </tapa.send>

      # Send DDatReq for UE2 with size equal to the allocated size on RGU. 
     <tapa.send lc="TRUE">
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="7" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="8">
         <tapa.tfu.pdsch.dat.req use="1" ueId="0" numSdu="1" />
# Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="2" ueId="1" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="3" ueId="2" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="4" ueId="3" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="5" ueId="4" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="6" ueId="5" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="7" ueId="6" numSdu="1" />
      # Expect PDU from MAC to PHY for UE1. UeId to check rnti sent by MAC.
         <tapa.tfu.pdsch.dat.req use="8" ueId="7" numSdu="1" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="8">
         <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="2" ueId="1"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="3" ueId="2"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="4" ueId="3"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="5" ueId="4"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="6" ueId="5"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="7" ueId="6"/>
         <tapa.tfu.pdcch.cntrl.req  saveTo="8" ueId="7"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
      # 1(TFU_UL_DELTA) - TFU_DELTA Ttis to expect harqrecp req from MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
  </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="8">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
         <tapa.tfu.hq.recp.req ueId="4"/>
         <tapa.tfu.hq.recp.req ueId="5"/>
         <tapa.tfu.hq.recp.req ueId="6"/>
         <tapa.tfu.hq.recp.req ueId="7"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0"/>
         <tapa.tfu.hq  ueId="1"/>
         <tapa.tfu.hq  ueId="2"/>
         <tapa.tfu.hq  ueId="3"/>
         <tapa.tfu.hq  ueId="4"/>
         <tapa.tfu.hq  ueId="5"/>
         <tapa.tfu.hq  ueId="6"/>
         <tapa.tfu.hq  ueId="7"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="8">
         <tapa.tfu.hq  ueId="0"/>
         <tapa.tfu.hq  ueId="1"/>
         <tapa.tfu.hq  ueId="2"/>
         <tapa.tfu.hq  ueId="3"/>
         <tapa.tfu.hq  ueId="4"/>
         <tapa.tfu.hq  ueId="5"/>
         <tapa.tfu.hq  ueId="6"/>
         <tapa.tfu.hq  ueId="7"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    21.21
#
#       Desc:    To test the insertion of measCb in ascending order
#                in MAC 
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the insertion of measCb in MAC in ascending order"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS" />
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="4000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4" qci="7"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5" qci="7"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="9" measType="8" numQci="1" qci="8"/>
      </tapa.send>

       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="4" measType="8" numQci="1" qci="7" transId="2"/>
      </tapa.send>

       # Send TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect measCfm for 2nd measReq
      <tapa.expect>
         <tapa.lrg.schL2meascfm transId="2"/>
      </tapa.expect>

       # Send TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect measCfm for 2nd measReq
      <tapa.expect>
         <tapa.lrg.schL2meascfm transId="1"/>
      </tapa.expect>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="9" measType="8" numQci="1" qci="8"/>
      </tapa.send>

       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="14" measType="8" numQci="1" qci="7" transId="2"/>
      </tapa.send>

       # Send TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Expect measCfm for 2nd measReq
      <tapa.expect>
         <tapa.lrg.schL2meascfm transId="1"/>
      </tapa.expect>

       # Send TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Expect measCfm for 2nd measReq
      <tapa.expect>
         <tapa.lrg.schL2meascfm transId="2"/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    21.22
#
#       Desc:    To validate Timing Indication for Scheduled IP 
#       Throughput in UL for a Long BSR
#
#       Notes:   None
#              
#       Module:  scheduler
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.22">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36314.910" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To validate Timing Indication for Scheduled IP
          throughput for long BSR."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
         <tapa.flag id="LTEMAC_R9"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" lcId="4" instId="5" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send UL Thrp Meas Req 
      <tapa.send>
         <tapa.rgu.ulthrpmeasreq ueId="0" lcIdLst="4" enbMeas="TRUE"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" addLongBsr="TRUE" bsr0="10"
            bsr1="32" bsr2="20" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <!--
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>
      -->
       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect pdcch control request
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send second TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
      # Expect HARQ ACK in PHICH For MSG3
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="7"/>
          </tapa.tfu.recp.req>        
       </tapa.expset>
      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="8"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="9"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="6" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="1"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>
      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="7" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="3"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="8" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="3"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>

      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message after receiving Message reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="9" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="3"/>
      </tapa.expset>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    21.23
#
#       Desc:    To validate Timing Indication for Scheduled IP 
#       Throughput in UL for a Long BSR by sending Meas OFF in between
#       burst
#
#       Notes:   None
#              
#       Module:  scheduler
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.23">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36314.910" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To validate Timing Indication for Scheduled IP
         throughput for long BSR by Meas OFF in between multiple
         bursts"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
         <tapa.flag id="LTEMAC_R9"/>
      </tapa.ifdef>

      <tapa.ifndef>
      <tapa.flag id="TFU_TDD"/>
   </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL (configure min bandwidth)
      <tapa.rg.cellInit/>
      #Initialize UE
      <tapa.rg.UeInit maxUlHqTx="4" ueBr="14000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional non-GBR DTCHs for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4" qci="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="5" lcgId="2" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="6" lcgId="3" dir="3" lcType="4"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" lcId="4" instId="5" qci="8"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="3" instId="5"/>
      </tapa.send>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send UL Thrp Meas Req 
      <tapa.send>
         <tapa.rgu.ulthrpmeasreq ueId="0" lcIdLst="4" enbMeas="TRUE"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" addLongBsr="TRUE" bsr0="10"
            bsr1="32" bsr2="20" bsr3="60"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <!--
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>
      -->
       # Send first TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect pdcch control request
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send second TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send third TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="4" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fourth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="5" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send fifth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="6" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 2 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send sixth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
      # Expect HARQ ACK in PHICH For MSG3
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="7" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 3 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="7"/>
          </tapa.tfu.recp.req>        
       </tapa.expset>
      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="8" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 4 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="8"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send eighth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="9" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      # Expect datRecpReq for pdcch stored in 5 
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="9"/>
         </tapa.tfu.recp.req>        
      </tapa.expset>
      # Send ninth TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="6" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="1"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
       </tapa.expset>
      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="7" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="3"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>
      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="8" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="3"/>
      </tapa.expect>

      # Send seventh TTI to schedule the BSR sent
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send UL Thrp Meas Req 
      <tapa.send>
         <tapa.rgu.ulthrpmeasreq ueId="0" lcIdLst="4" enbMeas="FALSE"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
             <tapa.tfu.pusch.recp.req/>
          </tapa.tfu.recp.req>

      # Expect ACK in PHICH
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send Message after receiving Message reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="9" lcId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message at RGU
      <tapa.expset>
         <tapa.rgu.ddatind ueId="0" lcId="4" lchTb1Data="4,1"
            vldtTimingInd="1" timeInd="0"/>
      </tapa.expset>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>



#
#
#       Test:   21.24
#
#       Desc:   "To test successful calculation of  number of 
#                active UE per qci in DL - PFS scheduler"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.24">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation number of active
          UE per qci in DL - sched type PFS"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="DLFS_INV"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="1"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE2 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="10" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>
     
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send BO for UE2 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>


      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #made changes to recieve multiple UE Cntrl and Data. 
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>

       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      #Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
     
       <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
  
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>
      
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
         
       <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
   
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
       
       <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
          <tapa.tfu.pdcch.cntrl.req ueId="0"/>
          <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        </tapa.tfu.cntrl.req>
        
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
        
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
    
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

     #Reception request for 3rd data request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
         <tapa.lrg.schL2meascfm numDlActQci="1" actvUeDl="2"/>
      </tapa.expset>
   
      </tapa.test>
  
   #Clean subsection
   <tapa.clean>
     
   #Command To ShutDown LTEMAC Layer
   <tapa.rg.macDeInit.grp16/>
  
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:   21.25
#
#       Desc:   "To test successful calculation of  number of 
#                active UE per qci in DL - RR scheduler"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation number of active
          UE per qci in DL - sched type RR"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE2 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="10" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>
     
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="100"/>
      </tapa.send>

      #Send BO for UE2 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="100"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #made changes to recieve multiple UE Cntrl and Data. 
     #Expect data request and control request for the 1st data
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req ueId="0"/>
           <tapa.tfu.pdsch.dat.req ueId="1"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        </tapa.tfu.cntrl.req>

        <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />

     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="100"/>
      </tapa.send>
      
      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      #Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
      <!--
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />-->
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
     
       <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
  
      </tapa.expset>

      <tapa.delay delay="5"/>
<!--
      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>
-->
      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="100"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>
     <!-- 
      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
         
       <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
   
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
       
       <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
          <tapa.tfu.pdcch.cntrl.req ueId="0"/>
          <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        </tapa.tfu.cntrl.req>
        
       <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
       </tapa.tfu.dat.req>
        
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
    
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

     #Reception request for 3rd data request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
         <tapa.lrg.schL2meascfm numDlActQci="1" actvUeDl="2"/>
      </tapa.expset>
      -->
      </tapa.test>
  
   #Clean subsection
   <tapa.clean>
     
   #Command To ShutDown LTEMAC Layer
   <tapa.rg.macDeInit.grp16/>
  
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    21.26
#
#       Desc:    UL Active UE per QCI :To test handling of Zero Short BSR for an UE
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="21.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To test handling of Zero short BSR for an UE"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="1000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" dlQci="8"
ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>


      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" dlQci="8"
ulQci="8" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="2" lcId="3:4" qci="8:7"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="20" measType="64" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="63"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="0"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>


      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="0"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    21.27
#
#       Desc:    UL Active UE per QCI :Multiple LC per LCG with Data Ind for single LC
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="21.27">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "UL Active UE per QCI :Multiple LC per LCG with Data Ind for single LC"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="2"  dlSchdType="2"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="99999999"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" dlQci="8"
ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" dlQci="8"
ulQci="8" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="1" dir="3" lcType="4" dlQci="6"
ulQci="7" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="3" lcId="3:4:5" qci="8:7:6"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="28" measType="64" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="63"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 1
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ## HARQ 2
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 3
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 4
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect data reception request, HARQ 5 pusch 1
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ## HARQ 6 pusch 2
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ## HARQ 7 pusch 3
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 8 pusch 4
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>



   #Send CRC for Msg 1
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

 
      # Expect HARQ ACK in PHICH pusch 5
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="4" addShortBsr="TRUE" lcgId="1" bsr="0"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1"/>
      </tapa.expset>
      # crc 2
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #pusch 6 phich 2
       <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="5" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="5,1"/>
      </tapa.expset>
   #Send CRC for Msg 3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #pusch 7 phich 3
       <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

        #Send CRC for Msg 4
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #pusch 8 phich 4
       <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="4" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1"/>
      </tapa.expset>

        #Send CRC for Msg  5
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #phich 5
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="5"/>
        </tapa.tfu.dat.ind>
     </tapa.send>
#need to check recp
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="5,1"/>
      </tapa.expset>

   #Send CRC for Msg 6
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #phich 6
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

   #Send CRC for Msg 7
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #phich 7
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="4" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1"/>
      </tapa.expset>

   #Send CRC for Msg 8
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  #Send CRC for Msg 9
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 

      #phich 8
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="5" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="5,1"/>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #phich 9
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="0"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>



#
#
#       Test:    21.28
#
#       Desc:    UL Active UE per QCI :To test handling when Effective BSR becomes zero, 
#                  but still some UL harq procs are busy. This is the case where MAC retx 
#                  buffer is being considered for Active UE count.
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="21.28">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "UL Active UE per QCI :Zero BSR but UE still active due to retx buffer"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="2"  dlSchdType="2"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="99999999"  maxUlHqTx="3"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" dlQci="8"
ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" dlQci="8"
ulQci="8" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" dlQci="7"
ulQci="7" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="1" dir="3" lcType="4" dlQci="6"
ulQci="7" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="3" lcId="3:4:5" qci="8:7:6"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="36" measType="64" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="63"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 1
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ## HARQ 2
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 3
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 4
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect data reception request, HARQ 5 pusch 1
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ## HARQ 6 pusch 2
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ## HARQ 7 pusch 3
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ## HARQ 8 pusch 4
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>



   #Send CRC for Msg 1
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

 
      # Expect HARQ ACK in PHICH pusch 5
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="4" addShortBsr="TRUE" lcgId="1" bsr="0"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1"/>
      </tapa.expset>
      # crc 2
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #pusch 6 phich 2
       <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="5" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="5,1"/>
      </tapa.expset>
   #Send CRC for Msg 3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #pusch 7 phich 3
       <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

        #Send CRC for Msg 4
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #pusch 8 phich 4
       <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="4" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1"/>
      </tapa.expset>

        #Send CRC for Msg  5
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #phich 5
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="5"/>
        </tapa.tfu.dat.ind>
     </tapa.send>
 # MSG 9
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="5,1"/>
      </tapa.expset>

   #Send CRC for Msg 6
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #phich 6
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

   #Send CRC for Msg 7
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #phich 7
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="4" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1"/>
      </tapa.expset>

   #Send CRC for Msg 8
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

  #Send CRC for Msg 9
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 

      #phich 8
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="5" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="5,1"/>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #phich 9
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

 # MSG 9 retx
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

  #Send CRC for Msg 9 retx
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #phich 9 retx
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" />
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="0"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:   21.29
#
#       Desc:   "To test successful calculation of  number of 
#                active UE per qci in DL: Consideration of Only Harq Retx buffer for Active UE count"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.29">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation number of active
          UE per qci in DL "
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="14" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>
     
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #made changes to recieve multiple UE Cntrl and Data. 
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
       </tapa.tfu.dat.req>

       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      #Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
     
       <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
       </tapa.tfu.dat.req>
  
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
         
       <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
   
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
       
       <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        </tapa.tfu.cntrl.req>
        
       <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
       </tapa.tfu.dat.req>
        
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
    
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>


      #Send HARQ Ack indication for 1st data request
########
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

########
########
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

########


########
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

########
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         #Reception request for 3rd data request
      <tapa.expset>
         <tapa.lrg.schL2meascfm numDlActQci="1" actvUeDl="1"/>
      </tapa.expset>
   </tapa.test>
  
   #Clean subsection
   <tapa.clean>
     
   #Command To ShutDown LTEMAC Layer
   <tapa.rg.macDeInit.grp16/>
  
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   21.30
#
#       Desc:   "To test the increment of downlink TB counter when MIB message 
                 is transmitted"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.30">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB counter when MIB message 
          is transmitted" 
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require> 

  # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send> 

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect> 

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" />
      </tapa.send>

      <tapa.send >
         <tapa.tfu.tti.ind numTti="39"/>
      </tapa.send>

   # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.bch.dat.req/>
         </tapa.tfu.dat.req>
      </tapa.expect> 

     # Send L2 Measurement send request
     <tapa.send>
        <tapa.lrg.schL2sendmeasreq measType="128" />
     </tapa.send>

     <tapa.send lc="TRUE">
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     <tapa.expset>
        <tapa.lrg.schL2meascfm dlTbCnt="4" />
     </tapa.expset>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean> 

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   21.31
#
#       Desc:   "To test the increment of downlink TB counter when SIB1 or 
                 SI message is transmitted"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB counter when SIB or SI
          message is transmitted" 
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
         <tapa.flag id="RGR_SI_SCH"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

   </tapa.cfg> 

   # Test Steps subsection
   <tapa.test>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="620"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" />
      </tapa.send>

      <tapa.send>
         # Send SI Configuration request for MIB
         <tapa.rgr.sicfgreq instId="5" bcchIdx="0" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_MIB" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      #Do the cell reconfiguration
       <tapa.send>
         <tapa.rgr.cfgreq.recfg.cell instId="5" siWinSize="4"
          siRetxCnt="2" recfgType="2048" modPrd="64"/>
      </tapa.send>

       #SFN,SF is (62,0),giving TTI upto (62,3)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.rgr.cfgCfm instId="5" />
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      #Modify the SI information
      <tapa.send>
         # Send SI Configuration request for SIB1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI1
         <tapa.rgr.sicfgreq instId="5" bcchIdx="2" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="1" buffSz="37"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>
      
      <tapa.send>
         # Send SI Configuration request for SI2
         <tapa.rgr.sicfgreq instId="5" bcchIdx="3" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="2" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI3
         <tapa.rgr.sicfgreq instId="5" bcchIdx="4" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="3" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send SI Configuration request for SI4
         <tapa.rgr.sicfgreq instId="5" bcchIdx="5" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SI" siId="4" />
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

       #SFN,SF is (62,4), giving TTI upto (63,8)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.bch.dat.req />
          <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
   
      #SFN,SF is (63,9), giving TTI upto (64,0)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="2" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>


       #SFN,SF is (64,0), giving TTI upto (64,2)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,3), giving TTI upto (64,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,4), giving TTI upto (64,4)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="3" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,5) giving TTU upto (64,6)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
         <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="10" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,7) giving TTI upto (64,7)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="10" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="4" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (64,8) giving TTI upto (65,0)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="11" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,1) giving TTI upto (65,1)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
         # ccpu00117423 - MOD - Added iMcs Validation
          <tapa.tfu.pdcch.cntrl.req vldImcs="TRUE" iMcs="11" />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="5" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

       #SFN,SF is (65,2) giving TTI upto (66,3)
      <tapa.send lc="TRUE">
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req>
          <tapa.tfu.pdcch.cntrl.req />
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req>
          <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm dlTbCnt="9" />
      </tapa.expset> 
   </tapa.test> 

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean> 

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.32
#
#       Desc:   "To test the increment of downlink TB counter when  
                 RA-RSP is sent"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.32">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB counter when
          RA-RSP is sent"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" timePrd="2" />
      </tapa.send>

     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm dlTbCnt="1" />
      </tapa.expset>  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean> 

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>  

#
#
#       Test:   21.33
#
#       Desc:   "To test the increment of downlink TB counter when  
                 MSG4 without CCCH SDU is transmitted"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.33">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB counter when  
          MSG4 without CCCH SDU is transmitted"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" />
      </tapa.send>


      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="15"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="128" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbCnt="2" />
   </tapa.expset>  
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>   

#
#
#       Test:   21.34
#
#       Desc:   "To test the increment of downlink TB counter when  
                 MSG4 with CCCH SDU is transmitted"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.34">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB counter when  
          MSG4 with CCCH SDU is transmitted"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" timePrd="16"/>
      </tapa.send>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="128" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbCnt="2" />
   </tapa.expset>  
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>    

#
#
#       Test:   21.35
#
#       Desc:   "To verify that downlink TB counter is not incremented
                 when MSG4 without CCCH SDU is retransmitted"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify that downlink TB counter is not incremented
          when MSG4 without CCCH SDU is retransmitted"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128"/>
      </tapa.send>


      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="15"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="128" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbCnt="2" />
   </tapa.expset>  

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset> 

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="128" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbCnt="0" />
   </tapa.expset>   
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>   

#
#
#       Test:   21.36
#
#       Desc:   "To verify that downlink TB counter is not incremented
                 when MSG4 with CCCH SDU is retransmitted"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify that downlink TB counter is not incremented
          when MSG4 with CCCH SDU is retransmitted"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send> 

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="128" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbCnt="2" />
   </tapa.expset>  

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset> 

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="128" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbCnt="0" />
   </tapa.expset>   
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>    

#
#
#       Test:   21.37
#
#       Desc:   "To test increment of UL TB counter when  
                 MSG3 is recieved from UE"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test increment of UL TB counter when          
          MSG3 is recieved from UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="512" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="512" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm ulTbCnt="1" />
   </tapa.expset>    
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       Test:   21.38
#
#       Desc:   "To verify UL TB counter is not incremented when          
                 MSG3 is retransmitted from UE"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify UL TB counter is not incremented when  
          MSG3 is retransmitted from UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="512" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="512" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm ulTbCnt="1" />
   </tapa.expset>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.msg3.recp.req/>
      </tapa.tfu.recp.req>
   </tapa.expect>

   # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send> 

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="512" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm ulTbCnt="0" />
   </tapa.expset>  
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       Test:   21.39
#
#       Desc:   "To verify UL TB counter is incremented when          
                 UL Data is received from UE"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.39">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify UL TB counter is incremented when    
          UL Data is received from UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>   
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="512" />
      </tapa.send>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="512" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm ulTbCnt="2" />
      </tapa.expset>   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.40
#
#       Desc:   "To verify UL TB counter is not incremented when          
                 UL Data is retransmitted from UE"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.40">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify UL TB counter is not incremented when
          UL Data is retransmitted from UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>   
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit prdBsrTmr="65535" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="512" />
      </tapa.send>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

       <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="512" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm ulTbCnt="2" />
      </tapa.expset>     

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect> 

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect> 

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="512" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm ulTbCnt="0" />
      </tapa.expset>   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>  

#
#
#       Test:   21.41
#
#       Desc:   "To test increment of UL TB Faulty counter when  
                 CRC failure comes for MSG3 reception"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.41">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test increment of UL TB Faulty counter when
          CRC failure comes for MSG3 reception"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1024" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="1024" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm ulTbFaulty="1" />
   </tapa.expset>    
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       Test:   21.42
#
#       Desc:  "To verify UL TB Faulty counter is not incremented
                when CRC failure comes for the MSG3 retransmission from UE"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.42">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify UL TB Faulty counter is not incremented 
          when CRC failure comes for the MSG3 retransmission from UE"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1024" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="1024" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm ulTbFaulty="1" />
   </tapa.expset>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.msg3.recp.req/>
      </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect> 

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="1024" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm ulTbCnt="0" />
   </tapa.expset>  
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>       

#
#
#       Test:   21.43
#
#       Desc:   "To verify UL Faulty TB counter is incremented when          
                 CRC failure is received for UL data"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.43">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify UL Faulty TB counter is incremented when 
          CRC failure is received for UL data"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>   
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1024" />
      </tapa.send>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="1024" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm ulTbFaulty="1" />
      </tapa.expset>   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>  

#
#
#       Test:   21.44
#
#       Desc:   "To verify UL Faulty TB counter is not incremented when          
                 CRC failure is received for retransmitted UL data"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.44">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify UL Faulty TB counter is not incremented when
          CRC failure is received for retransmitted UL data"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>   
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit prdBsrTmr="65535" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="1024" />
      </tapa.send>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="1024" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm ulTbFaulty="1" />
      </tapa.expset>      

       <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect> 

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      # Send L2 Measurement send request
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="1024" />
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.lrg.schL2meascfm ulTbFaulty="0" />
      </tapa.expset>   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>   

#
#
#       Test:   21.45
#
#       Desc:   "To test the increment of downlink TB Faulty counter when  
                 NACK is received for MSG4 transmission without CCCH SDU"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.45">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB Faulty counter when
          NACK is received for MSG4 transmission without CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req ueId="0"/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      # Send a 2 TTIs to Send the HARQ ACK Indication
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send> 

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/> 
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>  
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>     

#
#
#       Test:   21.46
#
#       Desc:   "To verify downlink TB Faulty counter is not incremented
                 when NACK is received for MSG4 re-transmission without CCCH SDU"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.46">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify downlink TB Faulty counter is not incremented 
          when NACK is received for MSG4 re-transmission without CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req ueId="0"/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      # Send a 2 TTIs to Send the HARQ ACK Indication
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send> 

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/> 
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>  

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req ueId="0"/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      # Send a 2 TTIs to Send the HARQ ACK Indication
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send> 

    # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/> 
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="0" />
   </tapa.expset>   
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       test:   21.47
#
#       desc:   "To verify downlink TB Faulty counter is incremented when 
                 NACK is received for MSG4 transmission with CCCH SDU"
#       notes:   none
#              
#       Module:  "L2 Measurement module"
#
#       file:    rgac_tc21.xml
#
#
<tapa.testcase id="21.47">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify downlink TB Faulty counter is incremented when 
          NACK is received for MSG4 transmission with CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send> 

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/> 
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

    # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>   

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset> 
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       test:   21.48
#
#       desc:   "To verify downlink TB Faulty counter is not incremented 
                 when NACK is received for MSG4 re-transmission with CCCH SDU"
#       notes:   none
#              
#       Module:  "L2 Measurement module"
#
#       file:    rgac_tc21.xml
#
#
<tapa.testcase id="21.48">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify downlink TB Faulty counter is not incremented 
          when NACK is received for MSG4 re-transmission with CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>
 
      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send> 

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/> 
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

    # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>   

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset> 

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="FALSE"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="0" />
   </tapa.expset>   
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>     

#
#
#       Test:   21.49
#
#       Desc:   "To test the increment of downlink TB Faulty counter when  
                 DTX is received for MSG4 transmission without CCCH SDU"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.49">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB Faulty counter when
          DTX is received for MSG4 transmission without CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>


      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req ueId="0"/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      # Send a 2 TTIs to Send the HARQ ACK Indication
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="TFU_HQ_DTX"/>
      </tapa.tfu.hq.ind>   
   </tapa.send> 

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/> 
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>  
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>     

#
#
#       Test:   21.50
#
#       Desc:   "To verify downlink TB Faulty counter is not incremented
                 when DTX is received for MSG4 re-transmission without CCCH SDU"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.50">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify downlink TB Faulty counter is not incremented 
          when DTX is received for MSG4 re-transmission without CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req ueId="0"/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      # Send a 2 TTIs to Send the HARQ ACK Indication
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="TFU_HQ_DTX"/>
      </tapa.tfu.hq.ind>   
   </tapa.send> 

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/> 
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>  

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req ueId="0"/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      # Send a 2 TTIs to Send the HARQ ACK Indication
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="TFU_HQ_DTX"/>
      </tapa.tfu.hq.ind>   
   </tapa.send> 

    # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/> 
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="0" />
   </tapa.expset>   
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       test:   21.51
#
#       desc:   "To verify downlink TB Faulty counter is incremented when 
                 DTX is received for MSG4 transmission with CCCH SDU"
#       notes:   none
#              
#       Module:  "L2 Measurement module"
#
#       file:    rgac_tc21.xml
#
#
<tapa.testcase id="21.51">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify downlink TB Faulty counter is incremented when 
          NACK is received for MSG4 transmission with CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>


      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send> 

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/> 
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="TFU_HQ_DTX"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

    # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>   

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset> 
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       test:   21.52
#
#       desc:   "To verify downlink TB Faulty counter is not incremented 
                 when DTX is received for MSG4 re-transmission with CCCH SDU"
#       notes:   none
#              
#       Module:  "L2 Measurement module"
#
#       file:    rgac_tc21.xml
#
#
<tapa.testcase id="21.52">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To verify downlink TB Faulty counter is not incremented 
          when NACK is received for MSG4 re-transmission with CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>  

    # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>

   </tapa.cfg>  

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" />
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
      </tapa.tfu.dat.ind>      
   </tapa.send>   

   # At start of this step, we are at (1,0)
   # Expect Message3 datInd on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,0)
   # Send UE config request from RRC in the same subframe as that of Msg3
   # reception but after msg3
   <tapa.send>
      <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # reception but after msg3
   <tapa.send>
      <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   # At start of this step, we are at (1,0)
   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # At start of this step, we are at (1,1)
   # Send BO for Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   # At start of this step, we are at (1,1)
   # Send a Tti to get Msg4 transmission scheduled. 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,2)
   # Expect staInd from MAC to RLC for Msg4 
   <tapa.expect>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expect>

   # At start of this step, we are at (1,2)
   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send> 

   # At start of this step, we are at (1,2)
   # Send 1 TTI to get MSG4 at PHY
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/> 
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="TFU_HQ_DTX"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

    # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="1" />
   </tapa.expset>   

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset> 

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
      
   # At start of this step, we are at (1,7)
   # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
   </tapa.expect>

   # At start of this step, we are at (1,7)
   # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
   # to MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send ACK as feedback for Msg4. 
   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0" isAck="TFU_HQ_DTX"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>

   # At start of this step, we are at (2,0)
   # Send TTIs to validate that there are no pending messages at MAC 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send> 

   # At start of this step, we are at (1,3)
   # Expect Msg4 from MAC to PHY
   <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req validate="TRUE"/>
      </tapa.tfu.dat.req>   
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>  

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="256" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbFaulty="0" />
   </tapa.expset>   
</tapa.test>

# Clean subsection
<tapa.clean>
   <tapa.rg.macDeInit/>
</tapa.clean> 

# Shutdown subsection
<tapa.shutdown>
</tapa.shutdown>

</tapa.testcase>      

#
#
#       Test:   21.53
#
#       Desc:   "To test the increment of downlink TB counter when Paging message 
                 is transmitted"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.53">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the increment of downlink TB counter when Paging message 
          is transmitted" 
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require> 

  # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="50" pdcchCodeRate="50"
         dlSchdType="0" ulSchdType="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" />
      </tapa.send> 

      <tapa.send>
         # Send BO for BCCH-DLSCH logical channel on RGU.
         # Chk the bo here! 
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="400" sfOffset="7"/>
      </tapa.send>

      <tapa.send>
         # Send BO for PCCH logical channel on RGU.
         # Chk the bo here! 
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="7"/>
      </tapa.send>

      <tapa.send>
         # Send 4 Ttis to get the transmission scheduled.
         # Send them individually so that if staInd comes in between, it will
         # fail. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.cstaind lcId="3" boSatisfied="TRUE" maxRb="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send PCCH data to MAC on RGU. 
         <tapa.rgu.cdatreq bcchIdx="1" lcId="3" lcType="2" use="2"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   # Expect Msg4 from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" lcId="3" bcchIdx="1" vldtPcch="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   # Send L2 Measurement send request
   <tapa.send>
      <tapa.lrg.schL2sendmeasreq measType="128" />
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.lrg.schL2meascfm dlTbCnt="1" />
   </tapa.expset>    

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.54
#
#       Desc:   "To verify DL TB counter is incremented for the first
#                transmission of DL Data in SISO mode." 
#
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.54">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
      # "To verify DL TB counter is incremented for the first
         transmission of DL Data in SISO mode."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" timePrd="10" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expset>

   <tapa.delay delay="1"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbCnt="6"/>
   </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.55
#
#       Desc:   "To verify DL TB counter is incremented for the first
#                transmission of DL Data in MIMO mode." 
#
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.55">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
      # "To verify DL TB counter is incremented for the first
         transmission of DL Data in MIMO mode."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128" timePrd="10" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expset>

   <tapa.delay delay="1"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbCnt="6"/>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.56
#
#       Desc:   "To verify DL Faulty TB counter is incremented for first NACKED
#                TB in SISO mode." 
#
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.56">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
      # To verify DL Faulty TB counter is incremented for first NACKED TB in
      # SISO mode."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" numQci="1" qci="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expset>

   <tapa.delay delay="1"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="256"/>
      </tapa.send>

    #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbFaulty="2"/>
   </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.57
#
#       Desc:   "To verify DL Faulty TB counter is incremented for first NACKED
#                TB in MIMO mode." 
#
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.57">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
      # "To verify DL Faulty TB counter is incremented for first NACKED TB in
      # MIMO mode."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="256" numQci="1" qci="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expset>

   <tapa.delay delay="1"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind>
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="256"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbFaulty="2"/>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.58
#
#       Desc:   "To verify DL TB counter is not incremented for retransmission
#                of DL Data in SISO mode." 
#
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.58">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
      # "To verify DL TB counter is not incremented for 
         retransmission of DL Data in SISO mode."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128"  numQci="1" qci="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expset>

   <tapa.delay delay="1"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbCnt="6"/>
   </tapa.expect>
   
   <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE" isRetx="TRUE" retxUse="3"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbCnt="0"/>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.59
#
#       Desc:   "To verify DL TB counter is not incremented for
#                retransmission of DL Data in MIMO mode." 
#
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.59">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
      # "To verify DL TB counter is incremented for
         retransmission of DL Data in MIMO mode."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_MIMO"/>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

# Configuration subsection
   <tapa.cfg>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0"/>
      <tapa.rg.UeInit.grp16 ueId="1"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="4" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" dir="1" lcType="4" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="4" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="128"  numQci="1" qci="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="64"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="0" numLchTb1="4" lchTb1Data="1:2:3:4" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="4" lchTb1Data="1:2:3:4" />
      </tapa.expset>

   <tapa.delay delay="1"/>

      <tapa.send>
         # Send DDatReq for UE1 
         <tapa.rgu.ddatreq ueId="0" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for UE2
         <tapa.rgu.ddatreq ueId="1" numLchTb1="4" lchTb1Data="1,0,1:2,0,1:3,0,1:4,0,1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" saveTo="3" validate="TRUE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="2" saveTo="4" validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 
      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbCnt="6"/>
   </tapa.expect>
   
   <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req>
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req>
        <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE" isRetx="TRUE" retxUse="3"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send lc="TRUE">
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
 

      <tapa.send lc="TRUE">
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.lrg.schL2sendmeasreq measType="128"/>
      </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expect>
         <tapa.lrg.schL2meascfm dlTbCnt="0"/>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:    21.60
#
#       Desc:    To test active UE per qci in uplink
#                in FDD mode : LC/QCI config is provided thru LCG RECFG
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="21.60">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To test active UE per qci in uplink"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="1000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="2000"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueBr="3000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>


      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="0" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5" numLch="0" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5" numLch="0" lcId="3" qci="8"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="13" measType="64" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="42"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="41"/>
           <tapa.tfu.dat ueId="2" use="6" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="40"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # verify grnt is recieved for UEs in descending order of ueBr amount
      # with BW constraint restricdting grnt allocation to only 2 UEs
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" ueId="0" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="5" ueId="1" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="6" ueId="2" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
     
      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           #<tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     <!--
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     -->
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="1"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.61
#
#       Desc:   "To test successful calculation of  number of 
#                active UE per qci in DL: With LC deletion and UE deletion ongoing"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.61">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation number of active
          UE per qci in DL "
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="3" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE2 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE3 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE4 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="10" sampPrd="2"  numQci="1" qci="1"/>
      </tapa.send>
     
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send BO for UE2 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE3 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE4 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #made changes to recieve multiple UE Cntrl and Data. 
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>

       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      #Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
     
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
  
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>
      
      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
         
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
   
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
       
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>
      
      #Send DDatReq for UE4
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="4">
          <tapa.tfu.pdcch.cntrl.req ueId="0"/>
          <tapa.tfu.pdcch.cntrl.req ueId="1"/>
          <tapa.tfu.pdcch.cntrl.req ueId="2"/>
          <tapa.tfu.pdcch.cntrl.req ueId="3"/>
        </tapa.tfu.cntrl.req>
        
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
    
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="4" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>


      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="3" spId="1">
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="3" spId="1">
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="2"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="3"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="2"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="3"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="3" spId="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
         <tapa.lrg.schL2meascfm numDlActQci="1" actvUeDl="3"/>
      </tapa.expset>
   
      </tapa.test>
  
   #Clean subsection
   <tapa.clean>
     
   #Command To ShutDown LTEMAC Layer
   <tapa.rg.macDeInit.grp16/>
  
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:    21.62
#
#       Desc:    To test active UE per qci in uplink
#                in FDD mode : With LCG reconfig and UE deletion ongoing
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="21.62">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To test active UE per qci in uplink"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="1000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="2000"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueBr="3000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="0" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5" numLch="0" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5" numLch="0" lcId="3" qci="8"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset> 

      <tapa.send>
         <tapa.rgr.cfgreq.del  DelType="3"  ueId="0" lcId="3" dir="3"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset> 

      <tapa.send>
         <tapa.rgr.cfgreq.del  DelType="3"  ueId="0" lcId="4" dir="3"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset> 

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset> 

      <tapa.send>
         <tapa.rgr.cfgreq.del  DelType="3"  ueId="0" lcId="5" dir="3"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset> 

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset> 

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" dir="3" lcType="4"
dlQci="8" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset> 

      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="13" measType="64" numQci="1" qci="8" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="42"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="41"/>
           <tapa.tfu.dat ueId="2" use="6" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="40"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # verify grnt is recieved for UEs in descending order of ueBr amount
      # with BW constraint restricdting grnt allocation to only 2 UEs
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="5" ueId="1" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="6" ueId="2" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
     
      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
     <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>


      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    <!-- 
    <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     -->
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="0"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:   21.63
#
#       Desc:   "To test successful calculation of  number of 
#                active UE per qci in DL"
#       Notes:   None
#              
#       Module:  "L2 Measurement module"
#
#       File:    rgac_tc21.xml
#
#
<tapa.testcase id="21.63">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="L2 Measurement"/>

      <tapa.desc>
         "To test the successful calculation number of active
          UE per qci in DL "
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" dlTotalBw="50"
         thresholdCqi= "5" dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit.grp16 ueId="0" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      <tapa.rg.UeInit.grp16 ueId="3" ueCatEnum="1" aprdModeEnumPres = "TRUE" 
         aprdModeEnum="RGAC_RGR_APRD_CQI_MOD20"/>
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE2 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE3 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #UE4 Configuration
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind />
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expset>
       <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="4" instId="5" 
           dlQci="1" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind/>
      </tapa.send>

     # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
     # Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq measType="32" timePrd="10" sampPrd="2"  numQci="0" qci="0"/>
      </tapa.send>
     
      #Send BO for UE1 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      #Send BO for UE2 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE3 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      #Send BO for UE4 for 1st data
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send a Tti to get the transmission scheduled. 
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect staInd from MAC to RLC
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #made changes to recieve multiple UE Cntrl and Data. 
     #Expect data request and control request for the 1st data
     <tapa.expset>
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>

       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
        <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
     </tapa.expset>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>
      
      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect staInd from MAC to RLC for the data
      #Expect control and data request for 2nd data request
      #Made changes to recieve multiple UE Cntrl and Data. 
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
     
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
  
      </tapa.expset>

      <tapa.delay delay="5"/>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>
      
      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Expect control and data request for 3rd data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
         
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
   
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="400"/>
      </tapa.send>

      # Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send BO for UE4
      <tapa.send>
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="40"/>
      </tapa.send>

      # Send DDatReq for UE4 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1" dispatchDatReq="1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect control and data request for 4th data request
      #Expect staInd from MAC to RLC for the data 
      <tapa.expset>
       
       <tapa.tfu.cntrl.req numCntrlReq="4">
        <tapa.tfu.pdcch.cntrl.req ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req ueId="2"/>
        <tapa.tfu.pdcch.cntrl.req ueId="3"/>
       </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
       <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" />
       <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" />
      </tapa.expset>

      <tapa.delay delay="5"/>

      #Send DDatReq for UE1 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE2 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send DDatReq for UE3 
      <tapa.send>
         <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>
      
      #Send DDatReq for UE4
      <tapa.send>
         <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1,0,1"/>
      </tapa.send>

      #Send tti indication for scheduling
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect data and control request
      #Expect data reception request
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="4">
          <tapa.tfu.pdcch.cntrl.req ueId="0"/>
          <tapa.tfu.pdcch.cntrl.req ueId="1"/>
          <tapa.tfu.pdcch.cntrl.req ueId="2"/>
          <tapa.tfu.pdcch.cntrl.req ueId="3"/>
        </tapa.tfu.cntrl.req>
        
       <tapa.tfu.dat.req datReqs="4">
        <tapa.tfu.pdsch.dat.req ueId="0"/>
        <tapa.tfu.pdsch.dat.req ueId="1"/>
        <tapa.tfu.pdsch.dat.req ueId="2"/>
        <tapa.tfu.pdsch.dat.req ueId="3"/>
       </tapa.tfu.dat.req>
        
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
    
      </tapa.expset>
      
      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="4" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request for 2nd data request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      #Send tti indicatio
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect reception request
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="4" spId="1">
          <tapa.tfu.hq.recp.req ueId="0"/>
          <tapa.tfu.hq.recp.req ueId="1"/>
          <tapa.tfu.hq.recp.req ueId="2"/>
          <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
     </tapa.expect>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="2"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send HARQ ACK Indication
      <tapa.send>
        <tapa.tfu.hq.ind>
           <tapa.tfu.hq ueId="3"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send tti indication
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="2"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send HARQ Ack indication for 1st data request
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="3"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Reception request for 3rd data request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="4" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>   
         <tapa.lrg.schL2meascfm numDlActQci="1" actvUeDl="4"/>
      </tapa.expset>
   
      </tapa.test>
  
   #Clean subsection
   <tapa.clean>
     
   #Command To ShutDown LTEMAC Layer
   <tapa.rg.macDeInit.grp16/>
  
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

#
#
#       Test:    21.64
#
#       Desc:    To test active UE per qci in uplink
#                in FDD mode
#
#       Notes:   None
#              
#       Module:  L2 Measurement
#
#       File:    rgac_tc21.xml
<tapa.testcase id="21.64">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To test active UE per qci in uplink"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTE_L2_MEAS"/>
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="30" maxUlUeNewTxPerTti="4" ulSchdType="0"  dlSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit.grp16 ueId="0" ueBr="1000"/>
      <tapa.rg.UeInit.grp16 ueId="1" ueBr="2000"/>
      <tapa.rg.UeInit.grp16 ueId="2" ueBr="3000"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="1" dir="3" lcType="4"
ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="1" instId="5" numLch="1" lcId="3" qci="8"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
     
      #Send L2 Measurement request
      <tapa.send>
         <tapa.lrg.schL2measreq timePrd="13" measType="64" numQci="0" qci="0" sampPrd="2"/>
      </tapa.send>
      
      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     #bsr amount is in the order opposite to ueBr amount.
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="42"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="41"/>
           <tapa.tfu.dat ueId="2" use="6" lcId="3" addShortBsr="TRUE" lcgId="1" bsr="40"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # verify grnt is recieved for UEs in descending order of ueBr amount
      # with BW constraint restricdting grnt allocation to only 2 UEs
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="4" ueId="0" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="5" ueId="1" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
          <tapa.tfu.dat use="6" ueId="2" addTruncBsr="TRUE" lcId="3" lcgId="1" bsr="50"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
     
      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>
      
      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           #<tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      # Send a TTI to schedule BSR
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     <!-- 
       <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     -->
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.lrg.schL2meascfm numUlActvQci="1" actvUeUl="1"/>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit.grp16/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase> 

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend

#/********************************************************************30**
#
#         End of file:     cm_xta_gen_tc_num.py@@/main/5 - Wed Jun 27 16:21:06 2007
#
#*********************************************************************31*/
#
#
#/********************************************************************40**
#
#        Notes:
#
#*********************************************************************41*/
#
#/********************************************************************50**
#
#*********************************************************************51*/
#
#
#/********************************************************************60**
#
#        Revision history:
#
#*********************************************************************61*/
#
#/********************************************************************90**
#
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#$SID$         ---      sy  1. Update of sid field
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg001.301    nudupi 1. Added the changes for the CR ccpu00119023. 
#$SID$        rg002.301    asehgal    1. Added the changes for the CR ccpu00109543
                                         and add changes for ccpu00120621.
#$SID$                                2. Modified the testcase 21.11 to incorporate
#                                    the code for multiple UEs. 
#$SID$      ---        rt  1. LTE MAC 4.1 Release
#*********************************************************************91*/
