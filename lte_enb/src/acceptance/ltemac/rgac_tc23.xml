#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases
#
#     File:    rgac_tc23.xml
#
#     Sid:      cm_xta_gen_tc_num.py@@/main/5 - Wed Jun 27 16:21:06 2007
#
#     Prg:     hn 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=5:hn:rgac_tc23.xml

#
#
#       Test:    23.1
#
#       Desc:    To test UE Configuration at CRG/RGR
#                with DRX parameters(Includes both unsuccessful
#                and successful cases)
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.1">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful UE config at CRG/RG with DRX params"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELl, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. Send Invalid values of DRX params and
         expect negative confirm. Finally, send valid values and expect 
         positive confirm.
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="LTEMAC_R9" />
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.rach/>
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
     # Send UE config request at CRG 
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue/>
     </tapa.send>
     # Expect success in cfg cfm from MAC
     <tapa.expect>
        <tapa.crg.cfgcfm/>
     </tapa.expect>

     # Send UE config request at RGR  with invalid value of onDurTmr
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="32"   
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
     
     # Send UE config request at RGR with an invalid drx-inactivity tmr val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid drx-retx tmr val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid long-Drx val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="21"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with an invalid short-cycle val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="7"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with an invalid short-cycle val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="17"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with longdrx Cycle
    # as not a multiple of short-drx cycle
    
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="17"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with drx-offset 
    # invalid 
    
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
           drxStartOffst="12"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with an valid drx params 
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="3"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="10"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect positive cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
    <tapa.rg.macDeInit/>
   </tapa.clean>

    #Request to ShutDown LTEMAC
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.2
#
#       Desc:    To test with DRX enabled, UE gets scheduled
#                only in its active time.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.2" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that MAC schedules UE only in its active time."
      </tapa.desc>

      <tapa.longdesc>
      "Send BO in DRX period. Expect PDCCH only when On-Duration starts."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50" />
      
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="30"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="14"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.3
#
#       Desc:    To test Contention Free RA procedure is not impacted
#                by DRX
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.3">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="DRX"/>

      <tapa.desc>
         "To test Contention Free RA with DRX." 
      </tapa.desc>

      <tapa.longdesc>
         "To test Contention Free RA is not impacted by the state of 
          UE as dicated by its DRX period.
          Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

      # UE configuration
      <tapa.rg.UeInit maxUlHqTx="4" 
      taTmrPres="TRUE"
      taTmr="40" 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="10"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="0"
      />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

       <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         #<tapa.tfu.tti.ind numTti="5" TTI="YSM"/>
         <tapa.tfu.tti.ind numTti="6" TTI="YSM"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         #<tapa.tfu.tti.ind numTti="5"/>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         #<tapa.tfu.tti.ind numTti="5" />
         <tapa.tfu.tti.ind numTti="6" />
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>   
      
      # Send BO for the created logical channel on RGU to trigger a PO. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      #send 2 TTIs one for scheduling and 1 for transmitting
      <tapa.send>
         #<tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
          # <tapa.tfu.pdcch.cntrl.req ueId="0" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="8"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="9"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      # Apply GAP number of TTI before indicating a RaReq
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #  send an authorized raReq. Processing this, MAC shall
      # free the rapId to UE association and further raReq with
      # this rapId without a PDCCH Order shall be discarded by MAC.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # we are at (6,8)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="11"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.msg3.recp.req ueId="0" vldtDatRecp="TRUE"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
   <tapa.send>
        <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
      
   #Send CRC for Msg
   <tapa.send>
       <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
        </tapa.tfu.crc.ind>
    </tapa.send>
     
    #At this point UE0 which was idle should be activated
    #so expect DStaInd, for DL scheduling would have happened 
    #for the reported BO.
    <tapa.send>
       <tapa.tfu.tti.ind numTti="1"/>
    </tapa.send>

     
     # Expect HARQ ACK in PHICH
     <tapa.expset>
        <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
       </tapa.tfu.cntrl.req>
     </tapa.expset>

     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req  use="1" ueId="0" numSdu="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.4
#
#       Desc:    Handling of SR is irrespective of the DRX state 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.4">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify an SR received is satisified even if the UE is in its
          inactive time" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC and reconfigure a Scheduling Request
         with a certain Periodicity.Verify that the received SR is satisified
         even if UE is DRX Inactive or an UE is treated as DRX ACTIVE on receipt 
         of a SR and remains so till the SR is satisified.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />

      # UE configuration
      <tapa.rg.UeInit ueId="0"  txModeEnum="RGR_UE_TM_1" 
         isDrxEnabled="TRUE"
         drxOnDurTmr = "2"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="10"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="0"
       />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2" instId="5"/>
      </tapa.send>
      <!--
      # Send UE ReConfiguration for the same UE-0 created above for SR Cfg
      # at RGR. At this point we are in (2,3) and a SR Index will be set for TTI#45
      # srCfgIdx="20" means Periodicity=20, offset=(20-15)=5
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
       srCfgPres ="TRUE" srCfgIdx ="20"  UeReCfgType="16384" />
      </tapa.send>
    -->

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         #<tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>
       
      <tapa.send>
         # Send enough TTI's to come to SR occurence. 
         # Move till (4,6)
         <tapa.tfu.tti.ind numTti="23"/>
      </tapa.send>
      <!-- 
      # At (4,3), ue is currently in its inactive time
      <tapa.expset>
         <tapa.tfu.recp.req>
            <tapa.tfu.sr.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send enough TTI's to come to SR occurence. 
         # Move till (4,6)
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     -->
     # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

     # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for UE to transmit) - TFU_DELTA(=2)
     # in advance that we expect datRecpReq
     <tapa.send>
        <tapa.tfu.tti.ind numTti="4"/>
     </tapa.send>

     #Expect data reception request
     <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>
           
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="2" lcId="9"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     # Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="9,1" vldtBuf="TRUE"/>
     </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.5
#
#       Desc:    To ensure UL retransmissions(non-adaptive)
#                are unaffected irrespective of the DRX state 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.5">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that UL retransmissions are unaffected irrespective
          of DRX state" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>
      <!--
      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/> -->

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="20"/>

      # UE configuration
      
      <tapa.rg.UeInit ueId="0" maxUlHqTx="4" txModeEnum="RGR_UE_TM_1" 
         isDrxEnabled="TRUE"
         drxOnDurTmr = "2"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="40"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="10"
         prdBsrTmr="65535"
         />
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         # <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>
       
      <tapa.send>
         # Send enough TTI's to come to SR occurence. 
         # Move till (2,4)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send SR Indication
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="0"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0. Since SR in previous TTI will lead to DCI-0. 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

     # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for UE to transmit) - TFU_DELTA(=2)
     # in advance that we expect datRecpReq
     <tapa.send>
        <tapa.tfu.tti.ind numTti="4"/>
     </tapa.send>

     #Expect data reception request
     <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" vldtRv="0" saveTo="2"/>
     </tapa.tfu.recp.req>   
     </tapa.expect>
           
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Do not Send CRC after 3 ttis 

      #Send a TTI to expect HarqAckReq
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect data reception request for retransmission
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" isRtx="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.6
#
#       Desc:    To verify UL Retx handling incase Adaptive retx of a UE 
#                is irrespective of DRX state
#
#       Notes:   None
#              
#       Module:  scheduler
#
#       File:    rgac_tc5.xml
#
#
<tapa.testcase id="23.6">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         "To verify UL Retx handling incase retx of a UE in reTxSf collides
          with msg3 allocation in the same subframe. In this case one of the
          UEs retx alloc collides with msg3, hence that UE shall be made to 
          undergo an Adaptive retx, other UEs shall perform Non-Adaptive Retx.
          The test case is to ensure DRX does not interfere with this adaptive
          retransmission
          "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <!--
      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>
      -->
      
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100" maxUlUeNewTxPerTti="10"
         dlSchdType="0" ulSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit ueId="0" ueBr="3000" maxUlHqTx="4"
         isDrxEnabled="TRUE"
         drxOnDurTmr = "2"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="40"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="10"
         prdBsrTmr="65535"
        />
     <tapa.rg.UeInit ueId="1" ueBr="3000" maxUlHqTx="4"
         isDrxEnabled="TRUE"
         drxOnDurTmr = "2"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="40"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="10"
         prdBsrTmr="65535"
        />
     <tapa.rg.UeInit ueId="2" ueBr="3000" maxUlHqTx="4"
         isDrxEnabled="TRUE"
         drxOnDurTmr = "2"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="40"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="10"
         prdBsrTmr="65535"
        />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
      # This is (6,9)
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="0" bsr="10"/>
           <tapa.tfu.dat ueId="1" use="5" lcId="3" addShortBsr="TRUE" lcgId="0" bsr="10"/>
           <tapa.tfu.dat ueId="2" use="6" lcId="3" addShortBsr="TRUE" lcgId="0" bsr="10"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req  expCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="2"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" isUlGrant="TRUE" vldtTx="TRUE" saveTo="3"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req  ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req  ueId="1" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req  ueId="2" isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" vldtGrant="TRUE" vldtRetx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      # Expect Adaptive grant for UeId=0 as it collides with msg3 resources
      <!--
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="3" use="4" validate="TRUE" saveTo="7"/>
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
           <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="5"/>
           <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat ueId="0" use="4" lcId="3"/>
          <tapa.tfu.dat ueId="1" use="5" lcId="3"/>
          <tapa.tfu.dat ueId="2" use="6" lcId="3"/>
          <tapa.tfu.dat ueId="3" use="7" isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>
    </tapa.send>

      <tapa.expset>
         # Expect datInd to go to RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="3"/>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3"/>
         <tapa.rgu.cdatind ueId="3" lcId="4"/>
      </tapa.expset>

       # Send BO for Msg4 on RGU. 
       <tapa.send>
          <tapa.rgu.cstarsp ueId="3" lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      # verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="3" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="3" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="3" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="3"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq  ueId="3"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="3"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Send 50 TTIs to check no further indications from MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="50"/>
   </tapa.send>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.7
#
#       Desc:    To ensure if cqi-Mask is setup by upper layers,
#                when onDuration is not running, CQI/PMI/RI is not reported
#                and if cqi-Mask is NOT setup by upper layers, 
#                when UE is not in its active time, CQI/PMI/RI is not reported
#
#       Notes:   None
#              
#       Module:  
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Setup cqi-Mask and make sure the CQI's periodicity lies when
          onDuration is running. Verify that cqi recep request is expected
          by TFU. Re-configure onDuration such that CQI's periodicity does
          no lie when onDuration is running. Verify that NO cqi recep req 
          is generated.
          Re-configure and reset cqi-Mask. Ensure that no cqi recep req
          is generated when UE is not in its active time and is generated
          when UE is in its active time.
          of DRX state" 
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, Common Logical channel configurations at CRG and RGR
         and also finish RACH.
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

     <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
        <tapa.flag id="LTEMAC_R9"/>  <!--cqi-Mask only available in R9 -->
        <tapa.flag id="TFU_UPGRADE"/> <!-- a recp req for CQI is generated
                                           only with TFU_UPGRADE -->
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef>
     </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>
      <!--
      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/> -->

      # Cell Configuration
      <tapa.rg.cellInit ulTotalBw="20"/>

      # UE configuration
      
      <tapa.rg.UeInit ueId="0" maxUlHqTx="4" txModeEnum="RGR_UE_TM_1" 
         isDrxEnabled="TRUE"
         drxOnDurTmr = "2"
         drxInactvTmr="2"
         drxRetxTmr="16"
         longDrxCycle="40"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="10"
         cqiMask="TRUE"
         prdCqiCfg.type="TRUE"
         cqiPCfgIdx = "8"
         />
      
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         # <tapa.rgr.cfgCfm status="0" instId="5"/>
         <tapa.rgr.cfgCfm status="0" ueId="0" instId="5"/>
      </tapa.expset>
       
      <tapa.send>
         # Send enough TTI's to come to CQI occurence. 
         # Move till (2,9). CQi will come at (3,1)
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <!-- Remove this CQI Reception request except
           after the code for R9 for TFU is finished
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
     </tapa.expset>
     
     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
           -->
      <!-- Remove till here -->

      <!-- We are currently at (2,9)
           Give enough TTI's to reach (3,9)
           which is the next occasion of 
           CQI RecpReq.  
           -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      <!-- 
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
     </tapa.expset>
     
     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
      -->
      <!-- Remove till here -->
      <!-- We are curently at (3,9)
           Give enought TTI's to reach (4,9)
           which is the next occasion of CQI
           RecpReq for a CQI occurence of
           (5,1). (5,1) also collidies with
           UE's on Duration
       -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
     </tapa.expset>
     
     # Send TTI to increment as many to receive DL Raw PCQI Ind
     # Give 3 TTI's (2 for TFU_DELTA + 1 for RG_UL_DELTA)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
   
   #Send UE ReConfiguration to disable cqi-Mask
      # RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "3"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="10"
            cqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #We are (5,4) now with cqi-Mask NOT setup.
      #The next CQI occassion is (6,1) which means
      #the reception request *should* come at (5,9).
      #However, since the UE is NOT active, no reception
      #request would come.
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
       </tapa.send>

      <!-- we are now at (5,9). The next few
           CQI occassions are (7,1),(8,1) and
           (9,1). Since, cqi-Mask is not setup,
           we should only see a reception request
           for (9,1) -->
           
      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      

      <!-- moving till (7,9) -->
      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>


      <!-- moving till (8,9) -->
      # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.recp.req >
           <tapa.tfu.dlcqi.recp.req />
        </tapa.tfu.recp.req>   
     </tapa.expset>
     
     # Send TTI to increment as many to receive DL Raw PCQI Ind
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    23.8
#
#       Desc:    To test successful CRG UE Delete Request
#
#       Notes:   None
#              
#       Module:  DRX Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.8">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful UE Delete Request with DRX enabled"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELL, RACH and UE configurations and then call UE Delete
         Request and expect configuration confirm"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit DLSPSMaxBw="40" dlTotalBw="50"/>

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.UeInit
        isDrxEnabled="TRUE"
        drxOnDurTmr="2"
        drxInactvTmr="30"
        drxRetxTmr="16"
        longDrxCycle="20"
        isShortDrxPrsnt="TRUE"
        shortDrxCycle="5"
        drxStartOffst="10"
        />

      #Finish RACH and then do UE Configuratrion
      <tapa.rg.UeInit
         ueId="1"
        isDrxEnabled="FALSE"
      />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Send UE Delete Request for the UE ID 0 at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the same UE ID 0 at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the UE ID 1 created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="1" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the UE ID 1 at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="1" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      #Request to ShutDown LTEMAC
      <!--
     <tapa.rg.macDeInit/>
      -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#       Test:    23.9
#
#       Desc:    To test successful CRG/RGR Cell Delete Request
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.9">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful CRG Cell Delete Request"
      </tapa.desc>

      <tapa.longdesc>
         "Send CELL configuration request to LTEMAC and to Scheduler from 
         Dummy RRC and RRM and expect a positive configuration confirmation from
         LTE MAC and acheduler then send a Cell Delte Request for CELL to LTEMAC
         and Scheduler and expect a configuration confirm"
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.cellInit ulTotalBw="20"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      

      # Send CELL Delete Request for the same CELL created above. 
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" DelType="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send CELL Delete Request for the same CELL created above at RGR. 
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" DelType="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.10
#
#       Desc:    To test UE reset at both CRG and RGR Interface with Data Path
#
#       Notes:   None
#              
#       Module:  Configuration/Reset 
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.10">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To test UE reset at CRG/RGR interface with Data Path
      </tapa.desc>

      <tapa.longdesc>
         "Create a CELL at CRG and RGR Interface and then create UE at CRG and
         RGR interface and start Uplink Data Path and then Send UE Reset 
         Request at CRG/RGR interfaces after Status Indication from MAC"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit
        isDrxEnabled="TRUE"
        drxOnDurTmr = "2"
        drxInactvTmr="2"
        drxRetxTmr="16"
        longDrxCycle="40"
        isShortDrxPrsnt="FALSE"
        shortDrxCycle="5"
        drxStartOffst="10"
        cqiMask="FALSE"
       />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      # Send UE Reset request for the default Ue at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With default Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
      
      # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="FALSE" />
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

     # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
     # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

     # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send re-configuration disabling SPS in downlink
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0"
           oldcrnti="11" newUeId="1" newcrnti="12"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      # Send UE ReConfiguration for the same UE created above for change in RNTI
       <tapa.send>
            <tapa.crg.cfgreq.recfg.ue cellId="3" oldUeId="0" newUeId="1"
              UeReCfgType="64"/>
       </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
       <tapa.expect>
            <tapa.crg.cfgcfm/>
       </tapa.expect>
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="100"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId='1' validate="TRUE" chkCcchSh="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId='1'/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req ueId='1'/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
          <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>
      </tapa.send>
      # Send a TTI to schedule SR, As UE is reset above we should not get pdcch
      # request after this TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Yes we didn't get pdcch request so Send SR Indication for default UE
      # again for normal UL call flow
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
     
     # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # In normal call flow we send 4 TTI's to get pusch recp req at TFU, But now
      # send 3 TTI's and then send UE Reset for default UE at RGR and CRG.
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # Send UE Reset request for the default Ue at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="1" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With default Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="1" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>

      # Now send one more TTI now we shouldn't get pusch recp req at TFU as we
      # reset UE above 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # send extra TTIs to verify nothing scheduled/signalled here after 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.11 
#
#       Desc:    Verify that multiple UE's act according to their DRX cycles 
#                
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test Multiple UE's act according to their DRX configurations. 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50" />
      
      # UE Configuration, ueId(0)
      <tapa.rg.UeInit 
       ueId="0"
      isDrxEnabled="TRUE"
      drxOnDurTmr="8"
      drxInactvTmr="5"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
   
    # UE Configuration, ueId(1)
      <tapa.rg.UeInit 
       ueId="1"
      isDrxEnabled="TRUE"
      drxOnDurTmr="5"
      drxInactvTmr="5"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="0"
      />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for ueId(0)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for ueId(0)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DCCH for ueId(1)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for ueId(1)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <!--- on RGR interface -->
      
      # Configure bi-directional DCCH for ueId(0) 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" ueId="0" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for  ueId(0)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" ueId="0" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Configure bi-directional DCCH for ueId(0) 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" ueId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for  ueId(0)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" ueId="1" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      <!-- Currently, we are at (5,5).
           Bring the system to (5,7). The onDuration
           timer from DL starts for UE 1.
           onDuration expiry calculated as (6,2)-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <!-- send 1 more TTI. onDuration timer from UL
           starts for UE 1. Check if ue is deleted
           from the current queue -->
           <tapa.send>
              <tapa.tfu.tti.ind numTti="1" />
           </tapa.send>
              
      
      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="50"/>
      </tapa.send>

      # Give 1 TTI for UE 1 to be scheduled. ue1 is in its 
      # onDuration period. This is (5,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq). This is (5,9)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <!-- This is (6,0) -->
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- The inactivity timer for 5pfs for UE 1 would have started. This
      would expire in (6,7) -->

      <!-- The actual data goes out on (6,2).This is currently (6,0) 
           Expect a reception request on (6,4). 
           The inActivity Timer for UE 1 also expires on this SF for DL.
        -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>


      <!-- give 3 TTI's (2 for TFU_DELTA + 1 for RG_UL_DELTA)
           for Hq feedback to come back -->
      <!-- at (6,5) inActivity timer for UL expires. Verify
           that ue gets deleted from the inActivity queue -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <!-- we are currently at (6,7) -->
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>


      <!-- We are currently at (6,7). UE 0's onDuration period
           starts at (7,0). The UE is currently inactive. Lets
           try sending some data in the DL direction -->
      
      # RLC--->MAC_SH (StaRsp). 
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" lcType="5" bo="30"/>
      </tapa.send>

      <!-- Don't expect StaInd unless TTI is moved further. UE 0
           becomes active in (7,0). Since, we will schedule in DL
           3 sf's ahead, moving by 1 tti should suffice -->
       <tapa.send>
          <tapa.tfu.tti.ind numTti="1" />
       </tapa.send>

       <!-- inAcitivty timer for UE 0 is also started expiring at (7,6) -->
      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      #RLC----->MAC (DatReq)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="1" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <!-- The Data goes out on (7,1) -->
      <!-- The inactivity timer for 5pfs for UE 1 would have started. This
      would expire in (7,7) -->

      <!-- inActivity timer for Ue 0 also expires in this subframe -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <!-- give 3 ttis (2 for TFU_DELTA + 1 RG_UL_DELTA) -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <!-- we are currently at (7,7) -->
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="3" />
     </tapa.send>
            

</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.12 
#
#       Desc:    Verify that multiple UE's act according to their DRX cycles 
#                They switch between their configured short and long drx cycle
#                
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test Multiple UE's act according to their DRX configurations. 
         They switch between their configured short and long drx cycles
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="80" />
      
      # UE Configuration, ueId(0)
      <tapa.rg.UeInit 
       ueId="0"
      isDrxEnabled="TRUE"
      drxOnDurTmr="8"
      drxInactvTmr="5"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="10"
      drxShortCycleTmr="2"
      drxStartOffst="10"
      />
   
    # UE Configuration, ueId(1)
      <tapa.rg.UeInit 
       ueId="1"
      isDrxEnabled="TRUE"
      drxOnDurTmr="5"
      drxInactvTmr="5"
      drxRetxTmr="16"
      longDrxCycle="10"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxShortCycleTmr="3"
      drxStartOffst="0"
      />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # Configure bi-directional DCCH for ueId(0)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for ueId(0)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DCCH for ueId(1)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for ueId(1)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <!--- on RGR interface -->
      
      # Configure bi-directional DCCH for ueId(0) 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" ueId="0" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for  ueId(0)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" ueId="0" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>

      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      # Configure bi-directional DCCH for ueId(0) 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" ueId="1" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>

      # Configure bi-directional DTCH for  ueId(0)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" ueId="1" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      <!-- Currently, we are at (5,5).
           Bring the system to (5,7). The onDuration
           timer from DL starts for UE 1.
           onDuration expiry calculated as (6,2)-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <!-- send 1 more TTI. onDuration timer from UL
           starts for UE 1. Check if ue is deleted
           from the current queue -->
           <tapa.send>
              <tapa.tfu.tti.ind numTti="1" />
           </tapa.send>
              
      
      # RLC--->MAC_SH (StaRsp)
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="5"/>
      </tapa.send>

      # Give 1 TTI for UE 1 to be scheduled. ue1 is in its 
      # onDuration period. This is (5,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #MAC_SH ----->RLC (StaInd)
      <tapa.expect>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      #RLC----->MAC (DatReq). This is (5,9)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <!-- This is (6,0) -->
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- The inactivity timer for 5pfs for UE 1 would have started. This
      would expire in (6,7) -->

      <!-- The actual data goes out on (6,2).This is currently (6,0) 
           Expect a reception request on (6,4). 
           The inActivity Timer for UE 1 also expires on this SF for DL.
           Verify that the cycle switches to short cycle and onDuration
           is calculated again based on short Cycle.Short cycle will
           expire on (9,1). The onDuration within shortCycle should
           be calculated as starting on (6,8)
        -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>


      <!-- give 3 TTI's (2 for TFU_DELTA + 1 for RG_UL_DELTA)
           for Hq feedback to come back -->
      <!-- at (6,5) inActivity timer for UL expires. Verify
      that ue gets deleted from the inActivity queue -->
      <!-- further at (6,5), we will mark the start of onDuration (within short cycle)
           in DL (as we look at DL 3 subframes in advance). 
           Calculate the onDuration expiry. It should expire in (7,3) -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <!-- we are currently at (6,7) -->
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>


      <!-- We are currently at (6,7). UE 0's onDuration period
           starts at (7,0). The UE is currently inactive. Lets
           try sending some data in the DL direction -->

      <!-- UE 1 is also inactive at this time (as onDuration of short cycle
           starts at (6,8). However, we take decisions regarding DL 3 sfs
           in advance and at (7,1) UE 1 will be active. Lets send some
           DL data)
           -->
      
       # RLC--->MAC_SH (StaRsp). UE 0
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" lcType="5" bo="23" />
      </tapa.send>
      
      # RLC--->MAC_SH (StaRsp). UE 1
      <tapa.send>
         # Send BO for the created logical channel on RGU for first harq 
         # process. 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="33" />
      </tapa.send>

      
      <!-- Don't expect StaInd for UE 0 unless TTI is moved further. 
           UE 0 becomes active in (7,0). Since, we will schedule in DL
           3 sf's ahead, moving by 1 tti should suffice -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      #MAC_SH ----->RLC (StaInd). UE 0,UE 1.This is (6,8)
      <tapa.expset>
         # Expect staInd from MAC to RLC for HARQ process - 0
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="4" />
         <tapa.rgu.dstaind ueId="0" lchTb1Data="1" saveTo="5" />
      </tapa.expset>

      #RLC----->MAC (DatReq) UeID(0)
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lcId="1" lchTb1Data="1" lcType="5" />
      </tapa.send>

      #RLC----->MAC (DatReq) UeID(1)
      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" lcId="3" lchTb1Data="3" lcType="5" />
      </tapa.send>



      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="10" lcId="1" chkSdu="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="3" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="10"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <!-- inActivity timer for Ue 0 also expires in this subframe -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <!-- at (7,3), short cycle of UE 1 starts again. Will now expire at (10,0).
           onDuration for Ue1 will start at (7,6).
           Inactivity timer for UE 0 expires. Short Cycle expires at (8,6) and
           onDuration starts at (8,0).
           At (7,3) again (looking at 7,6), onDuration for UE 1 will be started
           and onDuraiton expiry calculated as (8,1)
           -->
           
      <!-- give 3 ttis (2 for TFU_DELTA + 1 RG_UL_DELTA) -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <!-- we are currently at (7,7) -->
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="2">
         <tapa.tfu.hq ueId="0"/>
         <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <!-- Move the system to (8,3). -->
     <!-- At (8,3), short cycle for Ue 0 expires and the cycle is switched
          to long -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <!-- Move the system to (9,7) -->
      <!-- At (9,7), short cycle for UE 1 expires and the cycle is switched
           to long -->
       <tapa.send>
          <tapa.tfu.tti.ind numTti="14" />
       </tapa.send>

       <!-- Give more TTI's to see if everything works -->
       <tapa.send>
          <tapa.tfu.tti.ind numTti="10" />
       </tapa.send>

       <!-- send a delete request -->
       
      #Send UE ReConfiguration to disable cqi-Mask
      # RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>
      
      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

</tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.13 
#
#       Desc:    Verify UE reconfiguration by enabling and then disabling drx 
#                
#
#       Notes:   None
#              
#       Module:  DRX
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="drx"/>

      <tapa.desc>
         "To test drx enable and disable 
      </tapa.desc>

      <tapa.longdesc>
         ""
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
        <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
     </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="80" />
      
      # UE Configuration, ueId(0)
      <tapa.rg.UeInit 
       ueId="0"
      isDrxEnabled="TRUE"
      drxOnDurTmr="8"
      drxInactvTmr="5"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="10"
      drxShortCycleTmr="2"
      drxStartOffst="10"
      />
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
   #Send UE ReConfiguration to disable cqi-Mask
      # RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>
      
      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

     <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5"
         isDrxEnabled="TRUE"
         drxOnDurTmr="8"
         drxInactvTmr="5"
         drxRetxTmr="16"
         longDrxCycle="20"
         isShortDrxPrsnt="TRUE"
         shortDrxCycle="10"
         drxShortCycleTmr="2"
         drxStartOffst="10"
         UeReCfgType="131072"
         />
   </tapa.send>

      # Send TTI to apply the reconfig
      <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.14
#
#       Desc:    To test with DRX enabled, UE gets scheduled
#                in its On-Duration time.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.14" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that MAC schedules UE only in its On duration time."
      </tapa.desc>

      <tapa.longdesc>
      "Send BO in the On-Duration period.
      Expect PDCCH ."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="30"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.15
#
#       Desc:    To test with DRX enabled, UE gets scheduled
#                only in its active time.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.15" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that MAC schedules UE only in its active time."
      </tapa.desc>

      <tapa.longdesc>
      "Send BO in DRX period. Expect PDCCH only when On-Duration starts."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="30"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="14"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.16
#
#       Desc:    To test MAC starts Inactivity Timer. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.16" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that MAC starts Inactivity Timer."
      </tapa.desc>

      <tapa.longdesc>
      "Send BO in Inactivity period. Expect PDCCH."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="300"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="14"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         # Send Status Response to collide with Inactivity timer. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="300"/>
      </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.17
#
#       Desc:   To Test that MAC moves to short DRX cycle after 
#               expiry of Inactivity timer.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.17" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE moves to short DRX cycle on expiry of Inactivity
      timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="80"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="20"
      drxStartOffst="10"
      drxShortCycleTmr="16"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

       #Configure Logical Channel
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
#On-duration has expired. By now even the inactivity timer has expired and
#UE has moved to short cycle. Send Status Response and expect indication when
#the on-duration of the short cycle starts
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      
#Send TTIs to collide with on-duration on short cycle.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

#We received the status indication when the on-duration of the short cycle
#starts which confirms that UE has switched to short cycle.
      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="300"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.18
#
#       Desc:   To Test that MAC moves to long DRX cycle after 
#               expiry of Short Cycle timer.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.18" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE moves to long DRX cycle on expiry of Short Cycle timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="160"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="20"
      drxStartOffst="10"
      drxShortCycleTmr="2"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

       #Configure Logical Channel
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

#On-duration and inactivity timer have expired. Wait for the short cycle timer
   to expire.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="40"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="72"/>
      </tapa.send>
#We get the Status Indication after On-duration of the long cycle starts.
      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.19
#
#       Desc:    To test that MAC schedules only in its active time after
#                reconfiguration.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.19" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test that MAC schedules only in its active time after re-configuring
      the DRX parameters."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="14"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="0"
            g3RecpReqqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="36"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.20
#
#       Desc:    To test that MAC starts DRX-Inactivity timer after
#                reconfiguring the parameters.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#

<tapa.testcase id="23.20" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that MAC starts Inactivity Timer after reconfiguring DRX
      parameters."
      </tapa.desc>

      <tapa.longdesc>
      "Send BO in Inactivity period. Expect PDCCH."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="10"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

         # Send Status Response to collide with Inactivity timer. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="30"
            drxRetxTmr="16"
            longDrxCycle="64"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="10"
            g3RecpReqqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

adioResourceConfigDedicated
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
     
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
#On-duration changes after reconfiguration.
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         # Send Status Response to collide with Inactivity timer. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



#
#
#       Test:    23.21
#
#       Desc:    To test that MAC works according to the reconfigured short
#                DRX cycle. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.21" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test that MAC functions according to the re-configured short DRX
      cycle."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="20"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="14"
      drxShortCycleTmr="4"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="64"
            isShortDrxPrsnt="TRUE"
            shortDrxCycle="32"
            drxStartOffst="10"
            drxShortCycleTmr="6"
            g3RecpReqqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.22
#
#       Desc:   To Test that MAC moves to long DRX cycle after 
#               expiry of Short Cycle timer after the DRX paramters are
#               reconfigured.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.22" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE moves to long DRX cycle on expiry of Short Cycle timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="160"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="20"
      drxStartOffst="10"
      drxShortCycleTmr="2"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

       #Configure Logical Channel
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

#On-duration and inactivity timer have expired. Wait for the short cycle timer
   to expire.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="40"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="72"/>
      </tapa.send>
#We get the Status Indication after On-duration of the long cycle starts.
      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2"  ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>


      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="80"
            isShortDrxPrsnt="TRUE"
            shortDrxCycle="20"
            drxStartOffst="10"
            drxShortCycleTmr="6"
            g3RecpReqqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      

      <tapa.send>
         # Send  Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="145"/>
      </tapa.send>

      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      
      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

#Wait for the short cycle timer to expire to switch to long cycle.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="192"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="40"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.23
#
#       Desc:    To test the functionality of HARQ RTT timer. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.23" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test the HARQ RTT and DRX retx timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="40"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            saveTo="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect PDU from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="4" chkSdu="TRUE" lcId="3"
                isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req use="1" saveTo="4" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



#
#
#       Test:    23.24
#
#       Desc:    To test the functionality of HARQ Retx timer. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.24" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test the HARQ RTT and DRX retx timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="6"/>
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="1"
      longDrxCycle="80"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="61"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
#Complete the RACH procedure of the 2nd UE. Dont expect retx of the first UE
#as DRX retx timer has expired.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req  ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="1" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" />
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm ueId="1"/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" n1PUCCHVal="2:3:5:10"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" ueId="1" />
   </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.25
#
#       Desc:   Delete UE when Inactivity timer running. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.25" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "Delete UE when Inactivity timer running."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="30"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="14"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 5 Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send UE Delete Request for the UE ID 0 at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the same UE ID 0 at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.26
#
#       Desc:  To test UE delete when short cycle timer is running.  
#              
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.26" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE moves to short DRX cycle on expiry of Inactivity
      timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="80"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="20"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

       #Configure Logical Channel
      
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to collide with On-Duration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
#On-duration has expired. By now even the inactivity timer has expired and
#UE has moved to short cycle. 


      # Send UE Delete Request for the UE ID 0 at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the same UE ID 0 at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.27
#
#       Desc:  To test UE delete when HARQ RTT is running. 
#              
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.27" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test the HARQ RTT and DRX retx timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            saveTo="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.expset>
          # Expect PDU from MAC to PHY.
          #ccpu00119023 MOD changed added retx parameters for validation
        <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="4" chkSdu="TRUE" lcId="3"
                isRetx="TRUE" retxUse="3" validate="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req use="1" saveTo="4" validate="TRUE"  vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.28
#
#       Desc:  To test UE's drx functionality when shortBSR is received 
#              
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.28" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test UE's uplink handling with DRX"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELl, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. In the UE's drx period, send a SR. Expect
         a PDCCH with DCI 0 and subsquently PUSCH with shortBsr. Ensure,
         that the subsquent PDCCH does not go until the UE is in its active
         period. Test for receiving uplink data while the inactivity timer
         is running."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="8"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
         prdBsrTmr="65535"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create a bi-directional channel for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "1" lcgId = "0" 
             dir = "3" lcType = "5" instId="5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      #Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      #Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send SR Indication for default UE
      #This is (2,2). Currently, UE is in its
      #DRX period ergo Inactive. However, SR is
      #handled irrespective of that
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr />
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      # This will go out on (2,5).Currently, we are at (2,3)
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Data from UE will come at (2,9). Reception request should come
      #at (2,7). Give 4 TTI's to reach (2,7).
      #Further, at (2,7), UE becomes active in DL for (3,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>
      
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)
      #This is (3,0). UE is now inactive
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      # This is (3,1)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="6"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>

     #Reconfigure drx-Inactivity timer as 40 psf
     <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue instId="5" 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="40"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      UeReCfgType="131072"
      />
    </tapa.send>
    
    <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


     #BSR should not be scheduled as the UE is not active.
     #UE's next active time starts at (5,0) which means
     #UE will be eligibile for scheduling at (4,7) for DL
     #and (4,8) for UL.
     #Move the TTI to (4,7).
     <tapa.send>
        <tapa.tfu.tti.ind numTti="15"/>
     </tapa.send>
     
     <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req vldtTx="TRUE" saveTo="2" minGrantBits="152"
             vldtGrant="TRUE" isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Move the TTI to (5,1)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" saveTo="2" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expect>
      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)

      #This is (3,0). UE is now inactive
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI to receive HARQ ACK at TFU
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      # This is (3,1)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="6"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>
     
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
     <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req vldtTx="TRUE" saveTo="2" minGrantBits="152"
             vldtGrant="TRUE" isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Move the TTI to (5,1)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" saveTo="2" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expect>
      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI to receive HARQ ACK at TFU
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>
    <tapa.send>
        <tapa.tfu.tti.ind numTti="100"/>
    </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.29
#
#       Desc:  To test Inactivity time of 1 PDCCH subframe. 
#              
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.29" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test UE's uplink handling with DRX"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELl, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. In the UE's drx period, send a SR. Expect
         a PDCCH with DCI 0 and subsquently PUSCH with shortBsr. Ensure,
         that the subsquent PDCCH does not go until the UE is in its active
         period. Test for receiving uplink data while the inactivity timer
         is running."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="1"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      prdBsrTmr="65535"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create a bi-directional channel for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "1" lcgId = "0" 
             dir = "3" lcType = "5" instId="5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      #Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      #Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send SR Indication for default UE
      #This is (2,2). Currently, UE is in its
      #DRX period ergo Inactive. However, SR is
      #handled irrespective of that
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr />
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      # This will go out on (2,5).Currently, we are at (2,3)
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Data from UE will come at (2,9). Reception request should come
      #at (2,7). Give 4 TTI's to reach (2,7).
      #Further, at (2,7), UE becomes active in DL for (3,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>
      
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)
      #This is (3,0). UE is now inactive
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      # This is (3,1)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="6"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>

     #Reconfigure drx-Inactivity timer as 40 psf
     <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue instId="5" 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="40"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      UeReCfgType="131072"
      />
    </tapa.send>
    
    <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


     #BSR should not be scheduled as the UE is not active.
     #UE's next active time starts at (5,0) which means
     #UE will be eligibile for scheduling at (4,7) for DL
     #and (4,8) for UL.
     #Move the TTI to (4,7).
     <tapa.send>
        <tapa.tfu.tti.ind numTti="15"/>
     </tapa.send>
     
     <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req vldtTx="TRUE" saveTo="2" minGrantBits="152"
             vldtGrant="TRUE" isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Move the TTI to (5,1)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" saveTo="2" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expect>
      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)

      #This is (3,0). UE is now inactive
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI to receive HARQ ACK at TFU
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      # This is (3,1)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="6"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>
     
     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>
     
     <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req vldtTx="TRUE" saveTo="2" minGrantBits="152"
             vldtGrant="TRUE" isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Move the TTI to (5,1)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" saveTo="2" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expect>
      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI to receive HARQ ACK at TFU
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>
    <tapa.send>
        <tapa.tfu.tti.ind numTti="100"/>
    </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.30
#
#       Desc:    To test UE delete when in HARQ RTT timer queue. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.30" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test UE delete when in HARQ RTT timer queue."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>


      # Send UE Delete Request for the UE ID 0 at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the same UE ID 0 at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.31
#
#       Desc:    To test UE delete when in Harq Retx queue. 
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#

<tapa.testcase id="23.31" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test the HARQ RTT and DRX retx timer."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="6"/>
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="1"
      longDrxCycle="80"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="61"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 


      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Send NACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="FALSE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # Send UE Delete Request for the UE ID 0 at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the same UE ID 0 at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send>
         # Send 2 Ttis (one for scheduling, one for retransmission,
         # if scheduled and hence NACK is successfully handled)
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
<!--      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
#Complete the RACH procedure of the 2nd UE. Dont expect retx of the first UE
#as DRX retx timer has expired.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req  ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="1" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1" />
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" />
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm ueId="1"/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" n1PUCCHVal="2:3:5:10"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" ueId="1" />
   </tapa.expect>
-->
      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.32
#
#       Desc:  To test UE's drx functionality when shortBSR is received 
#              
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.32" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test UE's uplink handling with DRX specially checking
          shortCycle"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELl, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. In the UE's drx period, send a SR. Expect
         a PDCCH with DCI 0 and subsquently PUSCH with shortBsr. Ensure,
         that the subsquent PDCCH does not go until the UE is in its active
         period. Test for receiving uplink data while the cycle is short. 
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="5"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="40"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="20"
      drxStartOffst="10"
      prdBsrTmr="65535"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create a bi-directional channel for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "1" lcgId = "0" 
             dir = "3" lcType = "5" instId="5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      #Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      #Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send SR Indication for default UE
      #This is (2,2). Currently, UE is in its
      #DRX period ergo Inactive. However, SR is
      #handled irrespective of that
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr />
         </tapa.tfu.sr.ind>
      </tapa.send>

      #Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      # This will go out on (2,5).Currently, we are at (2,3)
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Data from UE will come at (2,9). Reception request should come
      #at (2,7). Give 4 TTI's to reach (2,7).
      #Further, at (2,7), UE becomes active in DL for (3,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>
      
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)
      #This is (3,0). UE is now inactive
      #At (2,5), shortCycle would have been started for (2,8) expiring on (6,8)
      #onDuration 
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      # This is (3,1)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>

     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="6"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>

     <!--
     #Reconfigure drx-Inactivity timer as 40 psf
     <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue instId="5" 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="40"
      drxRetxTmr="16"
      longDrxCycle="20"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="10"
      UeReCfgType="131072"
      />
    </tapa.send>

    <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
     -->

     #BSR should not be scheduled as the UE is not active.
     #UE's next active time starts at (5,0) which means
     #UE will be eligibile for scheduling at (4,7) for DL
     #and (4,8) for UL.
     #Move the TTI to (4,7).
     <tapa.send>
        <tapa.tfu.tti.ind numTti="16"/>
     </tapa.send>
     
     <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req vldtTx="TRUE" saveTo="2" minGrantBits="152"
             vldtGrant="TRUE" isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Move the TTI to (5,1)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" saveTo="2" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expect>
      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI to receive HARQ ACK at TFU
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1" addShortBsr="TRUE" bsr="6"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>

     #Bring it to (6,8) to make UE UL active
     <tapa.send>
        <tapa.tfu.tti.ind numTti="12"/>
     </tapa.send>
     
     <tapa.expect>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant 
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req vldtTx="TRUE" saveTo="2" minGrantBits="152"
             vldtGrant="TRUE" isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Move the TTI to (5,1)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
          <tapa.tfu.pusch.recp.req use="2" saveTo="2" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>        
      </tapa.expect>
      #Send 3 TTI's (TFU_DELTA(2) + TFU_UL_DELTA(1) for UE to send data)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send 1 TTI to receive HARQ ACK at TFU
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
     
     #Send Data Indication using TB size received in the grant
     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat use="2" lcId="1"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

     #Expect Data Indication at RLC
     <tapa.expect>
        <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
     </tapa.expect>
    <tapa.send>
        <tapa.tfu.tti.ind numTti="100"/>
     </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.33
#
#       Desc:  To test UE's drx functionality with max values
#              for DRX configuration
#              
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.33" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test UE's DRX functionality with max values 
          for DRX configuration"
      </tapa.desc>

      <tapa.longdesc>
         "To test UE's DRX functionality with max values
          for DRX configuration"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
         <tapa.flag id="DEBUGP"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="200"
      drxInactvTmr="2560"
      drxRetxTmr="33"
      longDrxCycle="2560"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="640"
      drxShortCycleTmr="16"
      drxStartOffst="0"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
      
   </tapa.cfg>
   
   # Test Steps subsection
   <tapa.test>
      #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      # Configure bi-directional DCCH for ueId(0)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for ueId(0)
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="4" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      <!--- on RGR interface -->
      # Configure bi-directional DCCH for ueId(0) 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" ueId="0" lcgId="0" dir="3" lcType="5" instId="5"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0"/>
      </tapa.expect>
      
      # Configure bi-directional DTCH for  ueId(0)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="2" ueId="0" lcgId="0" dir="3" lcType="4" instId="5"/>
      </tapa.send>

      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" />
      </tapa.expect>
      
      
      
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="500"/>
      </tapa.send>

   <tapa.delay delay="10"/>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="500"/>
      </tapa.send>
   <tapa.delay delay="10"/>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="500"/>
      </tapa.send>
   <tapa.delay delay="10"/>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="500"/>
      </tapa.send>

   <tapa.delay delay="10"/>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="557"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="20"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect guardTmr="100000">
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2"/>
      </tapa.expect>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="1" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="1" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
     
  <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20000"/>
      </tapa.send>
      -->
#5000 TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>

#10000 TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
#15000 TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
#20000 TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   <tapa.send>
      <tapa.tfu.tti.ind numTti="500" />
    </tapa.send>
   <tapa.delay delay="10"/>
   </tapa.test>
   
   # Clean subsection
   <tapa.clean>
    <tapa.rg.macDeInit/>
   </tapa.clean>

    #Request to ShutDown LTEMAC
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.34
#
#       Desc:    To test UE Re-Configuration at RGR
#                with DRX parameters(Includes both unsuccessful
#                and successful cases)
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.34">

   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test successful UE re-config at RG with DRX params"
      </tapa.desc>

      <tapa.longdesc>
         "Finish CELl, Common Logical channel configurations at CRG and RGR
         and also finish RACH and then send UE configuration request to 
         LTEMAC from Dummy RRC. After a while, Reconfig the UE
         and Send Invalid values of DRX params and
         expect negative confirm. Finally, send valid values and expect 
         positive confirm.
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="LTEMAC_R9" />
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit/>

      # UE configuration
      <tapa.rg.UeInit maxUlHqTx="4" 
      isDrxEnabled="TRUE"
      drxOnDurTmr="2"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="10"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="5"
      drxStartOffst="0"
      />
      
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
    #Send UE ReConfiguration to disable cqi-Mask
      # RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "32"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="10"
            cqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
     
     # Send UE config request at RGR with an invalid drx-inactivity tmr val
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "30"
            drxInactvTmr="7"
            drxRetxTmr="16"
            longDrxCycle="40"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="10"
            cqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid drx-retx tmr val
     <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "30"
            drxInactvTmr="30"
            drxRetxTmr="7"
            longDrxCycle="40"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="5"
            drxStartOffst="10"
            cqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

     # Send UE config request at RGR with an invalid long-Drx val
     <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="21"
           UeReCfgType="131072"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with an invalid short-cycle val
     <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="7"
           UeReCfgType="131072"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with an invalid short-cycle val
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="17"
           UeReCfgType="131072"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>

    # Send UE config request at RGR with longdrx Cycle
    # as not a multiple of short-drx cycle
    
     <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="30"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="20"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="17"
           UeReCfgType="131072"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect negative cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5" status="15"/>
    </tapa.expect>
    
    # Send UE config request at RGR with an valid drx params 
     <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" 
           isDrxEnabled="TRUE" 
           drxOnDurTmr="3"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="10"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
           UeReCfgType="131072"
          />
     </tapa.send>

     # Send TTI to apply the config
     <tapa.send>
        <tapa.tfu.tti.ind/>
     </tapa.send>

     # Expect positive cfm from Scheduler
     <tapa.expect>
       <tapa.rgr.cfgCfm instId="5"/>
    </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
    <tapa.rg.macDeInit/>
   </tapa.clean>

    #Request to ShutDown LTEMAC
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    23.35
#
#       Desc:    "Verify PUCCH group power control with a drx enabled UE"
#
#       Notes:   None
#              
#       Module:  "DRX"
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUCCH group power control with a drx enabled UE"
      </tapa.desc>

      <tapa.longdesc>
         "Verify PUCCH group power control with a drx enabled UE"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
         pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
         puschFmt3StartRnti="300" puschFmt3RntiSize="4"
         puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

      # UEs Creation
      <tapa.rg.UeInit isAccumulated="TRUE" trgCqi="12"
         ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="2"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"
         isDrxEnabled="TRUE"     drxOnDurTmr="3"    drxStartOffst="4"
         drxRetxTmr="16"         longDrxCycle="10"  drxInactvTmr="30"  
         isShortDrxPrsnt="TRUE"  shortDrxCycle="5"  drxShortCycleTmr="15" />


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send PUCCH delta indication. CfgdpucchDeltaPwr = -127 + pucchDeltaPwr
      # This is (2,3)
      <tapa.send>
         <tapa.tfu.pucchdelta.ind>
            <tapa.tfu.pucchdelta ueId="0" pucchDeltaPwr="134"/>
         </tapa.tfu.pucchdelta.ind>
      </tapa.send>

      # The onDuration period for this UE starts at (3,0). Currently, we 
      # are at (2,3). Bring it till (2,7) 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #send one more tti to send pdcch
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="100" tpcIndices="2" tpcCmds="3"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3. Also choose some other indices and verify
      # that these correspond to 0 dB TPC. 
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="100" tpcIndices="2:0:1:3:4:10"
               tpcCmds="3:1:1:1:1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3 - this one would have the final reduced
      # command.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE"
               vldtGrant="TRUE" tpcRnti="100" tpcIndices="2" tpcCmds="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # No more commands now
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.36
#
#       Desc:    "Verify PUSCH group power control with drx enabled UE"
#
#       Notes:   None
#              
#       Module:  "Power"
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUSCH group power control with a drx enabled UE"
      </tapa.desc>

      <tapa.longdesc>
         "Verify PUSCH group power control"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
         pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
         puschFmt3StartRnti="300" puschFmt3RntiSize="4"
         puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

      # UEs Creation
      <tapa.rg.UeInit isAccumulated="TRUE" trgCqi="12"
         ueBr="10000" ueCatEnum="CM_LTE_UE_CAT_5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="100" uePucchPwrIdx="1"
         puschTpcRntiPres="TRUE" puschtpcRnti="300" uePuschPwrIdx="2"
         isDrxEnabled="TRUE"     drxOnDurTmr="3"    drxStartOffst="4"
         drxRetxTmr="16"         longDrxCycle="10"  drxInactvTmr="30"  
         isShortDrxPrsnt="TRUE"  shortDrxCycle="5"  drxShortCycleTmr="15" />


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="5"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # The onDuration period for this UE starts at (3,0). Currently, we 
      # are at (2,3). Bring it till (2,7)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 3
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2" tpcCmds="3"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3. Also choose some other indices and verify
      # that these correspond to 0 dB TPC. 
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2:0:1:3:4:10"
               tpcCmds="3:1:1:1:1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3 - this one would have the final reduced
      # command.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="300" tpcIndices="2" tpcCmds="3"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # No more commands now
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.37
#
#       Desc:    "Verify PUSCH group power control(format 3a) 
#                 for a drx enabled UE"
#
#       Notes:   None
#              
#       Module:  "DRX"
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUSCH group power(format 3a) control for a drx enabled UE"
      </tapa.desc>

      <tapa.longdesc>
         "Verify PUSCH group power(format 3a) control for a drx enabled UE"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
         pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
         puschFmt3StartRnti="300" puschFmt3RntiSize="4"
         puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

      # UEs Creation
      <tapa.rg.UeInit ueId="0" isAccumulated="TRUE" trgCqi="14"
         puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="0"
         isDrxEnabled="TRUE"     drxOnDurTmr="3"    drxStartOffst="0"
         drxRetxTmr="16"         longDrxCycle="10"  drxInactvTmr="30"  
         isShortDrxPrsnt="TRUE"  shortDrxCycle="5"  drxShortCycleTmr="15"/>

      <tapa.rg.UeInit ueId="1" isAccumulated="TRUE" trgCqi="5"
         puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="2"
         isDrxEnabled="TRUE"     drxOnDurTmr="3"    drxStartOffst="0"
         drxRetxTmr="16"         longDrxCycle="10"  drxInactvTmr="30"  
         isShortDrxPrsnt="TRUE"  shortDrxCycle="5"  drxShortCycleTmr="15"/>


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Currently we are (4,6). Ue's 1 next longCycle starts at (5,0).
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="2"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="7"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      #Move to  (4,7), ue would be marked active
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2" tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      #currently at (4,8)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2" tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      #currently at (4,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Move to (5,7) for next OnDuration of UE 1
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE" isUlPdcchLst="TRUE"
               vldtGrant="TRUE" tpcRnti="402" tpcIndices="0:2"
               tpcCmds="1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Note that trgCqi internally was set to '9' for UE 0 due to
      # UE's capability. So no more power commands are sent for it.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.38
#
#       Desc:    "Verify PUCCH group power(format 3a) for a drx enabled UE"
#
#       Notes:   None
#              
#       Module:  "DRX"
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify PUCCH group power control format 3a for a drx enabled UE"
      </tapa.desc>

      <tapa.longdesc>
         "Configure two UEs for PUCCH group power control using format 3A (1
         bit cmd mode). Report a large pucch delta for first UE. Report pucch
         delta close to zero for second UE.
         Verify that this causes group power control to be scheduled with
         correct TPC command. Further, verify that for second UE, power
         commands are sent such that on the whole there is no delta applied on
         the second UE (sequence should be [-1,+1] or [+1, -1]).In addition,
         verify that the TPC commands are sent only in UE's active time"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         pucchFmt3StartRnti="100" pucchFmt3RntiSize="4"
         pucchFmt3aStartRnti="200" pucchFmt3aRntiSize="4"
         puschFmt3StartRnti="300" puschFmt3RntiSize="4"
         puschFmt3aStartRnti="400" puschFmt3aRntiSize="4"/>

      # UEs Creation
      <tapa.rg.UeInit ueId="0" isAccumulated="TRUE" trgCqi="14"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="202" uePucchPwrIdx="0"
         puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="0"
         isDrxEnabled="TRUE"     drxOnDurTmr="3"    drxStartOffst="0"
         drxRetxTmr="16"         longDrxCycle="10"  drxInactvTmr="30"  
         isShortDrxPrsnt="TRUE"  shortDrxCycle="5"  drxShortCycleTmr="15"/>

      <tapa.rg.UeInit ueId="1" isAccumulated="TRUE" trgCqi="5"
         pucchTpcRntiPres="TRUE" pucchtpcRnti="202" uePucchPwrIdx="2"
         puschTpcRntiPres="TRUE" puschtpcRnti="402" uePuschPwrIdx="2"
         isDrxEnabled="TRUE"     drxOnDurTmr="3"    drxStartOffst="0"
         drxRetxTmr="16"         longDrxCycle="10"  drxInactvTmr="30"  
         isShortDrxPrsnt="TRUE"  shortDrxCycle="5"  drxShortCycleTmr="15"/>


   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure LCG 1 at MAC (not scheduler) for UE 0
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcgId="1" lcId="3"
            lcType="4" dir="2"/>
      </tapa.send>

      # Configure LCG 1 for UE 0 (RGR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect the confirms
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #CfgdpucchDeltaPwr = -127 + pucchDeltaPwr
      #At (4,6) we receive this. Ue's onDuration starts at (5,0)
      #and would be marked active at (4,7)
      <tapa.send>
         <tapa.tfu.pucchdelta.ind>
            <tapa.tfu.pucchdelta ueId="0" pucchDeltaPwr="134"/>
            <tapa.tfu.pucchdelta ueId="1" pucchDeltaPwr="125"/>
         </tapa.tfu.pucchdelta.ind>
      </tapa.send>

      #we are (4,8)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 3A
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2" tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      #We are at (4,9)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #This is (5,0)
      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 3A.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isFormat3a="TRUE"
               vldtGrant="TRUE" tpcRnti="202" tpcIndices="0:2"
               tpcCmds="1:1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.39
#
#       Desc:   "To test the successful CCCH SDU based contention resolution 
#               where UeCfg from RRC is received soon after reception of Msg3" 
#
#       Notes:   None
#              
#       Module:  "DRX"
#
#       File:    rgac_tc23.xml
#
#
<tapa.testcase id="23.39">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of CCCH SDU based contention resolution with DRX."
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4. In this test case,
          the UE should be DRX inactive at the subframe on which Msg4 will go. Verfiy
          that DRX does not interfere with Msg4 transmission"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                                            tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"
           isDrxEnabled="TRUE"
           drxOnDurTmr="3"
           drxInactvTmr="30"
           drxRetxTmr="16"
           longDrxCycle="32"
           drxStartOffst="0"
           isShortDrxPrsnt="TRUE"
           shortDrxCycle="8"
           drxShortCycleTmr="15"
           />
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.40
#
#       Desc:   To Test that UE continues on running onduration cycle 
#               even after reconfiguration.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.40" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE runs on old onduration even after new configuration 
       is received if the timer is in running state."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="10"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="160"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="20"
      drxStartOffst="10"
      drxShortCycleTmr="2"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      #Configure Logical Channel
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         # Send  Ttis to start onduration. 
         <tapa.tfu.tti.ind numTti="145"/>
      </tapa.send>
  
      #reconfiguring DRX with short enabled and lesser timer values
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="20"
            isShortDrxPrsnt="FALSE"
            shortDrxCycle="20"
            drxStartOffst="10"
            drxShortCycleTmr="6"
            g3RecpReqqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

      #Send Tti to respond on the receved configuration
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send  Ttis to collide with On-Duration of old configuration. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.41
#
#       Desc:   To Test that UE starts with short cycle immediately after confguration.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.41" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE starts with short cycle immediately after configuration if shortDrx is enabled."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="10"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="160"
      isShortDrxPrsnt="TRUE"
      shortDrxCycle="20"
      drxStartOffst="10"
      drxShortCycleTmr="2"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      #Configure Logical Channel
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
      
      <tapa.send>
         # Send  Ttis to start onduration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
  
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #As UE is in onDuration(of short cycle), Scheduling should happen immediately
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.42
#
#       Desc:   To Test that UE starts with short cycle immediately after Re configuration.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc23.xml
#
<tapa.testcase id="23.42" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE starts with short cycle immediately after reconfiguration if shortDrx is enabled."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      #Configure Logical Channel
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>
     
     # Few TTis before sending reconfiguration 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
  
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue instId="5"  
            isDrxEnabled="TRUE"
            drxOnDurTmr = "2"
            drxInactvTmr="2"
            drxRetxTmr="16"
            longDrxCycle="80"
            isShortDrxPrsnt="TRUE"
            shortDrxCycle="20"
            drxStartOffst="10"
            drxShortCycleTmr="6"
            g3RecpReqqiMask="FALSE"
            UeReCfgType="131072"
            />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #As UE is in onDuration(of short cycle), Scheduling should happen immediately
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    23.43
#
#       Desc:   To Test that UE becomes active during RRC re-establishment.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
<tapa.testcase id="23.43" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To Test that UE becomes active during RRC re-establishment."
      </tapa.desc>

      <tapa.longdesc>
      "If UE is in DRX mode during UE reset as part of re-establishment the UE's state amde ACTIVE till the 
       new CRNTI Config happens"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_DRX"/>
         #rg002.301-ADD-ccpu00120969: added dependancy for RGR_V2
         <tapa.flag id="RGR_V2" />
         </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit />
      # UE Configuration
      <tapa.rg.UeInit 
      isDrxEnabled="TRUE"
      drxOnDurTmr="10"
      drxInactvTmr="2"
      drxRetxTmr="16"
      longDrxCycle="160"
      isShortDrxPrsnt="FALSE"
      shortDrxCycle="20"
      drxStartOffst="10"
      drxShortCycleTmr="2"
      />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send  Ttis to start onduration. 
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send UE Reset request for the default Ue at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With default Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>

      # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                         tpcs="1" cqiPres="FALSE" />
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
         <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         # Send a Tti to get the transmission scheduled.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send re-configuration disabling SPS in downlink
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0"
           oldcrnti="11" newUeId="1" newcrnti="12"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      # Send UE ReConfiguration for the same UE created above for change in RNTI
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue cellId="3" oldUeId="0" newUeId="1"
            UeReCfgType="64"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="100"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId='1' validate="TRUE" chkCcchSh="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId='1'/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req ueId='1'/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
          <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      #Enough TTIs provided to wait for the UE's ACTIVE state
      <tapa.send>
         # Send  Ttis to start onduration. 
         <tapa.tfu.tti.ind numTti="115"/>
      </tapa.send>
  
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="1" lcType="5" bo="20"/>
      </tapa.send>

      #As UE is in onDuration(of short cycle), Scheduling should happen immediately
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC 
         <tapa.rgu.dstaind lchTb1Data="1" saveTo="2" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="1" chkSdu="TRUE"
            />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend

#/********************************************************************30**
#
#         End of file:     cm_xta_gen_tc_num.py@@/main/5 - Wed Jun 27 16:21:06 2007
#
#*********************************************************************31*/
#
#
#/********************************************************************40**
#
#        Notes:
#
#*********************************************************************41*/
#
#/********************************************************************50**
#
#*********************************************************************51*/
#
#
#/********************************************************************60**
#
#        Revision history:
#
#*********************************************************************61*/
#
#/********************************************************************90**
#
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#$SID$         ---      sy  1. Update of sid field
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg001.301 nudupi 1. Added the changes for the CR ccpu00119023. 
#$SID$        rg002.301 asehgal -ccpu00120621-MOD-reversed the order of dstaInds
#$SID$                           ccpu00120969: added dependancy for RGR_V2
#$SID$      ---        rt  1. LTE MAC 4.1 Release
#*********************************************************************91*/
