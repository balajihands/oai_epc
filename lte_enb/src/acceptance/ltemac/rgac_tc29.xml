#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases for DL and FDX:4UE_per_TTI with RR scheduler 
#
#     File:    rgac_tc29.xml
#
#     Sid:     rgac_tc29.xml@@/main/1 - Tues Jul 15 3:43:03 2014
#
#     Prg:     akapoor
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=5:hn:rgac_tc29.xml
#
#
#       Test:    29.1
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_1
#                Verify that eNB successfully schedules the new transmissions of
#                4 non SPS UEs per TTI in the downlink when sufficient PDCCH
#                resources are available: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.1">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="100"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="100"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="80"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4"/> 
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="3" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="4" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.2
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_2
#                Verify that eNB successfully schedules
#                the new transmissions of 4 SPS UEs per TTI in the downlink when
#                sufficient bandwidth is available:RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
<tapa.testcase id="29.2" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" maxDlUeNewTxPerTti="4"
      maxUePerDlSf="4" maxSpsUePerDlSf="4" dlSchdType="2"/>
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="91"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="92"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="2" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="93"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="3" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="94"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
 
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "2" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "3" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3" saveTo="4"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3" saveTo="5"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO

   <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
   </tapa.expset>
   
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expset>
      <tapa.tfu.recp.req numRntis="4">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expset>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq/>
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="2"/>
        <tapa.tfu.hq ueId="3"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

# SPS is not activated for multi UE in the same TTI to spread PDCCH load. So we
# should activate SPS for 4 UEs such that their scheduling occasions collide
# once all 4 are activated.
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
       <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req numRntis="2">
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="2" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req numRntis="2">
         <tapa.tfu.hq.recp.req ueId="2"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="2"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="3"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="3" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     #At this point, SPS is activated for all 4 UEs. So at the next SPS occasion
      (after 10 ms), all 4 SPS UEs should get scheduled.

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req numRntis="2">
         <tapa.tfu.hq.recp.req ueId="3"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="3"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>
 
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      
     <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

     <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="3"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
    
    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.3
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_3
#                Verify that eNB successfully schedules the new transmissions of
#                2 SPS UEs and 2 non SPS UEs per TTI in the downlink when
#                sufficient bandwidth is available:RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.3">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" maxDlUeNewTxPerTti="4"
      maxUePerDlSf="4" maxSpsUePerDlSf="4" dlSchdType="2"/>
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="91"
         DLSpsExpltRelCnt="4" NumSPSProc="2"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="92"
         DLSpsExpltRelCnt="4" NumSPSProc="2"/>
      <tapa.rg.UeInit ueId="2"/>
      <tapa.rg.UeInit ueId="3"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
 
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "2" lcId = "3" lcgId = "0" dir = "3" lcType = "5"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "3" lcId = "3" lcgId = "0" dir = "3" lcType = "5"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3" saveTo="4"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3" saveTo="5"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO

   <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
   </tapa.expset>
   
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expset>
      <tapa.tfu.recp.req expRecpReq="4">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expset>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq/>
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="2"/>
        <tapa.tfu.hq ueId="3"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# SPS is not activated for multi UE in the same TTI to spread PDCCH load. So we
# should activate SPS for 4 UEs such that their scheduling occasions collide
# once all 4 are activated.
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="64"/>
      </tapa.send>


      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# This is the SPS occasion for UeId 0 and 1 which we activated earlier. Along
# with thos etwo UEs, data request is also expected for UeId 2 and 3 in this
# TTI. So we see 4 UEs getting scheduled in a TTI. 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="2" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.4
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_4
#                Verify that eNB successfully schedules the
#                retransmissions  of 4 non SPS UEs per TTI in the downlink when
#                sufficient bandwidth is available:RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.4">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req>
       		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      
     # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4" >
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK both the transmissions
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="4">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
            <tapa.tfu.hq ueId="2" isAck="FALSE"/>
            <tapa.tfu.hq ueId="3" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # Control request is received for all 4 UEs for retx.
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
   
      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.5
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_5
#                Verify that eNB successfully schedules the retransmissions  of
#                4 SPS UEs per TTI in the downlink when sufficient bandwidth is
#                available:RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.5">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" maxDlUeNewTxPerTti="4"
      maxUePerDlSf="4" maxSpsUePerDlSf="4" dlSchdType="2"/>
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="91"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="92"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="2" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="93"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="3" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="94"
         DLSpsExpltRelCnt="4" NumSPSProc="4" NumPucchVal="4"
         DLSPSSchIntrv="10"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
 
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "2" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "3" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3" saveTo="4"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3" saveTo="5"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO

   <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req numCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
   </tapa.expset>
   
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expset>
      <tapa.tfu.recp.req expRecpReq="4">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expset>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq/>
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="2"/>
        <tapa.tfu.hq ueId="3"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

# SPS is not activated for multi UE in the same TTI to spread PDCCH load. So we
# should activate SPS for 4 UEs such that their scheduling occasions collide
# once all 4 are activated.
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="2" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req ueId="2"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="2"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="3"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="3" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     #At this point, SPS is activated for all 4 UEs. So at the next SPS occasion
      (after 10 ms), all 4 SPS UEs should get scheduled.

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req ueId="3"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="3"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>
 
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="3"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
    
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="4">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
        <tapa.tfu.hq ueId="2" isAck="FALSE"/>
        <tapa.tfu.hq ueId="3" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
    
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" vldtRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" vldtRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" vldtRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
     	    </tapa.tfu.cntrl.req>
      
          <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" retxUse="1" isRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" retxUse="2" isRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" retxUse="3" isRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="3" retxUse="4" isRetx="TRUE"
            validateSPS ="TRUE" DLSPSInit="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

  </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.6
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_6
#                Verify that eNB successfully schedules the retransmissions  of
#                2 SPS UEs and 2 non SPS UEs per TTI in the downlink when
#                sufficient PDCCH resources are available:RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.6">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" maxDlUeNewTxPerTti="4"
      maxUePerDlSf="4" maxSpsUePerDlSf="4" dlSchdType="2"/>
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="91"
         DLSpsExpltRelCnt="4" NumSPSProc="2" DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="92"
         DLSpsExpltRelCnt="4" NumSPSProc="2" DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="2"/>
      <tapa.rg.UeInit ueId="3"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
 
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "2" lcId = "3" lcgId = "0" dir = "3" lcType = "5"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "3" lcId = "3" lcgId = "0" dir = "3" lcType = "5"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3" saveTo="4"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3" saveTo="5"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO

     <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
     </tapa.expset>
   
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="4">
           <tapa.tfu.hq.recp.req ueId="0"/>
           <tapa.tfu.hq.recp.req ueId="1"/>
           <tapa.tfu.hq.recp.req ueId="2"/>
           <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
       <tapa.tfu.hq.ind hqInds="4">
          <tapa.tfu.hq/>
          <tapa.tfu.hq ueId="1"/>
          <tapa.tfu.hq ueId="2"/>
          <tapa.tfu.hq ueId="3"/>
       </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# SPS is not activated for multi UE in the same TTI to spread PDCCH load. So we
# should activate SPS for 4 UEs such that their scheduling occasions collide
# once all 4 are activated.
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
       <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req numRntis="2">
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the non SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the non SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>



      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# This is the SPS occasion for UeId 0 and 1 which we activated earlier. Along
# with those two UEs, data request is also expected for UeId 2 and 3 in this
# TTI. So we see 4 UEs getting scheduled in a TTI. 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE"/>
        </tapa.tfu.dat.req>
#Control request is received only for UE 2 and 3. SPS occasion doesn't require
#PDCCH        
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="2" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="4">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
        <tapa.tfu.hq ueId="2" isAck="FALSE"/>
        <tapa.tfu.hq ueId="3" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
    
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" retxUse="2" isRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="1" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" retxUse="2" isRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="2" lcId="3" chkSdu="TRUE"
           retxUse="2" isRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="3" lcId="3" chkSdu="TRUE"
           retxUse="2" isRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0"
           vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1"
           vldtRetx="TRUE" />
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="2" vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="3" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.7
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_7
#                Verify that eNB fails to schedule the new transmission of a UE
#                when SPS retransmission is scheduled for 2 SPS UEs and dynamic
#                retransmission is scheduled for 2 non SPS UEs per TTI in the
#                downlink even when sufficient bandwidth is available:
#                RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.7">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" maxDlUeNewTxPerTti="4"
      maxUePerDlSf="4" maxSpsUePerDlSf="4" dlSchdType="2"/>
      # UE Configuration
      <tapa.rg.UeInit ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="91"
         DLSpsExpltRelCnt="4" NumSPSProc="2" DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="92"
         DLSpsExpltRelCnt="4" NumSPSProc="2" DLSPSSchIntrv="10"/>
      <tapa.rg.UeInit ueId="2"/>
      <tapa.rg.UeInit ueId="3"/>
      <tapa.rg.UeInit ueId="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="4" lcId="3" lcType="5" dir="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
 
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "2" lcId = "3" lcgId = "0" dir = "3" lcType = "5"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "3" lcId = "3" lcgId = "0" dir = "3" lcType = "5"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "4" lcId = "3" lcgId = "0" dir = "3" lcType = "5"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="200"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3" saveTo="4"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3" saveTo="5"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO

     <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
     </tapa.expset>
   
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expset>
        <tapa.tfu.recp.req expRecpReq="4">
           <tapa.tfu.hq.recp.req ueId="0"/>
           <tapa.tfu.hq.recp.req ueId="1"/>
           <tapa.tfu.hq.recp.req ueId="2"/>
           <tapa.tfu.hq.recp.req ueId="3"/>
        </tapa.tfu.recp.req>   
      </tapa.expset>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
       <tapa.tfu.hq.ind hqInds="4">
          <tapa.tfu.hq/>
          <tapa.tfu.hq ueId="1"/>
          <tapa.tfu.hq ueId="2"/>
          <tapa.tfu.hq ueId="3"/>
       </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# SPS is not activated for multi UE in the same TTI to spread PDCCH load. So we
# should activate SPS for 4 UEs such that their scheduling occasions collide
# once all 4 are activated.
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
       <tapa.tfu.recp.req numRntis="1">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req numRntis="2">
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the non SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the non SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="64"/>
      </tapa.send>



      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# This is the SPS occasion for UeId 0 and 1 which we activated earlier. Along
# with those two UEs, data request is also expected for UeId 2 and 3 in this
# TTI. So we see 4 UEs getting scheduled in a TTI. 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE"/>
        </tapa.tfu.dat.req>
#Control request is received only for UE 2 and 3. SPS occasion doesn't require
#PDCCH        
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="2" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="4">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
         <tapa.tfu.hq.recp.req ueId="2"/>
         <tapa.tfu.hq.recp.req ueId="3"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
        <tapa.tfu.hq ueId="2" isAck="FALSE"/>
        <tapa.tfu.hq ueId="3" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         # Send BO for the 5th UE on RGU such that the control and data requests
         # should collide with the other 4 UEs.
         <tapa.rgu.dstarsp ueId="4" lcId="3" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
       # After 1 TTI, staInd is not received.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
  
      <tapa.expset>
         #Only now the staInd is received for 5th UE, hence it would be
         scheduled in the next TTI.
         <tapa.rgu.dstaind ueId="4" lchTb1Data="3"  saveTo="2"/>
         <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" retxUse="2" isRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="1" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" retxUse="2" isRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="2" lcId="3" chkSdu="TRUE"
           retxUse="2" isRetx="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="3" lcId="3" chkSdu="TRUE"
           retxUse="2" isRetx="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0"
           vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1"
           vldtRetx="TRUE" />
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="2" vldtRetx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="3" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.8
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_8
#                Verify that the available bandwidth in the downlink is equally
#                divided amongst 4 UEs: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.8">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>
<!--
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="15"/>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="12"/>
            <tapa.tfu.dlcqi ueId="2" cqiIdx="10"/>
            <tapa.tfu.dlcqi ueId="3" cqiIdx="7"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
-->

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

#For RR scheduler, available bandwidth is equally divided amongst 4 UEs
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtRbAlign="TRUE"
            rbStart="0" numRb="12"  />
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" vldtRbAlign="TRUE"
            rbStart="12" numRb="12"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" vldtRbAlign="TRUE"
            rbStart="24" numRb="12"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" vldtRbAlign="TRUE"
            rbStart="36" numRb="12"/> 
     	 </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="3" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="4" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.9
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_9
#                Verify that the bandwidth unused by any UE in the downlink is
#                again divided equally amongst the remaining UEs: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.9">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="4" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="4" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="4" bo="400"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="4" bo="30"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="4" bo="30"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="4" bo="30"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" vldtRbAlign="TRUE"
            rbStart="25" numRb="4"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" vldtRbAlign="TRUE"
            rbStart="29" numRb="4"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" vldtRbAlign="TRUE"
            rbStart="33" numRb="4"/> 
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtRbAlign="TRUE"
            rbStart="0" numRb="25"  />
     	 </tapa.tfu.cntrl.req>
#With 50 RBs available, each UE should be given 12 RBs. Since UeId 1,2 and 3 do
       not need 12 RBs due to less BO, the remaining are given to UeId 0 who
       needs more.
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="3" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="4" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
         
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.10
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_10
#                Verify that only 2 UEs will be scheduled in a TTI when downlink
#                data is available for only 2 UEs: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.10">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

       <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="2">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.11
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_11
#                Verify that no new UE will be scheduled in a TTI when all
#                available bandwidth is utilized for the downlink retransmission
#                of 2 UEs: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.11">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="500"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="500"/>
      </tapa.send>

       <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="2">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     	   </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>         

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="2">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
     	   </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
    
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="2">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

     # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="2">
         <tapa.tfu.hq.recp.req ueId="0"/>
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

     #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

       <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

         #After sending a TTI, staInd is not received for the 3rd UE since
         entire b/w is used for retx.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3rd UE will not be scheduled in this TTI as the available bandwidth is
      utilized in the retx of 2 UEs
      
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="2">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtRetx="TRUE"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" vldtRetx="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" retxUse="1" isRetx="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" retxUse="2" isRetx="TRUE"/>
      	</tapa.tfu.dat.req>
       
         #Status indication is now received for the 3rd UE. 
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.12
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_12
#                Verify that eNB successfully schedules the retransmission of 1
#                UE and new transmissions of 3 non SPS UEs per TTI in the
#                downlink when sufficient PDCCH resources are available:
#                RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.12">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1">
       		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      
     # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1" >
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK the transmission
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
#Send BO for 3 new transmissions.
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>
     
      <tapa.expset>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#Expect the control and data requests for 1 retx and 3 new tx.      
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="1" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="3" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
   
      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.13
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_13
#                Verify that eNB successfully schedules the retransmission of 2
#                UEs and new transmissions of 2 non SPS UEs per TTI in the
#                downlink when sufficient PDCCH resources are available:
#                RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.13">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>
 
      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="2">
       		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
       		<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      
     # Send 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="2" >
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs (TFU_DELTA) + 1 TTI (TFU_UL_DELTA) before
         # sending the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # NACK the transmission
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
            <tapa.tfu.hq ueId="1" isAck="FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#Send BO for 2 new transmissions.
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>
     
      <tapa.expset>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

#Expect the control and data requests for 2 retx and 2 new tx.      
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="1" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="3" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
   
      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.14
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_14
#                Verify that when only 2 UE per TTI is configured, even when
#                downlink data is sent for 4 UEs, only 2 get scheduled: 
#                RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.14">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that 4UEs are scheduled in the reported BO order with SFR enabled" 
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0"
         maxDlUeNewTxPerTti="2" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
    
      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="200"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="100"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="80"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.

      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="2">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/> 
     	   </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/> 
         </tapa.tfu.dat.req>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.15
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_15
#                Verify the scheduling of 4 UEs per TTI given each UE has
#                downlink data on 2 logical channels: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.15">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   <tapa.test>
   #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

     # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

     # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

     
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="2" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="2" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="2" bo="64"/>
      </tapa.send>


      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="2" bo="64"/>
      </tapa.send>


      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="2" bo="64"/>
      </tapa.send>


	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="2" bo="64"/>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expset>
         <tapa.rgu.dstaind ueId="3" numLchTb1="2" lchTb1Data="1:2" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="2" lchTb1Data="1:2" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="2" lchTb1Data="1:2" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="2" lchTb1Data="1:2" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4"/> 
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="3" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="4" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.16
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_16
#                Verify that eNB successfully schedules 4 UEs per TTI in the
#                downlink: 5MHz: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.16">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5" dlTotalBw="25"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="20"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="20"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="20"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4"/> 
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="2" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="3" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="4" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.17
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_17
#                Verify that eNB successfully schedules all 4 non SPS UEs in
#                both uplink and downlink per TTI when PDCCH resources are
#                available: New Tx: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.17">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2" ulSchdType="2" maxUlUeNewTxPerTti="4" maxUePerUlSf="4"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
    # Send SR Indication for all UEs
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="8">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8"/> 
            
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="7" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="8" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.18
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_18
#                Verify that eNB successfully schedules 2 SPS and 2 non SPS UEs
#                in both uplink and downlink per TTI when PDCCH resources are
#                available: New Tx: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
<tapa.testcase id="29.18" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" maxDlUeNewTxPerTti="4"
      maxUePerDlSf="4" maxSpsUePerDlSf="4" dlSchdType="2" ulTotalBw="100"
      ulSchdType="2" numTxAntPorts="2" maxSpsUePerUlSf="4" startRnti="70" rntiSize="11"/>
      
      # UE Configuration
      <tapa.rg.UeInit ueId="0" ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="10" NumSPSProc="4" NumPucchVal="4" prdBsrTmr="65535"
         DLSPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" ULSPSimpRls="10"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
         DLSpsExpltRelCnt="10" NumSPSProc="4" NumPucchVal="4" prdBsrTmr="65535"
         DLSPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" ULSPSimpRls="10"/>
      <tapa.rg.UeInit ueId="2"/>
      <tapa.rg.UeInit ueId="3"/>
      
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId="4" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
 
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "4" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>


      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "2" lcId = "4" dir = "3" lcType = "5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "3" lcId = "4" dir = "3" lcType = "5"/>
      </tapa.send>
 
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="0" lchTb1Data="4" saveTo="2"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO

   <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="1" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
   </tapa.expset>
   
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expset>
      <tapa.tfu.recp.req expRecpReq="2">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
     </tapa.expset>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
 
# SPS is not activated for multi UE in the same TTI to spread PDCCH load. So we
# should activate SPS for 4 UEs such that their scheduling occasions collide
# once all 4 are activated.
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="4"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FDX SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

    # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>


      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>


         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"  saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

          <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="2"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
    </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
       <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" 
            vldtTx="TRUE" ULSPSInit="TRUE" vldtDciFmt="TRUE"/>
            
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.cntrl.req expCntrlReq="1">
           
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="2"
         isSPSOcc="TRUE"/>

       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">

         <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat  ueId="1" addShortBsr="TRUE" lcgId="1" bsr="20" />
          </tapa.tfu.dat.ind>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expset>
       <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" 
            vldtTx="TRUE" ULSPSInit="TRUE" vldtDciFmt="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
 
      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="2">

         <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE"/>
         <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="5" bo="64"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="4" lcType="5" bo="64"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="4" saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"  saveTo="2"/>
      </tapa.expect>
 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="4" saveTo="2"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="4"  saveTo="2"/>
      </tapa.expect>
 
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="4" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
#In this TTI which is an SPS occasion, 8 UEs are scheduled - 4 DL and 4 UL. 
#UeId 0 and 1 are SPS enabled in both UL and DL and UeId 2 and 3 are non SPS UEs.
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" vldtDciFmt="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" vldtDciFmt="TRUE"/>
              
           <tapa.tfu.pdsch.dat.req ueId="2"  use="2" lcId="4" chkSdu="TRUE"
            vldtDciFmt="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="3"  use="2" lcId="4" chkSdu="TRUE"
            vldtDciFmt="TRUE"/>
        </tapa.tfu.dat.req>

# Since this is SPS occasion, PDCCH control request is received only for the non
# SPS UEs.
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="2" />
           <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="3" />
            
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>

     </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">

            <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"/>
         
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>

         </tapa.tfu.recp.req>   
      </tapa.expset>
    
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.19
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_19
#                Verify that eNB successfully schedules all 4 non SPS UEs in
#                both uplink and downlink per TTI when PDCCH resources are
#                available: Re Tx: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.19">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2" ulSchdType="2" maxUlUeNewTxPerTti="4" maxUePerUlSf="4"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
       <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
       </tapa.send>
       
       <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
       <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
       </tapa.send>
       
       <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
       <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
       </tapa.send>
       
       <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

       # Configure UL LCG on RGR
       <tapa.send>
          <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instId="5"/>
       </tapa.send>
       
       <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
    # Send SR Indication for all UEs
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="8">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8"/> 
           
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>

     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
      	 <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"/>
			 <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"/>
          <tapa.tfu.pdsch.dat.req ueId="2" use="7" validate="TRUE"/>
		    <tapa.tfu.pdsch.dat.req ueId="3" use="8" validate="TRUE"/> 
       </tapa.tfu.dat.req>
   
    </tapa.expset>         

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

     # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE"/>
         
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            <tapa.tfu.hq.recp.req ueId="2"/>
            <tapa.tfu.hq.recp.req ueId="3"/>
   
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

        <tapa.send>
           <tapa.tfu.hq.ind hqInds="4">
              <tapa.tfu.hq ueId="0" isAck="FALSE"/>
              <tapa.tfu.hq ueId="1" isAck="FALSE"/>
              <tapa.tfu.hq ueId="2" isAck="FALSE"/>
              <tapa.tfu.hq ueId="3" isAck="FALSE"/>
           </tapa.tfu.hq.ind>
        </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="4">
      		<tapa.tfu.pdcch.cntrl.req ueId="0" use="10" vldtRetx="TRUE"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" use="11" vldtRetx="TRUE"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" use="12" vldtRetx="TRUE"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" use="13" vldtRetx="TRUE"/> 
         </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req>
      		<tapa.tfu.pdsch.dat.req ueId="0" isRetx="TRUE" retxUse="10" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" isRetx="TRUE" retxUse="11" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" isRetx="TRUE" retxUse="12" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" isRetx="TRUE" retxUse="13" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         
  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
 
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>   
     </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.20
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_20
#                Verify that eNB successfully schedules 2 SPS and 2 non SPS UEs
#                in both uplink and downlink per TTI when PDCCH resources are
#                available: Re Tx: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
<tapa.testcase id="29.20" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "30" dlTotalBw="50" maxDlUeNewTxPerTti="4"
      maxUePerDlSf="4" maxSpsUePerDlSf="4" dlSchdType="2" ulTotalBw="100"
      ulSchdType="2" numTxAntPorts="2" maxSpsUePerUlSf="4" startRnti="70" rntiSize="11"/>
      
      # UE Configuration
      <tapa.rg.UeInit ueId="0" ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="10" NumSPSProc="4" NumPucchVal="4" prdBsrTmr="65535"
         DLSPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" ULSPSimpRls="10"/>
      <tapa.rg.UeInit ueId="1" ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
         DLSpsExpltRelCnt="10" NumSPSProc="4" NumPucchVal="4" prdBsrTmr="65535"
         DLSPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" ULSPSimpRls="10"/>
      <tapa.rg.UeInit ueId="2"/>
      <tapa.rg.UeInit ueId="3"/>
      
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configuring the SPS for a UE for both UL and DL directions 
      #configure the dedicated logical channel for the Created UE
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="4" lcgId="1" lcType="5" dir="3"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId="4" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
 
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "4" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>


      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
     
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "2" lcId = "4" dir = "3" lcType = "5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "3" lcId = "4" dir = "3" lcType = "5"/>
      </tapa.send>
 
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gdr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

     #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="0" lcId="4" lcType="5" bo="64"/>
      </tapa.send>
   
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="0" lchTb1Data="4" saveTo="1"/>
      </tapa.expect>
      
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #PDCCH and PDSCH for FIRST BO

   <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="4" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" DLSPSInit="FALSE" ueId="0" />
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="1" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
   </tapa.expset>
  
      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expset>
      <tapa.tfu.recp.req expRecpReq="2">
         <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
     </tapa.expset>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
 
# SPS is not activated for multi UE in the same TTI to spread PDCCH load. So we
# should activate SPS for 4 UEs such that their scheduling occasions collide
# once all 4 are activated.
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="4"  saveTo="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FDX SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

    # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>


      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>


         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"  saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="1" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="2"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.hq.recp.req ueId="1"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
    </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      <tapa.expset>
       <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" 
            vldtTx="TRUE" ULSPSInit="TRUE" vldtDciFmt="TRUE"/>
            
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.cntrl.req expCntrlReq="1">
           
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">
         <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="2"
         isSPSOcc="TRUE"/>

       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="1">

         <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
          <tapa.tfu.dat.ind datInds="1">
             <tapa.tfu.dat  ueId="1" addShortBsr="TRUE" lcgId="1" bsr="20" />
          </tapa.tfu.dat.ind>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expset>
       <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" 
            vldtTx="TRUE" ULSPSInit="TRUE" vldtDciFmt="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
 
      <tapa.expset>
       <tapa.tfu.recp.req expRecpReq="2">

         <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE"/>
         <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"/>
       </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="4" lcType="5" bo="64"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="2" lcId="4" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="3" lcId="4" lcType="5" bo="64"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="4" saveTo="1"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="1" lchTb1Data="4"  saveTo="2"/>
      </tapa.expect>
 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="2" lchTb1Data="4" saveTo="3"/>
      </tapa.expect>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="3" lchTb1Data="4"  saveTo="4"/>
      </tapa.expect>
 
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="2" lchTb1Data="4" lcType="5"/>
      </tapa.send>
      
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="3" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
#In this TTI which is an SPS occasion, 8 UEs are scheduled - 4 DL and 4 UL. 
#UeId 0 and 1 are SPS enabled in both UL and DL and UeId 2 and 3 are non SPS UEs.
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="4">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" vldtDciFmt="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="1"  use="9" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE" vldtDciFmt="TRUE"/>
              
           <tapa.tfu.pdsch.dat.req ueId="2"  use="3" lcId="4" chkSdu="TRUE"
            vldtDciFmt="TRUE"/>
           <tapa.tfu.pdsch.dat.req ueId="3"  use="4" lcId="4" chkSdu="TRUE"
            vldtDciFmt="TRUE"/>
        </tapa.tfu.dat.req>

# Since this is SPS occasion, PDCCH control request is received only for the non
# SPS UEs.
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="2" />
           <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="3" />
            
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>

     </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">

            <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"/>
         
            <tapa.tfu.hq.recp.req ueId="2" use="9"/>
            <tapa.tfu.hq.recp.req ueId="3" use="9"/>

         </tapa.tfu.recp.req>   
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE" vldtRbStart="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE" vldtRbStart="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE" vldtRbStart="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE" vldtRbStart="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

# Send ACK for the received PDU
    <tapa.send>
     <tapa.tfu.hq.ind hqInds="4">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
        <tapa.tfu.hq ueId="1" isAck="FALSE"/>
        <tapa.tfu.hq ueId="2" isAck="FALSE"/>
        <tapa.tfu.hq ueId="3" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.tfu.dat.req datReqs="4">
         <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" />
         <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" />
         <tapa.tfu.pdsch.dat.req ueId="2"  use="3" lcId="4" chkSdu="TRUE" />
         <tapa.tfu.pdsch.dat.req ueId="3"  use="4" lcId="4" chkSdu="TRUE" />
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req expCntrlReq="4">
         <tapa.tfu.pdcch.cntrl.req saveTo="1" isSPSRetx="TRUE" ueId="0" />
         <tapa.tfu.pdcch.cntrl.req saveTo="2" isSPSRetx="TRUE" ueId="1" />
         <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="2" />
         <tapa.tfu.pdcch.cntrl.req saveTo="4"  ueId="3" />
      </tapa.tfu.cntrl.req>
   </tapa.expset>
<!--
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">

            <tapa.tfu.pusch.recp.req ueId="0" use="5" vldtDatRecp="TRUE"
            SPSRetx="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="6" vldtDatRecp="TRUE"
            SPSRetx="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="7" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="3" use="8" vldtDatRecp="TRUE" />
         
         </tapa.tfu.recp.req>   
      </tapa.expset>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.21
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_21
#                Verify that 4 UEs are scheduled in uplink and 4 UEs in downlink
#                along with BCCH data: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.21">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2" ulSchdType="2" maxUlUeNewTxPerTti="4" maxUePerUlSf="4"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send SI Configuration request for MIB
        <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>


      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
    # Send SR Indication for all UEs
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="9">
      	   <tapa.tfu.pdcch.cntrl.req />
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8"/> 
            
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
            <tapa.tfu.pdsch.dat.req bcchIdx="1" vldtBcch="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="7" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="8" validate="TRUE"/> 
       </tapa.tfu.dat.req>
      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.22
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_22
#                Verify that 4 UEs are scheduled in uplink and 4 UEs in downlink
#                along with PCCH data: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.22">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2" ulSchdType="2" maxUlUeNewTxPerTti="4" maxUePerUlSf="4"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="9" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expset>
         
         <tapa.rgu.cstaind lcId="3"/>  

         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      
     </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      #Send PCCH data
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" lcId="3" lcType="2"
            bufSize="41"/>
      </tapa.send>

    # Send SR Indication for all UEs
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="9">
            <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
            
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8"/> 
            
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
            <tapa.tfu.pdsch.dat.req bcchIdx="2" use="9"/>

            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="7" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="8" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.23
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_23
#                Verify that 4 UEs are scheduled in uplink and 4 UEs in downlink
#                along with RAR: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.23">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2" ulSchdType="2" maxUlUeNewTxPerTti="4" maxUePerUlSf="4"
         cfi="3"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

     # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1"
                timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
            </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expect>
         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
    # Send SR Indication for all UEs
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="9">
      		<tapa.tfu.pdcch.cntrl.req/>
      		
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6"/>
      		<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7"/>
		   	<tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8"/> 
            
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
    
       </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req>
            <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
      		
            <tapa.tfu.pdsch.dat.req ueId="0" use="5" validate="TRUE"/>
			   <tapa.tfu.pdsch.dat.req ueId="1" use="6" validate="TRUE"/>
      		<tapa.tfu.pdsch.dat.req ueId="2" use="7" validate="TRUE"/>
		   	<tapa.tfu.pdsch.dat.req ueId="3" use="8" validate="TRUE"/> 
      	</tapa.tfu.dat.req>
      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.24
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_24
#                Verify that 4 UEs are scheduled in uplink and 4 UEs in downlink
#                along with BCCH and PCCH data: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.24">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2" ulSchdType="2" maxUlUeNewTxPerTti="4" maxUePerUlSf="4"
         cfi="3"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send SI Configuration request for MIB
        <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="9" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expset>
         
         <tapa.rgu.cstaind lcId="3"/>  

         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      
     </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      #Send PCCH data
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" lcId="3" lcType="2"
            bufSize="41"/>
      </tapa.send>

    # Send SR Indication for all UEs
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
     #Expect 10 control requests - 4 for UL data, 4 for DL data, 1 for BCCH and
      1 for PCCH
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="10">
         </tapa.tfu.cntrl.req>
      
          <tapa.tfu.dat.req>
          </tapa.tfu.dat.req>
      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    29.25
#
#       Desc:    TC_MAC_RRDL_4UE_PER_TTI_25
#                Verify that 4 UEs are scheduled in uplink and 4 UEs in downlink
#                along with RAR, BCCH and PCCH data: RR Scheduler
#
#       Notes:   None
#              
#       Module:  "RR SCH"
#
#       File:    rgac_tc29.xml
#
#
<tapa.testcase id="29.25">

# Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.mwcDemo/>
	  
	  #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" maxDlUeNewTxPerTti="4" maxUePerDlSf="4"
         dlSchdType="2" ulSchdType="2" maxUlUeNewTxPerTti="4" maxUePerUlSf="4"
         cfi="3"/>
      </tapa.send>
	  
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>
      
	  # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>
	  

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         # Send SI Configuration request for MIB
        <tapa.rgr.sicfgreq instId="5" bcchIdx="1" cellId="3" cfgType="RGAC_RGR_SI_CFG_TYPE_SIB1" buffSz="32"/>
      </tapa.send>

      <tapa.expect>
         # Expect SI Cfg Cfm from MAC 
         <tapa.rgr.sicfgcfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="9" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send BO for UE1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="0" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE2
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="1" lcId="1" bo="64"/>
      </tapa.send>

      #Send BO for UE3
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="2" lcId="1" bo="64"/>
      </tapa.send>

	  #Send BO for UE4
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp ueId="3" lcId="1" bo="64"/>
      </tapa.send>

     # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1"
                timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
            </tapa.tfu.rareq.ind>
      </tapa.send>


      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #The order of staInd received should be in ascending order of BO sent as
      per the new MUE algorithm. Due to changes done in acc framework for MUE,
      any order of staInd is acceptable in xml. On disabling the OPTIMIZATION
      flag, it would accept staInd in ascending order strictly.
      <tapa.expset>
         
         <tapa.rgu.cstaind lcId="3"/>  

         <tapa.rgu.dstaind ueId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="2" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="1" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

         <tapa.rgu.dstaind ueId="0" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      
     </tapa.expset>

      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="1" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="2" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for UE1, 2, 3 and 4
          <tapa.rgu.ddatreq ueId="3" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      #Send PCCH data
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" lcId="3" lcType="2"
            bufSize="41"/>
      </tapa.send>

    # Send SR Indication for all UEs
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
     #Expect 11 control requests - 4 for UL data, 4 for DL data, 1 for BCCH,
      1 for PCCH and 1 for RAR.
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="11">
         </tapa.tfu.cntrl.req>
      
          <tapa.tfu.dat.req>
          </tapa.tfu.dat.req>
      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend
#/********************************************************************30**
#
#         End of file:     rgac_tc15.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#/main/1      ---     sm   1. Initial Release.
#$SID$         ---     sm   1. Initial Release.
#             rg004.201 rnt  1. Modified for SI Enhancement
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#*********************************************************************91*/
