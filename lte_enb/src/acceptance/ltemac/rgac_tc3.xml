#/************************************************************************
#     Name:     LTE-MAC Test Cases
#  
#     Type:     XML Script
#  
#     Desc:     XML source for LTE MAC Test Case
#     
#     File:     rgac_tc3.xml 
#  
#     Sid:      
#  
#     Prg:      ns
#**********************************************************************/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:hn:rgac_tc3.xml

############# Random Access Cases ##############
#
#
#       Test:    3.1
#
#       Desc:   "To test the successful CCCH SDU based contention resolution 
#               where UeCfg from RRC is received soon after reception of Msg3" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.1">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                    tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.2
#
#       Desc:   "To test the successful CCCH SDU based contention resolution 
#               where UeCfg from RRC is received after Msg4 is transmitted" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, Msg4 and then UeCfg"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
   </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # At start of this step, we are at (2,1)
      # Send CDatReq on CCCH for the same rnti.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3"
                            sendNoMatter="TRUE"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send stats req to know the failure
      <tapa.send>
         <tapa.lrg.stsreq elmntType="STRGUSAP"/>
      </tapa.send>
      
      # Expect stats to indicate a pdu drop
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STRGUSAP" numPduDrop="1"/>
      </tapa.expect>

      # At start of this step, we are at (2,1)
      # Send TTI to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.3
#
#       Desc:   "To test the unsuccessful CCCH SDU based contention resolution 
#               where UeCfg from RRC is received before Msg3" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Unsuccessful scenario of CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: UeCfg, Msg3 and then Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit maxMsg3Tx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      
      # At start of this step, we are at (0,7)
      # Send UE config request from RRC before Msg3 reception is successful
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (0,8)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request from RRC before Msg3 reception is successful
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (0,8)
      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="15" instId="5"/>
      </tapa.expect>
    
      # At start of this step, we are at (0,8)
      # Send 3 more TTIs for sending msg3 Feedback
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
    
      # At start of this step, we are at (0,11)
      # Send 4 more TTIs before reception request for Msg3 Re-transmission.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5).
      # Expect data reception request for MSG3 re-transmission.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      
      # At start of this step, we are at (0,15)
      # Send 4 more TTIs for msg3 Feedback.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # ccpu00111742: Sending NACK in PHICH for failed UL TX
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
    
      # RG_MAX_RA_PRC_FRM from 6 to 10 
      # At start of this step, we are at (1,5)
      # Send 81 TTIs to validate that the random access context is deleted after
      # raPrcFrm number of TTIs (raPrcFrm = RG_MAX_RA_PRC_FRM = 10)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="81" />
      </tapa.send>
     
      # At start of this step, we are at (10,0)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>
     
      # At start of this step, we are at (10,0)
      # Send TTI to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.4
#
#       Desc:   "To test the successful C-RNTI based contention resolution" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of C-RNTI based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Ue sends a C-RNTI control element in Msg3 and gets an uplink grant
through random access"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Configuration
      <tapa.rg.UeInit ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
    ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
    ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.crg.cfgcfm/>
        <tapa.rgr.cfgCfm instId="5"/>
        <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
            vldtTx="TRUE"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>      

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      # and Data reception request for the UL grant sent for contention
      # resolution
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Expect data reception request for Msg3 Re-Tx (ueId=1).
      # Expect data reception request for grant for contention resoultion.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
         #Send CRC for UL data
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For UL data 
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
     <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
      
      # At start of this step, we are at (1,9)
      # Send 3 TTIs to check if the are no pending msgs at MAC 
      # At 4th TTI, there will be a data reception request pending for the 
      # reported short BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.5
#
#       Desc:   "To test the unsuccessful C-RNTI based contention resolution" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Unsuccessful scenario of C-RNTI based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "C-RNTI based contention resolution failure for non-existing UE"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4" ueId="0"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" ueId="0"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="0" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
      
      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" invldCrnti="TRUE" ueId="0" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # RG_MAX_RA_PRC_FRM from 6 to 10 
      # At start of this step, we are at (1,5)
      # Send 85 TTIs to validate that the random access context is deleted after
      # raPrcFrm number of TTIs (raPrcFrm = RG_MAX_RA_PRC_FRM = 10)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="85"/>
      </tapa.send>

      # At start of this step, we are at (10,6)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" ueId="0" bo="10"/>
      </tapa.send>
      
      # At start of this step, we are at (10,6)
      # Send 5 TTIs to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.6
#
#       Desc:   "To test the successful handling of Msg4 reject"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of reject in Msg4"
      </tapa.desc>

      <tapa.longdesc>
         "Default Max DL retransmissions is 4. After 2 retransmissions, send a UE del
         request, triggering a MSG4 rejection. Now send the HqFeed back Ind as NACK for
         the second retransmission. Verify that no more retransmissions happen."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #Expect MSG4 retx.
   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # Send Msg4 reject by means of sending a UE del before UE cfg.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
   
   # Verify no further retransmissions.
   <tapa.send>
      <tapa.tfu.tti.ind numTti="10" />
   </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.7
#
#       Desc:   "To test Msg4 NACK handling"
#       TODO:    To be tested after coding of MSG4 re-transmission
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of NACK for Msg4"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, Msg4 and then NACK for Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration with maximum msg4 transmissions = 2
      <tapa.rg.cellInit maxMsg4HqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4" ueId="0"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
      
      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
  
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send NACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
      
      # At start of this step, we are at (2,1)
      # Send 2 TTIs(SCHEDULING_RETX(=1) + RG_DL_DELTA(=3) - TFU_DELTA(=2)) before expecting 
      # Pdcch request and data request for Msg4 re-transmission.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (2,3)
      # Expecting a pdcch request and data request for MSG4 re-transmission.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>      
  
      # At start of this step, we are at (2,3)
      # Send 4 TTIs before expecting a HARQ reception request for MSG4
      # re-transmission.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # At start of this step, we are at (2,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # At start of this step, we are at (2,7)
      # Send 3 TTIs before expecting a HARQ feedback for MSG4
      # re-transmission.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # At start of this step, we are at (3,0)
      # Send final NACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
      # At start of this step, we are at (3,0)
      # Send 1 TTI for NACK processing
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # At start of this step, we are at (3,1)
      # Send 69 TTIs to delete raCb after 
      # raPrcFrm number of TTIs (raPrcFrm = RG_MAX_RA_PRC_FRM = 150)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1500" />
      </tapa.send>
      
      # At start of this step, we are at (10,0)
      # Send UE config request from RRC when MSG4 is finally NACKED
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (10,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request from RRC when MSG4 is finally NACKED
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (10,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (10,1)
      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>
     
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.8
#
#       Desc:   "To test multiple simultaneous random access procedures"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of multiple simultaneous random access procedures
         for multiple rapIds"
      </tapa.desc>

      <tapa.longdesc>
         "4 RAPIDs in one random access request indication shall be handled"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>
      # Cell Configuration
      <tapa.rg.cellInit size="2" numSubbands="24" ulTotalBw="60"/>
      # Ue Configuration
      <tapa.rg.UeInit ulAmbr="1024"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
    ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
    ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send 1 tti for applying configuration
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Expect configuration confirm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="4" rapIds="18:56:35:43"
               timingAdvs="2:3:4:5" tpcs="1:2:3:4" cqiPres="TRUE:TRUE:TRUE:TRUE"
               cqis="2:3:4:1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      # Expect confirm for logical channel
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" expectAll="TRUE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="4">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="2"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="3"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="4"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="4" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expset>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req ueId="4" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # Send CCCH SDU
      # Send CRNTI MAC CE with valid CRNTI
      # Send CRNTI MAC CE with invalid CRNTI
      # Send CCCH SDU
      <tapa.send>
       <tapa.tfu.dat.ind datInds="4">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="1"/>
          <tapa.tfu.dat crnti="0" ueId="2" addCrnti="TRUE" />
          <tapa.tfu.dat invldCrnti="TRUE" ueId="3" addCrnti="TRUE"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="4" lcId="4"/>
      </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send 1 TTI to process Msg3 data indication
      # And for scheduling of grant for the CRNTI based contention resolution.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send TTIs for to expect PDCCH for the scheduled grant 
      # NumTti = RG_UL_SCHED_DELTA (=2) - TFU_DELTA(=2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>
      
      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0 for ueId=3.
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
            vldtTx="TRUE"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="4"/>
      </tapa.send>


      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4" ueId="1"/>
         <tapa.rgu.cstaind lcId="4" ueId="4"/>
      </tapa.expset>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq ueId="4" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # chk ueId Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="3" validate="TRUE" chkCcchSh="TRUE" ueId="1"/>
        <tapa.tfu.pdsch.dat.req use="4" validate="TRUE" chkCcchSh="TRUE" ueId="4"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="4"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5).
      # Expect data reception request for MSG3 re-transmission.
      # Expect data reception request for grant for contention resoultion.
    <tapa.expect>
      <tapa.tfu.recp.req numRntis="5">
  #       <tapa.tfu.msg3.recp.req ueId="1"/>
  #       <tapa.tfu.msg3.recp.req ueId="2"/>
  #       <tapa.tfu.msg3.recp.req ueId="3"/>
  #       <tapa.tfu.msg3.recp.req ueId="4"/>
         <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
      </tapa.tfu.recp.req>   
    </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="4"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
      
      # At start of this step, we are at (1,8)
      # Send 1 TTIs = (TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
         #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
     <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtGrant="TRUE"
            vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4 for ueId=1 
      # Send NACK as feedback for Msg4 for ueId=4 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="4" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (2,1)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="3"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="4" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

# At start of this step, we are at (2,2)
      # Expecting a pdcch request and data request for MSG4 re-transmission for
      # ueID=4.
      # Expect success in cfg cfm for ueId=1 and ueId=4(CCCH SDU based)
      # Expect failure in cfg cfm for ueId=2 and ueId=3
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE" ueId="4"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="4"/>
        </tapa.tfu.cntrl.req>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.9
#
#       Desc:   "To test handling of invalid rapId"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of invalid rapId"
      </tapa.desc>

      <tapa.longdesc>
         "Sending a raReqInd with one valid rapId and one invalid rapId (that is
          not configured) and ensuring that only the valid one is served"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numRaPreamble="60"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="3" rapIds="18:60:35"
               timingAdvs="2:3:4" tpcs="1:2:3" cqiPres="TRUE:TRUE:FALSE"
               cqis="2:3:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      # Expect confirm for logical channel
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" expectAll="FALSE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="0"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
         #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # Send CCCH SDU
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="0"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send 1 TTI to process Msg3 data indication
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="0"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId ="1"/>
      </tapa.send>


      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4" ueId="0"/>
         <tapa.rgu.cstaind lcId="4" ueId="1"/>
      </tapa.expset>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req  use="3" validate="TRUE" chkCcchSh="TRUE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="4" validate="TRUE" chkCcchSh="TRUE" ueId="1"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>
      

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.rg.dbgInitAll/> 

      # At start of this step, we are at (2,1)
      # Send UE config request from RRC for ueId=0
      # Send UE reconfig request from RRC for ueId=1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>
      # Send UE reconfig request from RRC for ueId=1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue oldUeId="3" newUeId="1" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (2,2)
      # Expect success in cfg cfm for ueId=0
      # Expect failure in cfg cfm for ueId=1
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm status="15" instId="5"/>
      </tapa.expset>

      # At start of this step, we are at (2,1)
      # Send TTI to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.10
#
#       Desc:   "To test handling of multiple RA-RNTIs"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of multiple simultaneous random access procedures
- different RA-RNTIs"
      </tapa.desc>

      <tapa.longdesc>
         "Two RA-RNTIs in two different random access request indications shall be handled"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      # Configure minimum possible dlBW so that it will be occupied in the
      # first scheduling subframe completely by BCCH and PCCH data!
      <tapa.rg.cellInit dlTotalBw="12" cfi="3" bcchPchCodeRate="2048"
         dlCcchCqi="3"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # At start of this step, we are at (0,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (0,0)
      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="6" />
      </tapa.send>

      # At start of this step, we are at (0,0)
      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="6" />
      </tapa.send>
      
      # At start of this step, we are at (0,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (0,2)
      # Send RaReqInd for one raRnti = 1
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="1" numRapId="2" rapIds="18:35"
               timingAdvs="2:3" tpcs="1:2" cqiPres="TRUE:TRUE"
               cqis="12:13"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # At start of this step, we are at (0,2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (0,3)
      # At the end of first TTI, expect CstaInd for BCCH on DLSCH and PCCH.
      <tapa.expset>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
      </tapa.expset>
      
      # At start of this step, we are at (0,3)
      # Send BCCH and PCCH data on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="0" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # At start of this step, we are at (0,3)
      # Send RaReqInd for second raRnti = 2
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="2" numRapId="1" rapIds="22"
               timingAdvs="3" tpcs="3" cqiPres="TRUE" cqis="12"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>
      
      # At start of this step, we are at (0,4)
      # Send 1 TTI to get BCCH and PCCH data at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,5)
      # Expect BCCH and PCCH data from MAC to PHY
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="3"/>
     </tapa.tfu.cntrl.req>
   # Expect Msg4 from MAC to PHY.
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req bcchIdx="0" ueId="0" use="2"/>
        <tapa.tfu.pdsch.dat.req bcchIdx="1"  ueId="1" use="3"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      # At start of this step, we are at (0,4)
      # Send 1 TTI before expecting Random access response 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (0,5)
      # UE1 starts expecting random access response at raRnti(=2) +
      # NumberofRaSubframes(=1) + RaRsp(=3) = 6 subframes after raReq
      # transmission
      # MAC shall send response delayed by 1 TTI and so after 3 TTIs(6 - TFU_UL_DELTA(=1)
      # - RG_DL_DELTA(=2)), MAC shall send it to PHY
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.rarsp.req  raRnti="1" expectAll="TRUE" vldtRar="TRUE"/>
           <tapa.tfu.rarsp.req raRnti="2" expectAll="TRUE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req/>
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,5)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="3">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="0"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
         #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="2"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # Send CCCH SDU
      <tapa.send>
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="2" ueId="0"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="2" ueId="1"/>
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="2" ueId="2"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
      </tapa.expset>

      # At start of this step, we are at (1,0)
      # Send 1 TTI to process Msg3 data indication
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="2" ueId ="0"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="2" ueId ="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="2" ueId ="2"/>
      </tapa.send>


      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4" ueId="0"/>
         <tapa.rgu.cstaind lcId="4" ueId="1"/>
         <tapa.rgu.cstaind lcId="4" ueId="2"/>
      </tapa.expset>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" ueId="0" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" ueId="1" lcId="4" lcType="3" />
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="3" ueId="2" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="3">
        <tapa.tfu.pdsch.dat.req  use="1" bcchIdx="1" validate="TRUE" chkCcchSh="TRUE" ueId="0"/>
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="2" validate="TRUE" chkCcchSh="TRUE" ueId="1"/>
        <tapa.tfu.pdsch.dat.req use="3" bcchIdx="3" validate="TRUE" chchkCcchSh="TRUE" ueId="2"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="3">
        <tapa.tfu.pdcch.cntrl.req  saveTo="1" ueId="0"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2" ueId="1"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="3" ueId="2"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # Send 2 TTI to get data reception request for MSG3 re-transmission
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="3">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
        <tapa.tfu.hq.recp.req ueId="2"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC for ueId=0 and ueId=1
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="3">
        <tapa.tfu.hq ueId="0"/>
        <tapa.tfu.hq ueId="1"/>
        <tapa.tfu.hq ueId="2"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send UE config request from RRC for ueId=0
      # Send UE reconfig request from RRC for ueId=1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue oldUeId="3" newUeId="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue oldUeId="3" newUeId="2" instId="5"/>
      </tapa.send>
      # At start of this step, we are at (2,1)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (2,2)
      # Expect success in cfg cfm for ueId=0
      # Expect failure in cfg cfm for ueId=1
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm status="15"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm status="15" instId="5"/>
      </tapa.expset>

      # At start of this step, we are at (2,1)
      # Send TTI to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.11
#
#       Desc:   "To test the successful C-RNTI based contention resolution when
#       a BSR and PHR is sent along with the CRNTI control element" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of C-RNTI based contention resolution when
         a BSR and PHR is sent along with the CRNTI control element" 
      </tapa.desc>

      <tapa.longdesc>
         "Ue sends a C-RNTI control element and a BSR and PHR in Msg3 and gets an 
         appropriate uplink grant through random access"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

   # PHR handling for MSG3 */
      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2"/>

      # UE Configuration
      <tapa.rg.UeInit isAccumulated="TRUE"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
    ulQci="8" ueId="0"/>
      </tapa.send>
      
      # Configure a DTCH for the UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4"
    ulQci="8" ueId="0" instId="5"/>
      </tapa.send>
      
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1"
               timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0) 
      # UeInit takes 20 subframes
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well. Expect configmation for Logical channel configuration
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" ueId="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA + TFU_UL_DELTA) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
      
      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # Send short BSR and a positive PHR
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"
            addShortBsr="TRUE" bsr="55" addPhr="TRUE" phr="30"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      
      # At start of this step, we are at (1,0)
      # Send 1 TTI for scheduling grant for CRNTI based contention resolution
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>

      # At start of this step, we are at (1,1).
      # Expect PDCCH for DCI format 0.
      # Grant should have tbSize more than the maximum bits corresponding to
      # BSR=5 (=19 * 8 =156)
      # TPC should be positive.
      <tapa.expect>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
            minGrantBits="156" vldtTx="TRUE" vldtTpc="TRUE"
            tpcPositive="TRUE" isAccumulated="TRUE"/>
     </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,1)
      # Send TFU_DELTA(=2) TTIs to send out the PDCCH
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,3)
      # Send 2 more TTIs before expecting a data reception request for Msg3 Re-Tx
      # and Data reception request for the UL grant sent for contention
      # resolution
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Expect data reception request for grant for contention resoultion.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # At start of this step, we are at (1,5)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending data to
      # MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
         #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,8)
      # Send Data indication with short BSR report
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="4"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,8)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" ueId="1" bo="10"/>
      </tapa.send>
      
      # At start of this step, we are at (1,8)
      # Send 1 TTI to expect PHICH for the sent data.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,9)
      # Expect ACK for the data sent
     <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expect>
      
      # At start of this step, we are at (1,9)
      # Send 3 TTIs to check if the are no pending msgs at MAC 
      # At 4th TTI, there will be a data reception request pending for the 
      # reported short BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.12
#
#       Desc:   "To test that atmost 4 RA-RNTIs are satisfied in a subframe"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of multiple simultaneous random access procedures
- different RA-RNTIs"
      </tapa.desc>

      <tapa.longdesc>
         "Test that atmost four RA-RNTIs shall be satisfied in a subframe"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      # Modified for SI Enhancement*/
      <tapa.ifndef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      # Configure minimum possible dlBW so that it will be occupied in the
      # first scheduling subframe completely by BCCH and PCCH data!
      <tapa.rg.cellInit dlTotalBw="12" cfi="3" bcchPchCodeRate="2048"
         dlCcchCqi="3"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # At start of this step, we are at (0,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="6" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="6" />
      </tapa.send>
      
      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="7" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="7" />
      </tapa.send>

      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="8" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="8" />
      </tapa.send>

      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="9" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="9" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send RaReqInd for one raRnti = 0
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="1" numRapId="1" rapIds="18"
               timingAdvs="2" tpcs="1" cqiPres="TRUE" cqis="12"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At the end of first TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=6.
      <tapa.expset>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
      </tapa.expset>
      
      # Send BCCH and PCCH data on RGU for sfOffset=6 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # Send RaReqInd for second raRnti = 1
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="2" numRapId="1" rapIds="22"
               timingAdvs="3" tpcs="3" cqiPres="TRUE" cqis="12"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>
      
      # Send 1 TTI to get BCCH and PCCH data at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect BCCH and PCCH data from MAC to PHY
      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=7.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="1" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="2"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>

      # Send BCCH and PCCH data on RGU for sfOffset=7 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="3" ueId="0" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="4" ueId="1" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # Send RaReqInd for second raRnti = 2
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="22"
               timingAdvs="3" tpcs="3" cqiPres="TRUE" cqis="12"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Send 1 TTI before expecting BCCH and PCCH cStaInd for sfOffset=8 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=8.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="3" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="4"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>

      # Send BCCH and PCCH data on RGU for sfOffset=7 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="5" ueId="0" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="6" ueId="1" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # At start of this step, we are at (0,3)
      # Send RaReqInd for second raRnti = 3
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="4" numRapId="1" rapIds="22"
               timingAdvs="3" tpcs="3" cqiPres="TRUE" cqis="12"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Send 1 TTI before expecting BCCH and PCCH cStaInd for sfOffset=9 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=9.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="5" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="6"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>
      
      # Send BCCH and PCCH data on RGU for sfOffset=9 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="7" ueId="0" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="8" ueId="1" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # Send 1 TTI before expecting BCCH and PCCH data for sfOffset=9 
      # RaRntis get scehduled in this TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=9.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="7" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="8"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.rarsp.req raRnti="3" vldtRar="TRUE"/>
           <tapa.tfu.rarsp.req raRnti="4" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req/>
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>
</tapa.testcase>


#
#
#       Test:    3.13
#
#       Desc:   "To test deletion of Random access context if Response is not
#       sent within window"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test deletion of Random access context if Response is not sent
         within the response window"
      </tapa.desc>

      <tapa.longdesc>
         "To test deletion of Random access context if Response is not sent
         within the response window"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      # Modified for SI Enhancement*/
      <tapa.ifndef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      # Configure minimum possible dlBW so that it will be occupied in the
      # first scheduling subframe completely by BCCH and PCCH data!
      <tapa.rg.cellInit dlTotalBw="12" cfi="3" bcchPchCodeRate="2048"
          dlCcchCqi="3"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # At start of this step, we are at (0,0)
      # Send 10 TTIs to move past 1 SFN
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="6" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="6" />
      </tapa.send>
      
      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="7" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="7" />
      </tapa.send>

      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="8" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="8" />
      </tapa.send>

      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="41" sfOffset="9" />
      </tapa.send>

      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="41" sfOffset="9" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send RaReqInd for one raRnti = 0
      # At subframe=2 and scheduling frame= 5 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="1" numRapId="1" rapIds="18"
               timingAdvs="2" tpcs="1" cqiPres="TRUE" cqis="12"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At the end of first TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=6.
      <tapa.expset>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
      </tapa.expset>
      
      # Send BCCH and PCCH data on RGU for sfOffset=6 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # Send 1 TTI to get BCCH and PCCH data at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect BCCH and PCCH data from MAC to PHY
      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=7.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="1" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="2"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>

      # Send BCCH and PCCH data on RGU for sfOffset=7 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" ueId="0" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" ueId="1" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # Send 1 TTI before expecting BCCH and PCCH cStaInd for sfOffset=8 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=8.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="1" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="2"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>
      
      # Send BCCH and PCCH data on RGU for sfOffset=7 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" ueId="0" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" ueId="1" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # Send 1 TTI before expecting BCCH and PCCH cStaInd for sfOffset=9 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=9.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="1" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="2"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>
      
      # Send BCCH and PCCH data on RGU for sfOffset=9 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" ueId="0" lcId="2" lcType="1" bufSize="41"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="2" ueId="1" lcId="3" lcType="2" bufSize="41"/>
      </tapa.send>

      # Send 1 TTI before expecting BCCH and PCCH data for sfOffset=9 
      # RaRntis get scehduled in this TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At the end of TTI, expect CstaInd for BCCH on DLSCH and PCCH for
      # sfOffset=9.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="1" bcchIdx="1" />
        <tapa.tfu.pdsch.dat.req use="2" bcchIdx="2"/>
     </tapa.tfu.dat.req>   
      </tapa.expset>

      # Send 10 TTIs to validate no messages are recieved for random access
      # response
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.14
#
#       Desc:   "To test the successful CCCH SDU based contention resolution 
#               where UeCfg from RRC is received after Msg4 is transmitted for
#               maximum RA Response window size." 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, Msg4 and then UeCfg"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration with rawinSize = 10 subframes
      <tapa.rg.cellInit raWinSize="10"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="1" rapIds="1"
               timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
      
      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # At start of this step, we are at (2,1)
      # Send CDatReq on CCCH for the same rnti.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3"
                           sendNoMatter="TRUE"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send stats req to know the failure
      <tapa.send>
         <tapa.lrg.stsreq elmntType="STRGUSAP"/>
      </tapa.send>
      
      # Expect stats to indicate a pdu drop
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STRGUSAP" numPduDrop="1"/>
      </tapa.expect>

      # At start of this step, we are at (2,1)
      # Send TTI to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

################### RACH and HandOver TCs #####################

#
#       Test:    3.15
#
#       Desc:    To test validation of failure scenario of cell configuration
#                with overlapping PO dedicated and non-dedicated preambles is rejected.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc2.xml
#
<tapa.testcase id="3.15">
   
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test validation of failure scenario of cell configuratio
         with overlapping PO dedicated and non-dedicated preambles is rejected."
      </tapa.desc>

      <tapa.longdesc>
         "To test validation of failure scenario of cell configuratio
         with overlapping PO dedicated and non-dedicated preambles is rejected."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>
   
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>
      
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      
      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq instId="0"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0" instId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP to Scheduler
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration If cellId not given it will take default as
      # 3.
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell  cellId="3" />
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send RGR Cell Configuration with overlapping ded and non-ded rapIds 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            numRaPreamble="4" sizeRaPreambleGrpA="3"
            preambleSetPres="1" preambleStart="4" preambleSize="62"/>
      </tapa.send>
      #Expect Negative confirmation Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration with overlapping ded and non-ded rapIds 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            numRaPreamble="4"  sizeRaPreambleGrpA="3"
            preambleSetPres="1" preambleStart="3" preambleSize="50"/>
      </tapa.send>
      #Expect Negative confirmation Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration with overlapping ded and non-de drapIds 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            numRaPreamble="20"  sizeRaPreambleGrpA="19"
            preambleSetPres="1" preambleStart="20" preambleSize="50"/>
      </tapa.send>
      #Expect Negative confirmation Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration with RACH Cfgn sfn as NA  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            numRaPreamble="20"  sizeRaPreambleGrpA="19" sfnEnum="RGAC_RGR_SFN_NA"
            preambleSetPres="1" preambleStart="20" preambleSize="50"/>
      </tapa.send>
      #Expect Negative confirmation Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

      #Send RGR Cell Configuration with dedPream start less than non-ded pream size  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            numRaPreamble="20"  sizeRaPreambleGrpA="19" sfnEnum="RGAC_RGR_SFN_NA"
            preambleSetPres="1" preambleStart="0" preambleSize="5"/>
      </tapa.send>
      #Expect Negative confirmation Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
      
      #Send RGR Cell Configuration with invalid dedPream size  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            numRaPreamble="20"  sizeRaPreambleGrpA="19" sfnEnum="RGAC_RGR_SFN_NA"
            preambleSetPres="1" preambleStart="21" preambleSize="0"/>
      </tapa.send>
      #Expect Negative confirmation Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
   
</tapa.testcase>


#
#       Test:    3.16
#
#       Desc:    To test validation of failure scenario of HO Ue configuration
#                with overlapping PO dedicated and non-dedicated preambles is rejected.
#
#       Notes:   None
#              
#       Module:  Configuration 
#
#       File:    rgac_tc2.xml
#
<tapa.testcase id="3.16">
   
   # Document subsection
   <tapa.doc>
      <tapa.rfc id="" section=""/>
      <tapa.module/>

      <tapa.desc>
         "To test validation of failure scenario of Ho Ue configuration
         with overlapping PO dedicated and non-dedicated preambles is rejected."
      </tapa.desc>

      <tapa.longdesc>
         "To test validation of failure scenario of Ho UE configuration
         with overlapping PO dedicated and non-dedicated preambles is rejected.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49 
         and for HO the preamble Ids from 50 to 63 are reserved."
      </tapa.longdesc>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef/>
      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>
   
   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>
      
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq/>
      </tapa.send>
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>

      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq instId="0"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0" instId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP to Scheduler
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>
      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration If cellId not given it will take default as
      # 3.
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell  cellId="3" />
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send RGR Cell Configuration  
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell  instId="5" cellId="3" numCmnLc="5"
            cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" 
            numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"/>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

      #Expect Positive confirmation from scheduler 
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue cellId="3"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with dedPrmblId overlapping with non-dedicated preambles
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="10"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with dedPrmblId overlapping with non-dedicated preambles
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="29"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with dedPrmblId overlapping with non-dedicated preambles
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="0"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with dedPrmblId overlapping with non-dedicated preambles
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="4"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with dedPrmblId overlapping with PO dedicated preambles
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="40"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with dedPrmblId overlapping with PO dedicated preambles
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="49"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with dedPrmblId outside bounds 
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="65"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with rnti belonging to the configured rnti pool of SCH 
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" crnti="11" dedPrmblPrsnt="TRUE" dedPrmblId="63"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5" status="15"/>
   </tapa.expect>

   # Send UE config request with valid and allowed dedPrmblId
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="63"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
   
</tapa.testcase>

#
#
#       Test:    3.17
#
#       Desc:    To test PDCCH Order generation for an Idle Ue. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.17">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test PDCCH Order generation for an Idle Ue." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for an Idle Ue.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

      # UE configuration
      <tapa.rg.UeInit taTmrPres="TRUE" taTmr="40" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      # Send BO for the created logical channel on RGU to trigger a PO. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="10"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Apply GAP number of TTI before indicating a RaReq
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #  send an authorized raReq. Processing this, MAC shall
      # free the rapId to UE association and further raReq with
      # this rapId without a PDCCH Order shall be discarded by MAC.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="11"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #  send an UNauthorized raReq.
      # verify this is discarded, as no rarsp is generated.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   # expect a recp req for this UE.
    <tapa.expect>
       <tapa.tfu.recp.req numRntis="1" spId="1">
          <tapa.tfu.msg3.recp.req/>
       </tapa.tfu.recp.req>
    </tapa.expect>
   <!--
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2">
        <tapa.tfu.pusch.recp.req ueId="0" vldtDatRecp="TRUE"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
   -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.18
#
#       Desc:    To test PDCCH Order generation for 2 Idle Ues with RACH Cfg as ANY, all subframes. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.18">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test PDCCH Order generation for 2 Idle Ues with RACH Cfg as ANY, all subframes." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for 2 Idle Ues with RACH Cfg as ANY, all subframes.
         Non Ded Preams are from 0 to 29, PO ded preambles is only 1 i.e rapId 30.
         Verify UEs are POed in consecutive RA occassions."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="1"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

      # UE configuration
       <tapa.rg.2UeInit taTmrPres="TRUE" taTmr="40" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
 
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      # Send BO for the created logical channel on RGU to trigger a PO
      # for both ues. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      #send 2 TTIs one for scheduling and 1 for transmitting
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #verify POs for these two UEs are generated in consecutive RA occasions.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="10"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Apply GAP number of TTI before indicating a RaReq
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  raRnti="1" numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  raRnti="2" numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="11"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="12"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.19
#
#       Desc:    To test PDCCH Order generation for 2 Idle Ues with RACH Cfg as EVEN, 1 subframe. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.19">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test PDCCH Order generation for 2 Idle Ues with RACH Cfg as EVEN, 1 subframe." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for 2 Idle Ues with RACH Cfg as EVEN, 1 subframe.
         Non Ded Preams are from 0 to 29, PO ded preambles is only 1 i.e rapId 30.
         Verify UEs are POed in consecutive RA occassions(where RA occasion subframes span across
         consecutive even SFNs)."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.oneRaOccn numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="1" 
            sfnEnum="RGAC_RGR_SFN_EVEN" raOccSubFrameNum="3" raOccSize="1"/>

      # UE configuration
      <tapa.rg.2UeInit taTmrPres="TRUE" taTmr="40" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="0"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send> 
 
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1" ueId="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  
 
      # Send BO for the created logical channel on RGU to trigger a PO
      # for both ues. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp ueId="1" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      #send 2 TTIs one for scheduling and 1 for transmitting
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
#at this point crntTime is 8.1, so raOccasion should be 10.3
#since there is only 1 rapId, UE1 should wait for 13 more TTI duration,
#so that crntTime goes to 9.4 and new raOccasion 12.3 is selected.      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #verify POs for these two UEs are generated in consecutive RA occasions.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #send 22 tti to reach to 10.3
      #send 12 to change RA occasion and get PO for other UE.
      <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
     -->  
      #1 Tti for transmission
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

### from here 9.4 we should wait for 29 TTis to reach 12.3 to send a raReq.

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  raRnti="1" numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="11"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   # expect a recp req for this UE.
   <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
   </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      #At this point UE0 which was idle should be activated
      #so expect DStaInd, for DL scheduling would have happened 
      #for the reported BO.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     
      # Expect HARQ ACK in PHICH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req  use="1" ueId="0" numSdu="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  raRnti="1" numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="12"/>
        </tapa.tfu.dat.req>
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.20
#
#       Desc:    To test successful handover scenario. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.20">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful handover scenario." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for an Idle Ue.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49.
         Configure a HO Ue with dedPreamble Id as 50"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue cellId="3"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with rnti not belonging to the configured rnti pool of SCH 
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # send raReq with the alloted rapId
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
         <tapa.tfu.rareq  numRapId="2" rapIds="50:61"
            tpcs="1:1" cqiPres="TRUE:TRUE" cqis="4:5"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect RaResp for the rapId sent in RaReq
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.rarsp.req hoUeId="0" expectAll="FALSE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   # send raReq with the alloted rapId again
   # verify that rapId-ue association is cleared in the 
   # previous raReqInd processing and that this is not honoured.
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
         <tapa.tfu.rareq  numRapId="1" rapIds="50"
            tpcs="1" cqiPres="TRUE" cqis="4"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect RaResp for the rapId sent in RaReq
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.rarsp.req hoUeId="0" expectAll="FALSE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

   # expect a recp req for this UE.
   <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>


   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.21
#
#       Desc:    To test successful backoff indication. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.21">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful backoff indication." 
      </tapa.desc>

      <tapa.longdesc>
         "To test successful backoff indication. 
         Adjust maxMsg3PerUlSf, such
         that only 2 UEs get the RAR grant at a time. Hence when 10 UEs
         are contending, BI value of 4 UEs is indicated by MAC at 
         subsequent scheduling instance which is the end of RaResp window."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns maxMsg3PerUlSf="2" numRaPreamble="30" sizeRaPreambleGrpA="25"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="10" rapIds="1:2:3:4:5:6:7:8:9:10" 
            timingAdvs="3:3:3:3:3:3:3:3:3:3" tpcs="1:1:1:1:1:1:1:1:1:1" 
            cqiPres="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
            cqis="4:4:4:4:4:4:4:4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1:2" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="3:4" expectAll="FALSE" bi="TRUE" biVal="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="2"/>
            <tapa.tfu.msg3.recp.req ueId="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # ignoring further message flow validations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.22
#
#       Desc:    To test unauthorized use of dedicated preambles, with in a Basic HO case. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.22">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test unauthorized use of dedicated preambles, with in a Basic HO case." 
      </tapa.desc>

      <tapa.longdesc>
         "To test unauthorized use of dedicated preambles.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49.
         Configure a HO Ue with dedPreamble Id as 50"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

        # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue cellId="3"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with rnti belonging to the configured rnti pool of SCH 
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #verify unauthorized use of RapId would result in MAC discarding the raReq
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
         <tapa.tfu.rareq  numRapId="1" rapIds="63"
            tpcs="1" cqiPres="TRUE" cqis="4"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   #verify no ra Rsp is generated for rapId=63 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="10"/>
   </tapa.send>

   #verify unauthorized use of RapId would result in MAC discarding the raReq
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
         <tapa.tfu.rareq  numRapId="1" rapIds="30"
            tpcs="1" cqiPres="TRUE" cqis="4"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   #verify no ra Rsp is generated for rapId=30 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="10"/>
   </tapa.send>

   # send raReq with the alloted rapId
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
         <tapa.tfu.rareq  numRapId="1" rapIds="50"
            tpcs="1" cqiPres="TRUE" cqis="4"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect RaResp for the rapId sent in RaReq
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   # send raReq with the alloted rapId again
   # verify that rapId-ue association is cleared in the 
   # previous raReqInd processing and that this is not honoured.
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
         <tapa.tfu.rareq  numRapId="1" rapIds="50"
            tpcs="1" cqiPres="TRUE" cqis="4"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

   # Expect RaResp for the rapId sent in RaReq
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.rarsp.req hoUeId="0" expectAll="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

   # expect a recp req for this UE.
   <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.23
#
#       Desc:    To test if UEs with Dedicated preambles are given 
#                higher priority over non-dedicated preamble UEs. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.23">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test if UEs with Dedicated preambles are given 
          higher priority over non-dedicated preamble UEs." 
      </tapa.desc>

      <tapa.longdesc>
         "To test if UEs with Dedicated preambles are given 
          higher priority over non-dedicated preamble UEs.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49,
         HO Ue configured with dedPreamble Id 50."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20" ulTotalBw="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

      # UE configuration
      <tapa.rg.UeInit taTmrPres="TRUE" taTmr="40" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   # Send HO UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1" cellId="3"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with rnti not belonging to the configured rnti pool of SCH 
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>   

      # Send BO for the created logical channel on RGU to trigger a PO. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      #send 2 TTIs one for scheduling and 1 for transmitting
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="10"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Apply GAP number of TTI before indicating a RaReq
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #  send an authorized raReq. Processing this, MAC shall
      # free the rapId to UE association and further raReq with
      # this rapId without a PDCCH Order shall be discarded by MAC.

      #Append a raReq for HO Ue as well as for some non-dedicated Prmbl Ue
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="3" rapIds="30:50:15"
               tpcs="1:1:1" cqiPres="TRUE:TRUE:TRUE" cqis="4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req rapIds="30:50" poUeId="11" hoUeId="0" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the non-Dedicated rapId delayed by 1 subfrm 
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req rapIds="15" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

   # expect a recp req for this UE.
   <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.24
#
#       Desc:    To test PDCCH Order generation for 1 Idle Ue with RACH Cfg as EVEN, 1 subframe.
#                To test UEs inactivity during PO Rach Procedure and Subsequent activity after
#                Ue successfully transmits uplink.
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.24">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test PDCCH Order generation for 1 Idle Ue with RACH Cfg as EVEN, 1 subframe.
          To test UEs inactivity during PO Rach Procedure and Subsequent activity after
          Ue successfully transmits uplink." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for 1 Idle Ue with RACH Cfg as EVEN, 1 subframe.
          To test UEs inactivity during PO Rach Procedure and Subsequent activity after
          Ue successfully transmits uplink."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.oneRaOccn numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="1" 
            sfnEnum="RGAC_RGR_SFN_EVEN" raOccSubFrameNum="3" raOccSize="1"/>

      # UE configuration
      <tapa.rg.UeInit ueId="0" taTmrPres="TRUE" taTmr="40" maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>    

      # Send BO for the created logical channel on RGU to trigger a PO
      # for both ues. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      #send 2 TTIs one for scheduling and 1 for transmitting
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
#Verify that NO Dl scheduling happens here, as UE is now Inactive due to PO.      
#No DstaInd Should be seen here.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #verify POs for these two UEs are generated in consecutive RA occasions.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" vldtTx="TRUE" vldtPO="TRUE" poRapId="30" prachMaskIdx="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  raRnti="1" numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req poUeId="11"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

   # expect a recp req for this UE.
   <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      #At this point UE0 which was idle should be activated
      #so expect DStaInd, for DL scheduling would have happened 
      #for the reported BO.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     
      # Expect HARQ ACK in PHICH
      <tapa.expset>
         <tapa.rgu.dstaind ueId="0" lchTb1Data="9" saveTo="2"/>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="9" ueId="0" lcId="9" lcType="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req  use="1" ueId="0" numSdu="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.25
#
#       Desc:   "To test the Failure scenario of MACs handling of CRC failure 
#                for MSG3." 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test the Failure scenario of MACs handling of CRC failure 
         for MSG3."
      </tapa.desc>

      <tapa.longdesc>
         "To test the Failure scenario of MACs handling of CRC failure 
         for MSG3. Send CRC failure indication for MSG3, verify that
         MSG3 is non-adaptively schedlued for retx by means of a RECPTN
         REQ."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Validate msg3 Recp for non-Adaptive RETX
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
           # Msg3 for ueId=0 is a non-adaptive retx
           <tapa.tfu.msg3.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.26
#
#       Desc:   "To test handling of multiple RAPIDs across sub-frames"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#       Patch:   ccpu00107640:Corrected RACH handling for multiple RAPIDs per RARNTI
#
<tapa.testcase id="3.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful handling of multiple RAPIDs across sub-frames."
      </tapa.desc>

      <tapa.longdesc>
         "RAPIDs shall be serviced across sub-frames"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
         <tapa.flag id="RGR_SI_SCH"/>
         <tapa.flag id="LTEMAC_HDFDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      # Configure minimum possible dlBW so that it will be occupied in the
      # first scheduling subframe completely by BCCH and PCCH data!
      <tapa.rg.cellInit dlTotalBw="23" cfi="3" bcchPchCodeRate="256"
         dlCcchCqi="3"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      # At start of this step, we are at (0,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (0,0)
      # Send BO for BCCH on DLSCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="2" lcType="1" bo="79" sfOffset="6" />
      </tapa.send>

      # At start of this step, we are at (0,0)
      # Send BO for PCCH
      <tapa.send>
         <tapa.rgu.cstarsp lcId="3" lcType="2" bo="79" sfOffset="6" />
      </tapa.send>
      
      # At start of this step, we are at (0,0)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (0,2)
      # Send RaReqInd for one raRnti = 1
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="1" numRapId="2" rapIds="18:35"
               timingAdvs="2:3" tpcs="1:2"
               cqiPres="TRUE:TRUE"
               cqis="12:13"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # At start of this step, we are at (0,2)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (0,3)
      # At the end of first TTI, expect CstaInd for BCCH on DLSCH and PCCH.
      <tapa.expset>
         <tapa.rgu.cstaind lcId="3"/>
         <tapa.rgu.cstaind lcId="2"/> 
      </tapa.expset>
      
      # At start of this step, we are at (0,3)
      # Send BCCH and PCCH data on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="0" lcId="2" lcType="1" bufSize="32"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.cdatreq bcchIdx="1" lcId="3" lcType="2" bufSize="32"/>
      </tapa.send>

      # At start of this step, we are at (0,4)
      # Send 1 TTI to get BCCH and PCCH data at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (0,5)
      # Expect BCCH and PCCH data from MAC to PHY
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="3">
        <tapa.tfu.pdcch.cntrl.req/>
        <tapa.tfu.pdcch.cntrl.req saveTo="2"/>
        <tapa.tfu.pdcch.cntrl.req saveTo="3"/>
     </tapa.tfu.cntrl.req>
   # Expect Msg4 from MAC to PHY.
     <tapa.tfu.dat.req datReqs="3">
        <tapa.tfu.rarsp.req  raRnti="1" expectAll="FALSE" vldtRar="TRUE"/>
        <tapa.tfu.pdsch.dat.req bcchIdx="0" ueId="0" use="2"/>
        <tapa.tfu.pdsch.dat.req bcchIdx="1"  ueId="1" use="3"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      # At start of this step, we are at (0,4)
      # Send 1 TTI before expecting Random access response 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # At start of this step, we are at (0,5)
      # UE1 starts expecting random access response at raRnti(=1) +
      # NumberofRaSubframes(=1) + RaRsp(=3) = 6 subframes after raReq
      # transmission
      # MAC shall send response delayed by 1 TTI and so after 3 TTIs(6 - TFU_UL_DELTA(=1)
      # - RG_DL_DELTA(=2)), MAC shall send it to PHY
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="1" expectAll="FALSE" vldtRar="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,5)bcdnr
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect MSG3 for ueId=1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req vldtMsg3Grant="TRUE" ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
         #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   # Expect ACK for ueId=0
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
    # Ending TC abruptly: rest of the steps not needed
    # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

# PHR handling for MSG3 */
#
#
#       Test:    3.27
#
#       Desc:   "To test the successful PHR handling for PHR recieved with MSG3
#                for CCCH SDU based contention resolution where UeCfg from RRC 
#                is received soon after reception of Msg3" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.27">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of PHR handling for MSG3 for CCCH 
         SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"
           addPhr="TRUE" phr="30"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtTpc="TRUE" tpcPositive="TRUE" isAccumulated="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.28
#
#       Desc:   "To test the successful PHR handling for PHR recieved with MSG3
#                for CCCH SDU based contention resolution where UeCfg from RRC 
#                is received after Msg4 is transmitted" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.28">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of PHR handling for CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, Msg4 and then UeCfg"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
                            tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" ueId="0"
           addPhr="TRUE" phr="15"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
   # At start of this step, we are at (1,3)
   <tapa.send>
      <tapa.tfu.tti.ind numTti="0" op="RG_ACC_PLUS" numTfuDelta="1"/>
   </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # At start of this step, we are at (2,1)
      # Send CDatReq on CCCH for the same rnti.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3"
                            sendNoMatter="TRUE"/>
      </tapa.send>

      # At start of this step, we are at (2,1)
      # Send stats req to know the failure
      <tapa.send>
         <tapa.lrg.stsreq elmntType="STRGUSAP"/>
      </tapa.send>
      
      # Expect stats to indicate a pdu drop
      <tapa.expect>
         <tapa.lrg.stscfm elmntType="STRGUSAP" numPduDrop="1"/>
      </tapa.expect>

      # At start of this step, we are at (2,1)
      # Send TTI to check if the are no pending msgs at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Therefore,Expect DCI format 0 due to PHR constraints
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtTpc="TRUE" tpcPositive="TRUE" isAccumulated="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.29
#
#       Desc:    Verify successful PHR handling for non-adaptive msg3
#       re-transmission
#
#       Notes:   None
#              
#       Module:  scheduler
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.29">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
         Verify successful PHR handling when recieved with non-adaptive MSG3
         re-transmission.
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
<!--
      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>
-->
      #Initialize CELL. Set ccchCqi and msgSizeGrpA such that 2 Subbands 
      #are taken for msg3 alloc.
      <tapa.rg.cellInit ulTotalBw="100" maxUlUeNewTxPerTti="10"
         dlSchdType="0" ulSchdType="0"/>
      #Initialize UE
      <tapa.rg.UeInit ueId="0" ueBr="3000" maxUlHqTx="4" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Optimally set UL CQI so that all the UEs get scheduled using 1 subband only.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="15"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="3">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     <tapa.send>
        <tapa.tfu.dat.ind datInds="1">
           <tapa.tfu.dat ueId="0" use="4" lcId="3" addShortBsr="TRUE" lcgId="0" bsr="20"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
         # Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req  expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="5" numRapId="2" rapIds="1:2"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5" rapIds="1:2" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" vldtGrant="TRUE" vldtRetx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="1" use="4" validate="TRUE" saveTo="5"/>
           <tapa.tfu.msg3.recp.req ueId="2" use="4" validate="TRUE" saveTo="6"/>
           <tapa.tfu.pusch.recp.req ueId="0" use="3" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

    #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat ueId="0" use="4" lcId="3"/>
          <tapa.tfu.dat ueId="1" use="5" isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>
    </tapa.send>

      <tapa.expset>
         # Expect datInd to go to RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

       # Send BO for Msg4 on RGU. 
       <tapa.send>
          <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="10"/>
       </tapa.send>

      #msg3 was scheduled for RETX Here

      # verify no more indications.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="1" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="1" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
  
      # Validate msg3 Recp for RETX
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="2" use="4" validate="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

    #Send CRC for Msg
    <tapa.send>
       <tapa.tfu.crc.ind>
          <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
       </tapa.tfu.crc.ind>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" use="6" isCcchSdu="TRUE" sduSize="6"
                        addPhr="TRUE" phr="30"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

    <tapa.expset>
         # Expect datInd to go to RLC
         <tapa.rgu.cdatind ueId="2" lcId="4"/>
      </tapa.expset>

       # Send BO for Msg4 on RGU. 
       <tapa.send>
          <tapa.rgu.cstarsp ueId="2" lcId="4" lcType="3" bo="10"/>
       </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="2" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="2" lcId="4" lcType="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq  ueId="1"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req ueId="2" use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="1"/>
     </tapa.tfu.cntrl.req>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="2"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq  ueId="2"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

     # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="2"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Send 2 TTIs to check no further indications from MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="2"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtTpc="TRUE" tpcPositive="TRUE" isAccumulated="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="2" use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" use="2" lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="2" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.30
#
#       Desc:    Verify successful handling of PHR when recieved with MSG
#       adaptive re-transmission.
#
#       Notes:   None
#              
#       Module:  scheduler
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.30">>>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
      "Verify successful PHR handling for adaptive MSG3 re-transmission."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
<!--
      <tapa.rg.dbgInitErr/>
      <tapa.rg.dbgInitParm/>
      <tapa.rg.dbgInitInfo/>
-->
      #Initialize CELL. Set ccchCqi and msgSizeGrpA such that 2 Subbands 
      #are taken for msg3 alloc.
      <tapa.rg.cellInit ulTotalBw="100" maxUlUeNewTxPerTti="10"
         dlSchdType="0" ulSchdType="0"/>
      #Initialize UE

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
      # Issue a RACH req such that its msg3 allocation collides with that of UEid=0's
      # msg3 retx allocation.
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="5" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="5" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   
      # msg3 retx would have been scheduled here
      # Expect Adaptive grant for UeId=0 for msg3 as it collides with msg3 TX resources
      # of UEID=1
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" vldtGrant="TRUE" vldtRetx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

      # Validate msg3 Recp for Adaptive RETX
      # Validate msg3 Recp for Initial TX
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2">
           # Msg3 for ueId=0 is an adaptive retx
           <tapa.tfu.msg3.recp.req ueId="0" use="3" vldtAdptRetx="TRUE" saveTo="5"/>
           <tapa.tfu.msg3.recp.req ueId="1" use="4" validate="TRUE" saveTo="6"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>
  
    #Send CRC for Msg
    <tapa.send>
       <tapa.tfu.crc.ind>
          <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
          <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
       </tapa.tfu.crc.ind>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

    <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat ueId="0" use="5" isCcchSdu="TRUE" sduSize="6"
             addPhr="TRUE" phr="30"/>
          <tapa.tfu.dat ueId="1" use="6" isCcchSdu="TRUE" sduSize="6"/>
       </tapa.tfu.dat.ind>
    </tapa.send>

      <tapa.expset>
         # Expect datInd to go to RLC
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

       # Send BO for Msg4 on RGU. 
       <tapa.send>
          <tapa.rgu.cstarsp ueId="0" lcId="4" lcType="3" bo="10"/>
       </tapa.send>

       <tapa.send>
          <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="10"/>
       </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind ueId="0" lcId="4"/>
      <tapa.rgu.cstaind ueId="1" lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req ueId="0" use="8" validate="FALSE"/>
        <tapa.tfu.pdsch.dat.req ueId="1" use="9" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="8"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="9"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq  ueId="0"/>
        <tapa.tfu.hq  ueId="1"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

     # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.crg.cfgcfm/>
      <tapa.crg.cfgcfm/>
   </tapa.expset>

   # Send UE config request
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
   </tapa.send>

   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expset>
      <tapa.rgr.cfgCfm instId="5"/>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expset>

   # Send 2 TTIs to check no further indications from MAC
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
             vldtTx="TRUE" vldtTpc="TRUE" tpcPositive="TRUE" isAccumulated="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.31
#
#       Desc:   "To test the successful handling of Msg4 reject"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of reject in Msg4"
      </tapa.desc>

      <tapa.longdesc>
         "Default Max DL retransmissions is 4. After 2 retransmissions, send a UE del
         request, triggering a MSG4 rejection. Now send the HqFeed back Ind as NACK for
         the second retransmission. Verify that no more retransmissions happen."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

      # Send Msg4 reject by means of sending a UE del before UE cfg.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>
      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Verify no further retransmissions.
   <tapa.send>
      <tapa.tfu.tti.ind numTti="10" />
   </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.32
#
#       Desc:   "To test handling of Msg4 Retransmission scenario
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.32">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of Msg4 retransmission scenario"
      </tapa.desc>

      <tapa.longdesc>
         "When maxMsg4HqTx is set >1, and there is a NACK sent across by the UE
        a retransmission has to be done for the Msg4 by the MAC. Since the msg4
        HARQ Entity is not in the 'inUse' list, MAC should refrain from deleting it.
        This test case is written to handle the above scenario which was 
        reported through CCPU00113296"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit maxMsg4HqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #Expect MSG4 retx.
   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   # Verify no further retransmissions.
   <tapa.send>
      <tapa.tfu.tti.ind numTti="10" />
   </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
############# Random Access Cases ##############
#
#
#       Test:    3.33
#
#       Desc:   "To test successfull transmission Contention REsolution CE
#               and transmission of CCCH SDU after that." 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.33">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test successfull transmission Contention REsolution CE
      and transmission of CCCH SDU after that." 
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" contResTmr="35"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

   
      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" />
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

############# Random Access Cases ##############
#
#
#       Test:    3.34
#
#       Desc:   "To test the processing of CR timer expiry."
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.34">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test the processing of CR timer expiry."
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" contResTmr="35"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <!--
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
-->
      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <!--
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      -->
      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <!--
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

   -->
      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" />
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
<!--
   #Expect MSG4 retx.
   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" />
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
-->
      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
############# Random Access Cases ##############
#
#
#       Test:    3.35
#
#       Desc:   "To check re-transmission of of CCCH SDU"
#               
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To check re-transmission of CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
         "To check re-transmission of CCCH SDU"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" contResTmr="35"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

   
      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" />
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" />
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
############# Random Access Cases ##############
#
#
#       Test:    3.36
#
#       Desc:   "To test successfull downlink scenario after transmission
#                of the CCCH SDU."
#               
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test successfull downlink scenario after successfull 
      transmission of CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" contResTmr="35"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

   
      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" />
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

############# Random Access Cases ##############
#
#
#       Test:    3.37
#
#       Desc:   "To check successfull downlink scenario after
#                re-transmission of of CCCH SDU"
#               
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To check successfull downlink scenario after
      re-transmission of of CCCH SDU"
      </tapa.desc>

      <tapa.longdesc>
         "To check re-transmission of CCCH SDU"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>
      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" contResTmr="35"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

   
      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" />
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" />
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h)
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="9" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="9" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="9" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="9" lcId="9" chkSdu="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.38
#
#       Desc:   "To check the behaviour if UE Cfg is done after CCCH SDU is
#                sent"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "To test successfull transmission Contention REsolution CE
      and transmission of CCCH SDU after that." 
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isDlFreqSel="1" contResTmr="35"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <!--
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
-->
      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

   
      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Should not receive any Status Indication as UE should be configured
      # before sending CCCH SDU if Contention Resolution timer is running.
      <tapa.timeout/>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.39
#
#       Desc:    To test successful backoff indication with zero RAR responses. 
#
#       Notes:   None
#              
#       Module:  Back Off Indicator.
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.39">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful backoff indication." 
      </tapa.desc>

      <tapa.longdesc>
         "To test successful backoff indication. 
         Adjust the maxMsg3perUlSf , such
         that only 2 RAPIDs get the RAR grant in RAR window. Hence when 5 UEs
         are contending, BI value of 3 (index 1) is indicated by MAC at 
         subsequent scheduling instance which is the end of RaResp window."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns maxMsg3PerUlSf="1" raWinSize="5"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
     #Send more RapIds such that with the above config all the RAPIDs will not 
     #responed with RAR and BI will be triggered
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="5" rapIds="1:2:3:4:5" 
            timingAdvs="3:3:3:3:3" tpcs="1:1:1:1:1" /> 
         </tapa.tfu.rareq.ind>
      </tapa.send>

     # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1" expectAll="FALSE" bi="TRUE" biVal="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 
      
      #Making sure that left out 3 RAPIDs are not scheduled after window
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req >
            <tapa.tfu.msg3.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # ignoring further message flow validations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.40
#
#       Desc:    To test successful backoff indication with maximum RAR Window
#        and higher preamble format
#
#       Notes:   None
#              
#       Module:  Back Off Indicator.
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.40">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful backoff indication with 9 RAR's and 1 backed off." 
      </tapa.desc>

      <tapa.longdesc>
         "To test successful backoff indication. 
         Configure maxMsg3perUlSf as such that 1 UE get the RAR grant 
         in each subframe and remaining 1 UE backed off out of 10
         contending UE's. Configure bigger RAR window and higher preamble format"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration ulTotalBw as 40 to satusfy only 5 RAR's
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleFormat="3" raWinSize="10" maxMsg3PerUlSf="1"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="10" rapIds="1:2:3:4:5:6:7:8:9:10" 
            timingAdvs="3:3:3:3:3:3:3:3:3:3" tpcs="1:1:1:1:1:1:1:1:1:1"/> 
         </tapa.tfu.rareq.ind>
      </tapa.send>

     # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1" expectAll="FALSE" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="2" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="3" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="4" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="5" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="6" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="7" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="0"/>
        </tapa.tfu.recp.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="8" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="1"/>
        </tapa.tfu.recp.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="9" expectAll="FALSE" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.msg3.recp.req ueId="2"/>
        </tapa.tfu.recp.req>
      </tapa.expset> 

      # ignoring further message flow validations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.41
#
#       Desc:    To test successful backoff indication Without any bi and serving all RAP IDs.
#
#       Notes:   None
#              
#       Module:  Back Off Indicator.
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.41">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful backoff indication Without any bi and serving all RAP IDs"
      </tapa.desc>

      <tapa.longdesc>
         "To test successful backoff indication. 
         Configure maxMsg3perUlSf as such that all UEs get RAR within 
         the window and no BI."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration ulTotalBw as 80 to statisf all RapId's in RAR grant
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            maxMsg3PerUlSf="4" raWinSize="4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="8" rapIds="1:2:3:4:5:6:7:8" 
            timingAdvs="3:3:3:3:3:3:3:3" tpcs="1:1:1:1:1:1:1:1"/> 
         </tapa.tfu.rareq.ind>
      </tapa.send>

     # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1:2:3:4" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="5:6:7:8" expectAll="FALSE" bi="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
            <tapa.tfu.msg3.recp.req ueId="2"/>
            <tapa.tfu.msg3.recp.req ueId="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="4"/>
            <tapa.tfu.msg3.recp.req ueId="5"/>
            <tapa.tfu.msg3.recp.req ueId="6"/>
            <tapa.tfu.msg3.recp.req ueId="7"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # ignoring further message flow validations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    3.42
#
#       Desc:    To test successful backoff indication, with increasing value 
#                of BI when unserved UE's count increses 
#
#       Notes:   None
#              
#       Module:  Back Off Indicator.
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.42">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful backoff indication, with increasing value 
          of BI when unserved UE's count increses"
      </tapa.desc>

      <tapa.longdesc>
         "To test successful backoff indication. 
         Configure maxMsg3perUldsf as such that 1 UE get the RAR grant 
         and remaining backed off out of 10
         contending UE's. Then again send 10 more UE's for RACH again serve only
         1 UE now Bi val should increased by 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration ulTotalBw as 80 to statisf all RapId's in RAR grant
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20" raWinSize="4"
            raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10" maxMsg3PerUlSf="1"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="10" rapIds="1:2:3:4:5:6:7:8:9:10" 
            timingAdvs="3:3:3:3:3:3:3:3:3:3" tpcs="1:1:1:1:1:1:1:1:1:1"/> 
         </tapa.tfu.rareq.ind>
      </tapa.send>

     # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="10" rapIds="2:3:4:5:6:7:8:9:10:11" 
            timingAdvs="3:3:3:3:3:3:3:3:3:3" tpcs="1:1:1:1:1:1:1:1:1:1" />
         </tapa.tfu.rareq.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1" expectAll="FALSE" bi="TRUE" biVal="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="10" rapIds="1" expectAll="FALSE" bi="TRUE" biVal="2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset> 

      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
      # ignoring further message flow validations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.43
#
#       Desc:   "To test handling of Msg4 Retransmission scenario
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.43">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Handling of Msg4 retransmission scenario"
      </tapa.desc>

      <tapa.longdesc>
         "When maxMsg4HqTx is set >1, and there is a NACK sent across by the UE
        a retransmission has to be done for the Msg4 by the MAC. Since the msg4
        HARQ Entity is not in the 'inUse' list, MAC should refrain from deleting it.
        This test case is written to handle the above scenario which was 
        reported through CCPU00113296"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit maxMsg4HqTx="4"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" />
       </tapa.tfu.dat.ind>      
   </tapa.send>   
   

   # Expect Message3 datReq on CCCH at RGU.
   <tapa.expect>
      <tapa.rgu.cdatind lcId="4"/>
   </tapa.expect>
   
    # Send BO for Msg4 on RGU. 
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/> 
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU. 
   <tapa.send>
      <tapa.rgu.cdatreq lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  
   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>
   <!--
   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
  --> 
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>

   #Expect MSG4 retx.
   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="2"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send DTX as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TFU_HQ_DTX"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   
   #Expect MSG4 retx.
   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="2"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send NACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="2" />
   </tapa.send>
   
   #Expect MSG4 retx.
   <tapa.expset>
      # Expect PDU from MAC to PHY.
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="3"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>
  

   # Recv Hq Recp Req for Msg4. 
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq isAck="TRUE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
<!-- test that a large ccchCqi does not cause
    iMcs to be greater than 15 -->
#
#
#       Test:    3.44
#
#       Desc:   "To test the successful CCCH SDU based contention resolution 
#               where UeCfg from RRC is received soon after reception of Msg3.
#               Further, ccchCqi is configured such that iMcs for Msg3 would
#               be greater than max" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.44">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, UeCfg and then Msg4.Furhter,
          ccchCqi is configured such that iMcs for Msg3 would be greater than
          max."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ccchCqi="12"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
            tpcs="1" />
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
   
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req validate="TRUE" chkCcchSh="TRUE"/>
     </tapa.tfu.dat.req>   
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.45
#
#       Desc:   "To test that raCb is deleted if ueCb is also deleted"
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.45">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "To test that raCb is deleted if ueCb is also deleted"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      #Send UE deletion from application now
      <tapa.send>
         <tapa.rgr.cfgreq.del ueId="0" instId="5" DelType="2"/>
      </tapa.send>
      
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
    
      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to make sure that there is no scheduling
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
   
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#To verify the scenario for ticket ccpu00125212
#
#
#       Test:    3.46
#
#       Desc:   "To test the RAR/BI is not scheduled if the UE is sending
#                dedicated preamble for initial attach
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.46">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful scenario of CCCH SDU based contention resolution"
      </tapa.desc>

      <tapa.longdesc>
         "Order in which msgs are received: Msg3, Msg4 and then UeCfg"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration with rawinSize = 10 subframes
      <tapa.rg.cellInit raWinSize="2" dlTotalBw="6"/>
      <tapa.rg.dbgDeInitAll/>
      #<tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId which unauthorised
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="1" rapIds="63"
               timingAdvs="3" tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      #eNB should send RAR 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

/* To verify the issue ccpu00131941 */
#
#
#       Test:    3.47
#
#       Desc:   "To test the transmission of CCCH SDU and DTCH(RATYPE 2)
#                in same TTI" 
#
#       Notes:   None
#              
#       Module:  "Random Access Module"
#
#       File:    rgac_tc3.xml
#
#
<tapa.testcase id="3.47">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
          "To test transmission of CCCH SDU and DTCH with RATYPE 2 
           in same TTI.
           Test fix for ccpu00131941" 
      </tapa.desc>

      <tapa.longdesc>
         " To test the raType2 RB allocation When CCCH SDU and DTCH data
           are scheduled in the same TTI "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RGR_V1"/>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlTotalBw="50" contResTmr="35" />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="2" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="2" rapIds="1:2" timingAdvs="3:3" 
                            tpcs="1:1" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1" rapIds="1:2"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

      # Delay Msg4 StaRsp
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      # At start of this step, we are at (1,0)
      # Send UE config request from RRC in the same subframe as that of Msg3
      # reception but after msg3
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>
      # reception but after msg3
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5"/>
      </tapa.send>
      # At start of this step, we are at (1,0)
      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" />
      </tapa.send>


      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="2">
        <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3"/>
        <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="4"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="2">
        <tapa.tfu.pdsch.dat.req use="3" ueId="0" chkSdu="TRUE" lcId="28"/>
        <tapa.tfu.pdsch.dat.req use="4" ueId="1" chkSdu="TRUE" lcId="28"/>
     </tapa.tfu.dat.req>   
   </tapa.expset>
      
      # At start of this step, we are at (1,3)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/> 
      </tapa.send>
      
      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="2">
           <tapa.tfu.hq.recp.req ueId="0"/>
           <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>
      
      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4. 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0"/>
            <tapa.tfu.hq ueId="1"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # At start of this step, we are at (1,1)
      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp ueId="0" lcId="4" lcType="3" bo="10"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send TTIs to validate that there are no pending messages at MAC 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1" TTI="400"/>
      </tapa.send>
      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.expset>
         <tapa.rgu.cstaind ueId="0" lcId="4"/>
         <tapa.rgu.cstaind ueId="1" lcId="4"/>
      </tapa.expset>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.pdsch.dat.req use="3" ueId="0" chkCcchSh="TRUE"/>
           <tapa.tfu.pdsch.dat.req use="4" ueId="1" chkCcchSh="TRUE"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      # LTE-MAC layer shutdown
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    3.48
#
#       Desc:    To test successful backoff indication. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.48">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful backoff indication." 
      </tapa.desc>

      <tapa.longdesc>
         "To test successful backoff indication. 
         Adjust maxMsg3PerUlSf, such
         that only 2 UEs get the RAR grant at a time. Hence when 10 UEs
         are contending, BI value of 4 UEs is indicated by MAC at 
         subsequent scheduling instance which is the end of RaResp window."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns maxMsg3PerUlSf="2" numRaPreamble="30" sizeRaPreambleGrpA="25"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"
            raWinSize="5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="5" rapIds="1:2:3:4:5" 
            timingAdvs="3:3:3:3:3" tpcs="1:1:1:1:1" 
            cqiPres="TRUE:TRUE:TRUE:TRUE:TRUE" 
            cqis="4:4:4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="3" rapIds="6:7:8" 
            timingAdvs="3:3:3" tpcs="1:1:1" 
            cqiPres="TRUE:TRUE:TRUE" 
            cqis="4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1:2" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="3:4" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="2">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="5" expectAll="FALSE" />
           <tapa.tfu.rarsp.req raRnti="10" rapIds="6" expectAll="FALSE" />
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req/>
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="7:8" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="2"/>
            <tapa.tfu.msg3.recp.req ueId="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="4"/>
            <tapa.tfu.msg3.recp.req ueId="5"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="6"/>
            <tapa.tfu.msg3.recp.req ueId="7"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.49
#
#       Desc:    To test successful backoff indication. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.49">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful backoff indication." 
      </tapa.desc>

      <tapa.longdesc>
         "To test successful backoff indication. 
         Adjust maxMsg3PerUlSf, such
         that only 2 UEs get the RAR grant at a time. Hence when 10 UEs
         are contending, BI value of 4 UEs is indicated by MAC at 
         subsequent scheduling instance which is the end of RaResp window."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      # Modified for SI Enhancement*/
      <tapa.ifndef>
      </tapa.ifndef>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns maxMsg3PerUlSf="2" numRaPreamble="30" sizeRaPreambleGrpA="25"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"
            raWinSize="5"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

         # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="9" numRapId="10" rapIds="61:2:63:4:5:62:7:8:9:10" 
            timingAdvs="3:3:3:3:3:3:3:3:3:3" tpcs="1:1:1:1:1:1:1:1:1:1" 
            cqiPres="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
            cqis="4:4:4:4:4:4:4:4:4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the 
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="1:2" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="3:4" expectAll="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="9" rapIds="5:6" expectAll="FALSE" bi="TRUE" biVal="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We 
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="0"/>
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="2"/>
            <tapa.tfu.msg3.recp.req ueId="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.msg3.recp.req ueId="4"/>
            <tapa.tfu.msg3.recp.req ueId="5"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # ignoring further message flow validations
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    3.50
#
#       Desc:    To test successful handover scenario. 
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc6.xml
#
#
<tapa.testcase id="3.50">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "To test successful handover scenario." 
      </tapa.desc>

      <tapa.longdesc>
         "To test PDCCH Order generation for an Idle Ue.
         Non Ded Preams are from 0 to 29, PO ded preambles are from 30 to 49.
         Configure a HO Ue with dedPreamble Id as 50"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
   
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.allRaOccns numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   # Send UE config request
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue cellId="3"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request with rnti not belonging to the configured rnti pool of SCH 
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" cellId="3" dedPrmblPrsnt="TRUE" dedPrmblId="50"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>

   # Expect failure in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # send raReq with the alloted rapId
   <tapa.send>
      <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
         <tapa.tfu.rareq  numRapId="2" rapIds="50:61"
            tpcs="1:1" cqiPres="TRUE:TRUE" cqis="4:5"/>
      </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect RaResp for the rapId sent in RaReq
   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.rarsp.req hoUeId="0" expectAll="FALSE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>
      
   <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="0"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#/********************************************************************30**
#
#         End of file:
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#$SID$         ---     ps   1. Initial Release.
#             rg004.201 rnt  1. Modified for SI Enhancement
#             rg005.201 sm  1. Changes maxMsg3Tx value to 2 instead of 1
#             rg006.201 ms    1. ccpu00111742: Sending NACK in PHICH for failed UL TX
#             rg008.201 dv  1. ccpu00113296: Msg4 Retx scenario. Test case:3.32
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg001.301    nudupi   1. Modified the test case for the incorporation of the Changes that corresponding to the CR ccpu00118788. 
#$SID$        rg002.301    asehgal 1. added test cases for ccpu00119494,ccpu00120703.
#$SID$      ---        rt  1. LTE MAC 4.1 Release
#*********************************************************************91*/
#
