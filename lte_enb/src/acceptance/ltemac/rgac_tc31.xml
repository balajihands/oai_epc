#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases for UL PFS Scheduler
#
#     File:    rgac_tc31.xml
#
#     Sid:     rgac_tc31.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#     Prg:     sprasad
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:hn:rgac_tc31.xml


#
#
#       Test:    31.1 - 33
#
#       Desc:   Verify that PFS schedules 4 UEs in the same TTI.
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.1">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that UL PFS schedules 4 UEs in the same TTI" 
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4"/>

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

     # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
           <tapa.tfu.sr ueId="2"/>
           <tapa.tfu.sr ueId="3"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req expRecpReq="4">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"/>
        <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"/>
        <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#
#       Test:    31.2 - 34
#
#       Desc:   Verify that UL PFS schedules 3 UEs when PDCCH resource are insufficient
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that UL PFS schedules 3 UEs when PDCCH resource are insufficient"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4" cfi="1"/>

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind> 
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="11"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="12"/>
            <tapa.tfu.ulcqi ueId="2" isWideBand="TRUE" wideCqi="13"/>
            <tapa.tfu.ulcqi ueId="3" isWideBand="TRUE" wideCqi="14"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="4">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="40" />
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" bsr="32" />
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" bsr="32" />
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" bsr="50" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
         #  <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 -->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    31.3 - 38
#                     - 88
#                     - 89
#
#       Desc:   Verify that PFS schedules 4 UEs for re-transmission in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules 4 UEs for re-transmission in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4"/>

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind> 
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="11"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="12"/>
            <tapa.tfu.ulcqi ueId="2" isWideBand="TRUE" wideCqi="13"/>
            <tapa.tfu.ulcqi ueId="3" isWideBand="TRUE" wideCqi="14"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="4">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="20" />
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" bsr="20" />
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" bsr="20" />
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="1"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    31.4 - 35
#
#       Desc:   Verify that PFS schedules 4 SPS UEs in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules 4 SPS UEs in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4" maxSpsUePerDlSf="4"
         DLSPSMaxBw="50" maxSpsUePerUlSf="4" numTxAntPorts="2" />

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="67"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="68"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    31.5 - 37
#
#       Desc:   Verify that PFS schedules 3 SPS UEs when PDCCH resources are less
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules 3 SPS UEs when PDCCH resources are les"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4"
         maxSpsUePerDlSf="4" DLSPSMaxBw="50" maxSpsUePerUlSf="4" 
         numTxAntPorts="2" />

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="67"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="68"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gbr="2000" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" lcgId="1" bsr="15" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" lcgId="1" bsr="15" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" lcgId="1" bsr="15" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" lcgId="1" bsr="19" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

<!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8" />
         </tapa.tfu.recp.req>   
      </tapa.expset>
-->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    31.6 - 36
#
#       Desc:   Verify that PFS schedules 2 SPS UEs and 2 non-SPS UEs in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules 2 SPS UEs and 2 non-SPS UEs in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" DLSPSMaxBw="50" maxUePerDlSf="4"
         maxSpsUePerDlSf="4" maxSpsUePerUlSf="4" 
         numTxAntPorts="2" />

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" dir="1" ulQci="9" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" dir="1" ulQci="9" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    31.7 - 31
#
#       Desc:   Verify that PFS schedules 2 SPS UEs and 1 non-SPS UEs in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules 2 SPS UEs and 1 non-SPS UEs in the same TTI when PDCCH resources are insufficient"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" DLSPSMaxBw="50" maxUePerDlSf="4"
         maxSpsUePerDlSf="4" maxSpsUePerUlSf="4" 
         numTxAntPorts="2" />

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>
<!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7" />
            #<tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8" />
         </tapa.tfu.recp.req>   
      </tapa.expset>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
            #<tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    31.8 - 39
#
#       Desc:   Verify that PFS schedules re-transmissions for 4 SPS UEs in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules re-transmissions for 4 SPS UEs in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" DLSPSMaxBw="50" maxUePerDlSf="4"
         maxSpsUePerDlSf="4" maxSpsUePerUlSf="4" 
         numTxAntPorts="2" />

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="67"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="68"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      ########## For re-transmission
      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    31.9 - 40
#
#       Desc:   Verify that PFS schedules re-transmission of 2 SPS UEs and 2 non-SPS UEs in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules re-transmission of 2 SPS UEs and 2 non-SPS UEs in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" DLSPSMaxBw="50" maxUePerDlSf="4"
         maxSpsUePerDlSf="4" maxSpsUePerUlSf="4" 
         numTxAntPorts="2" />

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4"
            ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="66"
            SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_10SF" numSPSproc="1"
            txModeEnum="RGR_UE_TM_3" ULSPSimpRls="2"  prdBsrTmr="65535"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="1" ulQci="9" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" gbr="2000" lcgId="1" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="3">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" lcgId="1" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="6" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
            <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="5"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="6"
               isSPSOcc="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="7" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="8" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    31.10 - 77
#
#       Desc:   Verify that PFS schedules 2 UEs in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules 2 UEs in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4"/>

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   31.11 - 101
#
#       Desc:   Verify that PFS schedules re-transmission of 3 non-SPS UEs and new
#               transmission of 1 non-SPS UE in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules re-transmission of 3 non-SPS UEs and new transmission of 1 non-SPS UE in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4"/>

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="4">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="3">
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

     <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="1"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            #<tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="1"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      -->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   31.12 - 102
#
#       Desc:   Verify that PFS schedules re-transmission of 2 non-SPS UEs and new
#               transmission of 2 non-SPS UE in the same TTI
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#
<tapa.testcase id="31.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that PFS schedules re-transmission of 2 non-SPS UEs and new transmission of 2 non-SPS UE in the same TTI"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4"/>

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="4">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="3" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="2">
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" bsr="12" />
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" bsr="12" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

     <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="1"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="3">
            #<tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="1"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      -->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   31.13 - 112
#
#       Desc:   Verify that 4 UEs are scheduled in ascending order based on CQI and BSR
#
#       Notes:   None
#              
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#<tapa.testcase id="31.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that 4 UEs are scheduled in ascending order based on CQI and BSR"
      </tapa.desc>

      <tapa.longdesc>

      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="RG_PHASE2_SCHED"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit
         dlSchdType="1" ulSchdType="1" maxDlUeNewTxPerTti="4"
         maxUlUeNewTxPerTti="4" maxUePerDlSf="4"/>

      # UE Creation
      <tapa.rg.4UeRrInit.mwcDemo/>

      # Send UE config request
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="0" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="1" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="2" instId="5" maxUlHqTx="4" />
      </tapa.send>
      <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue ueId="3" instId="5" maxUlHqTx="4" />
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instId="5"/>
         <tapa.rgr.cfgCfm ueId="1" instId="5"/>
         <tapa.rgr.cfgCfm ueId="2" instId="5"/>
         <tapa.rgr.cfgCfm ueId="3" instId="5"/>
      </tapa.expset>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #UE1 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #UE2 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE3 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="2" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="2" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="2" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      #UE4 Configuration
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="3" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="3" lcId="1" dir="1" lcType="5" instid="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="3" lcgId="0" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.ulcqi.ind> 
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="14"/>
            <tapa.tfu.ulcqi ueId="1" isWideBand="TRUE" wideCqi="13"/>
            <tapa.tfu.ulcqi ueId="2" isWideBand="TRUE" wideCqi="12"/>
            <tapa.tfu.ulcqi ueId="3" isWideBand="TRUE" wideCqi="11"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="4">
          <tapa.tfu.dat ueId="0" addShortBsr="TRUE" bsr="40" />
          <tapa.tfu.dat ueId="1" addShortBsr="TRUE" bsr="20" />
          <tapa.tfu.dat ueId="2" addShortBsr="TRUE" bsr="20" />
          <tapa.tfu.dat ueId="3" addShortBsr="TRUE" bsr="25" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="3" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <!--
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" />
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="1" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="2" isFailure="TRUE"/>
            <tapa.tfu.crc ueId="3" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="2" isAck="FALSE"/>
           <tapa.tfu.phich.cntrl.req ueId="3" isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="4">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="6" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="2" saveTo="7" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="3" saveTo="8" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="4">
            <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="1"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.pusch.recp.req ueId="2" use="3" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.pusch.recp.req ueId="3" use="4" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      -->

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:   31.14 - 112
#
#       Desc:   
#
#       Notes:   None
#
#       Module:  PFS SCH
#
#       File:    rgac_tc31.xml
#
#<tapa.testcase id="31.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="scheduler"/>

      <tapa.desc>
           "Configure 2 UEs with QCI 6 and QCI 9 present in same LCG respectively.
           Update BSR and validate that QCI 6 should be scheduled"  
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>
      
      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20" maxUlUeNewTxPerTti="2" maxUePerDlSf="2" ulThroughputFactor="0" ulFairnessFactor="0" 
         dlSchdType="1" ulSchdType="1"/>

      #Initialize UE
      <tapa.rg.UeInit ueId="0" ueCatEnum="3"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
         #dlAmbr="15000"/>
      <tapa.rg.UeInit ueId="1" ueCatEnum="3"
         prdModeEnumPres="TRUE" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for UE 1 and UE 2 (non-GBR) 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="3" dir="3" lcType="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE (non-GBR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="3" dir="3" lcType="4" ulQci="9" instid="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="3" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instid="5"/>
         <tapa.rgr.cfgCfm ueId="0" instid="5"/>
      </tapa.expset>

      # Configure bi-directional DTCH for default UE (non-GBR)
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="3" dir="3" lcType="4" ulQci="6" instid="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="3" instid="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0" instid="5"/>
         <tapa.rgr.cfgCfm ueId="0" instid="5"/>
      </tapa.expset>

     # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
      
      # Send one TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="2" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="3"/>
        <tapa.tfu.pusch.recp.req ueId="1" use="2" vldtDatRecp="TRUE" saveTo="4"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 

     <tapa.send>
        <tapa.tfu.dat.ind datInds="2">
           <tapa.tfu.dat ueId="0" use="3" lcId="3" addShortBsr="TRUE" lcgId="3" bsr="42"/>
           <tapa.tfu.dat ueId="1" use="4" lcId="4" addShortBsr="TRUE" lcgId="3" bsr="42"/>
        </tapa.tfu.dat.ind>
     </tapa.send>

      <tapa.expset>
          #Expect DatInd at RLC
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1"/>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1"/>
      </tapa.expset>

      # Send one TTI  (4 (TTIs to get the feedback) - TFU_DELTA (=2) - 1
      # (TFU_UL_DELTA that elapsed in giving datInd to MAC from PHY)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
    
      # verify grnt is recieved for UEs with higher LCG priority  
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req ueId="0" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" isUlGrant="TRUE" vldtTx="TRUE" saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend
 
#/********************************************************************30**
#
#         End of file:     rgac_tc31.xml $SID$
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#$SID$
#*********************************************************************91*/

