#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases For TDD SPS 
#
#     File:    rgac_tc33.xml
#
#     Sid:     rgac_tc33.xml@@/main/1 - Thu Sep 02 01:11:03 2014
#
#     Prg:     ns 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:hn:rgac_tc33.xml

###REVANTH_SPS_CASES_START
###############################################################################
#
#       Test:    33.1
#
#       Desc:   " TC_MAC_TDD_SPS_1 To test basic DL SPS path for a UE(15) in TDD"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.1" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
  
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#       Test:    33.2
#
#       Desc:   "TC_MAC_TDD_SPS_2 Verify successful configuration of Cell for SPS."
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
<tapa.testcase id="33.2" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify successful configuration of Cell for SPS."
      </tapa.desc>

      <tapa.longdesc>
         "Verify successful configuration of Cell for SPS."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
   </tapa.cfg>

   <tapa.test>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit DLSPSMaxBw = "40" dlTotalBw="50" />

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.3
#
#       Desc:   " TC_MAC_TDD_SPS_3 Verify unsuccessful configuration of DL UE SPS 
#                Parameters at Scheduler during UE Configuration when it has invalid periodicity.UL DL CFG 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.3" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify unsuccessful configuration of DL UE SPS UL DL CFG 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify unsuccessful configuration of DL UE SPS UL DL CFG 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1
      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="32" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



#
#       Test:    33.4
#
#       Desc:   "TC_MAC_TDD_SPS_4 Verify unsuccessful configuration of Cell for SPS. SPS BW > DL BW"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
<tapa.testcase id="33.4" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify unsuccessful configuration of Cell for SPS.  SPS BW > DL BW"
      </tapa.desc>

      <tapa.longdesc>
         "Verify unsuccessful configuration of Cell for SPS.  SPS BW > DL BW"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
   </tapa.cfg>

   <tapa.test>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration

      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>
      
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>
<!--
      #Send Bind Request for RGM SAP 
      <tapa.send>
         <tapa.rgm.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgm.bndcfm/>
      </tapa.expect>
 -->
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      
      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>


      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq instId="0"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0" instId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" ulDlCfgIdx="1" numCmnLc="5"  DLSPSMaxBw = "60" dlTotalBw="50"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" />
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>



   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.5
#
#       Desc:   " TC_MAC_TDD_SPS_5:Verify successful boundary case configuration of DL UE SPS 
#               Parameters at Scheduler during UE Configuration. Parameter shall 
#               have max values. List of Params shall have maximum entries in the list. UL DL cfg 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.5" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify successful boundary case configuration of DL UE SPS params ul dl cfg 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify successful boundary case configuration of DL UE SPS params ul dl cfg 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />

    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1
      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5"  ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
   NumPucchVal="4" n1PucchVal0="2047" n1PucchVal1="2044" n1PucchVal2="2045"  n1PucchVal3="2046" DLSpsExpltRelCnt="4" DLSPSSchIntrv="640" NumSPSProc="8"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>


    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.6
#
#       Desc:   " TC_MAC_TDD_SPS_6 Verify unsuccessful configuration of DL UE SPS Parameters 
#       at Scheduler during UE Configuration when it has invalid number of Harq Processes. UL DL cfg 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.6" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "invalid number of Harq Processes. UL DL cfg 1"
      </tapa.desc>

      <tapa.longdesc>
         "invalid number of Harq Processes. UL DL cfg 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="0"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.7
#
#       Desc:   " TC_MAC_TDD_SPS_7 Verify unsuccessful configuration of DL UE SPS Parameters 
#              at Scheduler during UE Configuration when it has invalid SPS RNTI. UL DL CFG 1 
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.7" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="10" startRnti="70" numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

### UL DL CFG 1
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="75" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.8
#
#       Desc:   " TC_MAC_TDD_SPS_8 Verify unsuccessful reconfiguration of DL UE SPS Parameters 
#              at Scheduler during UE Configuration when it has invalid SPS RNTI. UL DL cfg 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.8" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="10" startRnti="70"  numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

### UL DL CFG 1
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="FALSE" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  oldUeId="0" UeReCfgType="32768" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="75" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.9
#
#       Desc:   " TC_MAC_TDD_SPS_9 To test configuration of only 1 SPS service per UE
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.9" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "15"/>
      </tapa.expect>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>




###############################################################################
#
#       Test:    33.10
#
#       Desc:   " TC_MAC_TDD_SPS_10 : Verify successful recfg of both UL and DL SPS params
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.10" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL and UL sps recfg"
      </tapa.desc>

      <tapa.longdesc>
         "Verify successful recfg of both UL and DL sps params"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="FALSE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
      SPSSchIntrv="10" ULSPSSchIntrv="RGR_SPS_PRD_20SF" numSPSproc="1"
      txModeEnum="RGR_UE_TM_3" ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2"
      oldUeId="0" UeReCfgType="98304" instId="5" />
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>


      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.11
#
#       Desc:   " TC_MAC_TDD_SPS_11 Verify unsuccessful reconfiguration of DL UE SPS Parameters 
#              at Scheduler during UE Configuration when it has invalid periodicity
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.11" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Un successful reconfig due to invalid sps periodicity "
      </tapa.desc>

      <tapa.longdesc>
         "Un successful reconfig due to invalid sps periodicity "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="10" startRnti="70"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="FALSE" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  oldUeId="0" UeReCfgType="32768" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="32" NumSPSProc="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



#
#       Test:    33.12
#
#       Desc:   "TC_MAC_TDD_SPS_12 Verify unsuccessful configuration of Cell for SPS. SPS BW > DL BW UL DL CFG 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
<tapa.testcase id="33.12" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify unsuccessful configuration of Cell for SPS.  SPS BW > DL BW UL DL CFG 2"
      </tapa.desc>

      <tapa.longdesc>
         "Verify unsuccessful configuration of Cell for SPS.  SPS BW > DL BW UL DL CFG 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
   </tapa.cfg>

   <tapa.test>
      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration

      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>
      
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>
<!--
      #Send Bind Request for RGM SAP 
      <tapa.send>
         <tapa.rgm.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgm.bndcfm/>
      </tapa.expect>
 -->
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>
      
      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>


      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq instId="0"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0" instId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Expect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      
      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"  DLSPSMaxBw = "60" dlTotalBw="50"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0" />
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>



   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.13
#
#       Desc:   " TC_MAC_TDD_SPS_13:Verify successful boundary case configuration of DL UE SPS 
#               Parameters at Scheduler during UE Configuration. Parameter shall 
#               have max values. List of Params shall have maximum entries in the list. 
#               UL DL config 2
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.13" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Boundary case verification of config params : ul dl config idx 2"
      </tapa.desc>

      <tapa.longdesc>
         "Boundary case verification of config params : ul dl config idx 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5"  ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
   NumPucchVal="4" n1PucchVal0="2047" n1PucchVal1="2044" n1PucchVal2="2045"  n1PucchVal3="2046" DLSpsExpltRelCnt="4" DLSPSSchIntrv="640" NumSPSProc="8"/>
   </tapa.send>


   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>


    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.14
#
#       Desc:   " TC_MAC_TDD_SPS_14 Verify unsuccessful configuration of DL UE SPS Parameters 
#       at Scheduler during UE Configuration when it has invalid number of Harq Processes. 
#        UL DL cfg 2
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.14" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "verify unsuccessful cfg due to invalid num of hq procs ul dl cfg 2"
      </tapa.desc>

      <tapa.longdesc>
         "verify unsuccessful cfg due to invalid num of hq procs ul dl cfg 2"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="0"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.15
#
#       Desc:   " TC_MAC_TDD_SPS_15 Verify unsuccessful econfiguration of DL UE SPS Parameters 
#              at Scheduler during UE Configuration when it has invalid SPS RNTI. UL DL cfg 2
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.15" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="10" startRnti="70"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="75" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>





###############################################################################
#
#       Test:    33.16
#
#       Desc:   " TC_MAC_TDD_SPS_16 Verify unsuccessful reconfiguration of DL UE SPS Parameters 
#              at Scheduler during UE Configuration when it has invalid SPS RNTI. UL DL cfg 2
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.16" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="10" startRnti="70"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="FALSE" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  oldUeId="0" UeReCfgType="32768" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="75" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  status="15" />
      </tapa.expect>

    </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.17
#
#       Desc:   " TC_MAC_TDD_SPS_17 Verify Harq feedback timing for SPS data
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.17" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Harq feedback timing for SPS data"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the timing of Reception Request for Harq feedback for SPS Acitvation"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.18
#
#       Desc:   " TC_MAC_TDD_SPS_18 Verify the DL SPS data path on special subframe 
#                     number 1 when special subframe scheduling is enabled UL DL CFG 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.18" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is enabled Ul dl cfg 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is enabled Ul dl cfg 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

<!--
      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
         -->
         <!--
      <tapa.rg.cellInit.dlSched  spclSfCfgIdx="7" ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
      -->
        #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   numTxAntPorts="2"  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
                             ulStartSfIdxLst="0" rntiSize="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###3,3
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3,7
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,4
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,7
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #4,8
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      #5,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #5,8

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ###6,3

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ####6,8


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ####6,9

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      ####7,5

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      ####7,8

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
<!--
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>



      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
     #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.19
#
#       Desc:   " TC_MAC_TDD_SPS_19 Verify the DL SPS data path on special subframe 
#                     number 6 when special subframe scheduling is enabled UL DL CFG 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.19" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is enabled Ul dl cfg 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is enabled Ul dl cfg 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

<!--
      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
         -->
         <!--
      <tapa.rg.cellInit.dlSched  spclSfCfgIdx="7" ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
      -->
        #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   numTxAntPorts="2"  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
                             ulStartSfIdxLst="0" rntiSize="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###3,3
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3,7
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,4
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,7
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      #5,2
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #5,3
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #5,4
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      #5,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #5,8

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ###6,3

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ####6,8


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ####6,9

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      ####7,5

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      ####7,8

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
<!--
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>
-->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>



      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
     #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.20
#
#       Desc:   " TC_MAC_TDD_SPS_20 Verify the DL SPS data path on special subframe 
#                     number 1 when special subframe scheduling is disabled UL DL CFG 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.20" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is disabled Ul dl cfg 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is disabled Ul dl cfg 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###3,3
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3,7
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,4
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,7
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,8
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.21
#
#       Desc:   " TC_MAC_TDD_SPS_21 Verify the DL SPS data path on special subframe 
#                     number 6 when special subframe scheduling is disabled UL DL CFG 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.21" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is disabled Ul dl cfg 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is disabled Ul dl cfg 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###3,3
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3,7
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,4
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      #5,2
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.22
#
#       Desc:   " TC_MAC_TDD_SPS_22 Verify the DL SPS data path on special subframe 
#                     number 1 when special subframe scheduling is disabled UL DL CFG 1 SPL SF CFG 5
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.22" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is disabled Ul dl cfg 1 SPL SF 5"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is disabled Ul dl cfg 1 SPL SF 5"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" spclSfCfgIdx="5" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###3,3
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3,7
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,4
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,7
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,8
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.23
#
#       Desc:   " TC_MAC_TDD_SPS_23 Verify the DL SPS data path on special subframe 
#                     number 6 when special subframe scheduling is disabled UL DL CFG 1 SPL SF 5
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.23" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is disabled Ul dl cfg 1 SPLSF 5"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is disabled Ul dl cfg 1 SPLSF 5"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" spclSfCfgIdx="5"  raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      #RACH init 
      <tapa.rg.rachtdd1/>
### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###3,3
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3,7
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,4
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      #5,2
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
            transMode="TFU_UE_TM_3" numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.24
#
#
#       Desc:    TC_MAC_TDD_SPS_24 Verify the DL SPS data path on special subframe number 1
#                 when special subframe scheduling is enabled UL/DL cfg 2 spclsf 7
#                 
#       Notes:   None
#              
#       Module:  DwPTS Scheduling 
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.24">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DwPts"/>

      <tapa.desc>
      "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is enabled UL/DL cfg 2 spclsf 7"
      </tapa.desc>

      <tapa.longdesc>
      "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is enabled UL/DL cfg 2 spclsf 7"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgInitErr/>
      #<tapa.rg.dbgInitParm/>
      #<tapa.rg.dbgInitInfo/>

   #Initialize CELL
   <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" spclSfCfgIdx="7"  numTxAntPorts="2" rntiSize="2"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  DLSPSMaxBw="40" dlTotalBw="50"
         ulStartSfIdxLst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # [0, 3] 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      # [0, 6] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # [1, 5]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # [1,9]
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # [2, 2] 
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [2, 3]
      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # [2, 4] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      #[3, 0]
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # [3 ,3]
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

#### RACH DONE      
      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"   numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
###4,3
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
###4,7

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


####4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
####5,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

####5,8
      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
     ###6,8 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
###6,9
      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      ##Time 7,8
      #### SPS OCCASTION END##
     
     
       #### SPS OCCASTION START##
####7,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
<!--
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>
-->
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
     ###8,8 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
###8,9
      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      ##Time 9,8
      #### SPS OCCASTION END##
         
     
      
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
####Zero bo count hit
###10,8
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    33.25
#
#
#       Desc:    TC_MAC_TDD_SPS_25 Verify the DL SPS data path on special subframe number 6
#                 when special subframe scheduling is enabled UL/DL cfg 2 spclsf 7
#                 
#       Notes:   None
#              
#       Module:  DwPTS Scheduling 
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="DwPts"/>

      <tapa.desc>
      "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is enabled UL/DL cfg 2 spclsf 7"
      </tapa.desc>

      <tapa.longdesc>
      "Verify the DL SPS data path on special subframe number 6 when special subframe scheduling is enabled UL/DL cfg 2 spclsf 7"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="RGR_V2"/>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      #<tapa.rg.dbgInitErr/>
      #<tapa.rg.dbgInitParm/>
      #<tapa.rg.dbgInitInfo/>

   #Initialize CELL
   <tapa.rg.cellInit.dlSched.tddsplraocc ulDlCfgIdx="2" spclSfCfgIdx="7"  numTxAntPorts="2" rntiSize="2"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  DLSPSMaxBw="40" dlTotalBw="50"
         ulStartSfIdxLst="0"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # [0, 3] 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      # [0, 6] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="3"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # [1, 5]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # [1,9]
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      # [2, 2] 
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # [2, 3]
      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # [2, 4] 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      #[3, 0]
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="1">
           <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # [3 ,3]
      <tapa.send>
         <tapa.tfu.hq.ind>
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

#### RACH DONE      
      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"   numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
###4,3
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
###5,2

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


####4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
####5,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

####5,8
      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
     ###6,8 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
###6,9
      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      ##Time 7,8
      #### SPS OCCASTION END##
     
     
       #### SPS OCCASTION START##
####7,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
<!--
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>
-->
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
     ###8,8 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
###8,9
      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      ##Time 9,8
      #### SPS OCCASTION END##
         
     
      
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
####Zero bo count hit
###10,8
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.26
#
#       Desc:    TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 1
#                 when special subframe scheduling is disabled UL/DL cfg 2 spclsf 0
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.26" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 1
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 0"
      </tapa.desc>

      <tapa.longdesc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 1
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 0"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.27
#
#       Desc:    TC_MAC_TDD_SPS_27 Verify the DL SPS data path on special subframe number 6
#                 when special subframe scheduling is disabled UL/DL cfg 2 spclsf 0
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.27" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 6
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 0"
      </tapa.desc>

      <tapa.longdesc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 6
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 0"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.28
#
#       Desc:    TC_MAC_TDD_SPS_28 Verify the DL SPS data path on special subframe number 1
#                 when special subframe scheduling is disabled UL/DL cfg 2 spclsf 5
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.28" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 1
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 5"
      </tapa.desc>

      <tapa.longdesc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 1
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 5"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  spclSfCfgIdx="5" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.29
#
#       Desc:    TC_MAC_TDD_SPS_27 Verify the DL SPS data path on special subframe number 6
#                 when special subframe scheduling is disabled UL/DL cfg 2 spclsf 5
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.29" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 6
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 5"
      </tapa.desc>

      <tapa.longdesc>
         "TC_MAC_TDD_SPS_26 Verify the DL SPS data path on special subframe number 6
         when special subframe scheduling is disabled UL/DL cfg 2 spclsf 5"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit spclSfCfgIdx="5" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.30
#
#       Desc:   " TC_MAC_TDD_SPS_30 Verify successful transmission of SID Packets
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.30" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify successful transmission of SID Packets"
      </tapa.desc>

      <tapa.longdesc>
         "Verify successful transmission of SID Packets"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
#####first bo end

      <tapa.send>
         <tapa.tfu.tti.ind numTti="90"/>
      </tapa.send>

      ###SID BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
#####first bo end



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.31
#
#       Desc:   " TC_MAC_TDD_SPS_31 To test basic DL SPS path for a UE(15) in TDD DCI format 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.31" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE DCI format 2 "
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD. DCI format 2 "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_4" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_4"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_4"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_4"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
<!--
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   -->   
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.32
#
#       Desc:   " TC_MAC_TDD_SPS_32 To test basic DL SPS path for a UE(15) in TDD DCI format 2A"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.32" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE DCI format 2 "
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD. DCI format 2 "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
<!--
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   -->   
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.33
#
#       Desc:   " TC_MAC_TDD_SPS_33 To test unused SPS resources are used for dynamic resources"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.33" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " To test unused SPS resources are used for dynamic resources"
      </tapa.desc>

      <tapa.longdesc>
         " To test unused SPS resources are used for dynamic resources"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>


      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>




     #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" ULSPSEnFlag="FALSE" ueId = "0" UeReCfgType="32768" 
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

### SPS SVC for UE1
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "1" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
  
 ###send BO for UE 2 , TTI 100
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" ueId="1" lcType="5" bo="20"/>
      </tapa.send>
  ### 101 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind  ueId="1"  lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="1" lcType="5"/>
      </tapa.send>
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
###102
      # Expect a release PDCCH over here
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req ueId="1"  use="3" lcId="1" chkSdu="TRUE"  numTb1Lyrs="1"/>
      </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
              <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="FALSE" ueId="1" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.34
#
#       Desc:   " TC_MAC_TDD_SPS_34 To test BO is cleared dynamically incase SPS is not activated"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.34" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test SPS Bo is cleared by dynamic scheduling incase BO is not activated by the time next BO update arrives for SPS Svc"
      </tapa.desc>

      <tapa.longdesc>
         "To test SPS Bo is cleared by dynamic scheduling incase BO is not activated by the time next BO update arrives for SPS Svc"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

### recfg ue to enable meas gap and then send bo back to back such that 
### SPS sched assumes it has failed to activate SPS between two consecutive
### sps occasions leading to clearing of the BO dynamically.
      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5"  ueId="0" UeReCfgType="256"  isMesGapEnabled="TRUE"
                      gapPrd="40" gapOffst="32"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"  />
      </tapa.expect>
####44
      <tapa.send>
         <tapa.tfu.tti.ind numTti="27"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="22"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##Dynamic scheduling
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.35
#
#       Desc:   " TC_MAC_TDD_SPS_35 Verify SPS UEs new tx is given priority over non SPS UE new tx RR"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.35" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " Verify SPS UEs new tx is given priority over non SPS UE new tx RR"
      </tapa.desc>

      <tapa.longdesc>
         " Verify SPS UEs new tx is given priority over non SPS UE new tx RR"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  maxDlUeNewTxPerTti="1" maxUePerDlSf="2" dlSchdType="2" 
      ulSchdType="2" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" rntiSize="2"
      maxCcchPerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>


      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>




     #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" ULSPSEnFlag="FALSE" ueId = "0" UeReCfgType="32768" 
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

### SPS SVC for UE1
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "1" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" ueId="1" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind ueId="0" lchTb1Data="3" saveTo="2" />
         <tapa.rgu.dstaind ueId="1" lchTb1Data="1" saveTo="3" />
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.36
#
#       Desc:   " TC_MAC_TDD_SPS_36 Verify SPS UEs new tx is given priority over non SPS UE new tx PFS"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.36" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         " Verify SPS UEs new tx is given priority over non SPS UE new tx PFS"
      </tapa.desc>

      <tapa.longdesc>
         " Verify SPS UEs new tx is given priority over non SPS UE new tx PFS"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  maxDlUeNewTxPerTti="1" maxUePerDlSf="2" dlSchdType="1" 
      ulSchdType="2" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" 
      rntiSize="2" maxCcchPerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>


      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>




     #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" ULSPSEnFlag="FALSE" ueId = "0" UeReCfgType="32768" 
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

### SPS SVC for UE1
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "1" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" ueId="1" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.37
#
#       Desc:   " TC_MAC_TDD_SPS_37 Verify new tx for SPS LC is given priority over new tx of non SPS LC for the same UE: RR"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.37" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify new tx for SPS LC is given priority over new tx of non SPS LC for the same UE :: RR"
      </tapa.desc>

      <tapa.longdesc>
         "Verify new tx for SPS LC is given priority over new tx of non SPS LC for the same UE :: RR"
         " Verify SPS UEs new tx is given priority over non SPS UE new tx RR"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  maxDlUeNewTxPerTti="2" maxUePerDlSf="2" dlSchdType="2" 
      ulSchdType="2" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" 
      rntiSize="2" maxCcchPerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>


      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>




     #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" ULSPSEnFlag="FALSE" ueId = "0" UeReCfgType="32768" 
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

### SPS SVC for UE1
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>

         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "1" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" ueId="0" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>




###############################################################################
#
#       Test:    33.38
#
#       Desc:   " TC_MAC_TDD_SPS_38 Verify new tx for SPS LC is given priority over new tx of non SPS LC for the same UE: PFS"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.38" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify new tx for SPS LC is given priority over new tx of non SPS LC for the same UE :: PFS"
      </tapa.desc>

      <tapa.longdesc>
         "Verify new tx for SPS LC is given priority over new tx of non SPS LC for the same UE :: PFS"
         " Verify SPS UEs new tx is given priority over non SPS UE new tx RR"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  maxDlUeNewTxPerTti="1" maxUePerDlSf="2" dlSchdType="1" 
      ulSchdType="2" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" 
      rntiSize="2" maxCcchPerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>


      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0" instId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"  instId="0"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"  instId="0"/>
      <tapa.rgu.cstaind lcId="4"  instId="0"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3"  instId="0" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3"  instId="0" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"  instId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"  instId="0"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>




     #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" ULSPSEnFlag="FALSE" ueId = "0" UeReCfgType="32768" 
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

### SPS SVC for UE1
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>

         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "1" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" ueId="0" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>




###############################################################################
#
#       Test:    33.39
#
#       Desc:   " TC_MAC_TDD_SPS_39 To verify the scheduling of SPS and non SPS UEs when the entire bandwidth is available for SPS." 
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.39" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify the scheduling of SPS and non SPS UEs when the entire bandwidth is available for SPS."
      </tapa.desc>

      <tapa.longdesc>
         "To verify the scheduling of SPS and non SPS UEs when the entire bandwidth is available for SPS."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="100" dlTotalBw="100" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>


      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>




     #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" ULSPSEnFlag="FALSE" ueId = "0" UeReCfgType="32768" 
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

### SPS SVC for UE1
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "1" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
  
 ###send BO for UE 2 , TTI 100
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" ueId="1" lcType="5" bo="20"/>
      </tapa.send>
  ### 101 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind  ueId="1"  lchTb1Data="1" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="1" lcType="5"/>
      </tapa.send>
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
###102
      # Expect a release PDCCH over here
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req ueId="1"  use="3" lcId="1" chkSdu="TRUE"  numTb1Lyrs="1"/>
      </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
              <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="FALSE" ueId="1" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.40
#
#       Desc:   " TC_MAC_TDD_SPS_40 To verify TA shall be sent along with SPS Occasion data if present."
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.40" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify TA shall be sent along with SPS Occasion data if present."
      </tapa.desc>

      <tapa.longdesc>
         "To verify TA shall be sent along with SPS Occasion data if present."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit  maxDlUeNewTxPerTti="1" maxUePerDlSf="2" dlSchdType="1" 
      ulSchdType="2" numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="100" 
      rntiSize="2" maxCcchPerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>


      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

         # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="2">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3 for 1st UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   #Send CRC for Msg3 for 2nd UE
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" txModeEnum="RGR_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" prdBsrTmr="65535" ueCatEnum="1"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>




     #UE2 Configuration
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

         # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" ULSPSEnFlag="FALSE" ueId = "0" UeReCfgType="32768" 
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

### SPS SVC for UE1
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>

         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "1" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"  numTb1Lyrs="1" transMode="TFU_UE_TM_3"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

       <tapa.send>
       <tapa.tfu.timingadv.ind>
       <tapa.tfu.timingadv ueId="0" timingAdv="5"  />
       </tapa.tfu.timingadv.ind>
       </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"  numTb1Lyrs="1" 
               validateSPS ="TRUE" chkTA="TRUE" taVal="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" ueId="0" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.41
#
#       Desc:   " TC_MAC_TDD_SPS_41 To test basic DL and UL SPS path for a UE in TDD"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.41" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="TRUE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            ULSPSSchIntrv="RGR_SPS_PRD_20SF"  ULSPSPcktSize="80" ULSPSimpRls="RGR_SPS_E2" prdBsrTmr="65535"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3"   lcgId="1" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "1" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


####4,0
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="23"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

###4,1
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>


      <tapa.send>
      <tapa.tfu.sr.ind>
      <tapa.tfu.sr/>
      </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
      <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
      </tapa.tfu.recp.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
      <tapa.tfu.crc.ind>
      <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
####6,1 UL LINK
      <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
      <tapa.tfu.dat  ueId="0"
      addShortBsr="TRUE" lcgId="1" bsr="20" />
      </tapa.tfu.dat.ind>
      </tapa.send>
####6,1 UL LINK

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE" transMode="TFU_UE_TM_3"   numTb1Lyrs="1"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="4"
         isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>

      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1">
      <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="5"
      isSpsRnti="TRUE"/>
      </tapa.tfu.recp.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
      <tapa.tfu.crc.ind>
      <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
      </tapa.send>


      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

###here
      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
      <tapa.tfu.dat  ueId="0" use="5" dedBufIdx="0"
      lcId="3" isSpsRnti="TRUE" bsr="10" />
      </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
      <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="1">
      <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
      <tapa.tfu.recp.req numRntis="1">
      <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="5"
      isSpsRnti="TRUE"/>
      </tapa.tfu.recp.req>
      </tapa.expset>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

                                         

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
      <tapa.tfu.crc.ind>
      <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
      </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
      <tapa.tfu.dat.ind datInds="1">
      <tapa.tfu.dat  ueId="0" use="5" dedBufIdx="0"
      lcId="3" isSpsRnti="TRUE" />
      </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
      <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.42
#
#       Desc:   " TC_MAC_TDD_SPS_42 Verify Harq feedback timing for SPS Release"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.42" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "Verify Harq feedback timing for SPS Release"
      </tapa.desc>

      <tapa.longdesc>
        "Verify Harq feedback timing for SPS Release"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
<!--
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   -->   
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.43
#
#       Desc:   " TC_MAC_TDD_SPS_43 Verify the SPS release is not happening during non contigous absence of data"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.43" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "Verify the SPS release is not happening during non contigous absence of data"
      </tapa.desc>

      <tapa.longdesc>
        "Verify the SPS release is not happening during non contigous absence of data"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##
#### reset zero bo counter
      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##







      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
  
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.44
#
#       Desc:   " TC_MAC_TDD_SPS_44 Verify HARQ retransmission for SPS data"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.44" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
        "Verify HARQ retransmission for SPS data"
      </tapa.desc>

      <tapa.longdesc>
        "Verify HARQ retransmission for SPS data"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" saveTo="4"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="5" DLSPSInit="FALSE" ueId="0"
               isSPSRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="3" chkSdu="TRUE"
               transMode="TFU_UE_TM_3" isRetx="TRUE" retxUse="4" validateSPS="TRUE" SPSretxUse="4" isSPSRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>


      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.45
#
#       Desc:   " TC_MAC_TDD_SPS_45 To test re-transmission of Release PDCCH only maxDlHqRetx times"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.45" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test re-transmission of Release PDCCH only maxDlHqRetx times"
      </tapa.desc>

      <tapa.longdesc>
         "To test re-transmission of Release PDCCH only maxDlHqRetx times"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##


      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


### Retx 1 11,3
      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

### Retx 2 12,3
      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


### Retx 3 13,3
      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


## Release pdcch should not be received
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.46
#
#       Desc:   " TC_MAC_TDD_SPS_46 Verify Successful DL SPS Release due to deletion of SPS LC" 
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.46" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify Successful DL SPS Release due to deletion of SPS LC"
      </tapa.desc>

      <tapa.longdesc>
         "Verify Successful DL SPS Release due to deletion of SPS LC"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
### 
   # Release triggered whn SPS Hq prc is still busy
   #SPS RELEASE DUE TO LC DEL  5,8->6,1
      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="3" dir="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="3" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
  

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.47
#
#       Desc:   " TC_MAC_TDD_SPS_47 Verify if DL SPS is successfully disabled for a UE already configured with SPS"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.47" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify if DL SPS is successfully disabled for a UE already configured with SPS"
      </tapa.desc>

      <tapa.longdesc>
         "Verify if DL SPS is successfully disabled for a UE already configured with SPS"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
   ## DISABLE HERE 
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="32768" DLSPSEnFlag = "FALSE" />
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  status="0"/>
       </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>


  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.48
#
#       Desc:   " TC_MAC_TDD_SPS_48 Verify SPS Reactivation Due to change of Scaled CQI"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.48" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SPS Reactivation Due to change of Scaled CQI"
      </tapa.desc>

      <tapa.longdesc>
         "Verify SPS Reactivation Due to change of Scaled CQI"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.49
#
#       Desc:   " TC_MAC_TDD_SPS_49 Verify SPS Reactivation for N = 5 consecutive Dynamic scheduling for SPS LC BO for SPS Activated UE"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.49" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SPS Reactivation for N = 5 consecutive Dynamic scheduling for SPS LC BO for SPS Activated UE"
      </tapa.desc>

      <tapa.longdesc>
         "Verify SPS Reactivation for N = 5 consecutive Dynamic scheduling for SPS LC BO for SPS Activated UE"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##


      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="51"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##



      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="52"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##




      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="53"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##




      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="54"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="4"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
             transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##






    
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.50
#
#       Desc:   " TC_MAC_TDD_SPS_50 Verify SPS Reactivation for N = 5 consecutive reduced BO for SPS Activated UE"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.50" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SPS Reactivation for N = 5 consecutive reduced SPS LC BO for SPS Activated UE"
      </tapa.desc>

      <tapa.longdesc>
         "Verify SPS Reactivation for N = 5 consecutive reduced SPS LC BO for SPS Activated UE"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="50"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
                transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   numTb1Lyrs="1"  validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   numTb1Lyrs="1"  validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   numTb1Lyrs="1"  validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="FALSE"
            transMode="TFU_UE_TM_3"   numTb1Lyrs="1"  validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##





      ### Reactivation
      #### SPS OCCASTION START##
      ###7,3
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="4"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
             transMode="TFU_UE_TM_3"   numTb1Lyrs="1" validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##

    
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.51
#
#       Desc:   " TC_MAC_TDD_SPS_51 To test release of harq proc after max-retransmission time"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.51" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test release of harq proc after max-retransmission time"
      </tapa.desc>

      <tapa.longdesc>
         "To test release of harq proc after max-retransmission time"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="5" DLSPSInit="FALSE" ueId="0"
               isSPSRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="3" 
               transMode="TFU_UE_TM_3"  validateSPS ="TRUE" isRetx="TRUE" chkSdu="FALSE" isTb1="FALSE" SPSretxUse="2" isSPSRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="5" DLSPSInit="FALSE" ueId="0"
               isSPSRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="3" 
               transMode="TFU_UE_TM_3"  validateSPS ="TRUE" isRetx="TRUE" chkSdu="FALSE" isTb1="FALSE" SPSretxUse="2" isSPSRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
### for retx
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



<!--
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
-->

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

<!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
--> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.52
#
#       Desc:   " TC_MAC_TDD_SPS_52 To verify deletion of a SPS active UE"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.52" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify deletion of a SPS active UE"
      </tapa.desc>

      <tapa.longdesc>
         "To verify deletion of a SPS active UE"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
    ## DISABLE HERE 
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #HQ FDBK SPS Occassion TX should not be received
      <!--
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>
    -->

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>


   
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.53
#
#       Desc:   " TC_MAC_TDD_SPS_53 To verify retransmissions scheduled in response to DTX received for SPS occasion data"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.53" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify retransmissions scheduled in response to DTX received for SPS occasion data"
      </tapa.desc>

      <tapa.longdesc>
         "To verify retransmissions scheduled in response to DTX received for SPS occasion data"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="5" DLSPSInit="FALSE" ueId="0"
               isSPSRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="3" 
               transMode="TFU_UE_TM_3"  validateSPS ="TRUE" isRetx="TRUE" chkSdu="FALSE" isTb1="FALSE" SPSretxUse="2" isSPSRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


###############################################################################
#
#       Test:    33.54
#
#       Desc:   " TC_MAC_TDD_SPS_54 To verify DL SPS release due to CRNTI-CE reception"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.54" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is enabled Ul dl cfg 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DL SPS data path on special subframe number 1 when special subframe scheduling is enabled Ul dl cfg 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

<!--
      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>
         -->
         <!--
      <tapa.rg.cellInit.dlSched  spclSfCfgIdx="7" ulDlCfgIdx="1" raWinSize="10"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"  numTxAntPorts="2" />
      -->
        #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   numTxAntPorts="2"  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
                   ulStartSfIdxLst="0" rntiSize="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="40" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###3,3
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #3,7
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #4,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,4
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #4,7
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #4,8
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      #4,9
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      #5,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #5,8

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


####PLUG HERE

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send lc="TRUE">
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>

      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect PDCCH for DCI format 0.
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE"
            vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      





   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>



###############################################################################
#
#       Test:    33.55
#
#       Desc:   " TC_MAC_TDD_SPS_55 To verify DL SPS deactivation due to UE RESET"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.55" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify DL SPS deactivation due to UE RESET"
      </tapa.desc>

      <tapa.longdesc>
         "To verify DL SPS deactivation due to UE RESET"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

#### UE RESET HERE 
         # Send UE Reset Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Reset Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5"  cellId="3" ueId="0"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#
#       Test:    33.56
#
#       Desc:    TC_MAC_TDD_SPS_56 
#                To verify the case in which Retx for an SPS Harq Proc collides with New transmission for 
#                SPS (at SPS Occasion) for the Same UE. New TX is given Priority for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
###############################################################################
<tapa.testcase id="33.56">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="downlink.datapath"/>

      <tapa.desc>
         "To verify the case in which Retx for an SPS Harq Proc collides with New transmission for
          SPS (at SPS Occasion) for the Same UE. New TX is given Priority for UL/DL Config 2"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" numTxAntPorts="2"
      DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
   
      #Do the RACH for Config 2
      <tapa.rg.rachtdd2 />

       # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="10" NumSPSProc="4"
            maxDlUeNewTxPerTti="1" maxSpsUePerDlSf="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="10"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>




      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE" transMode="3"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      #<tapa.expect>
      #</tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" transMode="3" saveTo="4"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Nack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #Send BO for SPS Occasion
      <tapa.send >
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21" />
      </tapa.send> 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="3" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="1" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" transMode="3" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH for Occasion Retx
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="TRUE" ueId="0" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" transMode="3" isRetx="TRUE" retxUse="4"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      #<tapa.send>
      #   <tapa.tfu.tti.ind numTti="4"/>
      #</tapa.send>

      #<tapa.expect>
      #   <tapa.tfu.recp.req numRntis="1">
      #      <tapa.tfu.hq.recp.req/>
      #   </tapa.tfu.recp.req>   
      #</tapa.expect>

      #<tapa.send>
      #   <tapa.tfu.tti.ind numTti="3"/>
      #</tapa.send>

      #Ack for activation pdcch 
      #<tapa.send>
      #   <tapa.tfu.hq.ind hqInds="1">
      #      <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
      #   </tapa.tfu.hq.ind>   
      #</tapa.send>
 

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

###############################################################################
#
#       Test:    33.57
#
#       Desc:   " TC_MAC_TDD_SPS_57 
#                 Verify SPS UEs Retx is given priority over non SPS UE Retx. Scheduler type : RR  UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.57" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SPS UEs Retx is given priority over non SPS UE Retx. Scheduler type : RR  UL/DL Config 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify SPS UEs Retx is given priority over non SPS UE Retx. Scheduler type : RR  UL/DL Config 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   numTxAntPorts="2"  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
                             ulStartSfIdxLst="0" rntiSize="2" dlSchdType="2" 
         maxDlUeNewTxPerTti="1" maxUePerDlSf="1"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

   #RACH For 2nd UE
#[4, 0]
   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 4] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="6" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1" >
   <tapa.tfu.pdcch.cntrl.req />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [5, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [5,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [6, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4" ueId="1" />
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE" ueId="1" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[7, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [7 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="FALSE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" ueId="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" ueId="1" />
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="FALSE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,4]
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,5]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,8]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,9]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      #9,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #9,8

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ##10,3

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ###10,8


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ###10,9

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" saveTo="7" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      #Send BO for UE 1     
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21" ueId="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" lcType="5" ueId="1"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="8" ueId="1" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1"  use="8" lcId="3" chkSdu="TRUE"
               saveTo="10" />
         </tapa.tfu.dat.req>
      </tapa.expset>








      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      ###11,5

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>




      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      ###11,8

      # Send NACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="1" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      ###12,2
      ##DL SPS Occasion Retx PDCCH
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" isRetx="TRUE" retxUse="7"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="7" ueId="1" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1"  use="7" lcId="3" chkSdu="TRUE"
               isRetx="TRUE" retxUse="10"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 
      ###12,6
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.58
#
#       Desc:   " TC_MAC_TDD_SPS_58 
#                 Verify SPS UEs Retx is given priority over non SPS UE Retx. Scheduler type : PFS  UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.58" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SPS UEs Retx is given priority over non SPS UE Retx. Scheduler type : PFS  UL/DL Config 1"
      </tapa.desc>

      <tapa.longdesc>
         "Verify SPS UEs Retx is given priority over non SPS UE Retx. Scheduler type : PFS  UL/DL Config 1"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   numTxAntPorts="2"  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
                             ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" 
         maxDlUeNewTxPerTti="1" maxUePerDlSf="1"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

   #RACH For 2nd UE
#[4, 0]
   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 4] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="6" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1" >
   <tapa.tfu.pdcch.cntrl.req />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [5, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [5,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [6, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4" ueId="1" />
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE" ueId="1" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[7, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [7 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="FALSE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" ueId="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" ueId="1" />
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="FALSE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,4]
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,5]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,8]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,9]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      #9,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #9,8

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ##10,3

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      ###10,8


      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      ###10,9

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" saveTo="7" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      #Send BO for UE 1     
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21" ueId="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="3" lcType="5" ueId="1"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="8" ueId="1" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1"  use="8" lcId="3" chkSdu="TRUE"
               saveTo="10" />
         </tapa.tfu.dat.req>
      </tapa.expset>








      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      ###11,5

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>




      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      ###11,8

      # Send NACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send NACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="1" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      ###12,2
      ##DL SPS Occasion Retx PDCCH
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" isRetx="TRUE" retxUse="7"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="7" ueId="1" />
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1"  use="7" lcId="3" chkSdu="TRUE"
               isRetx="TRUE" retxUse="10"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

 
      ###12,6
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.59
#
#       Desc:   " TC_MAC_TDD_SPS_59 
#                 To test the path where BO  is received before getting feedback for RelPdcch for UL/DL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.59" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test the path where BO  is received before getting feedback for RelPdcch"
      </tapa.desc>

      <tapa.longdesc>
         "To test the path where BO  is received before getting feedback for RelPdcch"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      
      #Send BO for SPS LC before SPS REL Feedback
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.60
#
#       Desc:   " TC_MAC_TDD_SPS_60 
#                 To test path : UE deletion when UE's entry is in tobeActivated UE list: for UL/DL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.60" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test path : UE deletion when UE's entry is in tobeActivated UE list:"
      </tapa.desc>

      <tapa.longdesc>
         "To test path : UE deletion when UE's entry is in tobeActivated UE list:"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE Delete Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  numTti="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.61
#
#       Desc:   " TC_MAC_TDD_SPS_61
#                 To test path when UE delete is sent when Ue is in ToBeRelList for UL/DL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.61" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "To test path when UE delete is sent when Ue is in ToBeRelList"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 20)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 20)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE Delete Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="80"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.62
#
#       Desc:   " TC_MAC_TDD_SPS_62 
#                 To verify the failure of SPS reactivation due to non availability of SPS bandwidth: 
#                 SPS bandwidth available in the next slot UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.62" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify the failure of SPS reactivation due to non availability of SPS bandwidth: SPS bandwidth available in the next slot."
      </tapa.desc>

      <tapa.longdesc>
         "To verify the failure of SPS reactivation due to non availability of SPS bandwidth: SPS bandwidth available in the next slot."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="50"  DLSPSMaxBw="12"
                             ulStartSfIdxLst="0" rntiSize="2" dlSchdType="2" 
         maxDlUeNewTxPerTti="2" maxUePerDlSf="2" maxSpsUePerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="4" n1PucchVal0="1" n1PucchVal1="2" n1PucchVal2="3" n1PucchVal3="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

   #RACH For 2nd UE
#[4, 0]
   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 4] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="6" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1" >
   <tapa.tfu.pdcch.cntrl.req />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [5, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [5,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [6, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4" ueId="1" />
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE" ueId="1" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[7, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [7 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="66" DLSPSSchIntrv="20" NumSPSProc="4" ueId="1" 
            NumPucchVal="2" n1PucchVal0="1" n1PucchVal1="2" n1PucchVal2="3" n1PucchVal3="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" ueId="1" />
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,4]
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20" ueId="1"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

# [7 ,6]
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,7]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
            <tapa.tfu.pdsch.dat.req ueId="1"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="1" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,5]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,8]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,9]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      #9,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #9,8

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <!--
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>



      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
            <tapa.tfu.pdsch.dat.req ueId="1"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="TRUE" ueId="1" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

########
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Reactivation RB Alloc will be failed as TBSize required is more for given CQI
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         #SPS Release for First UE because of low CQI
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.63
#
#       Desc:   " TC_MAC_TDD_SPS_63 
#                 To verify the failure of SPS reactivation due to non availability of SPS bandwidth: 
#                 SPS bandwidth not available in subsequent slots UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.63" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify the failure of SPS reactivation due to non availability of SPS bandwidth: SPS bandwidth not available in subsequent slots."
      </tapa.desc>

      <tapa.longdesc>
         "To verify the failure of SPS reactivation due to non availability of SPS bandwidth: SPS bandwidth not available in subsequent slots."
      </tapa.longdesc>

   </tapa.doc>


   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="50"  DLSPSMaxBw="12"
                             ulStartSfIdxLst="0" rntiSize="2" dlSchdType="2" 
         maxDlUeNewTxPerTti="2" maxUePerDlSf="2" maxSpsUePerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="4" n1PucchVal0="1" n1PucchVal1="2" n1PucchVal2="3" n1PucchVal3="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

   #RACH For 2nd UE
#[4, 0]
   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 4] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="6" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1" >
   <tapa.tfu.pdcch.cntrl.req />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [5, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [5,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [6, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4" ueId="1" />
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE" ueId="1" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[7, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [7 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="66" DLSPSSchIntrv="20" NumSPSProc="4" ueId="1" 
            NumPucchVal="2" n1PucchVal0="1" n1PucchVal1="2" n1PucchVal2="3" n1PucchVal3="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" ueId="1" />
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,4]
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20" ueId="1"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

# [7 ,6]
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,7]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
            <tapa.tfu.pdsch.dat.req ueId="1"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="1" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,5]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,8]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,9]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      #9,5
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #9,8

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <!--
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      -->
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="0"/>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>



      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
            <tapa.tfu.pdsch.dat.req ueId="1"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="TRUE" ueId="1" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="4" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

########
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         #SPS Release for First UE because of low CQI
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp ueId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="0"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #Schedule the UE(0) Dynamically
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="5" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="5" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.64
#
#       Desc:   " TC_MAC_TDD_SPS_64 
#                 Verify SPS UEs Retx is scheduled on SPS occasion if new tx SPS data is not available in UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.64" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SPS UEs Retx is scheduled on SPS occasion if new tx SPS data is not available."
      </tapa.desc>

      <tapa.longdesc>
         "Verify SPS UEs Retx is scheduled on SPS occasion if new tx SPS data is not available."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
                             ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" 
         maxDlUeNewTxPerTti="1" maxUePerDlSf="1"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,5]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,7]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #9,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #9,4

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
            
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Nack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" isRetx="TRUE" retxUse="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3"  ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" />
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.65
#
#       Desc:   " TC_MAC_TDD_SPS_65 
#                 The new data should be schedule in next tick afetr the occasion Retx in UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.65" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "The new data should be schedule in next tick afetr the occasion Retx.."
      </tapa.desc>

      <tapa.longdesc>
         "The new data should be schedule in next tick afetr the occasion Retx.."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
                             ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" 
         maxDlUeNewTxPerTti="1" maxUePerDlSf="1"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,5]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,7]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #9,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #9,4

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
            
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Nack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" isRetx="TRUE" retxUse="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3"  ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" />
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" />
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.66
#
#       Desc:   " TC_MAC_TDD_SPS_66 
#                 Verify the DAI in DL DCI ( Format 1A,2A) in UL/DL Config 2
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.66" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DAI in DL DCI"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DAI in DL DCI."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="2" n1PucchVal0="1" n1PucchVal1="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##



      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
##################################################################################################################################
#
#       Test:    33.67
#
#       Desc:    TC_MAC_TDD_SPS_67 
#                Verify the PUCCH Harq resource (When harq feedback mode is bundling) allocated for 
#                 SPS data without pdcch for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
####################################################################################################################################
<tapa.testcase id="33.67">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="SPS PUCCH"/>

      <tapa.desc>
         "Verify the PUCCH Harq resource (When harq feedback mode is bundling) allocated for SPS data without pdcch."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
    <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2" NumPucchVal="2" n1PucchVal0="20" n1PucchVal1="30"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##Dynamic Resource
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
##################################################################################################################################
#
#       Test:    33.68
#
#       Desc:    TC_MAC_TDD_SPS_68 
#                Verify the DAI in DL DCI ( Format 1A,2A) when there is PDCCH coresponding to SPS release 
#                for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
####################################################################################################################################
<tapa.testcase id="33.68">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="SPS PUCCH"/>

      <tapa.desc>
         "Verify the DAI in DL DCI ( Format 1A,2A) when there is PDCCH coresponding to SPS release."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
    <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2" NumPucchVal="2" n1PucchVal0="20" n1PucchVal1="30"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##Dynamic Resource
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.69
#
#       Desc:   " TC_MAC_TDD_SPS_69 
#                 Verify the DAI and n1 resource when there is  PDCCH coresponding to SPS activation in UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.69" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is  PDCCH coresponding to SPS activation"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DAI and n1 resource when there is  PDCCH coresponding to SPS activation"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
         ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" maxDlUeNewTxPerTti="1" maxUePerDlSf="1"
         />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" NumPucchVal="2" n1PucchVal0="1" 
            n1PucchVal1="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,5]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,7]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      #9,1
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.70
#
#       Desc:   " TC_MAC_TDD_SPS_70 
#                 Verify the DAI and n1 resource when there is  PDCCH coresponding to SPS 
#                 activation and DL dynamic data on same DAI window in UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.70" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is  PDCCH coresponding to SPS activation and DL dynamic data on same DAI window."
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DAI and n1 resource when there is  PDCCH coresponding to SPS activation and DL dynamic data on same DAI window."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
         ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" maxDlUeNewTxPerTti="1" maxUePerDlSf="1"
         />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" NumPucchVal="2" n1PucchVal0="1" 
            n1PucchVal1="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      ## Configure for SPS  LC
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      ## Configure for Non SPS  LC
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
# [8 ,6]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="3"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,8]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="5" lcId="4"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="3" lcId="4" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="FALSE" ueId="0" 
            vldtDai="TRUE" dai="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
# [9 ,5]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.71
#
#       Desc:   " TC_MAC_TDD_SPS_71 
#                 Verify the DAI and n1 resource when there is  only SPS occasion (PDSCH without PDCCH) 
#                 in UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.71" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is  only SPS occasion (PDSCH without PDCCH)"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DAI and n1 resource when there is  only SPS occasion (PDSCH without PDCCH)"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
         ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" maxDlUeNewTxPerTti="1" maxUePerDlSf="1"
         />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" NumPucchVal="2" n1PucchVal0="1" 
            n1PucchVal1="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      ## Configure for SPS  LC
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      ## Configure for Non SPS  LC
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
# [8 ,6]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,8]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
# [9 ,5]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.72
#
#       Desc:   " TC_MAC_TDD_SPS_72 
#                 Verify the DAI and n1 resource when there is SPS occasion and DL dynamic data on same 
#                 DAI window (1st dynamic data then SPS occasion) in UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.72" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is SPS occasion and DL dynamic data on same DAI window (1st dynamic data then SPS occasion)"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DAI and n1 resource when there is SPS occasion and DL dynamic data on same DAI window (1st dynamic data then SPS occasion)"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
         ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" maxDlUeNewTxPerTti="1" maxUePerDlSf="1"
         />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" NumPucchVal="2" n1PucchVal0="1" 
            n1PucchVal1="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      ## Configure for SPS  LC
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      ## Configure for Non SPS  LC
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,6]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,8]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
# [9 ,5]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="3"/>
      </tapa.expset>


      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.73
#
#       Desc:   " TC_MAC_TDD_SPS_73 
#                 Verify the DAI and n1 resource when there is SPS occasion and DL dynamic data on same 
#                 DAI window (1st SPS occasion then dynamic data) in UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.73" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is SPS occasion and DL dynamic data on same DAI window (1st SPS occasion then dynamic data)"
      </tapa.desc>

      <tapa.longdesc>
         "Verify the DAI and n1 resource when there is SPS occasion and DL dynamic data on same DAI window (1st SPS occasion then dynamic data)"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit.dlSched.tddsplraocc   ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="100"  DLSPSMaxBw="40"
         ulStartSfIdxLst="0" rntiSize="2" dlSchdType="1" maxDlUeNewTxPerTti="1" maxUePerDlSf="1"
         />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" NumPucchVal="2" n1PucchVal0="1" 
            n1PucchVal1="2"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      ## Configure for SPS  LC
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      ## Configure for Non SPS  LC
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,2]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
# [8 ,6]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,7]
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,8]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
# [9 ,5]
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" lcId="3"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5" lcId="3"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" saveTo="5"/>
         </tapa.tfu.dat.req>
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2" lcId="4"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="0" 
            vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
##################################################################################################################################
#
#       Test:    33.74
#
#       Desc:    TC_MAC_TDD_SPS_74 
#                Verify the DAI and n1 resource when there is  only SPS release PDCCH 
#                for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
####################################################################################################################################
<tapa.testcase id="33.74">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="SPS PUCCH"/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is  only SPS release PDCCH "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
    <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2" NumPucchVal="2" n1PucchVal0="20" n1PucchVal1="30"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##Dynamic Resource
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
##################################################################################################################################
#
#       Test:    33.75
#
#       Desc:    TC_MAC_TDD_SPS_75 
#                Verify the DAI and n1 resource when there is SPS release PDCCH and DL dynamic data 
#                 on same DAI window (1st dynamic data then SPS release) for UL/DL Config 2 
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
####################################################################################################################################
<tapa.testcase id="33.75">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="SPS PUCCH"/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is SPS release PDCCH and DL dynamic data on same DAI window (1st dynamic data then SPS release)"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
    <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2" NumPucchVal="2" n1PucchVal0="20" n1PucchVal1="30"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      ##Configure one Non SPS LC
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL NON SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" lcType = "5" />
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

 
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>
      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
      ###First BO for NON SPS LC
      <tapa.send>
         # Send BO for the created NON SPS service on RGU 
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5" lcId="4"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="0"
            vldtDai="TRUE" dai="1" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

 
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" vldtDai="TRUE" dai="2"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##Dynamic Resource
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

##################################################################################################################################
#
#       Test:    33.76
#
#       Desc:    TC_MAC_TDD_SPS_76 
#                Verify the DAI and n1 resource when there is SPS release PDCCH and DL dynamic data on 
#                 same DAI window(1st SPS release then dynamic data) for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
####################################################################################################################################
<tapa.testcase id="33.76">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="SPS PUCCH"/>

      <tapa.desc>
         "Verify the DAI and n1 resource when there is SPS release PDCCH and DL dynamic data on same DAI window(1st SPS release then dynamic data)"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
    <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="2" NumPucchVal="2" n1PucchVal0="20" n1PucchVal1="30"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" lcType = "5" 
            />
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##the value configured in UE Config
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" vldtDai="TRUE" dai="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2" lcId="4"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5" lcId="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE" />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" ueId="0" vldtDai="TRUE" dai="2"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      ##Check the Haq resource of Recp Req in GDB, it should be 
      ##Dynamic Resource
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.77
#
#       Desc:   " TC_MAC_TDD_SPS_77 
#                 Verify N1PUCCH collision is taken care of during SPS activation in DL for UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.77" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify N1PUCCH collision is taken care of during SPS activation in DL"
      </tapa.desc>

      <tapa.longdesc>
         "Verify N1PUCCH collision is taken care of during SPS activation in DL"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="50"  DLSPSMaxBw="12"
                             ulStartSfIdxLst="0" rntiSize="2" dlSchdType="2" 
         maxDlUeNewTxPerTti="2" maxUePerDlSf="2" maxSpsUePerDlSf="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="1" n1PucchVal0="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

   #RACH For 2nd UE
#[4, 0]
   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 4] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="6" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [4, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1" >
   <tapa.tfu.pdcch.cntrl.req />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [5, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [5,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="1" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [6, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4" ueId="1" />
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [6, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE" ueId="1" />
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="1" />
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[7, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req ueId="1" />
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [7 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="1" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue ueId="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1" />
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="66" DLSPSSchIntrv="20" NumSPSProc="4" ueId="1" 
            NumPucchVal="1" n1PucchVal0="1" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" ueId="1" />
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

# [7 ,4]
      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="1" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20" ueId="1"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

# [7 ,6]
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>
      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [7 ,7]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
            <tapa.tfu.pdsch.dat.req ueId="1"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="1" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [8 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="2">
            <tapa.tfu.hq.recp.req/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>



      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [8 ,7]
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21" ueId="1"/>
      </tapa.send>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


# [8 ,9]
      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="1" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="1"  use="3" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="3" DLSPSInit="TRUE" ueId="1" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.78
#
#       Desc:   " TC_MAC_TDD_SPS_78
#                 To test the path when PUSCH collides with Feedback reception on N1PUCCH for UL/DL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.78" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test the path when PUSCH collides with Feedback reception on N1PUCCH"
      </tapa.desc>

      <tapa.longdesc>
         "To test the path when PUSCH collides with Feedback reception on N1PUCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="4" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>



      #<tapa.expect>
      #   <tapa.tfu.recp.req numRntis="1">
      #      <tapa.tfu.hq.recp.req/>
      #   </tapa.tfu.recp.req>   
      #</tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.79
#
#       Desc:   " TC_MAC_TDD_SPS_79
#                 Verify that DL SPS Activation is not done in Measurement Gaps for UL/DL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.79" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that DL SPS Activation is not done in Measurement Gaps"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that DL SPS Activation is not done in Measurement Gaps"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="34"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #Send BO to activate SPS in Meas gap period
      <tapa.send>
         <tapa.tfu.tti.ind numTti="25"/>
      </tapa.send>


      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.80
#
#       Desc:   " TC_MAC_TDD_SPS_80 
#                 Verify that Dynamic scheduling for SPS LC Data is not done in Measurement Gaps for UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.80" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Dynamic scheduling for SPS LC Data is not done in Measurement Gaps"
      </tapa.desc>

      <tapa.longdesc>
         "Verify that Dynamic scheduling for SPS LC Data is not done in Measurement Gaps"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="50"  DLSPSMaxBw="12"
         ulStartSfIdxLst="0" rntiSize="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="1" n1PucchVal0="1" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="34"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      ###RACH and UE Config Complete

# [3 ,3]
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

# [3 ,7]
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [3 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
# [4 ,5]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [4 ,8]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.81
#
#       Desc:   " TC_MAC_TDD_SPS_81 
#                 To test Meas Gap collision with release PDCCH for UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.81" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test Meas Gap collision with release PDCCH"
      </tapa.desc>

      <tapa.longdesc>
         "To test Meas Gap collision with release PDCCH"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="50"  DLSPSMaxBw="12"
         ulStartSfIdxLst="0" rntiSize="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="1" n1PucchVal0="1" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="34"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      ###RACH and UE Config Complete

# [3 ,3]
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

# [3 ,7]
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [3 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
# [4 ,5]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [4 ,8]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="17"/>
      </tapa.send>
     
      ###Send BO to activate SPS
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [6 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [7 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [7 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [9 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [9 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [10 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [11 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [11 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #SPS RELEASE DUE TO SPS LC DEL  
      # Send LC Delete Request for the same LC created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="3" dir="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send LC Delete Request for the same LC created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="3" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [11 ,8]
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
              chkFrmt1aRelPdcch="TRUE" />
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.82
#
#       Desc:   " TC_MAC_TDD_SPS_82 
#                 Verify SPS Reactivation when reconfiguration of Meas Gap results in collision with SPS Occasions for UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.82" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify SPS Reactivation when reconfiguration of Meas Gap results in collision with SPS Occasions"
      </tapa.desc>

      <tapa.longdesc>
         "Verify SPS Reactivation when reconfiguration of Meas Gap results in collision with SPS Occasions"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="50"  DLSPSMaxBw="12"
         ulStartSfIdxLst="0" rntiSize="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="1" n1PucchVal0="1" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="34"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      ###RACH and UE Config Complete

# [3 ,3]
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

# [3 ,7]
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [3 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
# [4 ,5]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [4 ,8]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="17"/>
      </tapa.send>
     
      ###Send BO to activate SPS
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [6 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [7 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [7 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [9 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [9 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #<tapa.send>
         # Send BO for the created SPS service on RGU 
      #   <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      #</tapa.send>

      ##Reconfig the UE with new MeasGap Config
      #<tapa.send>
      #   <tapa.crg.cfgreq.recfg.ue/>
      #</tapa.send>

      # Expect success in cfg cfm
      #<tapa.expect>
      #   <tapa.crg.cfgcfm/>
      #</tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue oldUeId="0" UeReCfgType="256" instId="5" 
            isMesGapEnabled="TRUE" gapPrd="40" gapOffst="24"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>


      #<tapa.send>
         # Send BO for the created SPS service on RGU 
      #   <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      #</tapa.send>

     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      #<tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
      #   <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      #</tapa.expset>

      #<tapa.send>
         # Send data with size equal to the allocated size on RGU. 
      #   <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      #</tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [9 ,7]
      <tapa.expset>
         #<tapa.tfu.dat.req datReqs="1">
         #   <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
         #      validateSPS ="TRUE" DLSPSInit="TRUE"/>
         #</tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" chkFrmt1aRelPdcch="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [10 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [10 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.83
#
#       Desc:   " TC_MAC_TDD_SPS_83 
#                 To verify SPS Retx are not scheduled in case of collision with Meas Gaps for UL/DL Config 1
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.83" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify SPS Retx are not scheduled in case of collision with Meas Gaps"
      </tapa.desc>

      <tapa.longdesc>
         "To verify SPS Retx are not scheduled in case of collision with Meas Gaps"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      #Initialize CELL
      <tapa.rg.cellInit  ulDlCfgIdx="1" spclSfCfgIdx="7"
         numRsc="1" freqIdxLst="0" sfnLst="2" halfFrmLst="0"  dlTotalBw="50"  DLSPSMaxBw="12"
         ulStartSfIdxLst="0" rntiSize="2" />
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
### UL DL CFG 1 SP CL  CFG 7

   <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 3] 
   <tapa.send>
   <tapa.tfu.rareq.ind numRaRntis="1">
   <tapa.tfu.rareq raRnti="3" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
   </tapa.tfu.rareq.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [0, 7] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.rarsp.req raRnti="3"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="8"/>
   </tapa.send>

# [1, 5]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.msg3.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

# [1,9]
   <tapa.send>
   <tapa.tfu.crc.ind>
   <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
   </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.dat.ind datInds="1">
   <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
   </tapa.tfu.dat.ind>      
   </tapa.send>   

   <tapa.expect>
   <tapa.rgu.cdatind ueId="0" lcId="4"/>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 0] 
   <tapa.expect>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
   </tapa.tfu.cntrl.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>

# [2, 2] 
# Send BO for Msg4 on RGU.
   <tapa.send>
   <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 3] 
# Expect CStatInd For MSG4
   <tapa.expset>
   <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   <tapa.send>
   <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

# [2, 4] 
   <tapa.expset>
   <tapa.tfu.dat.req datReqs="1">
   <tapa.tfu.pdsch.dat.req use="1" validate="TRUE"/>
   </tapa.tfu.dat.req>
   <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
   <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
   </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="6"/>
   </tapa.send>

#[3, 0]
   <tapa.expect>
   <tapa.tfu.recp.req numRntis="1" spId="1">
   <tapa.tfu.hq.recp.req/>
   </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
   <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

# [3 ,3]
   <tapa.send>
   <tapa.tfu.hq.ind>
   <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
   </tapa.tfu.hq.ind>
   </tapa.send>

### UL DL CFG 1 


      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"
            NumPucchVal="1" n1PucchVal0="1" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="34"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
     
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
      ###RACH and UE Config Complete

# [3 ,3]
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

# [3 ,7]
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [3 ,8]
      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
# [4 ,5]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [4 ,8]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="17"/>
      </tapa.send>
     
      ###Send BO to activate SPS
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [6 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [7 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [7 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [8 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [9 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [9 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
     
      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
# [10 ,7]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
# [11 ,1]
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [11 ,4]
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
# [11 ,7]
      ##Two DL/SP SF are skipped due to RetX not allowed in DL SF 0 and SP SF for Tx of DL SF
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
# [12 ,2]
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE" isRetx="TRUE" retxUse="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.84
#
#       Desc:   " TC_MAC_TDD_SPS_84 
#                 To verify SPS is not activated during DRX time for UL/DL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.84" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify SPS is not activated during DRX time"
      </tapa.desc>

      <tapa.longdesc>
         "To verify SPS is not activated during DRX time"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send UE Reconfig request to enable DRX
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" oldUeId="0" UeReCfgType="131072"
         isDrxEnabled="TRUE"
         drxOnDurTmr="2"
         drxInactvTmr="3"
         drxRetxTmr="4"
         longDrxCycle="20"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.85
#
#       Desc:   " TC_MAC_TDD_SPS_85
#                 To verify SPS release PDCCH is not sent during DRX time for DL/UL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.85" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify SPS release PDCCH is not sent during DRX time"
      </tapa.desc>

      <tapa.longdesc>
         "To verify SPS release PDCCH is not sent during DRX time"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send UE Reconfig request to enable DRX
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" oldUeId="0" UeReCfgType="131072"
         isDrxEnabled="TRUE"
         drxOnDurTmr="2"
         drxInactvTmr="3"
         drxRetxTmr="4"
         longDrxCycle="20"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.86
#
#       Desc:   " TC_MAC_TDD_SPS_86
#                 To verify retransmission of SPS data is done in UE's on duration: DRX-retx timer is running for DL/UL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.86" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify retransmission of SPS data is done in UE's on duration: DRX-retx timer is running"
      </tapa.desc>

      <tapa.longdesc>
         "To verify retransmission of SPS data is done in UE's on duration: DRX-retx timer is running"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Send UE Reconfig request to enable DRX
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" oldUeId="0" UeReCfgType="131072"
         isDrxEnabled="TRUE"
         drxOnDurTmr="2"
         drxInactvTmr="2"
         drxRetxTmr="6"
         longDrxCycle="20"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="14"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      #Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Send NACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

       <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" isRetx="TRUE" retxUse="5"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" isRetx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.87
#
#       Desc:   " TC_MAC_TDD_SPS_87
#                 To verify SPS reactivation is not sent in DRX time for DL/UL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.87" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify SPS reactivation is not sent in DRX time."
      </tapa.desc>

      <tapa.longdesc>
         "To verify SPS reactivation is not sent in DRX time. "
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     # Send NACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send UE Reconfig request to enable DRX
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" oldUeId="0" UeReCfgType="131072"
         isDrxEnabled="TRUE"
         drxOnDurTmr="2"
         drxInactvTmr="2"
         drxRetxTmr="2"
         longDrxCycle="20"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="19"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      #Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="3" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="14"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="0"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      #<tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
      #   <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      #</tapa.expect>

      #<tapa.send>
         # Send data with size equal to the allocated size on RGU. 
      #   <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      #</tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##DL SPS Reactivation PDCCH
      <tapa.expset>
         #<tapa.tfu.dat.req datReqs="1">
         #   <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
         #      validateSPS ="TRUE" DLSPSInit="TRUE"/>
         #</tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" chkFrmt1aRelPdcch="TRUE"/>
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

     <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.88
#
#       Desc:   " TC_MAC_TDD_SPS_88
#                 To verify SPS scheduling in DRX time on SPS occasion for DL/UL Config 2"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.88" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify SPS scheduling in DRX time on SPS occasion"
      </tapa.desc>

      <tapa.longdesc>
         "To verify SPS scheduling in DRX time on SPS occasion"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="LTEMAC_DRX"/>
         <tapa.flag id="RGR_V2" />
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" saveTo="5"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     # Send NACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send UE Reconfig request to enable DRX
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue instId="5" oldUeId="0" UeReCfgType="131072"
         isDrxEnabled="TRUE"
         drxOnDurTmr="2"
         drxInactvTmr="2"
         drxRetxTmr="2"
         longDrxCycle="20"
         isShortDrxPrsnt="FALSE"
         shortDrxCycle="5"
         drxStartOffst="19"/>
      </tapa.send>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      #Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>
 
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##DL SPS Reactivation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

     <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.89
#
#       Desc:    TC_MAC_TDD_SPS_89
#                To verify UL SPS shouldn't be activated when PHR MAC CE comes
#                along, even when BSR > SID Packet Size.
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.89">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To verify UL SPS shouldn't be activated when PHR MAC CE comes
           along, even when BSR > SID Packet Size."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Give a low value of CQI such that maxRbs would be less to activate SPS
      # with a low PHR.
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="8"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Since CQI is low(8), even with PHR of 20, SPS is not activated.
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" 
             addPhr="TRUE" phr="10"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           #SPS Activation doesnot because of PHR and the BSR is scheduled dynamically
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.90
#
#       Desc:    TC_MAC_TDD_SPS_90 
#                To verify UL SPS(TDD) activation to deactivation with 
#                two interval config true and UL/DL Config 2
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.90">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify basic UL SPS (TDD) with two interval config."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         ulTotalBw="100" rntiSize="2" />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd2 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535"/>

      # UE entry and config end
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
        #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	# Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="10" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Nothing should be there, as there is no BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
      #1st empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      #2nd empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>


#
#
#       Test:    33.91
#
#       Desc:    TC_MAC_TDD_SPS_91 
#                Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="33.91">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 1."
      </tapa.desc>

      <tapa.longdesc/>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      #<tapa.rg.cellInit ulDlCfgIdx="1"  />
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE" ueId="0"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" ULSPSTwoIntConf="TRUE" txModeEnum="3"
      prdBsrTmr="65535" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
       
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    33.92
#
#       Desc:    TC_MAC_TDD_SPS_92
#                Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="33.92">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 2."
      </tapa.desc>

      <tapa.longdesc/>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Do RACH init
      <tapa.rg.rachtdd2/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE" ueId="0"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" ULSPSTwoIntConf="TRUE" txModeEnum="3"
      prdBsrTmr="65535" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
       
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    33.93
#
#       Desc:    TC_MAC_TDD_SPS_93 
#                Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="33.93">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 1."
      </tapa.desc>

      <tapa.longdesc/>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      #<tapa.rg.cellInit ulDlCfgIdx="1"  />
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE" ueId="0"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" ULSPSTwoIntConf="FALSE" txModeEnum="4"
      prdBsrTmr="65535" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
       
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    33.94
#
#       Desc:    TC_MAC_TDD_SPS_94
#                Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="33.94">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify successful configuration of UL UE SPS Parameters at Scheduler during UE Configuration UL/DL Config 2."
      </tapa.desc>

      <tapa.longdesc/>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Do RACH init
      <tapa.rg.rachtdd2/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE" ueId="0"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" ULSPSTwoIntConf="FALSE" txModeEnum="4"
      prdBsrTmr="65535" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
       
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    33.95
#
#       Desc:    TC_MAC_TDD_SPS_95 
#                Verify unsuccessful configuration of UL UE SPS Parameters at Scheduler during 
#                UE Configuration when it has invalid periodicity for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="33.95">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify unsuccessful configuration of UL UE SPS Parameters at Scheduler during UE Configuration when it has invalid periodicity for UL/DL Config 1."
      </tapa.desc>

      <tapa.longdesc/>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      #<tapa.rg.cellInit ulDlCfgIdx="1"  />
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Do RACH init
      <tapa.rg.rachtdd1/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request with invalid interval
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE" ueId="0"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_64SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" ULSPSTwoIntConf="FALSE" txModeEnum="4"
      prdBsrTmr="65535" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
       
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    33.96
#
#       Desc:    TC_MAC_TDD_SPS_96
#                Verify unsuccessful configuration of UL UE SPS Parameters at Scheduler during UE Configuration 
#                when it has invalid periodicity for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc11.xml
#
#
<tapa.testcase id="33.96">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify unsuccessful configuration of UL UE SPS Parameters at Scheduler during UE Configuration when it has invalid periodicity for UL/DL Config 2."
      </tapa.desc>

      <tapa.longdesc/>
   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Do RACH init
      <tapa.rg.rachtdd2/>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="TRUE" ueId="0"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_64SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" ULSPSTwoIntConf="FALSE" txModeEnum="4"
      prdBsrTmr="65535" />
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>
       
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#
#       Test:    33.97
#
#       Desc:    TC_MAC_TDD_SPS_97 
#                To verify successful SPS activation in a UE in uplink on receiving BSR on SPS logical channel for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
<tapa.testcase id="33.97">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful SPS activation in a UE in uplink on receiving BSR on SPS logical channel."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="FALSE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="100" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Nothing should be there, as there is no BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>
      #1st empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>
      #2nd empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.98
#
#       Desc:    TC_MAC_TDD_SPS_98 
#                To verify successful SPS activation for a UE in uplink upon receiving data for SPS logical channel for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.98">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify basic UL SPS (TDD) with two interval config."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         ulTotalBw="100" rntiSize="2" />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd2 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535"/>

      # UE entry and config end
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
        #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	# Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="200" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Nothing should be there, as there is no BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
      #1st empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      #2nd empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.99
#
#       Desc:    TC_MAC_TDD_SPS_99 
#                To verify resending SPS activation PDCCH on CRC failure till maxUlTxCnt for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.99">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify basic UL SPS (TDD) with two interval config."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         ulTotalBw="100" rntiSize="2" />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd2 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" maxUlHqTx="2"/>

      # UE entry and config end
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" SPSRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      #<tapa.send>
      #   <tapa.tfu.dat.ind datInds="1">
      #      <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      #         lcId="4" isSpsRnti="TRUE" bsr="200" />
      #   </tapa.tfu.dat.ind>
      #</tapa.send>

      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" SPSRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      #<tapa.send>
      #   <tapa.tfu.dat.ind datInds="1">
      #      <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
      #         lcId="4" isSpsRnti="TRUE" />
      #   </tapa.tfu.dat.ind>
      #</tapa.send>

      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" SPSRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
           # <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE" ULSPSRel="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.100
#
#       Desc:    TC_MAC_TDD_SPS_100 
#                To verify SPS is not activated in a UE in uplink as long as BSR for SPS LCG remains < SID Packet Size for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.100">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify SPS is not activated in a UE in uplink as long as BSR for SPS LCG remains less than SID Packet Size ."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="FALSE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      # Since SID packet size is 10, we send a BSR of 0 index (index 1 gives 10 bytes)
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="0" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH 
      # No PDCCH is received for SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            #<tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>



   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.101
#
#       Desc:    TC_MAC_TDD_SPS_101 
#                To verify that MAC shall  activate Second SPS UE in next TTI when it doesn't 
#                have sufficient bandwidth for Second UE for UL/DL Config 2
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.101">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify that MAC shall  activate Second SPS UE in next TTI when it doesn't have sufficient bandwidth for Second UE."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" 
       DLSPSMaxBw="40"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="2" rapIds="5:10" cqiPres="TRUE:TRUE" cqis="4:4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="2" spId="1">
            <tapa.tfu.msg3.recp.req ueId="0" />
            <tapa.tfu.msg3.recp.req ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg3 for 1st UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      #Send CRC for Msg3 for 2nd UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req for 1st UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Send Message3 after receiving Message3 reception req for 2nd UE .
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   

   <tapa.send>
      <tapa.tfu.tti.ind numTti="2"/>
   </tapa.send>
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expset>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expset>

    # Send BO for Msg4 on RGU for 1st UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="0"/>
    </tapa.send>

    # Send BO for Msg4 on RGU for 2nd UE.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4"/>
      <tapa.rgu.cstaind lcId="4"/>
   </tapa.expset>

   # Send Msg4 on RGU for 1st UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
   </tapa.send>

   # Send Msg4 on RGU for 2nd UE.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req numRntis="2" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
        <tapa.tfu.hq.recp.req ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4 for 1st UE.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="2">
        <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
        <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="0"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.crg.cfgreq.cfg.ue ueId="1"/>
   </tapa.send>

   # Expect success in cfg cfm for 1st UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Expect success in cfg cfm for 2nd UE
   <tapa.expect>
      <tapa.crg.cfgcfm/>
   </tapa.expect>

   # Send UE config request for 1st UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="0" prdBsrTmr="65535"
      ULSPSTwoIntConf="FALSE" ULSPSEnFlag="TRUE" DLSPSEnFlag="FALSE" 
      ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSPcktSize="80" ULSPSimpRls="2"
      SPSRnti="75"/>
   </tapa.send>

   # Send UE config request for 2nd UE
   <tapa.send>
     <tapa.rgr.cfgreq.cfg.ue instId="5" ueId="1" prdBsrTmr="65535"
      ULSPSTwoIntConf="FALSE" ULSPSEnFlag="TRUE" DLSPSEnFlag="FALSE" 
      ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSPcktSize="80" ULSPSimpRls="2"
      SPSRnti="76"/>
   </tapa.send>

   # Send TTI to apply the config
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   # Expect success in cfg cfm
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>

   #Till now RACH and basic UE context is setup
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>

      # UE entry and config end
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      
      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" dir="3" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" dir="3" lcType="5" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req saveTo="5" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ueId="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" ueId="0"/>
         </tapa.tfu.recp.req>   
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="6" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="5" use="2"/>
            <tapa.tfu.dat  ueId="1"
               addShortBsr="TRUE" lcgId="1" bsr="5" use="5"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH 
      # No PDCCH is received for SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="4">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="4" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="5"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.102
#
#       Desc:    TC_MAC_TDD_SPS_102 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 2 
#                and twoIntervalCfg is enabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.102">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 2 and twoIntervalCfg is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="100" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="10"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.103
#
#       Desc:    TC_MAC_TDD_SPS_103 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 7 
#                and twoIntervalCfg is enabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.103">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 7 and twoIntervalCfg is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="100" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="10"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.104
#
#       Desc:    TC_MAC_TDD_SPS_104 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 2 
#                and twoIntervalCfg is disabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.104">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 2 and twoIntervalCfg is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="FALSE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="0" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.105
#
#       Desc:    TC_MAC_TDD_SPS_105 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 7 
#                and twoIntervalCfg is disabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.105">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 7 and twoIntervalCfg is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="FALSE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="0" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#
#       Test:    33.106
#
#       Desc:    TC_MAC_TDD_SPS_106 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 3 
#                and twoIntervalCfg is enabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.106">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 3 and twoIntervalCfg is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="100" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.107
#
#       Desc:    TC_MAC_TDD_SPS_107 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 8 
#                and twoIntervalCfg is enabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.107">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 8 and twoIntervalCfg is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="TRUE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="100" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="0"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.108
#
#       Desc:    TC_MAC_TDD_SPS_108 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 3 
#                and twoIntervalCfg is disabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.108">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 3 and twoIntervalCfg is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="FALSE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="100" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>
#
#
#       Test:    33.109
#
#       Desc:    TC_MAC_TDD_SPS_109 
#                Verify the Max number of HARQ process used when the SPS activation happens at subframe 8 
#                and twoIntervalCfg is disabled for UL/DL Config 1
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.109">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the Max number of HARQ process used when the SPS activation happens at subframe 8 and twoIntervalCfg is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd1 ULSPSTwoIntConf="FALSE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="75" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535" />
      
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" bsr="100" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addShortBsr="TRUE" lcgId="1" bsr="0"/>
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>




#
#
#       Test:    33.110
#
#       Desc:    TC_MAC_TDD_SPS_110
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 2 (ULDLCfg-1) and 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.110">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 2 (ULDLCfg-1) and twoIntervalCfg
          is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"
         startRnti="70" rntiSize="10" DLSPSMaxBw="40"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect second retransmission of SPS activation for subframe 2
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect First SPS occasion at sf3 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 3)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect third retransmission of SPS activation for subframe 2 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect First retransmission of first SPS occasion at sf3 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 3)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect new tx at second SPS occasion (sf 2)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.111
#
#       Desc:    TC_MAC_TDD_SPS_111
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 7 (ULDLCfg-1) and 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.111">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 7 (ULDLCfg-1) and twoIntervalCfg
          is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect second retransmission of SPS activation for subframe7
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect First SPS occasion at sf8 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 8)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect third retransmission of SPS activation for subframe 7 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect First retransmission of first SPS occasion at sf8 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 8)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect new tx at second SPS occasion (sf 7)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.112
#
#       Desc:    TC_MAC_TDD_SPS_112
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 2 (ULDLCfg-1) and 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.112">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 2 (ULDLCfg-1) and twoIntervalCfg
          is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect new transmission on SPS occasion for subframe 2
      # as twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.113
#
#       Desc:    TC_MAC_TDD_SPS_113
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 7 (ULDLCfg-1) and 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.113">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 2 (ULDLCfg-1) and twoIntervalCfg
          is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect new transmission on SPS occasion for subframe 7
      # as twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.114
#
#       Desc:    TC_MAC_TDD_SPS_114
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 3 (ULDLCfg-1) and 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.114">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 3 (ULDLCfg-1) and twoIntervalCfg
          is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for subframe 3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 3
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 3
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect First SPS occasion at sf2 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect second retransmission of SPS activation for subframe 3
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS activation (sf 3)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect First retransmission of first SPS occasion at sf2 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect third retransmission of SPS activation for subframe 3 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS activation (sf 3)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect second retransmission of first SPS occasion at sf2 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect new tx at second SPS occasion (sf 3)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.115
#
#       Desc:    TC_MAC_TDD_SPS_115
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 8 (ULDLCfg-1) and 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.115">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 8 (ULDLCfg-1) and twoIntervalCfg
          is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect second retransmission of SPS activation for subframe 8
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS activation (sf 8)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect First retransmission of first SPS occasion at sf7 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect third retransmission of SPS activation for subframe 8 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS activation (sf 8)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect second retransmission of first SPS occasion at sf7 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect new tx at second SPS occasion (sf 8)
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.116
#
#       Desc:    TC_MAC_TDD_SPS_116
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 3 (ULDLCfg-1) and 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.116">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 3 (ULDLCfg-1) and twoIntervalCfg
          is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for subframe 3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 3
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 3
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect new tx at second SPS occasion (sf 3) after on retransmission
      # as twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.117
#
#       Desc:    TC_MAC_TDD_SPS_117
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 8 (ULDLCfg-1) and 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.117">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 8 (ULDLCfg-1) and twoIntervalCfg
          is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect new tx at second SPS occasion (sf 8) after on retransmission
      # as twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.118
#
#       Desc:    TC_MAC_TDD_SPS_118
#                To Verify the Max number of HARQ process used when 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.118">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "Verify maximum number of HARQ process used is 2 after activation at 
          subframe 2 such that SPS data can be on subframe 2 or 7 when 
          twoIntervalCfg is enabled."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Expect Second SPS occasion at sf2 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.119
#
#       Desc:    TC_MAC_TDD_SPS_119
#                To Verify the Max number of HARQ process used when 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.119">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "Verify maximum number of HARQ process used is 2 after activation at 
          subframe 7 such that SPS data can be on subframe 2 or 7 when 
          twoIntervalCfg is enabled."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Expect First SPS occasion at sf2 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      # Expect Second SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.120
#
#       Desc:    TC_MAC_TDD_SPS_120
#                To Verify the Max number of HARQ process used when 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.120">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "Verify maximum number of HARQ process used is 1 after activation at 
          subframe 2 such that SPS data can be on subframe 2 always
          twoIntervalCfg is disabled."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      # Expect First SPS occasion at sf2 as twoIntervalCfg is disabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      # Expect Second SPS occasion at sf2 as twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#       Test:    33.121
#
#       Desc:    TC_MAC_TDD_SPS_121
#                To Verify the Max number of HARQ process used when 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.121">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "Verify maximum number of HARQ process used is 1 after activation at 
          subframe 7 such that SPS data can be on subframe 7 always
          twoIntervalCfg is disabled."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      # Expect First SPS occasion at sf7 as twoIntervalCfg is disabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      # Expect Second SPS occasion at sf7 as twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.122
#
#       Desc:    TC_MAC_TDD_SPS_122
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 2 (ULDLCfg-2) and 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.122">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 2 (ULDLCfg-2) and twoIntervalCfg
          is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect second retransmission of SPS activation for subframe 2
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect third retransmission of SPS activation for subframe 2 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS activation (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect first retransmission of SPS occasion for subframe 7 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect newtx of SPS occasion for subframe 2 after third retx as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.123
#
#       Desc:    TC_MAC_TDD_SPS_123
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 7 (ULDLCfg-2) and 
#                twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.123">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 7 (ULDLCfg-2) and twoIntervalCfg
          is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect First SPS occasion at sf2 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect second retransmission of SPS activation for subframe 7
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect first retransmission of SPS occasion for subframe 2 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion(sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect third retransmission of SPS activation for subframe 7
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect second retransmission of SPS occasion for subframe 2 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect newtx of SPS occasion for subframe 7 after third retx as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
   
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.124
7
#       Desc:    TC_MAC_TDD_SPS_124
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 2 (ULDLCfg-2) and 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.124">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 2 (ULDLCfg-2) and twoIntervalCfg
          is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect newtx of SPS occasion for subframe 2 after one retx as 
      # twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.125
#
#       Desc:    TC_MAC_TDD_SPS_125
#                To Verify the Max number of HARQ retransmission when the 
#                SPS activation happens at subframe 7 (ULDLCfg-2) and 
#                twoIntervalCfg is disabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.125">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To Verify the Max number of HARQ retransmission when the SPS 
          activation happens at subframe 7 (ULDLCfg-2) and twoIntervalCfg
          is disabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="FALSE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect newtx of SPS occasion for subframe 7 after one retx as 
      # twoIntervalCfg is disabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.126
#
#       Desc:    TC_MAC_TDD_SPS_126
#                To Verify release of harq proc after max-retransmission 
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.126">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To verify release of harq proc after max-retransmission"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="3" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect second retransmission of SPS activation for subframe 2
      # as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect First SPS occasion at sf3 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Do not send CRC IND such that retx will happen for SPS occasion (sf 3)

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # No more retransmission expected for SPS activation as
      # maxUlHqTx is reached and HqProc is got released

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect First retransmission of first SPS occasion at sf3 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 3)
 
      #Expect SPS activation again for subframe 2 as the maxUlHqTx is reached
      #with CRC Failure 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.127
#
#       Desc:    TC_MAC_TDD_SPS_127
#                To verify the non-adaptive retransmission of SPS data in 
#                uplink when twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.127">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To verify the non-adaptive retransmission of SPS data in
          uplink when twoIntervalCfg is enabled."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Expect First SPS occasion at sf2 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      # And no PDCCH as the retx can be of non-adaptive type
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect non-adaptive retransmisson at sf2 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.128
#
#       Desc:    TC_MAC_TDD_SPS_128
#                To verify the adaptive retransmission of SPS data in 
#                uplink when twoIntervalCfg is enabled
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.128">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To verify the adaptive retransmission of SPS data in 
           uplink when twoIntervalCfg is enabled"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      # And adaptive retx PDCCH for SPS occasion
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtGrant="TRUE" vldtRetx="TRUE"
               isUlGrant="TRUE" />
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect First retransmission of first SPS occasion at sf7 
      # and MSG3 recp req of second UE
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.msg3.recp.req ueId="1"/>
            <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="7"
               isRetx="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.129
#
#       Desc:    TC_MAC_TDD_SPS_129
#                To verify the SPS scheduling of a UL SPS activated UE is not
#                disturbed with the admission of other SPS UE with the
#                periodicity resulting in change of LCM when twoIntervalCfg is
#                enabled.
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.129">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To verify the SPS scheduling of a UL SPS activated UE is not
           disturbed with the admission of other SPS UE with the
           periodicity resulting in change of LCM when twoIntervalCfg is
           enabled."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>

      #Initialize another UE
      <tapa.rg.UeInitTdd2 ueId="1" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for second UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expset>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

       # Configure bi-directional DTCH for second UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR for second UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Expect First SPS occasion at sf2 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         #Configure SPS for 2nd UE with different periodicity
         <tapa.rgr.cfgreq.recfg.ue oldUeId="1" newUeId="1" UeReCfgType="65536"
            instId="5" ULSPSEnFlag="TRUE"  ULSPSSchIntrv="RGR_SPS_PRD_40SF" 
            ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      # Send SR Indication for second UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE"  
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for second UE
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="3" ueId="1" vldtDatRecp="TRUE" 
               saveTo="4" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" use="4" dedBufIdx="0"
                lcId="4" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="1" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #DCI 0 expected for 2nd UE but SPS activation will not be done 
      #as the SPS resource are limited to 1st UE
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect Second SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE" 
               saveTo="6"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
    
      # SPS activation expected as the resources found in other UL subframe 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="4" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
      </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect data reception request for 2nd UE on SPS occasion
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="1" use="4" vldtDatRecp="TRUE" 
               saveTo="5" isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect third SPS occasion at sf2 for 1st UE
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.130
#
#       Desc:    TC_MAC_TDD_SPS_130
#                To verify the path when UEs in UL SPS retransmission queue get
#                priority over new transmission of non SPS data.
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.130">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To verify the path when UEs in UL SPS retransmission queue get
          priority over new transmission of non SPS data."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10" ulTotalBw="50"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>

      #Initialize 2nd UE
      <tapa.rg.UeInitTdd1 ueId="1" prdBsrTmr="65535"/>

      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      # Configure bi-directional DTCH for second UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expset> 
         <tapa.crg.cfgcfm/>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expset>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch  ueId="1" lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="1" lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
         <tapa.rgr.cfgCfm instId="5" ueId="1"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send SR Indication for second UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and DCI0 for 2nd UE
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for 1st UE 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect data recp for 2nd UE
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE" 
               saveTo="4" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect data reception request of SPS activation for 1st UE
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send bigger BSR such that multiple DCI0 should be received 
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" addShortBsr="TRUE" lcgId="1" bsr="30" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      # and DCI0 of 2nd UE for received BSR
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="3" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      # 2nd DCI0 of 2nd UE for outstanding BSR
      # Multiple DCI0 are expected for non-SPS UE as the retx of SPS UE is 
      # given priority over newtx of nonSPS UE
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="5" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Expect first retransmission of SPS UE and UL data of 2nd UE
      # Retx of SPS UE is given priority over newtx of non-SPS UE
      # Hence newtx DCI0 of non-SPS UE are spread over 2 UL TTIs
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE"/>
            <tapa.tfu.pusch.recp.req ueId="1" use="3" vldtDatRecp="TRUE" 
               saveTo="4"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#       Test:    33.131
#
#       Desc:    TC_MAC_TDD_SPS_131
#                To Verify the SPS release by receiving CRC failure 
#                RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) times 
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.131">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To Verify the SPS release by receiving CRC failure 
           RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) times "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="1" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
     
      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #First CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect second SPS occasion at sf2 as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Third CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Expect second SPS occasion at sf2 as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Third CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>





<!--
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0"
              isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#       Test:    33.132
#
#       Desc:    TC_MAC_TDD_SPS_132
#                To Verify the count reset if CRC success received before 
#                RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) reaches 
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.132">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To Verify the SPS release by receiving CRC failure 
           RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) times "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="1" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
     
      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #First CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect second SPS occasion at sf2 as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Third CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      # Expect second SPS occasion at sf2 as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Third CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>



      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>



      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect second SPS occasion at sf2 as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>



   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
 

     
#
#       Test:    33.133
#
#       Desc:    TC_MAC_TDD_SPS_133
#                To Verify the count reset if CRC success received at  
#                end of RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) 
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.133">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To Verify the count reset if CRC success received at  
           end of RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL(7) "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>
     
      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #First CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      # Expect first retransmission of SPS occasion for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Second CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect second SPS occasion at sf2 as twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Third CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect second retransmission of SPS occasion at subframe 7 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Fourth CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect First retx of 2nd SPS occasion at sf2 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Fifth CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect third retransmission of SPS occasion for subframe 7 as 
      # twoIntervalCfg is enabled
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Sixth CRC Failure
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect second retx of 2nd SPS occasion at sf2 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
   
      # Sending CRC Success here such that RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL 
      # counter should be reset
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect newtx at sf7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
    
      # Expect HARQ ACK in PHICH
      # and no UL SPS Rel after RGSCH_SPS_MAX_UL_SPS_OCC_CRC_FAIL CRC failures
      # because CRC SUCCESS received at end of the counter
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.134
#
#       Desc:    TC_MAC_TDD_SPS_134
#                Verify the DAI in UL DCI (Format 0) when DL SPS Data is 
#                transmitted.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.134">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the DAI in UL DCI (Format 0) when DL SPS Data is transmitted."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "1" dir = "3" 
            lcType = "5" DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" 
            DLSPSLchPktPrd="20" DLSPSLchExpltRelCnt="2"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
   
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      # No Sta Ind received till SPS occasion
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>
   
      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      #Send SR for UL DCI
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DAI from DCI0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.135
#
#       Desc:    TC_MAC_TDD_SPS_135
#                Verify the DAI in UL DCI (Format 0) when no DL SPS Data is 
#                transmitted.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.135">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the DAI in UL DCI (Format 0) when no DL SPS Data is transmitted."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "1" dir = "3" 
            lcType = "5" DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" 
            DLSPSLchPktPrd="20" DLSPSLchExpltRelCnt="2"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send SR for UL DCI
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DAI  as 4 from DCI0 because there is no DL data now
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="4"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.136
#
#       Desc:    TC_MAC_TDD_SPS_136
#                Verify the DAI in UL DCI (Format 0)  when there is PDCCH 
#                coresponding to SPS release.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.136">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "Verify the DAI in UL DCI (Format 0)  when there is PDCCH coresponding
          to SPS release."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "1" dir = "3" 
            lcType = "5" DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" 
            DLSPSLchPktPrd="20" DLSPSLchExpltRelCnt="2"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      #Do not send BO such that DL SPS release can happen   

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      #Do not send BO such that DL SPS release can happen   

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH Release for DL SPS after reaching Explicit release count
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
              chkFrmt1aRelPdcch="TRUE" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #Send SR for UL DCI
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DAI from DCI0 after PDCCH release
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE" vldtDai="TRUE" dai="1"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.137
#
#       Desc:    TC_MAC_TDD_SPS_137
#                To verify successful deactivation (Implicit Release) of UL SPS
#                alone in a UE (and continue with DL SPS): ImplicitRel Counter 
#                hits max configured value.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.137">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful deactivation (Implicit Release) of UL SPS alone 
          in a UE (and continue with DL SPS): ImplicitRel Counter hits max 
          configured value."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="5"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "1" dir = "3" 
            lcType = "5" DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" 
            DLSPSLchPktPrd="20" DLSPSLchExpltRelCnt="2"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # ACK sent for First BO
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      #  and staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
         <tapa.rgu.dstaind lchTb1Data="3"  saveTo="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication without SPS data
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
         # Expect staInd from MAC to RLC for SPS service on SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

     # Send Data Indication without SPS data such that UL SPS will be released 
     # implicitly
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expecting only HARQ Recp and no PUSCH recp req is expected as UL SPS is 
      #implicitly released
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.138
#
#       Desc:    TC_MAC_TDD_SPS_138
#                To verify successful deactivation (Explicit Release) of UL SPS
#                alone in a UE (and continue with DL SPS): Non SPS data on SPS 
#                occasions
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.138">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify successful deactivation (Explicit Release) of UL SPS
           alone in a UE (and continue with DL SPS): Non SPS data on SPS 
           occasions"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="5"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated non-SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" 
            DLSPSLchPktPrd="20" DLSPSLchExpltRelCnt="2"/>
      </tapa.send>
      
      <tapa.send>
         # Create non-SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "2" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Configure non-SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="1"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request together with HARQ recp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Second BO Upd sent on SPS service with in 20 TTIs
      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="4"  saveTo="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # BO for SPS LC
      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send Data Indication with non-SPS data
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="3" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send SPS BO
      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req />
         </tapa.tfu.recp.req>   
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

     # Send Data for non-SPS LC such that UL SPS will be released explictly
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expecting only HARQ Recp for DL SPS
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send Data Indication with non-SPS data
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="3" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Sent 3(implicitCount+1) times non-SPS data on SPS occasion such that 
      # explicit UL SPS can happen
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0"
              isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0"
              isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>



      #Send SPS BO such that DL SPS will be continued
      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.139
#
#       Desc:    TC_MAC_TDD_SPS_139
#                To verify successful deactivation (Explicit Release) of UL SPS 
#                in a UE : LCG deletion.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.139">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful deactivation (Explicit Release) of UL SPS in a UE
          : LCG deletion."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" startRnti="70" rntiSize="10" DLSPSMaxBw="40" />
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  lcId="4"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  lcId="4"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  lcId="4"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>

      # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect Release PDCCH from MAC to PHY after LCG Delete.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.140
#
#       Desc:    TC_MAC_TDD_SPS_140
#                To verify successful deactivation (Explicit Release) of UL SPS
#                alone in a UE : Release PDCCH does not reach UE and is 
#                resent (DTX).
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.140">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify successful deactivation (Explicit Release) of UL SPS #                alone in a UE : Release PDCCH does not reach UE and is 
          resent (DTX)."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated non-SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" 
            DLSPSLchPktPrd="20" DLSPSLchExpltRelCnt="2"/>
      </tapa.send>
      
      <tapa.send>
         # Create non-SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "2" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Configure non-SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>

      # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect Release PDCCH from MAC to PHY after LCG Delete.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3"
               isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

     # Expect Release PDCCH from MAC to PHY after LCG Delete.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3"
               isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


 <!--
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Considering UE did not receive PDCCH release, send CRC SUCCESS
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      # and PDCCH release again after receiving CRC SUCCESS on SPS occasion
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE" HERE="YES"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3"
               isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication with non-SPS data as the SPS LCG is deleted
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="3" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.141
#
#       Desc:    TC_MAC_TDD_SPS_141
#                To verify explicit release does not happen, eventhough no
#                Data observed on SPS occasions, if SPS data is received in 
#                non SPS occasions.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.141">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify explicit release does not happen, eventhough no
           Data observed on SPS occasions, if SPS data is received in 
           non SPS occasions."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E3" ULSPSTwoIntConf="TRUE"
         maxUlHqTx="5"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication without data for 1st SPS occasion
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expset>
         #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
           <tapa.tfu.pdcch.cntrl.req saveTo="3" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication without data for SPS occasion - 2nd time
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request for non-SPS grant
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" saveTo="4"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      #SPS Data on non-SPS occasions
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="4" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expset>
         #Expect Data reception for SPS occasion at sf7
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication without data -3rdtime
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      #Even after sending empty TB on SPS occasion 3 times (implicit release
       count), data reception request for SPS is received as SPS data was
       sent in between on a non SPS occasion. Hence SPS is not implicitly
       released.
      <tapa.expset>
         #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.142
#
#       Desc:    TC_MAC_TDD_SPS_142
#                To verify successful reactivation of UL SPS on receiving SPS 
#                LCG BSR greater than the current BSR for which SPS is activated
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.142">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify successful reactivation of UL SPS on receiving SPS 
           LCG BSR greater than the current BSR for which SPS is activated"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" 
               addShortBsr="TRUE" lcgId="1" bsr="10"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Received BSR is scheduled dynamically instead of waiting for SPS occasion
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.expset>
         #SPS reactivation happens because of the newly received BSR
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
         #Expect Data reception for Dyn Ul Grant
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="2"
               vldtHarq="TRUE" expHarqProcId="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.143
#
#       Desc:    TC_MAC_TDD_SPS_143
#                To verify the deactivation of UL and DL SPS locally on 
#                reception of MAC CRNTI CE.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.143">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify the deactivation of UL and DL SPS locally on 
           reception of MAC CRNTI CE."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         dlTotalBw="50" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="5"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" 
            DLSPSLchPktPrd="20" DLSPSLchExpltRelCnt="2"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #HQ FDBK for FIRST BO
      <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1">
        <tapa.tfu.hq.recp.req/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # ACK sent for First BO
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      #  and staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
         <tapa.rgu.dstaind lchTb1Data="4"  saveTo="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="TRUE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="1"/>
     </tapa.send>

     <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.hq.recp.req />
        </tapa.tfu.recp.req>   
     </tapa.expect>

     <tapa.send>
        <tapa.tfu.tti.ind numTti="2"/>
     </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
             lcId="4" isSpsRnti="TRUE"  />
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

#####RACH for CRNTI CE
      # Send RaReqInd for one rapId 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="10" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4" ueId="1"/>
         </tapa.tfu.rareq.ind>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="3"/>
      </tapa.expect>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size received
         <tapa.tfu.dat.req datReqs="2">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
               validateSPS ="TRUE"/>
            <tapa.tfu.rarsp.req raRnti="10" vldtRar="TRUE" saveTo="1"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.msg3.recp.req ueId="1" vldtDatRecp="TRUE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send lc="TRUE">
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      #Send MAC CRNTI CE here such that UL and DL SPS should be released implicitly
      <tapa.send lc="TRUE">
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #UE STA IND to APP
      <tapa.expset>
         <tapa.rgr.uestaind />
      </tapa.expset>      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI0 after MAC CRNTI CE.
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>      

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request for grant for contention resoultion.
      <tapa.expect>
        <tapa.tfu.recp.req expRecpReq="1">
           <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
        </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for UL data
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For UL data 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # As ULSPS and DLSPS got released implicitly with MAC CRNTI CE, no recpreq
      # or dat req are expected
      <tapa.send>
         <tapa.tfu.tti.ind numTti="30"/>
      </tapa.send>
 
      #Starting activation of UL and DL SPS again

      #FIRST BO sched dynamically  
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="4" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="4" chkSdu="TRUE"
              validateSPS ="FALSE" DLSPSInit="FALSE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
 
      #DCI0  for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # ACK sent for First BO
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Second BO Upd sent with in 20 TTIs
      <tapa.send>
         <tapa.rgu.dstarsp lcId="4" lcType="5" bo="20"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind lchTb1Data="4"  saveTo="3"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="4" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for DL SPS ACTIVATION and DCI 0 for UL SPS ACTIVATION
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId="0"  use="4" lcId="4" chkSdu="TRUE"
              validateSPS ="TRUE" DLSPSInit="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.pdcch.cntrl.req saveTo="4" DLSPSInit="TRUE" ueId="0" />
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
              isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.144
#
#       Desc:    TC_MAC_TDD_SPS_144
#                To verify deactivation of ULSPS on MAC reset and releases the 
#                SPS resources.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.144">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify deactivation of ULSPS on MAC reset and releases the 
           SPS resources."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

#### UE RESET HERE 
      # Send UE Reset Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Reset Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5"  cellId="3" ueId="0"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      #No Data reception request should be expected for UL SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.145
#
#       Desc:    TC_MAC_TDD_SPS_145
#                To verify reactivation of UL SPS due to re-allocation of 
#                SPS resources due to change in scaled UL CQI.                 
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.145">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify reactivation of UL SPS due to re-allocation of 
           SPS resources due to change in scaled UL CQI. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      #Setting Ul CQI to 6 initially      
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="6"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #SPS Activation from to be actvd list succeeds in the next TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      #Sending Ul CQI as 14
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="14"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>

      #UL SPS re-activated due to scaled CQI leading to change in num of subbands
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.146
#
#       Desc:    TC_MAC_TDD_SPS_146
#                To verify deletion of a UL SPS active UE.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.146">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify deletion of a UL SPS active UE."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

# Send a UE delete request
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="2" ueId="0"/>
      </tapa.send>
     
       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      #No Data reception request should be expected for UL SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="50"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.147
#
#       Desc:    TC_MAC_TDD_SPS_147
#                To verify UL SPS scheduling when PHR is present: de-activate SPS
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.147">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify reactivation of UL SPS due to re-allocation of 
           SPS resources due to change in scaled UL CQI. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      #Setting Ul CQI to 6 initially      
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="6"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE"  />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" addPhr="TRUE" phr="1" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="15"/>
      </tapa.send>
<!-- Can be uncommented if the proper set of config is found
      #UL SPS re-activated due to scaled CQI leading to change in num of subbands
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="3" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
-->
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.148
#
#       Desc:    TC_MAC_TDD_SPS_148
#                To verify re-activation of UL SPS due to collision with 
#                measurment gap which comes in UE-ReCfg.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.148">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify re-activation of UL SPS due to collision with measurment i
          gap which comes in UE-ReCfg."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      /*Sending Meas Gap such that collieds with SPS occassion
      <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" UeReCfgType="256" 
           isMesGapEnabled="TRUE"  gapPrd="40" gapOffst="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # SPS reactivation is expcted after identifying Meas Gap collision
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
              isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"
              ULSPSInit="FALSE" ULSPSReInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS reactivation for subframe 8 
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #PHICH will not be expected as the UE is in Meas Gap

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      # Expect data reception request of SPS occasion for subframe 7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.149
#
#       Desc:    TC_MAC_TDD_SPS_149
#                To verify UL SPS activation doesn't collide with measurement gap.                 
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.149">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify UL SPS activation doesn't collide with measurement gap. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="4" isMesGapEnabled="TRUE"  gapPrd="80" gapOffst="57"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
   
      #UL SPS activation PDCCH is not received as the Meas Gap is started

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
   
      #Expect SPS activation for subframe 7 after Meas Gap expiry
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.150
#
#       Desc:    TC_MAC_TDD_SPS_150
#                To verify the path when feedback (ACK) of UL SPS data 
#                collides with measurement gap (UE assumes ACK).
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.150">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the path when feedback (ACK) of UL SPS data collides with 
          measurement gap (UE assumes ACK)."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      /*Sending Meas Gap such that collieds with SPS occassion
      <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" UeReCfgType="256" 
           isMesGapEnabled="TRUE"  gapPrd="40" gapOffst="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # SPS reactivation is expcted after identifying Meas Gap collision
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
              isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"
              ULSPSInit="FALSE" ULSPSReInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS reactivation for subframe 8 
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #PHICH will not be expected as the UE is in Meas Gap and UE considers ACK

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      # Expect data reception request of SPS occasion for subframe 7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.151
#
#       Desc:    TC_MAC_TDD_SPS_151
#                To verify the path when explicit release PDCCH collides 
#                with measurement gap.                 
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.151">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify the path when explicit release PDCCH collides
           with measurement gap."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="4" isMesGapEnabled="TRUE"  gapPrd="80" gapOffst="17"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
   
      #Expect SPS activation for subframe 2 
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      # Expect data reception request of SPS occasion for subframe 7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
 
      # Send LCG Delete Request at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="4" cellId="3" lcgId="1"/>
      </tapa.send>

      # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #UL SPS Release should not be received here as the Meas Gap is ON

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect Release PDCCH after Meas Gap.
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.152
#
#       Desc:    TC_MAC_TDD_SPS_152
#                To verify the path when feedback (NACK) of UL SPS data 
#                collides with measurement gap (UE assumes ACK).
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.152">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the path when feedback (NACK) of UL SPS data collides with 
          measurement gap (UE assumes ACK)."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      /*Sending Meas Gap such that collieds with SPS occassion
      <tapa.send>
        <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" UeReCfgType="256" 
           isMesGapEnabled="TRUE"  gapPrd="40" gapOffst="20"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # SPS reactivation is expcted after identifying Meas Gap collision
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
          <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
              isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"
              ULSPSInit="FALSE" ULSPSReInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS reactivation for subframe 8 
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #PHICH will not be expected as the UE is in Meas Gap and UE considers ACK

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      # Expect data reception request of SPS occasion for subframe 7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.153
#
#       Desc:    TC_MAC_TDD_SPS_153
#                To verify UL SPS is not activated during DRX time.   
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.153">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify UL SPS activation is not activated during DRX time.
           Send BSR > SID Packet Size is received on SPS LC when UE is in 
           DRX time. (UE can send UL data in DRX).
           PDCCH for SPS activation will be received in next possible 
           on/active time."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="4" isDrxEnabled="TRUE" drxOnDurTmr="2" drxInactvTmr="2" 
         drxRetxTmr="16" longDrxCycle="20" isShortDrxPrsnt="TRUE" 
         shortDrxCycle="5" drxShortCycleTmr="2" drxStartOffst="6"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
  
      #UL SPS Activation is not scheduled during DRX time
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
   
      #Expect SPS activation for subframe 2 in onDuration Timer
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.154
#
#       Desc:    TC_MAC_TDD_SPS_154
#                To verify SPS release PDCCH is not sent during DRX time.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.154">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify SPS release PDCCH is not sent during DRX time.                                                                                            
           UL SPS is activated.
           Send non SPS LCG data on 2 consecutive SPS occasions.         
           SPS release PDCCH is sent after UE comes from DRX time. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" startRnti="70" rntiSize="10" DLSPSMaxBw="40"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" isDrxEnabled="TRUE" drxOnDurTmr="2" drxInactvTmr="2"
         drxRetxTmr="16" longDrxCycle="20" isShortDrxPrsnt="FALSE"
         drxStartOffst="15"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.send>
         # Configure a dedicated non-SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5"/>
      </tapa.send>
      
      <tapa.send>
         # Create non-SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "2" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Configure non-SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="2" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication with non-SPS data
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="3" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf2
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

     # Send Data for non-SPS LC such that UL SPS will be released explictly
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE"  lcId="3"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication with non-SPS data
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="3" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
 
      # Explicit PDCCH Release should not be received here as UE is in DRX time

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
 
      # Sent 3(implicitCount+1) times non-SPS data on SPS occasion such that 
      # explicit UL SPS Release can happen
      # Explicit PDCCH release received once UE moves to onDuration
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0"
              isUlGrant="TRUE" vldtGrant="TRUE" ULSPSRel="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.155
#
#       Desc:    TC_MAC_TDD_SPS_155
#                To verify non-adaptive retransmission of SPS data can be sent 
#                during DRX time.
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.155">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         "To verify non-adaptive retransmission of SPS data can be sent during
          DRX time. UL SPS is activated. Send CRC failure, 
          expect a Nack (non adaptive retx)."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10"
         DLSPSMaxBw="40" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535" 
         isDrxEnabled="TRUE" drxOnDurTmr="5" drxInactvTmr="2"
         drxRetxTmr="16" longDrxCycle="80" isShortDrxPrsnt="TRUE"
         drxStartOffst="3" shortDrxCycle="20" drxShortCycleTmr="2" />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 7
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Expect First SPS occasion at sf2 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 2)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      # And no PDCCH as the retx can be of non-adaptive type
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect non-adaptive retransmisson at sf2 eventhough UE is in DRX time 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.156
#
#       Desc:    TC_MAC_TDD_SPS_156
#                To verify adaptive retransmission of SPS data can be 
#                sent during DRX time.
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.156">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To verify adaptive retransmission of SPS data can be sent during 
           DRX time. UL SPS is activated.Send SPS LCG data on SPS occasions.                                                 
           Send CRC failure, and make sure that SPS resources are insufficient
           for retx. Expect a PDCCH for adaptive retx when no DRX related 
           timer is running."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="1" raWinSize="10"
         DLSPSMaxBw="40" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="5" prdBsrTmr="65535"
         isDrxEnabled="TRUE" drxOnDurTmr="5" drxInactvTmr="2"
         drxRetxTmr="16" longDrxCycle="80" isShortDrxPrsnt="TRUE"
         drxStartOffst="3" shortDrxCycle="20" drxShortCycleTmr="2" />
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect First SPS occasion at sf7 as twoIntervalCfg is enabled 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS occasion (sf 7)

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      # And adaptive retx PDCCH for SPS occasion eventhough UE is in DRX time
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="5" vldtGrant="TRUE" vldtRetx="TRUE"
               isUlGrant="TRUE" />
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect First retransmission of first SPS occasion at sf7 
      # and MSG3 recp req of second UE
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="2">
            <tapa.tfu.msg3.recp.req ueId="1"/>
            <tapa.tfu.pusch.recp.req use="5" vldtDatRecp="TRUE" saveTo="7"
               isRetx="TRUE" />
         </tapa.tfu.recp.req>   
      </tapa.expect>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.157
#
#       Desc:    TC_MAC_TDD_SPS_157
#                To verify SPS scheduling in DRX time on SPS occasion.   
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.157">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify SPS scheduling in DRX time on SPS occasion.
           1. UL SPS is activated.
           2. Identify SPS occasion which will fall in DRX time."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw = "40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" ULSPSTwoIntConf="TRUE" 
         maxUlHqTx="4" isDrxEnabled="TRUE" drxOnDurTmr="2" drxInactvTmr="2" 
         drxRetxTmr="16" longDrxCycle="80" isShortDrxPrsnt="TRUE" 
         shortDrxCycle="40" drxShortCycleTmr="2" drxStartOffst="16"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      
      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #PDCCH and PDSCH for FIRST BO and DCI0 for received SR
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
  
      #Expect SPS activation for subframe 2 in onDuration Timer
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="18"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7 eventhough UE is in 
      # DRX time
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.158
#
#       Desc:    TC_MAC_TDD_SPS_158
#                To verify SPS reactivation is not sent in DRX time.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.158">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify SPS reactivation is not sent in DRX time.
           1. SPS is activated for a UE.
           2. Send BSR > configured activated size so as to reactivate SPS 
              such that reactivation (next SPS occasion) falls when UE has 
              entered DRX time. "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" DLSPSMaxBw="40" raWinSize="10" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" SPSRnti="65" prdBsrTmr="65535"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" isDrxEnabled="TRUE" drxOnDurTmr="2" drxInactvTmr="1"
         drxRetxTmr="16" longDrxCycle="10" isShortDrxPrsnt="FALSE"
         drxStartOffst="4"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5"/>
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      # Expect data reception request 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect SPS activation for subframe 8
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 8
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="3" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="12"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf7
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf8
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" 
             addShortBsr="TRUE" lcgId="1" bsr="12"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            #Received BSR is scheduled dynamically instead of waiting for SPS occasion
            #in onduration 
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="2"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      <tapa.expset>
        #Expect Data reception for SPS occasion at sf8
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="3"
               vldtHarq="TRUE" expHarqProcId="3"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #UL SPS reactivation PDCCH is not received as UE is in DRX time
    
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        #Expect Data reception for SPS occasion at sf7
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      #UL SPS reactivation PDCCH can be scheduled here as UE will be ACTIVE
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.159
#
#       Desc:    TC_MAC_TDD_SPS_159
#                To verify DTX for SPS activation.
#
#       Notes:   None
#              
#       Module:  tdd.ulsps
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.159">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="tdd.ulsps"/>

      <tapa.desc>
         " To verify DTX for SPS activation."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2" prdBsrTmr="65535"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
    
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Configuring SPS DTCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="1"/>
      </tapa.send>

      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure SPS Logical Channel
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            instId="5" ulQci="1"/>
      </tapa.send>

      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="20" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation considering DTX

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect first retransmission of SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" isRetx="TRUE" vldtHarq="TRUE" expHarqProcId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>
     
      #Do not send CRC IND such that retx will happen for SPS activation considering DTX

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
     
      #SPS Activation PDCCH tramsitted again on nest SPS occasion (sf7)
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
     
      #Expecte Data reception at sf7 
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>
      
#
#
#       Test:    33.160
#
#       Desc:    TC_MAC_TDD_SPS_160
#                To verify the path when UE delete is sent: UE is in ToBeActvtdList.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.160">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify the path when UE delete is sent: UE is in ToBeActvtdList."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" 
               addShortBsr="TRUE" lcgId="1" bsr="15"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send a UE delete request
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="2" ueId="0"/>
      </tapa.send>
     
       # Expect Del Confirm from SCH
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 
      # No more reception request/reactivation is received for SPS on SPS occasion
      <tapa.send>
         <tapa.tfu.tti.ind numTti="20"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

###############################################################################
#
#       Test:    33.161
#
#       Desc:   " TC_MAC_TDD_SPS_161 To test re-transmission of DL SPS 
#                Release PDCCH on DTX"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.161" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test re-transmission of Release PDCCH only maxDlHqRetx times"
      </tapa.desc>

      <tapa.longdesc>
         "To test re-transmission of Release PDCCH only maxDlHqRetx times"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##


      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>


      # Do not send HQ Indication for Release PDCCH to consider DTX

### Retx 1 11,3
      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
###############################################################################
#
#       Test:    33.162
#
#       Desc:   " TC_MAC_TDD_SPS_162 To test basic DL SPS path for a UE(15) in TDD for multiple times"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.162" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Successful DL SPS path for a UE"
      </tapa.desc>

      <tapa.longdesc>
         "This is intended to check successful DL SPS path for a UE in TDD for multiple times."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"  txModeEnum="RGR_UE_TM_3" ULSPSEnFlag="FALSE"
            DLSPSEnFlag="TRUE" SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

<tapa.repeat.start repeatCount="12"/>
      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>


      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
  
      #### SPS OCCASTION END##





      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>


      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for Release PDCCH
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>
<tapa.repeat.end/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    33.163
#
#       Desc:    TC_MAC_TDD_SPS_163 
#                To verify UL SPS(TDD) activation to deactivation with 
#                two interval config true for multiple times in UL/DL Config 2
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc19.xml
#
#
<tapa.testcase id="33.163">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify basic UL SPS (TDD) with two interval config."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulDlCfgIdx="2"  DLSPSMaxBw="40"
         ulTotalBw="100" rntiSize="2" />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      
      <tapa.rg.UeInitTdd2 ULSPSTwoIntConf="FALSE" instId="5" ULSPSEnFlag="TRUE"
      DLSPSEnFlag="FALSE" SPSRnti="65" ULSPSSchIntrv="RGR_SPS_PRD_20SF"
      ULSPSPcktSize="80" ULSPSimpRls="2" prdBsrTmr="65535"/>

      # UE entry and config end
      <tapa.send>
         <tapa.tfu.ulcqi.ind>
            <tapa.tfu.ulcqi ueId="0" isWideBand="TRUE" wideCqi="12"/>
         </tapa.tfu.ulcqi.ind>
      </tapa.send>
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5"
            instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
 

      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>
<tapa.repeat.start repeatCount="03"/>
      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="20" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH and PDCCH for UL SPS activation
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="2">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
        #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         #old tapa.tfu.tti.ind numTti="4"/>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
	# Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>

      
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
   # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" dedBufIdx="0" 
               lcId="4" isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      #Nothing should be there, as there is no BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>
      #1st empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="13"/>
      </tapa.send>
      #2nd empty ocasion 
      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" 
               isSpsRnti="TRUE" />
         </tapa.tfu.dat.ind>
      </tapa.send>
      # Expect Data Indication at RLC
      #<tapa.expect>
      #   <tapa.rgu.ddatind lchTb1Data="4,1" vldtBuf="TRUE"/>
      #</tapa.expect>
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>
<tapa.repeat.end/>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

###############################################################################
#
#       Test:    33.164
#
#       Desc:   " To test re-transmission of Release PDCCH only maxDlHqRetx times
#                 DTX happened"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
################################################################################
<tapa.testcase id="33.164" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test re-transmission of Release PDCCH only maxDlHqRetx times DTX happened"
      </tapa.desc>

      <tapa.longdesc>
         "To test re-transmission of Release PDCCH only maxDlHqRetx times DTX happened"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="40" dlTotalBw="50" rntiSize="2"/>
  
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Send RaReqInd for one rapId in the first special frame 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send it in the 6th frequency index 
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first DL subframe after 3 Ttis.

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.rarsp.req raRnti="52"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="0"/>
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="0" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send BO for Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="0" lcId="4" lcType="3" />
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect Msg4 from MAC to PHY.
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req vldtNp="TRUE" np="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # Send ACK as feedback for Msg4.
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>
      </tapa.send>

      # Send UE config request
      <tapa.send>
         <tapa.crg.cfgreq.cfg.ue/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.ue instId="5" ULSPSEnFlag="FALSE" 
            ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL" DLSPSEnFlag="TRUE"
            SPSRnti="65" DLSPSSchIntrv="20" NumSPSProc="4"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #expect config Cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="7"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Ack for activation pdcch 
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #### SPS OCCASTION START##
      ###5,3
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      ####5,8
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      #### SPS OCCASTION END##
      
      ##Time 73
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 1
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service for SPS ocassion  
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect PDU from MAC to PHY. UeId to check spsRnti sent by MAC.
         # Use the activation PDCCH to validate the data size recieved
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      #### SPS OCCASTION END##

      ##Time 93
      #### SPS OCCASTION START##
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      ### DONT SEND BO UPD ZERO BO OCC 2
      # Send TTIs to expect status indication for SPS ocassion (prd = 30)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      #### SPS OCCASTION END##

      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

     # Do not send feedback suchthat it will be considered DTX

### Retx 1 11,3
      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Do not send feedback suchthat it will be considered DTX

### Retx 2 12,3
      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Do not send feedback suchthat it will be considered DTX

### Retx 3 13,3
      <tapa.send>
         # Send 1 Tti to get release PDCCH at PHY.
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect a release PDCCH over here
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validateSPS="TRUE" ueId="0"
               chkFrmt1aRelPdcch="TRUE" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Do not expect any status indication for SPS service before next SPS
      # ocassion.

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Do not send feedback suchthat it will be considered DTX

## Release pdcch should not be received
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.165
#
#       Desc:    
#                To verify ULSPS on re-establishment
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.165">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         " To verify deactivation of ULSPS on MAC reset and releases the 
           SPS resources."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

 # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit ulDlCfgIdx="1" raWinSize="10" DLSPSMaxBw = "30"
         startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd1 ULSPSEnFlag = "TRUE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         prdBsrTmr="65535" ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2" 
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2"/>
      <tapa.rg.dbgDeInitAll/>
      <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      
      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="4" lcType="5" dir="3"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>
      
      <tapa.send>
         # Create SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "4" lcgId = "1" dir = "3" 
            lcType = "5" />
      </tapa.send>
      
      # Configure SPS LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>
      
      # Send SR Indication for default UE
      <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
              vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="0" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      #SPS Data
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="16"/>
      </tapa.send>

      #Expect Data reception req of SPS occasion at sf3
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      #SPS Data together with new BSR for SPS LCG
      <tapa.send>
         <tapa.tfu.dat.ind datInds="1">
            <tapa.tfu.dat  ueId="0" use="2" isSpsRnti="TRUE" lcId="4" />
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="4,1" vldtBuf="TRUE"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

#### UE RESET HERE 
      # Send UE Reset Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Reset Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset instId="5"  cellId="3" ueId="0"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      #No Data reception request should be expected for UL SPS
      <tapa.send>
         <tapa.tfu.tti.ind numTti="42"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRntis="1">
            <tapa.tfu.rareq raRnti="52" numRapId="1" rapIds="5" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>
      
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="52"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      # message 3 reception request afetr Ra Rsp
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" spId="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>
   
   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>
   
      # Send Message3 after receiving Message3 reception req.
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>      
      </tapa.send>   
      
      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

    # Send BO for Msg4 on RGU.
    <tapa.send>
       <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" ueId="1"/>
    </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect CStatInd For MSG4
   <tapa.expset>
      <tapa.rgu.cstaind lcId="4" ueId="1"/>
   </tapa.expset>

   # Send Msg4 on RGU.
   <tapa.send>
      <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect Msg4 from MAC to PHY.
   <tapa.expset>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req use="1" validate="FALSE" ueId="1"/>
     </tapa.tfu.dat.req>
     <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
        <tapa.tfu.pdcch.cntrl.req saveTo="1" ueId="1"/>
     </tapa.tfu.cntrl.req>
   </tapa.expset>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="7"/>
   </tapa.send>

   # Recv Hq Recp Req for Msg4.
   <tapa.expect>
     <tapa.tfu.recp.req expRecpReq="1" spId="1">
        <tapa.tfu.hq.recp.req vldtNp="FALSE" ueId="1"/>
     </tapa.tfu.recp.req>
   </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3" />
   </tapa.send>

   # Send ACK as feedback for Msg4.
   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="1" isAck="TRUE"/>
     </tapa.tfu.hq.ind>
  </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0"
            newUeId="1" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      # Send UE ReConfiguration for the same UE created above for change in RNTI
       <tapa.send>
            <tapa.crg.cfgreq.recfg.ue cellId="3" oldUeId="0" newUeId="1"
              UeReCfgType="64"/>
       </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
       <tapa.expect>
            <tapa.crg.cfgcfm/>
       </tapa.expect>

     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect DCI format 0
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" ueId="1" vldtDatRecp="TRUE" saveTo="3"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      #Send CRC for PUSCH
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
     
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  ueId="1" addShortBsr="TRUE" lcgId="1" bsr="10" />
       </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Expect SPS activation for subframe 2
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #Expect data reception request of SPS activation for subframe 2
      <tapa.expset>
         <tapa.tfu.recp.req expRecpReq="1">
            <tapa.tfu.pusch.recp.req use="1" ueId="1" vldtDatRecp="TRUE" saveTo="2"
               isSpsRnti="TRUE" vldtHarq="TRUE" expHarqProcId="2" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    33.166
#
#       Desc:    To verify the collision of retx of non-SPS UE and activation 
#                of SPS UE in UL
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc33.xml
#
#
<tapa.testcase id="33.166">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify the collision of retx of non-SPS UE and activation i
          of SPS UE in UL"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit.dlSched ulDlCfgIdx="2" raWinSize="10" DLSPSMaxBw="40"
       maxUePerUlSf="1" maxUlUeNewTxPerTti="1" startRnti="70" rntiSize="10"/>
      # UE Configuration
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "TRUE" SPSRnti="65"
         ULSPSSchIntrv="RGR_SPS_PRD_20SF" ULSPSimpRls="RGR_SPS_E2"
         ULSPSTwoIntConf="TRUE" maxUlHqTx="2" prdBsrTmr="65535"  
         isDrxEnabled="TRUE"
         drxOnDurTmr="2"
         drxInactvTmr="2"
         drxRetxTmr="4"
         longDrxCycle="20"
         isShortDrxPrsnt="FALSE"
         drxStartOffst="18"/>

      #Initialize another UE
      <tapa.rg.UeInitTdd2 ueId="1" maxUlHqTx="2" prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # Configure bi-directional DCCH for default UE for 1st UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
            ueId="0"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE for 2nd UE
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="4" lcgId="1" dir="3" lcType="5" 
               ueId="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" dir="3" lcType="5" instId="5" ueId="0"/>
      </tapa.send>

      # Configure DL LC on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="4" dir="3" lcType="5" instId="5" ueId="1"/>
      </tapa.send>

      # Configure UL LCG on RGR for 1st UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" ueId="0"/>
      </tapa.send>

      # Configure UL LCG on RGR for 2nd UE
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="1" instId="5" ueId="1"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI for 1st UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Expect configuration confirm after the TTI for 2nd UE
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr ueId="1"/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI(s) to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ueId="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3" ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send CRC for Msg for SPS UE
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.dat.ind datInds="2">
            <tapa.tfu.dat  ueId="0"
               addShortBsr="TRUE" lcgId="1" bsr="5" use="2"/>
         </tapa.tfu.dat.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH 
      # DRX was configured such that UL SPS activation is not scheduled here
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="0"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>

      #NACK for second UE as the CRC SUCCESS is not recieved
      #Activation PDCCH cannot be scheduled as allocs are limited
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="FALSE" ueId="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="3" ueId="1" isRetx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.phich.cntrl.req isAck="TRUE" ueId="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>

      #Expect SPS activation received now
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1"
               isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" ULSPSInit="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

   </tapa.test>
   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>
</tapa.testcase>

#
#       Test:    33.167
#
#       Desc:   " To verify the scheduling of SPS and non SPS UEs when the
#                 entire BW is available for SPS"
#
#       Notes:   None
#              
#       Module:  "Semi Persistant Scheduling Module"
#
#       File:    rgac_tc33.xml
#
<tapa.testcase id="33.167" >

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To verify the scheduling of SPS and non SPS UEs when the entire 
          bandwidth is available for SPS"
      </tapa.desc>

      <tapa.longdesc>
         "To verify the scheduling of SPS and non SPS UEs when the entire
          bandwidth is available for SPS"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numTxAntPorts="2" ulDlCfgIdx="2"  DLSPSMaxBw="50" 
         dlTotalBw="50" rntiSize="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>
  
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" 
         SPSRnti="65" prdBsrTmr="65535" DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" 
         NumSPSProc="4"/>
      <tapa.rg.UeInitTdd2 ULSPSEnFlag = "FALSE" DLSPSEnFlag = "FALSE" ueId="1" />
    #<tapa.rg.dbgDeInitAll/>
    <tapa.rg.dbgInitAll/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      <tapa.send>
         # Configure a dedicated SPS logical channel for the created UE  
         # lcType=5 for DCCH (cm_lte.h) at MAC
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch ueId="1" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.crg.cfgcfm status="0"/>
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expset>

      <tapa.send>
         # Create DL SPS service for the UE at scheduler
         <tapa.rgr.cfgreq.cfg.lch ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
            DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="32"
            DLSPSLchExpltRelCnt="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId = "1" lcId = "3" lcgId = "0" dir = "3" lcType = "5" />
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      #expect config Cfm
      <tapa.expset>
         <tapa.rgr.cfgCfm status = "0"/>
         <tapa.rgr.cfgCfm status = "0"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi ueId="0" cqiIdx="8" />
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

      ###First BO scheduled dynamically
      <tapa.send>
         # Send BO for the created SPS service on RGU 
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="20"/>
      </tapa.send>

      <tapa.send>
         # Send two TTIs (and not one due to TDD) to get the
         # transmission scheduled
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      ##First BO Dynamic Sched
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="FALSE" DLSPSInit="FALSE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
         </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send BO for the created SPS service on RGU again
         <tapa.rgu.dstarsp lcId="3" lcType="5" bo="21"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created non-SPS UE on RGU again
         <tapa.rgu.dstarsp ueId="1" lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         # Expect staInd from MAC to RLC for SPS service 
         <tapa.rgu.dstaind lchTb1Data="3" saveTo="2"/>
      </tapa.expset>

      <tapa.send>
         # Send data with size equal to the allocated size on RGU. 
         <tapa.rgu.ddatreq ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send lc="TRUE">
         <tapa.rgu.cstarsp lcId="4" lcType="3" bo="10" /> 
      </tapa.send>

      <tapa.send>
         # Send 1 Tti to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>



      ##DL SPS Activation PDCCH
      <tapa.expset>
         <tapa.rgu.cstaind lcId="4" />
        <tapa.rgu.dstaind ueId="1" lchTb1Data="3"  saveTo="2"/>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
               validateSPS ="TRUE" DLSPSInit="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#
#
# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend
#/********************************************************************30**
#
#         End of file:     rgac_tc33.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#*********************************************************************31*/
#/**********************************************************************
#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#/main/1      ---     sm   1. Initial Release.
#$SID$         ---     sm   1. Initial Release.
#             rg004.201 rnt  1. Modified for SI Enhancement
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$        rg001.301   nudupi   1.Changes for the CR ccpu00118643. 
#$SID$        rg002.301  asehgal 1.Changes for ccpu00109543,ccpu00119953
#$SID$                           2.Changes for the CR ccpu001120264 and ccpu00119494.
#$SID$                           3.ccpu00120969: added dependancy for RGR_V2
#$SID$        rg003.301  ap      1.Added TDD configuration 1 test cases.
#$SID$        ---     rt  	 1.LTE MAC 4.1 Release
#*********************************************************************91*/
